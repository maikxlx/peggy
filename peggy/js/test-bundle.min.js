// peggy 4.0.2
//
// https://peggyjs.org/
//
// Copyright (c) 2024- the Peggy authors
// Licensed under the MIT License.

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("chai"),require("whatwg-url")):"function"==typeof define&&define.amd?define(["chai","whatwg-url"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).chai,e.whatwgURL)}(this,(function(require$$0,require$$0$1){var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},GrammarLocation$5=function(){function e(e,t){this.source=e,this.start=t}return e.prototype.toString=function(){return String(this.source)},e.prototype.offset=function(e){return{line:e.line+this.start.line-1,column:1===e.line?e.column+this.start.column-1:e.column,offset:e.offset+this.start.offset}},e.offsetStart=function(e){return e.source&&"function"==typeof e.source.offset?e.source.offset(e.start):e.start},e.offsetEnd=function(e){return e.source&&"function"==typeof e.source.offset?e.source.offset(e.end):e.end},e}(),grammarLocation=GrammarLocation$5,__extends=commonjsGlobal&&commonjsGlobal.__extends||(extendStatics=function(e,t){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},extendStatics(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),extendStatics,GrammarLocation$4=grammarLocation,setProtoOf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},GrammarError$5=function(e){function t(r,a,n){var o=e.call(this,r)||this;return setProtoOf(o,t.prototype),o.name="GrammarError",o.location=a,void 0===n&&(n=[]),o.diagnostics=n,o.stage=null,o.problems=[["error",r,a,n]],o}return __extends(t,e),t.prototype.toString=function(){var t=e.prototype.toString.call(this);this.location&&(t+="\n at ",void 0!==this.location.source&&null!==this.location.source&&(t+="".concat(this.location.source,":")),t+="".concat(this.location.start.line,":").concat(this.location.start.column));for(var r=0,a=this.diagnostics;r<a.length;r++){var n=a[r];t+="\n from ",void 0!==n.location.source&&null!==n.location.source&&(t+="".concat(n.location.source,":")),t+="".concat(n.location.start.line,":").concat(n.location.start.column,": ").concat(n.message)}return t},t.prototype.format=function(e){var t=e.map((function(e){var t=e.source,r=e.text;return{source:t,text:null!=r?String(r).split(/\r\n|\n|\r/g):[]}}));function r(e,r,a){void 0===a&&(a="");var n="",o=t.find((function(t){return t.source===e.source})),s=e.start,i=GrammarLocation$4.offsetStart(e);if(o){var c=e.end,u=o.text[s.line-1],p=(s.line===c.line?c.column:u.length+1)-s.column||1;a&&(n+="\nnote: ".concat(a)),n+="\n --\x3e ".concat(e.source,":").concat(i.line,":").concat(i.column,"\n").concat("".padEnd(r)," |\n").concat(i.line.toString().padStart(r)," | ").concat(u,"\n").concat("".padEnd(r)," | ").concat("".padEnd(s.column-1)).concat("".padEnd(p,"^"))}else n+="\n at ".concat(e.source,":").concat(i.line,":").concat(i.column),a&&(n+=": ".concat(a));return n}function a(e,t,a,n){void 0===n&&(n=[]);var o=-1/0;o=a?n.reduce((function(e,t){var r=t.location;return Math.max(e,GrammarLocation$4.offsetStart(r).line)}),a.start.line):Math.max.apply(null,n.map((function(e){return e.location.start.line}))),o=o.toString().length;var s="".concat(e,": ").concat(t);a&&(s+=r(a,o));for(var i=0,c=n;i<c.length;i++){var u=c[i];s+=r(u.location,o,u.message)}return s}return this.problems.filter((function(e){return"info"!==e[0]})).map((function(e){return a.apply(void 0,e)})).join("\n\n")},t}(Error),grammarError=GrammarError$5,__spreadArray$6=commonjsGlobal&&commonjsGlobal.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var a,n=0,o=t.length;n<o;n++)!a&&n in t||(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))},visitor$d={build:function(e){function t(t){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];return e[t.type].apply(e,__spreadArray$6([t],r,!1))}function r(){}function a(e){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];return t.apply(void 0,__spreadArray$6([e.expression],r,!1))}function n(e){return function(r){for(var a=[],n=1;n<arguments.length;n++)a[n-1]=arguments[n];r[e].forEach((function(e){return t.apply(void 0,__spreadArray$6([e],a,!1))}))}}var o={grammar:function(e){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];for(var n=0,o=e.imports;n<o.length;n++){var s=o[n];t.apply(void 0,__spreadArray$6([s],r,!1))}if(e.topLevelInitializer)if(Array.isArray(e.topLevelInitializer))for(var i=0,c=e.topLevelInitializer;i<c.length;i++){var u=c[i];t.apply(void 0,__spreadArray$6([u],r,!1))}else t.apply(void 0,__spreadArray$6([e.topLevelInitializer],r,!1));if(e.initializer)if(Array.isArray(e.initializer))for(var p=0,l=e.initializer;p<l.length;p++){var f=l[p];t.apply(void 0,__spreadArray$6([f],r,!1))}else t.apply(void 0,__spreadArray$6([e.initializer],r,!1));e.rules.forEach((function(e){return t.apply(void 0,__spreadArray$6([e],r,!1))}))},grammar_import:r,top_level_initializer:r,initializer:r,rule:a,named:a,choice:n("alternatives"),action:a,sequence:n("elements"),labeled:a,text:a,simple_and:a,simple_not:a,optional:a,zero_or_more:a,one_or_more:a,repeated:function(e){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];return e.delimiter&&t.apply(void 0,__spreadArray$6([e.delimiter],r,!1)),t.apply(void 0,__spreadArray$6([e.expression],r,!1))},group:a,semantic_and:r,semantic_not:r,rule_ref:r,library_ref:r,literal:r,class:r,any:r};return Object.keys(o).forEach((function(t){Object.prototype.hasOwnProperty.call(e,t)||(e[t]=o[t])})),t}},visitor_1=visitor$d,visitor$c=visitor_1;function combinePossibleArrays(e,t){if(!e||!t)return e||t;var r=Array.isArray(e)?e:[e];return r.push(t),r}var asts$8={findRule:function(e,t){for(var r=0;r<e.rules.length;r++)if(e.rules[r].name===t)return e.rules[r]},indexOfRule:function(e,t){for(var r=0;r<e.rules.length;r++)if(e.rules[r].name===t)return r;return-1},alwaysConsumesOnSuccess:function(e,t){function r(){return!0}function a(){return!1}var n=visitor$c.build({choice:function(e){return e.alternatives.every(n)},sequence:function(e){return e.elements.some(n)},simple_and:a,simple_not:a,optional:a,zero_or_more:a,repeated:function(e){var t=e.min?e.min:e.max;return!("constant"!==t.type||0===t.value||!n(e.expression)&&!(t.value>1&&e.delimiter&&n(e.delimiter)))},semantic_and:a,semantic_not:a,rule_ref:function(t){var r=asts$8.findRule(e,t.name);return r?n(r):void 0},library_ref:function(){return!1},literal:function(e){return""!==e.value},class:r,any:r});return n(t)},combine:function(e){return e.reduce((function(e,t){return e.topLevelInitializer=combinePossibleArrays(e.topLevelInitializer,t.topLevelInitializer),e.initializer=combinePossibleArrays(e.initializer,t.initializer),e.rules=e.rules.concat(t.rules),e}))}},asts_1=asts$8;function addImportedRules$1(e){for(var t=0,r=0,a=e.imports;r<a.length;r++){for(var n=a[r],o=0,s=n.what;o<s.length;o++){var i=s[o],c=void 0;switch(i.type){case"import_binding_all":continue;case"import_binding_default":break;case"import_binding":c=i.binding;break;case"import_binding_rename":c=i.rename;break;default:throw new TypeError("Unknown binding type")}e.rules.push({type:"rule",name:i.binding,nameLocation:i.location,expression:{type:"library_ref",name:c,library:n.from.module,libraryNumber:t,location:i.location},location:n.from.location})}t++}}var addImportedRules_1=addImportedRules$1,visitor$b=visitor_1;function findLibraryNumber(e,t){for(var r=0,a=0,n=e.imports;a<n.length;a++){for(var o=0,s=n[a].what;o<s.length;o++){var i=s[o];if("import_binding_all"===i.type&&i.binding===t)return r}r++}return-1}function fixLibraryNumbers$1(e,t,r){visitor$b.build({library_ref:function(t){-1===t.libraryNumber&&(t.libraryNumber=findLibraryNumber(e,t.library),-1===t.libraryNumber&&r.error('Unknown module "'.concat(t.library,'"'),t.location))}})(e)}var fixLibraryNumbers_1=fixLibraryNumbers$1,opcodes={PUSH:0,PUSH_EMPTY_STRING:35,PUSH_UNDEFINED:1,PUSH_NULL:2,PUSH_FAILED:3,PUSH_EMPTY_ARRAY:4,PUSH_CURR_POS:5,POP:6,POP_CURR_POS:7,POP_N:8,NIP:9,APPEND:10,WRAP:11,TEXT:12,PLUCK:36,IF:13,IF_ERROR:14,IF_NOT_ERROR:15,IF_LT:30,IF_GE:31,IF_LT_DYNAMIC:32,IF_GE_DYNAMIC:33,WHILE_NOT_ERROR:16,MATCH_ANY:17,MATCH_STRING:18,MATCH_STRING_IC:19,MATCH_CHAR_CLASS:20,MATCH_REGEXP:20,ACCEPT_N:21,ACCEPT_STRING:22,FAIL:23,LOAD_SAVED_POS:24,UPDATE_SAVED_POS:25,CALL:26,RULE:27,LIBRARY_RULE:41,SILENT_FAILS_ON:28,SILENT_FAILS_OFF:29,SOURCE_MAP_PUSH:37,SOURCE_MAP_POP:38,SOURCE_MAP_LABEL_PUSH:39,SOURCE_MAP_LABEL_POP:40},opcodes_1=opcodes,__assign$2=commonjsGlobal&&commonjsGlobal.__assign||function(){return __assign$2=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},__assign$2.apply(this,arguments)},Intern$2=function(){function e(e){this.options=__assign$2({stringify:String,convert:function(e){return e}},e),this.items=[],this.offsets={}}return e.prototype.add=function(e){var t=this.options.convert(e);if(!t)return-1;var r=this.options.stringify(t),a=this.offsets[r];return void 0===a&&(a=this.items.push(t)-1,this.offsets[r]=a),a},e.prototype.get=function(e){return this.items[e]},e.prototype.map=function(e){return this.items.map(e)},e}(),intern=Intern$2,visitor$a=visitor_1,asts$7=asts_1,GrammarError$4=grammarError,ALWAYS_MATCH$1=1,SOMETIMES_MATCH$1=0,NEVER_MATCH$1=-1;function inferenceMatchResult$1(e){function t(e){return e.match=SOMETIMES_MATCH$1}function r(e){return o(e.expression),e.match=ALWAYS_MATCH$1}function a(e){return e.match=o(e.expression)}function n(e,t){for(var r=e.length,a=0,n=0,s=0;s<r;++s){var i=o(e[s]);i===ALWAYS_MATCH$1&&++a,i===NEVER_MATCH$1&&++n}return a===r?ALWAYS_MATCH$1:t?n===r?NEVER_MATCH$1:SOMETIMES_MATCH$1:n>0?NEVER_MATCH$1:SOMETIMES_MATCH$1}var o=visitor$a.build({rule:function(e){var t=void 0,r=0;if(void 0===e.match){e.match=SOMETIMES_MATCH$1;do{if(t=e.match,e.match=o(e.expression),++r>6)throw new GrammarError$4("Infinity cycle detected when trying to evaluate node match result",e.location)}while(t!==e.match)}return e.match},named:a,choice:function(e){return e.match=n(e.alternatives,!0)},action:a,sequence:function(e){return e.match=n(e.elements,!1)},labeled:a,text:a,simple_and:a,simple_not:function(e){return e.match=-o(e.expression)},optional:r,zero_or_more:r,one_or_more:a,repeated:function(e){var t=o(e.expression),r=e.delimiter?o(e.delimiter):NEVER_MATCH$1,a=e.min?e.min:e.max;return"constant"!==a.type||"constant"!==e.max.type?e.match=SOMETIMES_MATCH$1:0===e.max.value||null!==e.max.value&&a.value>e.max.value?e.match=NEVER_MATCH$1:t===NEVER_MATCH$1?e.match=0===a.value?ALWAYS_MATCH$1:NEVER_MATCH$1:t===ALWAYS_MATCH$1?e.delimiter&&a.value>=2?e.match=r:e.match=ALWAYS_MATCH$1:e.delimiter&&a.value>=2?e.match=r===NEVER_MATCH$1?NEVER_MATCH$1:SOMETIMES_MATCH$1:e.match=0===a.value?ALWAYS_MATCH$1:SOMETIMES_MATCH$1},group:a,semantic_and:t,semantic_not:t,rule_ref:function(t){var r=asts$7.findRule(e,t.name);return r?t.match=o(r):SOMETIMES_MATCH$1},library_ref:function(){return 0},literal:function(e){var t=0===e.value.length?ALWAYS_MATCH$1:SOMETIMES_MATCH$1;return e.match=t},class:function(e){var t=0===e.parts.length?NEVER_MATCH$1:SOMETIMES_MATCH$1;return e.match=t},any:t});o(e)}inferenceMatchResult$1.ALWAYS_MATCH=ALWAYS_MATCH$1,inferenceMatchResult$1.SOMETIMES_MATCH=SOMETIMES_MATCH$1,inferenceMatchResult$1.NEVER_MATCH=NEVER_MATCH$1;var inferenceMatchResult_1=inferenceMatchResult$1,__spreadArray$5=commonjsGlobal&&commonjsGlobal.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var a,n=0,o=t.length;n<o;n++)!a&&n in t||(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))},asts$6=asts_1,op$2=opcodes_1,visitor$9=visitor_1,Intern$1=intern,_a$4=inferenceMatchResult_1,ALWAYS_MATCH=_a$4.ALWAYS_MATCH,SOMETIMES_MATCH=_a$4.SOMETIMES_MATCH,NEVER_MATCH=_a$4.NEVER_MATCH;function generateBytecode$1(e,t){var r=new Intern$1,a=new Intern$1({stringify:JSON.stringify,convert:function(e){return{value:e.parts,inverted:e.inverted,ignoreCase:e.ignoreCase}}}),n=new Intern$1({stringify:JSON.stringify}),o=new Intern$1,s=[],i=[];function c(e,t,r){var a={predicate:e,params:t,body:r.code,location:r.codeLocation},n=JSON.stringify(a),o=s.findIndex((function(e){return JSON.stringify(e)===n}));return-1===o?s.push(a)-1:o}function u(e){return i.push(e)-1}function p(e){var t={};return Object.keys(e).forEach((function(r){t[r]=e[r]})),t}function l(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return e.concat.apply(e,t)}function f(e,t,r,a){return e===ALWAYS_MATCH?r:e===NEVER_MATCH?a:t.concat([r.length,a.length],r,a)}function d(e,t,r,a){var n=Object.keys(r).map((function(e){return a-r[e]}));return[op$2.CALL,e,t,n.length].concat(n)}function m(e,t,r){var a=e.match||0;return l([op$2.PUSH_CURR_POS],[op$2.SILENT_FAILS_ON],v(e,{sp:r.sp+1,env:p(r.env),action:null}),[op$2.SILENT_FAILS_OFF],f(t?-a:a,[t?op$2.IF_ERROR:op$2.IF_NOT_ERROR],l([op$2.POP],[t?op$2.POP:op$2.POP_CURR_POS],[op$2.PUSH_UNDEFINED]),l([op$2.POP],[t?op$2.POP_CURR_POS:op$2.POP],[op$2.PUSH_FAILED])))}function g(e,t,r){var a=c(!0,Object.keys(r.env),e);return l([op$2.UPDATE_SAVED_POS],d(a,0,r.env,r.sp),f(e.match||0,[op$2.IF],l([op$2.POP],t?[op$2.PUSH_FAILED]:[op$2.PUSH_UNDEFINED]),l([op$2.POP],t?[op$2.PUSH_UNDEFINED]:[op$2.PUSH_FAILED])))}function $(e){return t=[op$2.WHILE_NOT_ERROR],r=l([op$2.APPEND],e),t.concat([r.length],r);var t,r}function h(e,t,r,a){switch(e.type){case"constant":return{pre:[],post:[],sp:r};case"variable":return e.sp=a+r-t[e.value],{pre:[],post:[],sp:r};case"function":return e.sp=a,{pre:d(c(!0,Object.keys(t),{code:e.value,codeLocation:e.codeLocation}),0,t,r),post:[op$2.NIP],sp:r+1};default:throw function(e){return new Error('Unknown boundary type "'.concat(e.type,'" for the "repeated" node'))}(e)}}function x(e,t){if(null!==t.value){var r="constant"===t.type?[op$2.IF_GE,t.value]:[op$2.IF_GE_DYNAMIC,t.sp||0];return f(SOMETIMES_MATCH,r,[op$2.PUSH_FAILED],e)}return e}var b,v=(b={grammar:function(e){e.rules.forEach(v),e.literals=r.items,e.classes=a.items,e.expectations=n.items,e.importedNames=o.items,e.functions=s,e.locations=i},rule:function(e){e.bytecode=v(e.expression,{sp:-1,env:{},pluck:[],action:null})},named:function(e,t){var r=e.match||0,a=r===NEVER_MATCH?-1:n.add({type:"rule",value:e.name});return l([op$2.SILENT_FAILS_ON],v(e.expression,t),[op$2.SILENT_FAILS_OFF],f(r,[op$2.IF_ERROR],[op$2.FAIL,a],[]))},choice:function(e,t){return function e(t,r){var a=t[0].match||0,n=v(t[0],{sp:r.sp,env:p(r.env),action:null});return a===ALWAYS_MATCH?n:l(n,t.length>1?f(SOMETIMES_MATCH,[op$2.IF_ERROR],l([op$2.POP],e(t.slice(1),r)),[]):[])}(e.alternatives,t)},action:function(e,t){var r=p(t.env),a="sequence"!==e.expression.type||0===e.expression.elements.length,n=v(e.expression,{sp:t.sp+(a?1:0),env:r,action:e}),o=e.expression.match||0,s=a&&o!==NEVER_MATCH?c(!1,Object.keys(r),e):-1;return a?l([op$2.PUSH_CURR_POS],n,f(o,[op$2.IF_NOT_ERROR],l([op$2.LOAD_SAVED_POS,1],d(s,1,r,t.sp+2)),[]),[op$2.NIP]):n},sequence:function(e,t){return l([op$2.PUSH_CURR_POS],function t(r,a){if(r.length>0){var n=e.elements.length-r.length+1;return l(v(r[0],{sp:a.sp,env:a.env,pluck:a.pluck,action:null}),f(r[0].match||0,[op$2.IF_NOT_ERROR],t(r.slice(1),{sp:a.sp+1,env:a.env,pluck:a.pluck,action:a.action}),l(n>1?[op$2.POP_N,n]:[op$2.POP],[op$2.POP_CURR_POS],[op$2.PUSH_FAILED])))}if(a.pluck&&a.pluck.length>0)return l([op$2.PLUCK,e.elements.length+1,a.pluck.length],a.pluck.map((function(e){return a.sp-e})));if(a.action){var o=c(!1,Object.keys(a.env),a.action);return l([op$2.LOAD_SAVED_POS,e.elements.length],d(o,e.elements.length+1,a.env,a.sp))}return l([op$2.WRAP,e.elements.length],[op$2.NIP])}(e.elements,{sp:t.sp+1,env:t.env,pluck:[],action:t.action}))},labeled:function(e,a){var n=a.env,o=e.label,s=a.sp+1;o&&(n=p(a.env),a.env[o]=s),e.pick&&a.pluck.push(s);var i=v(e.expression,{sp:a.sp,env:n,action:null});return o&&e.labelLocation&&t&&"source-and-map"===t.output?l([op$2.SOURCE_MAP_LABEL_PUSH,s,r.add(o),u(e.labelLocation)],i,[op$2.SOURCE_MAP_LABEL_POP,s]):i},text:function(e,t){return l([op$2.PUSH_CURR_POS],v(e.expression,{sp:t.sp+1,env:p(t.env),action:null}),f(e.match||0,[op$2.IF_NOT_ERROR],l([op$2.POP],[op$2.TEXT]),[op$2.NIP]))},simple_and:function(e,t){return m(e.expression,!1,t)},simple_not:function(e,t){return m(e.expression,!0,t)},optional:function(e,t){return l(v(e.expression,{sp:t.sp,env:p(t.env),action:null}),f(-(e.expression.match||0),[op$2.IF_ERROR],l([op$2.POP],[op$2.PUSH_NULL]),[]))},zero_or_more:function(e,t){var r=v(e.expression,{sp:t.sp+1,env:p(t.env),action:null});return l([op$2.PUSH_EMPTY_ARRAY],r,$(r),[op$2.POP])},one_or_more:function(e,t){var r=v(e.expression,{sp:t.sp+1,env:p(t.env),action:null});return l([op$2.PUSH_EMPTY_ARRAY],r,f(e.expression.match||0,[op$2.IF_NOT_ERROR],l($(r),[op$2.POP]),l([op$2.POP],[op$2.POP],[op$2.PUSH_FAILED])))},repeated:function(e,t){var r=e.min?e.min:e.max,a="constant"!==r.type||r.value>0,n="constant"!==e.max.type&&null!==e.max.value,o=a?2:1,s=e.min?h(e.min,t.env,t.sp,2+("function"===e.max.type?1:0)):{pre:[],post:[],sp:t.sp},i=h(e.max,t.env,s.sp,o),c=v(e.expression,{sp:i.sp+o,env:p(t.env),action:null}),u=null!==e.delimiter?v(e.expression,{sp:i.sp+o+1,env:p(t.env),action:null}):c,d=function(e,t,r,a,n){return e?l([op$2.PUSH_CURR_POS],v(e,{sp:a.sp+n+1,env:p(a.env),action:null}),f(e.match||0,[op$2.IF_NOT_ERROR],l([op$2.POP],r,f(-t,[op$2.IF_ERROR],[op$2.POP,op$2.POP_CURR_POS,op$2.PUSH_FAILED],[op$2.NIP])),[op$2.NIP])):r}(e.delimiter,e.expression.match||0,u,t,o),m=x(d,e.max),g=n?x(c,e.max):c,b=l(a?[op$2.PUSH_CURR_POS]:[],[op$2.PUSH_EMPTY_ARRAY],g,$(m),[op$2.POP]);return l(s.pre,i.pre,a?function(e,t){var r="constant"===t.type?[op$2.IF_LT,t.value]:[op$2.IF_LT_DYNAMIC,t.sp||0];return l(e,f(SOMETIMES_MATCH,r,[op$2.POP,op$2.POP_CURR_POS,op$2.PUSH_FAILED],[op$2.NIP]))}(b,r):b,i.post,s.post)},group:function(e,t){return v(e.expression,{sp:t.sp,env:p(t.env),action:null})},semantic_and:function(e,t){return g(e,!1,t)},semantic_not:function(e,t){return g(e,!0,t)},rule_ref:function(t){return[op$2.RULE,asts$6.indexOfRule(e,t.name)]},library_ref:function(e){return[op$2.LIBRARY_RULE,e.libraryNumber,o.add(e.name)]},literal:function(e){if(e.value.length>0){var t=e.match||0,a=t===SOMETIMES_MATCH||t===ALWAYS_MATCH&&!e.ignoreCase?r.add(e.ignoreCase?e.value.toLowerCase():e.value):-1,o=t!==ALWAYS_MATCH?n.add({type:"literal",value:e.value,ignoreCase:e.ignoreCase}):-1;return f(t,e.ignoreCase?[op$2.MATCH_STRING_IC,a]:[op$2.MATCH_STRING,a],e.ignoreCase?[op$2.ACCEPT_N,e.value.length]:[op$2.ACCEPT_STRING,a],[op$2.FAIL,o])}return[op$2.PUSH_EMPTY_STRING]},class:function(e){var t=e.match||0,r=t===SOMETIMES_MATCH?a.add(e):-1,o=t!==ALWAYS_MATCH?n.add({type:"class",value:e.parts,inverted:e.inverted,ignoreCase:e.ignoreCase}):-1;return f(t,[op$2.MATCH_CHAR_CLASS,r],[op$2.ACCEPT_N,1],[op$2.FAIL,o])},any:function(e){var t=e.match||0,r=t!==ALWAYS_MATCH?n.add({type:"any"}):-1;return f(t,[op$2.MATCH_ANY],[op$2.ACCEPT_N,1],[op$2.FAIL,r])}},t&&"source-and-map"===t.output&&Object.keys(b).forEach((function(e){var t=b[e];b[e]=function(e){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];var n=t.apply(void 0,__spreadArray$5([e],r,!1));return void 0!==n&&e.location?l([op$2.SOURCE_MAP_PUSH,u(e.location)],n,[op$2.SOURCE_MAP_POP]):n}})),visitor$9.build(b));v(e)}var generateBytecode_1=generateBytecode$1,sourceMap$1={},sourceMapGenerator$1={},base64Vlq$1={},base64$6={};const intToCharMap$1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");base64$6.encode=function(e){if(0<=e&&e<intToCharMap$1.length)return intToCharMap$1[e];throw new TypeError("Must be between 0 and 63: "+e)};const base64$5=base64$6,VLQ_BASE_SHIFT$1=5,VLQ_BASE$1=1<<VLQ_BASE_SHIFT$1,VLQ_BASE_MASK$1=VLQ_BASE$1-1,VLQ_CONTINUATION_BIT$1=VLQ_BASE$1;function toVLQSigned$1(e){return e<0?1+(-e<<1):0+(e<<1)}base64Vlq$1.encode=function(e){let t,r="",a=toVLQSigned$1(e);do{t=a&VLQ_BASE_MASK$1,a>>>=VLQ_BASE_SHIFT$1,a>0&&(t|=VLQ_CONTINUATION_BIT$1),r+=base64$5.encode(t)}while(a>0);return r};var util$8={};function getArg$1(e,t,r){if(t in e)return e[t];if(3===arguments.length)return r;throw new Error('"'+t+'" is a required argument.')}util$8.getArg=getArg$1;const supportsNullProto$1=!("__proto__"in Object.create(null));function identity$1(e){return e}function toSetString$1(e){return isProtoString$1(e)?"$"+e:e}function fromSetString$1(e){return isProtoString$1(e)?e.slice(1):e}function isProtoString$1(e){if(!e)return!1;const t=e.length;if(t<9)return!1;if(95!==e.charCodeAt(t-1)||95!==e.charCodeAt(t-2)||111!==e.charCodeAt(t-3)||116!==e.charCodeAt(t-4)||111!==e.charCodeAt(t-5)||114!==e.charCodeAt(t-6)||112!==e.charCodeAt(t-7)||95!==e.charCodeAt(t-8)||95!==e.charCodeAt(t-9))return!1;for(let r=t-10;r>=0;r--)if(36!==e.charCodeAt(r))return!1;return!0}function strcmp$1(e,t){return e===t?0:null===e?1:null===t?-1:e>t?1:-1}function compareByGeneratedPositionsInflated$1(e,t){let r=e.generatedLine-t.generatedLine;return 0!==r?r:(r=e.generatedColumn-t.generatedColumn,0!==r?r:(r=strcmp$1(e.source,t.source),0!==r?r:(r=e.originalLine-t.originalLine,0!==r?r:(r=e.originalColumn-t.originalColumn,0!==r?r:strcmp$1(e.name,t.name)))))}util$8.toSetString=supportsNullProto$1?identity$1:toSetString$1,util$8.fromSetString=supportsNullProto$1?identity$1:fromSetString$1,util$8.compareByGeneratedPositionsInflated=compareByGeneratedPositionsInflated$1;const PROTOCOL$1="http:",PROTOCOL_AND_HOST$1=`${PROTOCOL$1}//host`;function createSafeHandler$1(e){return t=>{const r=getURLType$1(t),a=buildSafeBase$1(t),n=new URL(t,a);e(n);const o=n.toString();return"absolute"===r?o:"scheme-relative"===r?o.slice(PROTOCOL$1.length):"path-absolute"===r?o.slice(PROTOCOL_AND_HOST$1.length):computeRelativeURL$1(a,o)}}function withBase$1(e,t){return new URL(e,t).toString()}function buildUniqueSegment$1(e,t){let r=0;for(;;){const a=e+r++;if(-1===t.indexOf(a))return a}}function buildSafeBase$1(e){const t=e.split("..").length-1,r=buildUniqueSegment$1("p",e);let a=`${PROTOCOL_AND_HOST$1}/`;for(let e=0;e<t;e++)a+=`${r}/`;return a}const ABSOLUTE_SCHEME$1=/^[A-Za-z0-9\+\-\.]+:/;function getURLType$1(e){return"/"===e[0]?"/"===e[1]?"scheme-relative":"path-absolute":ABSOLUTE_SCHEME$1.test(e)?"absolute":"path-relative"}function computeRelativeURL$1(e,t){"string"==typeof e&&(e=new URL(e)),"string"==typeof t&&(t=new URL(t));const r=t.pathname.split("/"),a=e.pathname.split("/");for(a.length>0&&!a[a.length-1]&&a.pop();r.length>0&&a.length>0&&r[0]===a[0];)r.shift(),a.shift();return a.map((()=>"..")).concat(r).join("/")+t.search+t.hash}const ensureDirectory$1=createSafeHandler$1((e=>{e.pathname=e.pathname.replace(/\/?$/,"/")})),normalize$1=createSafeHandler$1((e=>{}));function join$1(e,t){const r=getURLType$1(t),a=getURLType$1(e);if(e=ensureDirectory$1(e),"absolute"===r)return withBase$1(t,void 0);if("absolute"===a)return withBase$1(t,e);if("scheme-relative"===r)return normalize$1(t);if("scheme-relative"===a)return withBase$1(t,withBase$1(e,PROTOCOL_AND_HOST$1)).slice(PROTOCOL$1.length);if("path-absolute"===r)return normalize$1(t);if("path-absolute"===a)return withBase$1(t,withBase$1(e,PROTOCOL_AND_HOST$1)).slice(PROTOCOL_AND_HOST$1.length);const n=buildSafeBase$1(t+e);return computeRelativeURL$1(n,withBase$1(t,withBase$1(e,n)))}function relative$1(e,t){const r=relativeIfPossible$1(e,t);return"string"==typeof r?r:normalize$1(t)}function relativeIfPossible$1(e,t){if(getURLType$1(e)!==getURLType$1(t))return null;const r=buildSafeBase$1(e+t),a=new URL(e,r),n=new URL(t,r);try{new URL("",n.toString())}catch(e){return null}return n.protocol!==a.protocol||n.user!==a.user||n.password!==a.password||n.hostname!==a.hostname||n.port!==a.port?null:computeRelativeURL$1(a,n)}util$8.normalize=normalize$1,util$8.join=join$1,util$8.relative=relative$1;var arraySet$1={};let ArraySet$4=class e{constructor(){this._array=[],this._set=new Map}static fromArray(t,r){const a=new e;for(let e=0,n=t.length;e<n;e++)a.add(t[e],r);return a}size(){return this._set.size}add(e,t){const r=this.has(e),a=this._array.length;r&&!t||this._array.push(e),r||this._set.set(e,a)}has(e){return this._set.has(e)}indexOf(e){const t=this._set.get(e);if(t>=0)return t;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}};arraySet$1.ArraySet=ArraySet$4;var mappingList$1={};const util$7=util$8;function generatedPositionAfter$1(e,t){const r=e.generatedLine,a=t.generatedLine,n=e.generatedColumn,o=t.generatedColumn;return a>r||a==r&&o>=n||util$7.compareByGeneratedPositionsInflated(e,t)<=0}let MappingList$3=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,t){this._array.forEach(e,t)}add(e){generatedPositionAfter$1(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))}toArray(){return this._sorted||(this._array.sort(util$7.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};mappingList$1.MappingList=MappingList$3;const base64VLQ$1=base64Vlq$1,util$6=util$8,ArraySet$3=arraySet$1.ArraySet,MappingList$2=mappingList$1.MappingList;let SourceMapGenerator$3=class e{constructor(e){e||(e={}),this._file=util$6.getArg(e,"file",null),this._sourceRoot=util$6.getArg(e,"sourceRoot",null),this._skipValidation=util$6.getArg(e,"skipValidation",!1),this._sources=new ArraySet$3,this._names=new ArraySet$3,this._mappings=new MappingList$2,this._sourcesContents=null}static fromSourceMap(t){const r=t.sourceRoot,a=new e({file:t.file,sourceRoot:r});return t.eachMapping((function(e){const t={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(t.source=e.source,null!=r&&(t.source=util$6.relative(r,t.source)),t.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(t.name=e.name)),a.addMapping(t)})),t.sources.forEach((function(e){let n=e;null!=r&&(n=util$6.relative(r,e)),a._sources.has(n)||a._sources.add(n);const o=t.sourceContentFor(e);null!=o&&a.setSourceContent(e,o)})),a}addMapping(e){const t=util$6.getArg(e,"generated"),r=util$6.getArg(e,"original",null);let a=util$6.getArg(e,"source",null),n=util$6.getArg(e,"name",null);this._skipValidation||this._validateMapping(t,r,a,n),null!=a&&(a=String(a),this._sources.has(a)||this._sources.add(a)),null!=n&&(n=String(n),this._names.has(n)||this._names.add(n)),this._mappings.add({generatedLine:t.line,generatedColumn:t.column,originalLine:r&&r.line,originalColumn:r&&r.column,source:a,name:n})}setSourceContent(e,t){let r=e;null!=this._sourceRoot&&(r=util$6.relative(this._sourceRoot,r)),null!=t?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[util$6.toSetString(r)]=t):this._sourcesContents&&(delete this._sourcesContents[util$6.toSetString(r)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))}applySourceMap(e,t,r){let a=t;if(null==t){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');a=e.file}const n=this._sourceRoot;null!=n&&(a=util$6.relative(n,a));const o=this._mappings.toArray().length>0?new ArraySet$3:this._sources,s=new ArraySet$3;this._mappings.unsortedForEach((function(t){if(t.source===a&&null!=t.originalLine){const a=e.originalPositionFor({line:t.originalLine,column:t.originalColumn});null!=a.source&&(t.source=a.source,null!=r&&(t.source=util$6.join(r,t.source)),null!=n&&(t.source=util$6.relative(n,t.source)),t.originalLine=a.line,t.originalColumn=a.column,null!=a.name&&(t.name=a.name))}const i=t.source;null==i||o.has(i)||o.add(i);const c=t.name;null==c||s.has(c)||s.add(c)}),this),this._sources=o,this._names=s,e.sources.forEach((function(t){const a=e.sourceContentFor(t);null!=a&&(null!=r&&(t=util$6.join(r,t)),null!=n&&(t=util$6.relative(n,t)),this.setSourceContent(t,a))}),this)}_validateMapping(e,t,r,a){if(t&&"number"!=typeof t.line&&"number"!=typeof t.column)throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!t&&!r&&!a);else if(!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:t,name:a}))}_serializeMappings(){let e,t,r,a,n=0,o=1,s=0,i=0,c=0,u=0,p="";const l=this._mappings.toArray();for(let f=0,d=l.length;f<d;f++){if(t=l[f],e="",t.generatedLine!==o)for(n=0;t.generatedLine!==o;)e+=";",o++;else if(f>0){if(!util$6.compareByGeneratedPositionsInflated(t,l[f-1]))continue;e+=","}e+=base64VLQ$1.encode(t.generatedColumn-n),n=t.generatedColumn,null!=t.source&&(a=this._sources.indexOf(t.source),e+=base64VLQ$1.encode(a-u),u=a,e+=base64VLQ$1.encode(t.originalLine-1-i),i=t.originalLine-1,e+=base64VLQ$1.encode(t.originalColumn-s),s=t.originalColumn,null!=t.name&&(r=this._names.indexOf(t.name),e+=base64VLQ$1.encode(r-c),c=r)),p+=e}return p}_generateSourcesContent(e,t){return e.map((function(e){if(!this._sourcesContents)return null;null!=t&&(e=util$6.relative(t,e));const r=util$6.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,r)?this._sourcesContents[r]:null}),this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}};SourceMapGenerator$3.prototype._version=3,sourceMapGenerator$1.SourceMapGenerator=SourceMapGenerator$3;var sourceNode$1={};const SourceMapGenerator$2=sourceMapGenerator$1.SourceMapGenerator,util$5=util$8,REGEX_NEWLINE$1=/(\r?\n)/,NEWLINE_CODE$1=10,isSourceNode$1="$$$isSourceNode$$$";let SourceNode$4=class e{constructor(e,t,r,a,n){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==r?null:r,this.name=null==n?null:n,this[isSourceNode$1]=!0,null!=a&&this.add(a)}static fromStringWithSourceMap(t,r,a){const n=new e,o=t.split(REGEX_NEWLINE$1);let s=0;const i=function(){return e()+(e()||"");function e(){return s<o.length?o[s++]:void 0}};let c,u=1,p=0,l=null;return r.eachMapping((function(e){if(null!==l){if(!(u<e.generatedLine)){c=o[s]||"";const t=c.substr(0,e.generatedColumn-p);return o[s]=c.substr(e.generatedColumn-p),p=e.generatedColumn,f(l,t),void(l=e)}f(l,i()),u++,p=0}for(;u<e.generatedLine;)n.add(i()),u++;p<e.generatedColumn&&(c=o[s]||"",n.add(c.substr(0,e.generatedColumn)),o[s]=c.substr(e.generatedColumn),p=e.generatedColumn),l=e}),this),s<o.length&&(l&&f(l,i()),n.add(o.splice(s).join(""))),r.sources.forEach((function(e){const t=r.sourceContentFor(e);null!=t&&(null!=a&&(e=util$5.join(a,e)),n.setSourceContent(e,t))})),n;function f(t,r){if(null===t||void 0===t.source)n.add(r);else{const o=a?util$5.join(a,t.source):t.source;n.add(new e(t.originalLine,t.originalColumn,o,r,t.name))}}}add(e){if(Array.isArray(e))e.forEach((function(e){this.add(e)}),this);else{if(!e[isSourceNode$1]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this}prepend(e){if(Array.isArray(e))for(let t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[isSourceNode$1]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this}walk(e){let t;for(let r=0,a=this.children.length;r<a;r++)t=this.children[r],t[isSourceNode$1]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let t,r;const a=this.children.length;if(a>0){for(t=[],r=0;r<a-1;r++)t.push(this.children[r]),t.push(e);t.push(this.children[r]),this.children=t}return this}replaceRight(e,t){const r=this.children[this.children.length-1];return r[isSourceNode$1]?r.replaceRight(e,t):"string"==typeof r?this.children[this.children.length-1]=r.replace(e,t):this.children.push("".replace(e,t)),this}setSourceContent(e,t){this.sourceContents[util$5.toSetString(e)]=t}walkSourceContents(e){for(let t=0,r=this.children.length;t<r;t++)this.children[t][isSourceNode$1]&&this.children[t].walkSourceContents(e);const t=Object.keys(this.sourceContents);for(let r=0,a=t.length;r<a;r++)e(util$5.fromSetString(t[r]),this.sourceContents[t[r]])}toString(){let e="";return this.walk((function(t){e+=t})),e}toStringWithSourceMap(e){const t={code:"",line:1,column:0},r=new SourceMapGenerator$2(e);let a=!1,n=null,o=null,s=null,i=null;return this.walk((function(e,c){t.code+=e,null!==c.source&&null!==c.line&&null!==c.column?(n===c.source&&o===c.line&&s===c.column&&i===c.name||r.addMapping({source:c.source,original:{line:c.line,column:c.column},generated:{line:t.line,column:t.column},name:c.name}),n=c.source,o=c.line,s=c.column,i=c.name,a=!0):a&&(r.addMapping({generated:{line:t.line,column:t.column}}),n=null,a=!1);for(let o=0,s=e.length;o<s;o++)e.charCodeAt(o)===NEWLINE_CODE$1?(t.line++,t.column=0,o+1===s?(n=null,a=!1):a&&r.addMapping({source:c.source,original:{line:c.line,column:c.column},generated:{line:t.line,column:t.column},name:c.name})):t.column++})),this.walkSourceContents((function(e,t){r.setSourceContent(e,t)})),{code:t.code,map:r}}};sourceNode$1.SourceNode=SourceNode$4,sourceMap$1.SourceMapGenerator=sourceMapGenerator$1.SourceMapGenerator,sourceMap$1.SourceNode=sourceNode$1.SourceNode;var SourceNode$3=sourceMap$1.SourceNode,GrammarLocation$3=grammarLocation,Stack$2=function(){function e(e,t,r,a){this.sp=-1,this.maxSp=-1,this.varName=t,this.ruleName=e,this.type=r,this.bytecode=a,this.labels={},this.sourceMapStack=[]}return e.prototype.name=function(e){if(e<0)throw new RangeError("Rule '".concat(this.ruleName,"': The variable stack underflow: attempt to use a variable '").concat(this.varName,"<x>' at an index ").concat(e,".\nBytecode: ").concat(this.bytecode));return this.varName+e},e.sourceNode=function(e,t,r){var a=GrammarLocation$3.offsetStart(e);return new SourceNode$3(a.line,a.column?a.column-1:null,String(e.source),t,r)},e.prototype.push=function(t){++this.sp>this.maxSp&&(this.maxSp=this.sp);var r=this.labels[this.sp],a=[this.name(this.sp)," = ",t,";"];if(r){if(this.sourceMapStack.length){var n=e.sourceNode(r.location,a.splice(0,2),r.label),o=this.sourceMapPopInternal(),s=o.parts,i=o.location,c=i.start.offset<r.location.end.offset?{start:r.location.end,end:i.end,source:i.source}:i,u=e.sourceNode(c,a.concat("\n"));return this.sourceMapStack.push([s,s.length+1,i]),new SourceNode$3(null,null,r.location.source,[n,u])}return e.sourceNode(r.location,a.concat("\n"))}return a.join("")},e.prototype.pop=function(e){var t=this;return void 0!==e?(this.sp-=e,Array.from({length:e},(function(e,r){return t.name(t.sp+1+r)}))):this.name(this.sp--)},e.prototype.top=function(){return this.name(this.sp)},e.prototype.index=function(e){if(e<0)throw new RangeError("Rule '".concat(this.ruleName,"': The variable stack overflow: attempt to get a variable at a negative index ").concat(e,".\nBytecode: ").concat(this.bytecode));return this.name(this.sp-e)},e.prototype.result=function(){if(this.maxSp<0)throw new RangeError("Rule '".concat(this.ruleName,"': The variable stack is empty, can't get the result.\nBytecode: ").concat(this.bytecode));return this.name(0)},e.prototype.defines=function(){var e=this;return this.maxSp<0?"":this.type+" "+Array.from({length:this.maxSp+1},(function(t,r){return e.name(r)})).join(", ")+";"},e.prototype.checkedIf=function(e,t,r){var a=this.sp,n=t();if(!r)return[n];var o=this.sp;this.sp=a;var s=r();if(o!==this.sp)throw new Error("Rule '"+this.ruleName+"', position "+e+": Branches of a condition can't move the stack pointer differently (before: "+a+", after then: "+o+", after else: "+this.sp+"). Bytecode: "+this.bytecode);return[n,s]},e.prototype.checkedLoop=function(e,t){var r=this.sp,a=t();if(r!==this.sp)throw new Error("Rule '"+this.ruleName+"', position "+e+": Body of a loop can't move the stack pointer (before: "+r+", after: "+this.sp+"). Bytecode: "+this.bytecode);return a},e.prototype.sourceMapPush=function(e,t){if(this.sourceMapStack.length){var r=this.sourceMapStack[this.sourceMapStack.length-1];r[2].start.offset===t.start.offset&&r[2].end.offset>t.end.offset&&(r[2]={start:t.end,end:r[2].end,source:r[2].source})}this.sourceMapStack.push([e,e.length,t])},e.prototype.sourceMapPopInternal=function(){var e=this.sourceMapStack.pop();if(!e)throw new RangeError("Rule '".concat(this.ruleName,"': Attempting to pop an empty source map stack.\nBytecode: ").concat(this.bytecode));var t=e[0],r=e[1],a=e[2],n=t.splice(r).map((function(e){return e instanceof SourceNode$3?e:e+"\n"}));if(n.length){var o=GrammarLocation$3.offsetStart(a);t.push(new SourceNode$3(o.line,o.column-1,String(a.source),n))}return{parts:t,location:a}},e.prototype.sourceMapPop=function(e){var t=this.sourceMapPopInternal().location;if(this.sourceMapStack.length&&t.end.offset<this.sourceMapStack[this.sourceMapStack.length-1][2].end.offset){var r=this.sourceMapPopInternal(),a=r.parts,n=r.location,o=n.start.offset<t.end.offset?{start:t.end,end:n.end,source:n.source}:n;this.sourceMapStack.push([a,a.length+(e||0),o])}},e}(),stack=Stack$2,version$1="4.0.2",utils$1={};function hex$1(e){return e.charCodeAt(0).toString(16).toUpperCase()}function stringEscape$2(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\v/g,"\\v").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+hex$1(e)})).replace(/[\x10-\x1F\x7F-\xFF]/g,(function(e){return"\\x"+hex$1(e)})).replace(/[\u0100-\u0FFF]/g,(function(e){return"\\u0"+hex$1(e)})).replace(/[\u1000-\uFFFF]/g,(function(e){return"\\u"+hex$1(e)}))}function regexpClassEscape$2(e){return e.replace(/\\/g,"\\\\").replace(/\//g,"\\/").replace(/]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\v/g,"\\v").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+hex$1(e)})).replace(/[\x10-\x1F\x7F-\xFF]/g,(function(e){return"\\x"+hex$1(e)})).replace(/[\u0100-\u0FFF]/g,(function(e){return"\\u0"+hex$1(e)})).replace(/[\u1000-\uFFFF]/g,(function(e){return"\\u"+hex$1(e)}))}function base64$4(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=e.length%3,a=e.length-r,n="",o=0;o<a;o+=3)n+=t[e[o]>>2],n+=t[(3&e[o])<<4|e[o+1]>>4],n+=t[(15&e[o+1])<<2|e[o+2]>>6],n+=t[63&e[o+2]];return 1===r?(n+=t[e[a]>>2],n+=t[(3&e[a])<<4],n+="=="):2===r&&(n+=t[e[a]>>2],n+=t[(3&e[a])<<4|e[a+1]>>4],n+=t[(15&e[a+1])<<2],n+="="),n}utils$1.hex=hex$1,utils$1.stringEscape=stringEscape$2,utils$1.regexpClassEscape=regexpClassEscape$2,utils$1.base64=base64$4;var OPS_TO_PREFIXED_TYPES={$:"text","&":"simple_and","!":"simple_not"},OPS_TO_SUFFIXED_TYPES={"?":"optional","*":"zero_or_more","+":"one_or_more"},OPS_TO_SEMANTIC_PREDICATE_TYPES={"&":"semantic_and","!":"semantic_not"};function peg$subclass(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}function peg$SyntaxError(e,t,r,a){var n=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(n,peg$SyntaxError.prototype),n.expected=t,n.found=r,n.location=a,n.name="SyntaxError",n}function peg$padEnd(e,t,r){return r=r||" ",e.length>t?e:(t-=e.length,e+(r+=r.repeat(t)).slice(0,t))}function peg$parse(e,t){var r,a={},n=(t=void 0!==t?t:{}).grammarSource,o={Grammar:Br,ImportsAndSource:function(){var t,r,n;return t=Ar,r=function(){var t,r;return t=Ar,r=Ar,Mr(),r=e.substring(r,Ar),yr=t,At(r)}(),n=function(){var t,r,n,o;for(t=Ar,r=Ar,n=[],e.length>Ar?(o=e.charAt(Ar),Ar++):(o=a,0===kr&&Or(ce));o!==a;)n.push(o),e.length>Ar?(o=e.charAt(Ar),Ar++):(o=a,0===kr&&Or(ce));return r=e.substring(r,Ar),yr=t,vt(r)}(),yr=t,bt(r,n)}},s=Br,i="import",c=";",u=",",p="*",l="as",f="{",d="}",m="from",g="=",$="/",h="@",x=":",b="|",v="..",A="(",y=")",S=".",_="\n",E="\r\n",k="/*",T="*/",C="//",w="\\",P="i",R='"',L="'",F="[",O="^",B="]",M="-",D="0",I="b",j="f",N="n",U="r",q="t",G="v",H="x",z="u",W=/^[!$&]/,V=/^[*-+?]/,Y=/^[!&]/,Q=/^[\t\v-\f \xA0\u1680\u2000-\u200A\u202F\u205F\u3000\uFEFF]/,J=/^[\n\r\u2028\u2029]/,X=/^[\r\u2028-\u2029]/,K=/^[A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376-\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E-\u066F\u0671-\u06D3\u06D5\u06E5-\u06E6\u06EE-\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4-\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F-\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC-\u09DD\u09DF-\u09E1\u09F0-\u09F1\u0A05-\u0A0A\u0A0F-\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32-\u0A33\u0A35-\u0A36\u0A38-\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2-\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0-\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F-\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32-\u0B33\u0B35-\u0B39\u0B3D\u0B5C-\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99-\u0B9A\u0B9C\u0B9E-\u0B9F\u0BA3-\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60-\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0-\u0CE1\u0CF1-\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32-\u0E33\u0E40-\u0E46\u0E81-\u0E82\u0E84\u0E87-\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA-\u0EAB\u0EAD-\u0EB0\u0EB2-\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065-\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE-\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5-\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A-\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5-\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40-\uFB41\uFB43-\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,Z=/^[$0-9_\u0300-\u036F\u0483-\u0487\u0591-\u05BD\u05BF\u05C1-\u05C2\u05C4-\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7-\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962-\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7-\u09C8\u09CB-\u09CD\u09D7\u09E2-\u09E3\u09E6-\u09EF\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47-\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47-\u0B48\u0B4B-\u0B4D\u0B56-\u0B57\u0B62-\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55-\u0C56\u0C62-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5-\u0CD6\u0CE2-\u0CE3\u0CE6-\u0CEF\u0D01-\u0D03\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62-\u0D63\u0D66-\u0D6F\u0D82-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2-\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EB9\u0EBB-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18-\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F3F\u0F71-\u0F84\u0F86-\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752-\u1753\u1772-\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19D9\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF8-\u1CF9\u1DC0-\u1DF5\u1DFC-\u1DFF\u200C-\u200D\u203F-\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099-\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E-\uA69F\uA6F0-\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880-\uA881\uA8B4-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F1\uA900-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C-\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7-\uAAB8\uAABE-\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5-\uAAF6\uABE3-\uABEA\uABEC-\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33-\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F]/,ee=/^[\n\r"\\\u2028-\u2029]/,te=/^[\n\r'\\\u2028-\u2029]/,re=/^[\n\r\\-\]\u2028-\u2029]/,ae=/^["'\\]/,ne=/^[0-9ux]/,oe=/^[0-9]/,se=/^[0-9a-f]/i,ie=/^[{}]/,ce={type:"any"},ue=wr("import",!1),pe=wr(";",!1),le=wr(",",!1),fe=wr("*",!1),de=wr("as",!1),me=wr("{",!1),ge=wr("}",!1),$e=wr("from",!1),he=wr("=",!1),xe=wr("/",!1),be=wr("@",!1),ve=wr(":",!1),Ae=Pr(["!","$","&"],!1,!1),ye=Pr([["*","+"],"?"],!1,!1),Se=wr("|",!1),_e=wr("..",!1),Ee=wr("(",!1),ke=wr(")",!1),Te=wr(".",!1),Ce=Pr(["!","&"],!1,!1),we=Rr("whitespace"),Pe=Pr(["\t",["\v","\f"]," "," "," ",[" "," "]," "," ","　","\ufeff"],!1,!1),Re=Pr(["\n","\r","\u2028","\u2029"],!1,!1),Le=Rr("end of line"),Fe=wr("\n",!1),Oe=wr("\r\n",!1),Be=Pr(["\r",["\u2028","\u2029"]],!1,!1),Me=Rr("comment"),De=wr("/*",!1),Ie=wr("*/",!1),je=wr("//",!1),Ne=Rr("identifier"),Ue=Pr([["A","Z"],"_",["a","z"],"ª","µ","º",["À","Ö"],["Ø","ö"],["ø","ˁ"],["ˆ","ˑ"],["ˠ","ˤ"],"ˬ","ˮ",["Ͱ","ʹ"],["Ͷ","ͷ"],["ͺ","ͽ"],"Ϳ","Ά",["Έ","Ί"],"Ό",["Ύ","Ρ"],["Σ","ϵ"],["Ϸ","ҁ"],["Ҋ","ԯ"],["Ա","Ֆ"],"ՙ",["ա","և"],["א","ת"],["װ","ײ"],["ؠ","ي"],["ٮ","ٯ"],["ٱ","ۓ"],"ە",["ۥ","ۦ"],["ۮ","ۯ"],["ۺ","ۼ"],"ۿ","ܐ",["ܒ","ܯ"],["ݍ","ޥ"],"ޱ",["ߊ","ߪ"],["ߴ","ߵ"],"ߺ",["ࠀ","ࠕ"],"ࠚ","ࠤ","ࠨ",["ࡀ","ࡘ"],["ࢠ","ࢴ"],["ऄ","ह"],"ऽ","ॐ",["क़","ॡ"],["ॱ","ঀ"],["অ","ঌ"],["এ","ঐ"],["ও","ন"],["প","র"],"ল",["শ","হ"],"ঽ","ৎ",["ড়","ঢ়"],["য়","ৡ"],["ৰ","ৱ"],["ਅ","ਊ"],["ਏ","ਐ"],["ਓ","ਨ"],["ਪ","ਰ"],["ਲ","ਲ਼"],["ਵ","ਸ਼"],["ਸ","ਹ"],["ਖ਼","ੜ"],"ਫ਼",["ੲ","ੴ"],["અ","ઍ"],["એ","ઑ"],["ઓ","ન"],["પ","ર"],["લ","ળ"],["વ","હ"],"ઽ","ૐ",["ૠ","ૡ"],"ૹ",["ଅ","ଌ"],["ଏ","ଐ"],["ଓ","ନ"],["ପ","ର"],["ଲ","ଳ"],["ଵ","ହ"],"ଽ",["ଡ଼","ଢ଼"],["ୟ","ୡ"],"ୱ","ஃ",["அ","ஊ"],["எ","ஐ"],["ஒ","க"],["ங","ச"],"ஜ",["ஞ","ட"],["ண","த"],["ந","ப"],["ம","ஹ"],"ௐ",["అ","ఌ"],["ఎ","ఐ"],["ఒ","న"],["ప","హ"],"ఽ",["ౘ","ౚ"],["ౠ","ౡ"],["ಅ","ಌ"],["ಎ","ಐ"],["ಒ","ನ"],["ಪ","ಳ"],["ವ","ಹ"],"ಽ","ೞ",["ೠ","ೡ"],["ೱ","ೲ"],["അ","ഌ"],["എ","ഐ"],["ഒ","ഺ"],"ഽ","ൎ",["ൟ","ൡ"],["ൺ","ൿ"],["අ","ඖ"],["ක","න"],["ඳ","ර"],"ල",["ව","ෆ"],["ก","ะ"],["า","ำ"],["เ","ๆ"],["ກ","ຂ"],"ຄ",["ງ","ຈ"],"ຊ","ຍ",["ດ","ທ"],["ນ","ຟ"],["ມ","ຣ"],"ລ","ວ",["ສ","ຫ"],["ອ","ະ"],["າ","ຳ"],"ຽ",["ເ","ໄ"],"ໆ",["ໜ","ໟ"],"ༀ",["ཀ","ཇ"],["ཉ","ཬ"],["ྈ","ྌ"],["က","ဪ"],"ဿ",["ၐ","ၕ"],["ၚ","ၝ"],"ၡ",["ၥ","ၦ"],["ၮ","ၰ"],["ၵ","ႁ"],"ႎ",["Ⴀ","Ⴥ"],"Ⴧ","Ⴭ",["ა","ჺ"],["ჼ","ቈ"],["ቊ","ቍ"],["ቐ","ቖ"],"ቘ",["ቚ","ቝ"],["በ","ኈ"],["ኊ","ኍ"],["ነ","ኰ"],["ኲ","ኵ"],["ኸ","ኾ"],"ዀ",["ዂ","ዅ"],["ወ","ዖ"],["ዘ","ጐ"],["ጒ","ጕ"],["ጘ","ፚ"],["ᎀ","ᎏ"],["Ꭰ","Ᏽ"],["ᏸ","ᏽ"],["ᐁ","ᙬ"],["ᙯ","ᙿ"],["ᚁ","ᚚ"],["ᚠ","ᛪ"],["ᛮ","ᛸ"],["ᜀ","ᜌ"],["ᜎ","ᜑ"],["ᜠ","ᜱ"],["ᝀ","ᝑ"],["ᝠ","ᝬ"],["ᝮ","ᝰ"],["ក","ឳ"],"ៗ","ៜ",["ᠠ","ᡷ"],["ᢀ","ᢨ"],"ᢪ",["ᢰ","ᣵ"],["ᤀ","ᤞ"],["ᥐ","ᥭ"],["ᥰ","ᥴ"],["ᦀ","ᦫ"],["ᦰ","ᧉ"],["ᨀ","ᨖ"],["ᨠ","ᩔ"],"ᪧ",["ᬅ","ᬳ"],["ᭅ","ᭋ"],["ᮃ","ᮠ"],["ᮮ","ᮯ"],["ᮺ","ᯥ"],["ᰀ","ᰣ"],["ᱍ","ᱏ"],["ᱚ","ᱽ"],["ᳩ","ᳬ"],["ᳮ","ᳱ"],["ᳵ","ᳶ"],["ᴀ","ᶿ"],["Ḁ","ἕ"],["Ἐ","Ἕ"],["ἠ","ὅ"],["Ὀ","Ὅ"],["ὐ","ὗ"],"Ὑ","Ὓ","Ὕ",["Ὗ","ώ"],["ᾀ","ᾴ"],["ᾶ","ᾼ"],"ι",["ῂ","ῄ"],["ῆ","ῌ"],["ῐ","ΐ"],["ῖ","Ί"],["ῠ","Ῥ"],["ῲ","ῴ"],["ῶ","ῼ"],"ⁱ","ⁿ",["ₐ","ₜ"],"ℂ","ℇ",["ℊ","ℓ"],"ℕ",["ℙ","ℝ"],"ℤ","Ω","ℨ",["K","ℭ"],["ℯ","ℹ"],["ℼ","ℿ"],["ⅅ","ⅉ"],"ⅎ",["Ⅰ","ↈ"],["Ⰰ","Ⱞ"],["ⰰ","ⱞ"],["Ⱡ","ⳤ"],["Ⳬ","ⳮ"],["Ⳳ","ⳳ"],["ⴀ","ⴥ"],"ⴧ","ⴭ",["ⴰ","ⵧ"],"ⵯ",["ⶀ","ⶖ"],["ⶠ","ⶦ"],["ⶨ","ⶮ"],["ⶰ","ⶶ"],["ⶸ","ⶾ"],["ⷀ","ⷆ"],["ⷈ","ⷎ"],["ⷐ","ⷖ"],["ⷘ","ⷞ"],"ⸯ",["々","〇"],["〡","〩"],["〱","〵"],["〸","〼"],["ぁ","ゖ"],["ゝ","ゟ"],["ァ","ヺ"],["ー","ヿ"],["ㄅ","ㄭ"],["ㄱ","ㆎ"],["ㆠ","ㆺ"],["ㇰ","ㇿ"],["㐀","䶵"],["一","鿕"],["ꀀ","ꒌ"],["ꓐ","ꓽ"],["ꔀ","ꘌ"],["ꘐ","ꘟ"],["ꘪ","ꘫ"],["Ꙁ","ꙮ"],["ꙿ","ꚝ"],["ꚠ","ꛯ"],["ꜗ","ꜟ"],["Ꜣ","ꞈ"],["Ꞌ","Ɬ"],["Ʞ","ꞷ"],["ꟷ","ꠁ"],["ꠃ","ꠅ"],["ꠇ","ꠊ"],["ꠌ","ꠢ"],["ꡀ","ꡳ"],["ꢂ","ꢳ"],["ꣲ","ꣷ"],"ꣻ","ꣽ",["ꤊ","ꤥ"],["ꤰ","ꥆ"],["ꥠ","ꥼ"],["ꦄ","ꦲ"],"ꧏ",["ꧠ","ꧤ"],["ꧦ","ꧯ"],["ꧺ","ꧾ"],["ꨀ","ꨨ"],["ꩀ","ꩂ"],["ꩄ","ꩋ"],["ꩠ","ꩶ"],"ꩺ",["ꩾ","ꪯ"],"ꪱ",["ꪵ","ꪶ"],["ꪹ","ꪽ"],"ꫀ","ꫂ",["ꫛ","ꫝ"],["ꫠ","ꫪ"],["ꫲ","ꫴ"],["ꬁ","ꬆ"],["ꬉ","ꬎ"],["ꬑ","ꬖ"],["ꬠ","ꬦ"],["ꬨ","ꬮ"],["ꬰ","ꭚ"],["ꭜ","ꭥ"],["ꭰ","ꯢ"],["가","힣"],["ힰ","ퟆ"],["ퟋ","ퟻ"],["豈","舘"],["並","龎"],["ﬀ","ﬆ"],["ﬓ","ﬗ"],"יִ",["ײַ","ﬨ"],["שׁ","זּ"],["טּ","לּ"],"מּ",["נּ","סּ"],["ףּ","פּ"],["צּ","ﮱ"],["ﯓ","ﴽ"],["ﵐ","ﶏ"],["ﶒ","ﷇ"],["ﷰ","ﷻ"],["ﹰ","ﹴ"],["ﹶ","ﻼ"],["Ａ","Ｚ"],["ａ","ｚ"],["ｦ","ﾾ"],["ￂ","ￇ"],["ￊ","ￏ"],["ￒ","ￗ"],["ￚ","ￜ"]],!1,!1),qe=wr("\\",!1),Ge=Pr(["$",["0","9"],"_",["̀","ͯ"],["҃","҇"],["֑","ֽ"],"ֿ",["ׁ","ׂ"],["ׄ","ׅ"],"ׇ",["ؐ","ؚ"],["ً","٩"],"ٰ",["ۖ","ۜ"],["۟","ۤ"],["ۧ","ۨ"],["۪","ۭ"],["۰","۹"],"ܑ",["ܰ","݊"],["ަ","ް"],["߀","߉"],["߫","߳"],["ࠖ","࠙"],["ࠛ","ࠣ"],["ࠥ","ࠧ"],["ࠩ","࠭"],["࡙","࡛"],["ࣣ","ः"],["ऺ","़"],["ा","ॏ"],["॑","ॗ"],["ॢ","ॣ"],["०","९"],["ঁ","ঃ"],"়",["া","ৄ"],["ে","ৈ"],["ো","্"],"ৗ",["ৢ","ৣ"],["০","৯"],["ਁ","ਃ"],"਼",["ਾ","ੂ"],["ੇ","ੈ"],["ੋ","੍"],"ੑ",["੦","ੱ"],"ੵ",["ઁ","ઃ"],"઼",["ા","ૅ"],["ે","ૉ"],["ો","્"],["ૢ","ૣ"],["૦","૯"],["ଁ","ଃ"],"଼",["ା","ୄ"],["େ","ୈ"],["ୋ","୍"],["ୖ","ୗ"],["ୢ","ୣ"],["୦","୯"],"ஂ",["ா","ூ"],["ெ","ை"],["ொ","்"],"ௗ",["௦","௯"],["ఀ","ః"],["ా","ౄ"],["ె","ై"],["ొ","్"],["ౕ","ౖ"],["ౢ","ౣ"],["౦","౯"],["ಁ","ಃ"],"಼",["ಾ","ೄ"],["ೆ","ೈ"],["ೊ","್"],["ೕ","ೖ"],["ೢ","ೣ"],["೦","೯"],["ഁ","ഃ"],["ാ","ൄ"],["െ","ൈ"],["ൊ","്"],"ൗ",["ൢ","ൣ"],["൦","൯"],["ං","ඃ"],"්",["ා","ු"],"ූ",["ෘ","ෟ"],["෦","෯"],["ෲ","ෳ"],"ั",["ิ","ฺ"],["็","๎"],["๐","๙"],"ັ",["ິ","ູ"],["ົ","ຼ"],["່","ໍ"],["໐","໙"],["༘","༙"],["༠","༩"],"༵","༷","༹",["༾","༿"],["ཱ","྄"],["྆","྇"],["ྍ","ྗ"],["ྙ","ྼ"],"࿆",["ါ","ှ"],["၀","၉"],["ၖ","ၙ"],["ၞ","ၠ"],["ၢ","ၤ"],["ၧ","ၭ"],["ၱ","ၴ"],["ႂ","ႍ"],["ႏ","ႝ"],["፝","፟"],["ᜒ","᜔"],["ᜲ","᜴"],["ᝒ","ᝓ"],["ᝲ","ᝳ"],["឴","៓"],"៝",["០","៩"],["᠋","᠍"],["᠐","᠙"],"ᢩ",["ᤠ","ᤫ"],["ᤰ","᤻"],["᥆","᥏"],["᧐","᧙"],["ᨗ","ᨛ"],["ᩕ","ᩞ"],["᩠","᩼"],["᩿","᪉"],["᪐","᪙"],["᪰","᪽"],["ᬀ","ᬄ"],["᬴","᭄"],["᭐","᭙"],["᭫","᭳"],["ᮀ","ᮂ"],["ᮡ","ᮭ"],["᮰","᮹"],["᯦","᯳"],["ᰤ","᰷"],["᱀","᱉"],["᱐","᱙"],["᳐","᳒"],["᳔","᳨"],"᳭",["ᳲ","᳴"],["᳸","᳹"],["᷀","᷵"],["᷼","᷿"],["‌","‍"],["‿","⁀"],"⁔",["⃐","⃜"],"⃡",["⃥","⃰"],["⳯","⳱"],"⵿",["ⷠ","ⷿ"],["〪","〯"],["゙","゚"],["꘠","꘩"],"꙯",["ꙴ","꙽"],["ꚞ","ꚟ"],["꛰","꛱"],"ꠂ","꠆","ꠋ",["ꠣ","ꠧ"],["ꢀ","ꢁ"],["ꢴ","꣄"],["꣐","꣙"],["꣠","꣱"],["꤀","꤉"],["ꤦ","꤭"],["ꥇ","꥓"],["ꦀ","ꦃ"],["꦳","꧀"],["꧐","꧙"],"ꧥ",["꧰","꧹"],["ꨩ","ꨶ"],"ꩃ",["ꩌ","ꩍ"],["꩐","꩙"],["ꩻ","ꩽ"],"ꪰ",["ꪲ","ꪴ"],["ꪷ","ꪸ"],["ꪾ","꪿"],"꫁",["ꫫ","ꫯ"],["ꫵ","꫶"],["ꯣ","ꯪ"],["꯬","꯭"],["꯰","꯹"],"ﬞ",["︀","️"],["︠","︯"],["︳","︴"],["﹍","﹏"],["０","９"],"＿"],!1,!1),He=Rr("literal"),ze=wr("i",!1),We=Rr("string"),Ve=wr('"',!1),Ye=wr("'",!1),Qe=Pr(["\n","\r",'"',"\\",["\u2028","\u2029"]],!1,!1),Je=Pr(["\n","\r","'","\\",["\u2028","\u2029"]],!1,!1),Xe=Rr("character class"),Ke=wr("[",!1),Ze=wr("^",!1),et=wr("]",!1),tt=wr("-",!1),rt=Pr(["\n","\r",["\\","]"],["\u2028","\u2029"]],!1,!1),at=wr("0",!1),nt=Pr(['"',"'","\\"],!1,!1),ot=wr("b",!1),st=wr("f",!1),it=wr("n",!1),ct=wr("r",!1),ut=wr("t",!1),pt=wr("v",!1),lt=Pr([["0","9"],"u","x"],!1,!1),ft=wr("x",!1),dt=wr("u",!1),mt=Pr([["0","9"]],!1,!1),gt=Pr([["0","9"],["a","f"]],!1,!0),$t=Rr("code block"),ht=Pr(["{","}"],!1,!1),xt=function(e,t,r,a){return{type:"grammar",imports:e,topLevelInitializer:t,initializer:r,rules:a,location:Tr()}},bt=function(e,t){return[e,t]},vt=function(e){return{type:"top_level_initializer",code:e,codeLocation:Tr()}},At=function(e){return{type:"top_level_initializer",code:e,codeLocation:Tr()}},yt=function(e,t){return{type:"grammar_import",what:e,from:t,location:Tr()}},St=function(e){return{type:"grammar_import",what:[],from:e,location:Tr()}},_t=function(e,t){return t?Array.isArray(t)?(t.unshift(e),t):[e,t]:[e]},Et=function(e){return{type:"import_binding_default",binding:e[0],location:e[1]}},kt=function(e){return[{type:"import_binding_all",binding:e[0],location:e[1]}]},Tt=function(){return[]},Ct=function(e,t){return{type:"import_binding_rename",rename:e[0],renameLocation:e[1],binding:t[0],location:t[1]}},wt=function(e){return{type:"import_binding",binding:e[0],location:e[1]}},Pt=function(e){return{type:"import_module_specifier",module:e,location:Tr()}},Rt=function(e){return[e,Tr()]},Lt=function(e){return[e,Tr()]},Ft=function(e){return Sa.indexOf(e[0])>=0&&Cr("Binding identifier can't be a reserved word \"".concat(e[0],'"'),e[1]),e[0]},Ot=function(e){return{type:"top_level_initializer",code:e[0],codeLocation:e[1],location:Tr()}},Bt=function(e){return{type:"initializer",code:e[0],codeLocation:e[1],location:Tr()}},Mt=function(e,t,r){return{type:"rule",name:e[0],nameLocation:e[1],expression:null!==t?{type:"named",name:t,expression:r,location:Tr()}:r,location:Tr()}},Dt=function(e,t){return t.length>0?{type:"choice",alternatives:[e].concat(t),location:Tr()}:e},It=function(e,t){return null!==t?{type:"action",expression:e,code:t[0],codeLocation:t[1],location:Tr()}:e},jt=function(e,t){return t.length>0||"labeled"===e.type&&e.pick?{type:"sequence",elements:[e].concat(t),location:Tr()}:e},Nt=function(e,t,r){return r.type.startsWith("semantic_")&&Cr('"@" cannot be used on a semantic predicate',e),{type:"labeled",label:null!==t?t[0]:null,labelLocation:null!==t?t[1]:e,pick:!0,expression:r,location:Tr()}},Ut=function(e,t){return{type:"labeled",label:e[0],labelLocation:e[1],expression:t,location:Tr()}},qt=function(){return Tr()},Gt=function(e){return Sa.indexOf(e[0])>=0&&Cr("Label can't be a reserved word \"".concat(e[0],'"'),e[1]),e},Ht=function(e,t){return{type:OPS_TO_PREFIXED_TYPES[e],expression:t,location:Tr()}},zt=function(e,t){return{type:OPS_TO_SUFFIXED_TYPES[t],expression:e,location:Tr()}},Wt=function(e,t,r){var a=t[0],n=t[1];return"constant"===n.type&&0===n.value&&Cr("The maximum count of repetitions of the rule must be > 0",n.location),{type:"repeated",min:a,max:n,expression:e,delimiter:r,location:Tr()}},Vt=function(e,t){return[null!==e?e:{type:"constant",value:0},null!==t?t:{type:"constant",value:null}]},Yt=function(e){return[null,e]},Qt=function(e){return{type:"constant",value:e,location:Tr()}},Jt=function(e){return{type:"variable",value:e[0],location:Tr()}},Xt=function(e){return{type:"function",value:e[0],codeLocation:e[1],location:Tr()}},Kt=function(e){return"labeled"===e.type||"sequence"===e.type?{type:"group",expression:e,location:Tr()}:e},Zt=function(e,t){return{type:"library_ref",name:t[0],library:e[0],libraryNumber:-1,location:Tr()}},er=function(e){return{type:"rule_ref",name:e[0],location:Tr()}},tr=function(e,t){return{type:OPS_TO_SEMANTIC_PREDICATE_TYPES[e],code:t[0],codeLocation:t[1],location:Tr()}},rr=function(e,t){return[e+t.join(""),Tr()]},ar=function(e,t){return{type:"literal",value:e,ignoreCase:null!==t,location:Tr()}},nr=function(e){return e.join("")},or=function(e){return e.join("")},sr=function(e,t,r){return{type:"class",parts:t.filter((function(e){return""!==e})),inverted:null!==e,ignoreCase:null!==r,location:Tr()}},ir=function(t,r){return t.charCodeAt(0)>r.charCodeAt(0)&&Cr("Invalid character range: "+e.substring(yr,Ar)+"."),[t,r]},cr=function(){return""},ur=function(){return"\0"},pr=function(){return"\b"},lr=function(){return"\f"},fr=function(){return"\n"},dr=function(){return"\r"},mr=function(){return"\t"},gr=function(){return"\v"},$r=function(e){return String.fromCharCode(parseInt(e,16))},hr=function(e){return String.fromCharCode(parseInt(e,16))},xr=function(){return{type:"any",location:Tr()}},br=function(e){return[e,Tr()]},vr=function(e){return parseInt(e,10)},Ar=0|t.peg$currPos,yr=Ar,Sr=[{line:1,column:1}],_r=Ar,Er=t.peg$maxFailExpected||[],kr=0|t.peg$silentFails;if(t.startRule){if(!(t.startRule in o))throw new Error("Can't start parsing from rule \""+t.startRule+'".');s=o[t.startRule]}function Tr(){return Fr(yr,Ar)}function Cr(e,t){throw function(e,t){return new peg$SyntaxError(e,null,null,t)}(e,t=void 0!==t?t:Fr(yr,Ar))}function wr(e,t){return{type:"literal",text:e,ignoreCase:t}}function Pr(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Rr(e){return{type:"other",description:e}}function Lr(t){var r,a=Sr[t];if(a)return a;if(t>=Sr.length)r=Sr.length-1;else for(r=t;!Sr[--r];);for(a={line:(a=Sr[r]).line,column:a.column};r<t;)10===e.charCodeAt(r)?(a.line++,a.column=1):a.column++,r++;return Sr[t]=a,a}function Fr(e,t,r){var a=Lr(e),o=Lr(t),s={source:n,start:{offset:e,line:a.line,column:a.column},end:{offset:t,line:o.line,column:o.column}};return r&&n&&"function"==typeof n.offset&&(s.start=n.offset(s.start),s.end=n.offset(s.end)),s}function Or(e){Ar<_r||(Ar>_r&&(_r=Ar,Er=[]),Er.push(e))}function Br(){var t,r,n,o,s,i,c,u;if(t=Ar,r=Mr(),n=Ar,o=Aa(),s=function(){var t,r,n,o;return t=Ar,123===e.charCodeAt(Ar)?(r=f,Ar++):(r=a,0===kr&&Or(me)),r!==a&&(n=ba())!==a?(125===e.charCodeAt(Ar)?(o=d,Ar++):(o=a,0===kr&&Or(ge)),o!==a&&ya()!==a?(yr=t,t=Ot(n)):(Ar=t,t=a)):(Ar=t,t=a),t}(),s!==a?n=s:(Ar=n,n=a),n===a&&(n=null),o=Ar,s=Aa(),i=function(){var e,t;return e=Ar,(t=ba())!==a&&ya()!==a?(yr=e,e=Bt(t)):(Ar=e,e=a),e}(),i!==a?o=i:(Ar=o,o=a),o===a&&(o=null),s=Aa(),i=[],c=Ar,(u=Gr())!==a?(Aa(),c=u):(Ar=c,c=a),c!==a)for(;c!==a;)i.push(c),c=Ar,(u=Gr())!==a?(Aa(),c=u):(Ar=c,c=a);else i=a;return i!==a?(yr=t,t=xt(r,n,o,i)):(Ar=t,t=a),t}function Mr(){var e,t;for(e=[],t=Dr();t!==a;)e.push(t),t=Dr();return e}function Dr(){var t,r,n,o,s,p,l,f;return t=Ar,Aa(),e.substr(Ar,6)===i?(r=i,Ar+=6):(r=a,0===kr&&Or(ue)),r!==a?(Aa(),n=function(){var t,r,n,o,s;return(t=Ir())===a&&(t=jr())===a&&(t=Ar,r=function(){var e,t;return e=Ar,(t=qr())!==a&&(yr=e,t=Et(t)),e=t}(),r!==a?(n=Ar,Aa(),44===e.charCodeAt(Ar)?(o=u,Ar++):(o=a,0===kr&&Or(le)),o!==a?(Aa(),(s=Ir())===a&&(s=jr()),s!==a?n=s:(Ar=n,n=a)):(Ar=n,n=a),n===a&&(n=null),yr=t,t=_t(r,n)):(Ar=t,t=a)),t}(),n!==a?(o=Aa(),s=function(){var t,r,n;return t=Ar,e.substr(Ar,4)===m?(r=m,Ar+=4):(r=a,0===kr&&Or($e)),r!==a?(Aa(),(n=Ur())!==a?t=n:(Ar=t,t=a)):(Ar=t,t=a),t}(),s!==a?(p=Ar,l=Aa(),59===e.charCodeAt(Ar)?(f=c,Ar++):(f=a,0===kr&&Or(pe)),f!==a?p=l=[l,f]:(Ar=p,p=a),p===a&&(p=null),yr=t,t=yt(n,s)):(Ar=t,t=a)):(Ar=t,t=a)):(Ar=t,t=a),t===a&&(t=Ar,Aa(),e.substr(Ar,6)===i?(r=i,Ar+=6):(r=a,0===kr&&Or(ue)),r!==a?(Aa(),(n=Ur())!==a?(o=Ar,s=Aa(),59===e.charCodeAt(Ar)?(p=c,Ar++):(p=a,0===kr&&Or(pe)),p!==a?o=s=[s,p]:(Ar=o,o=a),o===a&&(o=null),yr=t,t=St(n)):(Ar=t,t=a)):(Ar=t,t=a)),t}function Ir(){var t,r,n,o;return t=Ar,42===e.charCodeAt(Ar)?(r=p,Ar++):(r=a,0===kr&&Or(fe)),r!==a?(Aa(),e.substr(Ar,2)===l?(n=l,Ar+=2):(n=a,0===kr&&Or(de)),n!==a?(Aa(),(o=qr())!==a?(yr=t,t=kt(o)):(Ar=t,t=a)):(Ar=t,t=a)):(Ar=t,t=a),t}function jr(){var t,r,n,o,s;return t=Ar,123===e.charCodeAt(Ar)?(r=f,Ar++):(r=a,0===kr&&Or(me)),r!==a?(Aa(),125===e.charCodeAt(Ar)?(n=d,Ar++):(n=a,0===kr&&Or(ge)),n!==a?(yr=t,t=Tt()):(Ar=t,t=a)):(Ar=t,t=a),t===a&&(t=Ar,123===e.charCodeAt(Ar)?(r=f,Ar++):(r=a,0===kr&&Or(me)),r!==a?(Aa(),n=function(){var t,r,n,o,s,i;for(t=Ar,r=[],n=Nr();n!==a;)r.push(n),n=Ar,o=Ar,s=Aa(),44===e.charCodeAt(Ar)?(i=u,Ar++):(i=a,0===kr&&Or(le)),i!==a?o=s=[s,i,Aa()]:(Ar=o,o=a),o!==a&&(o=Nr())===a?(Ar=n,n=a):n=o;return r.length<1?(Ar=t,t=a):t=r,t}(),n!==a?(Aa(),o=Ar,44===e.charCodeAt(Ar)?(s=u,Ar++):(s=a,0===kr&&Or(le)),s!==a?o=s=[s,Aa()]:(Ar=o,o=a),o===a&&(o=null),125===e.charCodeAt(Ar)?(s=d,Ar++):(s=a,0===kr&&Or(ge)),s!==a?t=n:(Ar=t,t=a)):(Ar=t,t=a)):(Ar=t,t=a)),t}function Nr(){var t,r,n,o;return t=Ar,r=function(){var e,t;return(e=oa())===a&&(e=Ar,(t=ca())!==a&&(yr=e,t=Lt(t)),e=t),e}(),r!==a?(Aa(),e.substr(Ar,2)===l?(n=l,Ar+=2):(n=a,0===kr&&Or(de)),n!==a?(Aa(),(o=qr())!==a?(yr=t,t=Ct(r,o)):(Ar=t,t=a)):(Ar=t,t=a)):(Ar=t,t=a),t===a&&(t=Ar,(r=qr())!==a&&(yr=t,r=wt(r)),t=r),t}function Ur(){var e,t;return e=Ar,(t=ca())!==a&&(yr=e,t=Pt(t)),t}function qr(){var e,t;return e=Ar,t=function(){var e,t;return e=Ar,(t=oa())!==a&&(yr=e,t=Ft(t)),e=t}(),t!==a&&(yr=e,t=Rt(t)),t}function Gr(){var t,r,n,o,s;return t=Ar,(r=oa())!==a?(Aa(),n=Ar,(o=ca())!==a?(Aa(),n=o):(Ar=n,n=a),n===a&&(n=null),61===e.charCodeAt(Ar)?(o=g,Ar++):(o=a,0===kr&&Or(he)),o!==a?(Aa(),(s=Hr())!==a&&ya()!==a?(yr=t,t=Mt(r,n,s)):(Ar=t,t=a)):(Ar=t,t=a)):(Ar=t,t=a),t}function Hr(){var t,r,n,o,s,i;if(t=Ar,(r=zr())!==a){for(n=[],o=Ar,Aa(),47===e.charCodeAt(Ar)?(s=$,Ar++):(s=a,0===kr&&Or(xe)),s!==a?(Aa(),(i=zr())!==a?o=i:(Ar=o,o=a)):(Ar=o,o=a);o!==a;)n.push(o),o=Ar,Aa(),47===e.charCodeAt(Ar)?(s=$,Ar++):(s=a,0===kr&&Or(xe)),s!==a?(Aa(),(i=zr())!==a?o=i:(Ar=o,o=a)):(Ar=o,o=a);yr=t,t=Dt(r,n)}else Ar=t,t=a;return t}function zr(){var e,t,r,n;return e=Ar,t=function(){var e,t,r,n,o;if(e=Ar,(t=Wr())!==a){for(r=[],n=Ar,Aa(),(o=Wr())!==a?n=o:(Ar=n,n=a);n!==a;)r.push(n),n=Ar,Aa(),(o=Wr())!==a?n=o:(Ar=n,n=a);yr=e,e=jt(t,r)}else Ar=e,e=a;return e}(),t!==a?(r=Ar,Aa(),(n=ba())!==a?r=n:(Ar=r,r=a),r===a&&(r=null),yr=e,e=It(t,r)):(Ar=e,e=a),e}function Wr(){var t,r,n,o;return t=Ar,r=function(){var t,r;return t=Ar,64===e.charCodeAt(Ar)?(r=h,Ar++):(r=a,0===kr&&Or(be)),r!==a&&(yr=t,r=qt()),t=r}(),r!==a?((n=Vr())===a&&(n=null),(o=Yr())!==a?(yr=t,t=Nt(r,n,o)):(Ar=t,t=a)):(Ar=t,t=a),t===a&&(t=Ar,(r=Vr())!==a?(n=Aa(),(o=Yr())!==a?(yr=t,t=Ut(r,o)):(Ar=t,t=a)):(Ar=t,t=a),t===a&&(t=Yr())),t}function Vr(){var t,r,n;return t=Ar,(r=oa())!==a?(Aa(),58===e.charCodeAt(Ar)?(n=x,Ar++):(n=a,0===kr&&Or(ve)),n!==a?(yr=t,t=Gt(r)):(Ar=t,t=a)):(Ar=t,t=a),t}function Yr(){var t,r,n;return t=Ar,r=function(){var t;return t=e.charAt(Ar),W.test(t)?Ar++:(t=a,0===kr&&Or(Ae)),t}(),r!==a?(Aa(),(n=Qr())!==a?(yr=t,t=Ht(r,n)):(Ar=t,t=a)):(Ar=t,t=a),t===a&&(t=Qr()),t}function Qr(){var t,r,n;return t=Ar,(r=Xr())!==a?(Aa(),n=function(){var t;return t=e.charAt(Ar),V.test(t)?Ar++:(t=a,0===kr&&Or(ye)),t}(),n!==a?(yr=t,t=zt(r,n)):(Ar=t,t=a)):(Ar=t,t=a),t===a&&(t=function(){var t,r,n,o,s,i,c;return t=Ar,(r=Xr())!==a?(Aa(),124===e.charCodeAt(Ar)?(n=b,Ar++):(n=a,0===kr&&Or(Se)),n!==a?(Aa(),o=function(){var t,r,n,o;return t=Ar,(r=Jr())===a&&(r=null),Aa(),e.substr(Ar,2)===v?(n=v,Ar+=2):(n=a,0===kr&&Or(_e)),n!==a?(Aa(),(o=Jr())===a&&(o=null),yr=t,t=Vt(r,o)):(Ar=t,t=a),t===a&&(t=Ar,(r=Jr())!==a&&(yr=t,r=Yt(r)),t=r),t}(),o!==a?(Aa(),s=Ar,44===e.charCodeAt(Ar)?(i=u,Ar++):(i=a,0===kr&&Or(le)),i!==a?(Aa(),(c=Hr())!==a?(Aa(),s=c):(Ar=s,s=a)):(Ar=s,s=a),s===a&&(s=null),124===e.charCodeAt(Ar)?(i=b,Ar++):(i=a,0===kr&&Or(Se)),i!==a?(yr=t,t=Wt(r,o,s)):(Ar=t,t=a)):(Ar=t,t=a)):(Ar=t,t=a)):(Ar=t,t=a),t}(),t===a&&(t=Xr())),t}function Jr(){var t,r;return t=Ar,r=function(){var t,r,n,o;if(t=Ar,r=Ar,n=[],(o=ha())!==a)for(;o!==a;)n.push(o),o=ha();else n=a;return(r=n!==a?e.substring(r,Ar):n)!==a&&(yr=t,r=vr(r)),t=r}(),r!==a&&(yr=t,r=Qt(r)),(t=r)===a&&(t=Ar,(r=oa())!==a&&(yr=t,r=Jt(r)),(t=r)===a&&(t=Ar,(r=ba())!==a&&(yr=t,r=Xt(r)),t=r)),t}function Xr(){var t,r,n,o;return t=function(){var t,r,n;return kr++,t=Ar,(r=ca())!==a?(105===e.charCodeAt(Ar)?(n=P,Ar++):(n=a,0===kr&&Or(ze)),n===a&&(n=null),yr=t,t=ar(r,n)):(Ar=t,t=a),kr--,t===a&&(r=a,0===kr&&Or(He)),t}(),t===a&&(t=function(){var t,r,n,o,s,i;if(kr++,t=Ar,91===e.charCodeAt(Ar)?(r=F,Ar++):(r=a,0===kr&&Or(Ke)),r!==a){for(94===e.charCodeAt(Ar)?(n=O,Ar++):(n=a,0===kr&&Or(Ze)),n===a&&(n=null),o=[],(s=la())===a&&(s=fa());s!==a;)o.push(s),(s=la())===a&&(s=fa());93===e.charCodeAt(Ar)?(s=B,Ar++):(s=a,0===kr&&Or(et)),s!==a?(105===e.charCodeAt(Ar)?(i=P,Ar++):(i=a,0===kr&&Or(ze)),i===a&&(i=null),yr=t,t=sr(n,o,i)):(Ar=t,t=a)}else Ar=t,t=a;return kr--,t===a&&(r=a,0===kr&&Or(Xe)),t}(),t===a&&(t=function(){var t,r;return t=Ar,46===e.charCodeAt(Ar)?(r=S,Ar++):(r=a,0===kr&&Or(Te)),r!==a&&(yr=t,r=xr()),t=r}(),t===a&&(t=function(){var t,r,n,o,s,i,c;return t=Ar,(r=oa())!==a?(46===e.charCodeAt(Ar)?(n=S,Ar++):(n=a,0===kr&&Or(Te)),n!==a&&(o=oa())!==a?(yr=t,t=Zt(r,o)):(Ar=t,t=a)):(Ar=t,t=a),t===a&&(t=Ar,(r=oa())!==a?(n=Ar,kr++,o=Ar,s=Aa(),i=Ar,(c=ca())!==a?i=c=[c,Aa()]:(Ar=i,i=a),i===a&&(i=null),61===e.charCodeAt(Ar)?(c=g,Ar++):(c=a,0===kr&&Or(he)),c!==a?o=s=[s,i,c]:(Ar=o,o=a),kr--,o===a?n=void 0:(Ar=n,n=a),n!==a?(yr=t,t=er(r)):(Ar=t,t=a)):(Ar=t,t=a)),t}(),t===a&&(t=function(){var t,r,n;return t=Ar,r=function(){var t;return t=e.charAt(Ar),Y.test(t)?Ar++:(t=a,0===kr&&Or(Ce)),t}(),r!==a?(Aa(),(n=ba())!==a?(yr=t,t=tr(r,n)):(Ar=t,t=a)):(Ar=t,t=a),t}(),t===a&&(t=Ar,40===e.charCodeAt(Ar)?(r=A,Ar++):(r=a,0===kr&&Or(Ee)),r!==a?(Aa(),(n=Hr())!==a?(Aa(),41===e.charCodeAt(Ar)?(o=y,Ar++):(o=a,0===kr&&Or(ke)),o!==a?(yr=t,t=Kt(n)):(Ar=t,t=a)):(Ar=t,t=a)):(Ar=t,t=a)))))),t}function Kr(){var t;return e.length>Ar?(t=e.charAt(Ar),Ar++):(t=a,0===kr&&Or(ce)),t}function Zr(){var t;return kr++,t=e.charAt(Ar),Q.test(t)?Ar++:(t=a,0===kr&&Or(Pe)),kr--,t===a&&0===kr&&Or(we),t}function ea(){var t;return t=e.charAt(Ar),J.test(t)?Ar++:(t=a,0===kr&&Or(Re)),t}function ta(){var t;return kr++,10===e.charCodeAt(Ar)?(t=_,Ar++):(t=a,0===kr&&Or(Fe)),t===a&&(e.substr(Ar,2)===E?(t=E,Ar+=2):(t=a,0===kr&&Or(Oe)),t===a&&(t=e.charAt(Ar),X.test(t)?Ar++:(t=a,0===kr&&Or(Be)))),kr--,t===a&&0===kr&&Or(Le),t}function ra(){var t;return kr++,(t=function(){var t,r,n,o,s,i;if(t=Ar,e.substr(Ar,2)===k?(r=k,Ar+=2):(r=a,0===kr&&Or(De)),r!==a){for(n=[],o=Ar,s=Ar,kr++,e.substr(Ar,2)===T?(i=T,Ar+=2):(i=a,0===kr&&Or(Ie)),kr--,i===a?s=void 0:(Ar=s,s=a),s!==a&&(i=Kr())!==a?o=s=[s,i]:(Ar=o,o=a);o!==a;)n.push(o),o=Ar,s=Ar,kr++,e.substr(Ar,2)===T?(i=T,Ar+=2):(i=a,0===kr&&Or(Ie)),kr--,i===a?s=void 0:(Ar=s,s=a),s!==a&&(i=Kr())!==a?o=s=[s,i]:(Ar=o,o=a);e.substr(Ar,2)===T?(o=T,Ar+=2):(o=a,0===kr&&Or(Ie)),o!==a?t=r=[r,n,o]:(Ar=t,t=a)}else Ar=t,t=a;return t}())===a&&(t=na()),kr--,t===a&&0===kr&&Or(Me),t}function aa(){var t,r,n,o,s,i;if(t=Ar,e.substr(Ar,2)===k?(r=k,Ar+=2):(r=a,0===kr&&Or(De)),r!==a){for(n=[],o=Ar,s=Ar,kr++,e.substr(Ar,2)===T?(i=T,Ar+=2):(i=a,0===kr&&Or(Ie)),i===a&&(i=ea()),kr--,i===a?s=void 0:(Ar=s,s=a),s!==a&&(i=Kr())!==a?o=s=[s,i]:(Ar=o,o=a);o!==a;)n.push(o),o=Ar,s=Ar,kr++,e.substr(Ar,2)===T?(i=T,Ar+=2):(i=a,0===kr&&Or(Ie)),i===a&&(i=ea()),kr--,i===a?s=void 0:(Ar=s,s=a),s!==a&&(i=Kr())!==a?o=s=[s,i]:(Ar=o,o=a);e.substr(Ar,2)===T?(o=T,Ar+=2):(o=a,0===kr&&Or(Ie)),o!==a?t=r=[r,n,o]:(Ar=t,t=a)}else Ar=t,t=a;return t}function na(){var t,r,n,o,s,i;if(t=Ar,e.substr(Ar,2)===C?(r=C,Ar+=2):(r=a,0===kr&&Or(je)),r!==a){for(n=[],o=Ar,s=Ar,kr++,i=ea(),kr--,i===a?s=void 0:(Ar=s,s=a),s!==a&&(i=Kr())!==a?o=s=[s,i]:(Ar=o,o=a);o!==a;)n.push(o),o=Ar,s=Ar,kr++,i=ea(),kr--,i===a?s=void 0:(Ar=s,s=a),s!==a&&(i=Kr())!==a?o=s=[s,i]:(Ar=o,o=a);t=r=[r,n]}else Ar=t,t=a;return t}function oa(){var e,t,r,n;if(kr++,e=Ar,(t=sa())!==a){for(r=[],n=ia();n!==a;)r.push(n),n=ia();yr=e,e=rr(t,r)}else Ar=e,e=a;return kr--,e===a&&(t=a,0===kr&&Or(Ne)),e}function sa(){var t,r,n;return t=e.charAt(Ar),K.test(t)?Ar++:(t=a,0===kr&&Or(Ue)),t===a&&(t=Ar,92===e.charCodeAt(Ar)?(r=w,Ar++):(r=a,0===kr&&Or(qe)),r!==a&&(n=$a())!==a?t=n:(Ar=t,t=a)),t}function ia(){var t;return(t=sa())===a&&(t=e.charAt(Ar),Z.test(t)?Ar++:(t=a,0===kr&&Or(Ge))),t}function ca(){var t,r,n,o;if(kr++,t=Ar,34===e.charCodeAt(Ar)?(r=R,Ar++):(r=a,0===kr&&Or(Ve)),r!==a){for(n=[],o=ua();o!==a;)n.push(o),o=ua();34===e.charCodeAt(Ar)?(o=R,Ar++):(o=a,0===kr&&Or(Ve)),o!==a?(yr=t,t=nr(n)):(Ar=t,t=a)}else Ar=t,t=a;if(t===a)if(t=Ar,39===e.charCodeAt(Ar)?(r=L,Ar++):(r=a,0===kr&&Or(Ye)),r!==a){for(n=[],o=pa();o!==a;)n.push(o),o=pa();39===e.charCodeAt(Ar)?(o=L,Ar++):(o=a,0===kr&&Or(Ye)),o!==a?(yr=t,t=or(n)):(Ar=t,t=a)}else Ar=t,t=a;return kr--,t===a&&(r=a,0===kr&&Or(We)),t}function ua(){var t,r,n,o;return t=Ar,r=Ar,n=Ar,kr++,o=e.charAt(Ar),ee.test(o)?Ar++:(o=a,0===kr&&Or(Qe)),kr--,o===a?n=void 0:(Ar=n,n=a),n!==a&&(o=Kr())!==a?r=n=[n,o]:(Ar=r,r=a),(t=r!==a?e.substring(t,Ar):r)===a&&(t=Ar,92===e.charCodeAt(Ar)?(r=w,Ar++):(r=a,0===kr&&Or(qe)),r!==a&&(n=ma())!==a?t=n:(Ar=t,t=a),t===a&&(t=da())),t}function pa(){var t,r,n,o;return t=Ar,r=Ar,n=Ar,kr++,o=e.charAt(Ar),te.test(o)?Ar++:(o=a,0===kr&&Or(Je)),kr--,o===a?n=void 0:(Ar=n,n=a),n!==a&&(o=Kr())!==a?r=n=[n,o]:(Ar=r,r=a),(t=r!==a?e.substring(t,Ar):r)===a&&(t=Ar,92===e.charCodeAt(Ar)?(r=w,Ar++):(r=a,0===kr&&Or(qe)),r!==a&&(n=ma())!==a?t=n:(Ar=t,t=a),t===a&&(t=da())),t}function la(){var t,r,n,o;return t=Ar,(r=fa())!==a?(45===e.charCodeAt(Ar)?(n=M,Ar++):(n=a,0===kr&&Or(tt)),n!==a&&(o=fa())!==a?(yr=t,t=ir(r,o)):(Ar=t,t=a)):(Ar=t,t=a),t}function fa(){var t,r,n,o;return t=Ar,r=Ar,n=Ar,kr++,o=e.charAt(Ar),re.test(o)?Ar++:(o=a,0===kr&&Or(rt)),kr--,o===a?n=void 0:(Ar=n,n=a),n!==a&&(o=Kr())!==a?r=n=[n,o]:(Ar=r,r=a),(t=r!==a?e.substring(t,Ar):r)===a&&(t=Ar,92===e.charCodeAt(Ar)?(r=w,Ar++):(r=a,0===kr&&Or(qe)),r!==a&&(n=ma())!==a?t=n:(Ar=t,t=a),t===a&&(t=da())),t}function da(){var t,r;return t=Ar,92===e.charCodeAt(Ar)?(r=w,Ar++):(r=a,0===kr&&Or(qe)),r!==a&&ta()!==a?(yr=t,t=cr()):(Ar=t,t=a),t}function ma(){var t,r,n,o;return t=function(){var t;return(t=ga())===a&&(t=function(){var t,r,n,o;return t=Ar,r=Ar,n=Ar,kr++,o=function(){var t;return(t=ga())===a&&(t=e.charAt(Ar),ne.test(t)?Ar++:(t=a,0===kr&&Or(lt))),t}(),o===a&&(o=ea()),kr--,o===a?n=void 0:(Ar=n,n=a),n!==a&&(o=Kr())!==a?r=n=[n,o]:(Ar=r,r=a),t=r!==a?e.substring(t,Ar):r}()),t}(),t===a&&(t=Ar,48===e.charCodeAt(Ar)?(r=D,Ar++):(r=a,0===kr&&Or(at)),r!==a?(n=Ar,kr++,o=ha(),kr--,o===a?n=void 0:(Ar=n,n=a),n!==a?(yr=t,t=ur()):(Ar=t,t=a)):(Ar=t,t=a),t===a&&(t=function(){var t,r,n,o,s,i;return t=Ar,120===e.charCodeAt(Ar)?(r=H,Ar++):(r=a,0===kr&&Or(ft)),r!==a?(n=Ar,o=Ar,(s=xa())!==a&&(i=xa())!==a?o=s=[s,i]:(Ar=o,o=a),(n=o!==a?e.substring(n,Ar):o)!==a?(yr=t,t=$r(n)):(Ar=t,t=a)):(Ar=t,t=a),t}(),t===a&&(t=$a()))),t}function ga(){var t,r;return t=e.charAt(Ar),ae.test(t)?Ar++:(t=a,0===kr&&Or(nt)),t===a&&(t=Ar,98===e.charCodeAt(Ar)?(r=I,Ar++):(r=a,0===kr&&Or(ot)),r!==a&&(yr=t,r=pr()),(t=r)===a&&(t=Ar,102===e.charCodeAt(Ar)?(r=j,Ar++):(r=a,0===kr&&Or(st)),r!==a&&(yr=t,r=lr()),(t=r)===a&&(t=Ar,110===e.charCodeAt(Ar)?(r=N,Ar++):(r=a,0===kr&&Or(it)),r!==a&&(yr=t,r=fr()),(t=r)===a&&(t=Ar,114===e.charCodeAt(Ar)?(r=U,Ar++):(r=a,0===kr&&Or(ct)),r!==a&&(yr=t,r=dr()),(t=r)===a&&(t=Ar,116===e.charCodeAt(Ar)?(r=q,Ar++):(r=a,0===kr&&Or(ut)),r!==a&&(yr=t,r=mr()),(t=r)===a&&(t=Ar,118===e.charCodeAt(Ar)?(r=G,Ar++):(r=a,0===kr&&Or(pt)),r!==a&&(yr=t,r=gr()),t=r)))))),t}function $a(){var t,r,n,o,s,i,c,u;return t=Ar,117===e.charCodeAt(Ar)?(r=z,Ar++):(r=a,0===kr&&Or(dt)),r!==a?(n=Ar,o=Ar,(s=xa())!==a&&(i=xa())!==a&&(c=xa())!==a&&(u=xa())!==a?o=s=[s,i,c,u]:(Ar=o,o=a),(n=o!==a?e.substring(n,Ar):o)!==a?(yr=t,t=hr(n)):(Ar=t,t=a)):(Ar=t,t=a),t}function ha(){var t;return t=e.charAt(Ar),oe.test(t)?Ar++:(t=a,0===kr&&Or(mt)),t}function xa(){var t;return t=e.charAt(Ar),se.test(t)?Ar++:(t=a,0===kr&&Or(gt)),t}function ba(){var t,r,n,o;return kr++,t=Ar,123===e.charCodeAt(Ar)?(r=f,Ar++):(r=a,0===kr&&Or(me)),r!==a?(n=function(){var e,t;return e=Ar,t=va(),yr=e,e=t=br(t)}(),125===e.charCodeAt(Ar)?(o=d,Ar++):(o=a,0===kr&&Or(ge)),o!==a?t=n:(Ar=t,t=a)):(Ar=t,t=a),kr--,t===a&&(r=a,0===kr&&Or($t)),t}function va(){var t,r,n,o,s,i;if(t=Ar,r=[],n=[],o=Ar,s=Ar,kr++,i=e.charAt(Ar),ie.test(i)?Ar++:(i=a,0===kr&&Or(ht)),kr--,i===a?s=void 0:(Ar=s,s=a),s!==a&&(i=Kr())!==a?o=s=[s,i]:(Ar=o,o=a),o!==a)for(;o!==a;)n.push(o),o=Ar,s=Ar,kr++,i=e.charAt(Ar),ie.test(i)?Ar++:(i=a,0===kr&&Or(ht)),kr--,i===a?s=void 0:(Ar=s,s=a),s!==a&&(i=Kr())!==a?o=s=[s,i]:(Ar=o,o=a);else n=a;for(n===a&&(n=Ar,123===e.charCodeAt(Ar)?(o=f,Ar++):(o=a,0===kr&&Or(me)),o!==a?(s=va(),125===e.charCodeAt(Ar)?(i=d,Ar++):(i=a,0===kr&&Or(ge)),i!==a?n=o=[o,s,i]:(Ar=n,n=a)):(Ar=n,n=a));n!==a;){if(r.push(n),n=[],o=Ar,s=Ar,kr++,i=e.charAt(Ar),ie.test(i)?Ar++:(i=a,0===kr&&Or(ht)),kr--,i===a?s=void 0:(Ar=s,s=a),s!==a&&(i=Kr())!==a?o=s=[s,i]:(Ar=o,o=a),o!==a)for(;o!==a;)n.push(o),o=Ar,s=Ar,kr++,i=e.charAt(Ar),ie.test(i)?Ar++:(i=a,0===kr&&Or(ht)),kr--,i===a?s=void 0:(Ar=s,s=a),s!==a&&(i=Kr())!==a?o=s=[s,i]:(Ar=o,o=a);else n=a;n===a&&(n=Ar,123===e.charCodeAt(Ar)?(o=f,Ar++):(o=a,0===kr&&Or(me)),o!==a?(s=va(),125===e.charCodeAt(Ar)?(i=d,Ar++):(i=a,0===kr&&Or(ge)),i!==a?n=o=[o,s,i]:(Ar=n,n=a)):(Ar=n,n=a))}return e.substring(t,Ar)}function Aa(){var e,t;for(e=[],(t=Zr())===a&&(t=ta())===a&&(t=ra());t!==a;)e.push(t),(t=Zr())===a&&(t=ta())===a&&(t=ra());return e}function ya(){var t,r,n,o;if(t=[],r=Ar,n=Aa(),59===e.charCodeAt(Ar)?(o=c,Ar++):(o=a,0===kr&&Or(pe)),o!==a?r=n=[n,o]:(Ar=r,r=a),r!==a)for(;r!==a;)t.push(r),r=Ar,n=Aa(),59===e.charCodeAt(Ar)?(o=c,Ar++):(o=a,0===kr&&Or(pe)),o!==a?r=n=[n,o]:(Ar=r,r=a);else t=a;return t===a&&(t=Ar,r=function(){var e,t;for(e=[],(t=Zr())===a&&(t=aa());t!==a;)e.push(t),(t=Zr())===a&&(t=aa());return e}(),(n=na())===a&&(n=null),(o=ta())!==a?t=r=[r,n,o]:(Ar=t,t=a),t===a&&(t=Ar,r=Aa(),n=function(){var t,r;return t=Ar,kr++,e.length>Ar?(r=e.charAt(Ar),Ar++):(r=a,0===kr&&Or(ce)),kr--,r===a?t=void 0:(Ar=t,t=a),t}(),n!==a?t=r=[r,n]:(Ar=t,t=a))),t}var Sa=t.reservedWords||[];if(r=s(),t.peg$library)return{peg$result:r,peg$currPos:Ar,peg$FAILED:a,peg$maxFailExpected:Er,peg$maxFailPos:_r};if(r!==a&&Ar===e.length)return r;throw r!==a&&Ar<e.length&&Or({type:"end"}),function(e,t,r){return new peg$SyntaxError(peg$SyntaxError.buildMessage(e,t),e,t,r)}(Er,_r<e.length?e.charAt(_r):null,_r<e.length?Fr(_r,_r+1):Fr(_r,_r))}peg$subclass(peg$SyntaxError,Error),peg$SyntaxError.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var r,a=null;for(r=0;r<e.length;r++)if(e[r].source===this.location.source){a=e[r].text.split(/\r\n|\n|\r/g);break}var n=this.location.start,o=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(n):n,s=this.location.source+":"+o.line+":"+o.column;if(a){var i=this.location.end,c=peg$padEnd("",o.line.toString().length," "),u=a[n.line-1],p=(n.line===i.line?i.column:u.length+1)-n.column||1;t+="\n --\x3e "+s+"\n"+c+" |\n"+o.line+" | "+u+"\n"+c+" | "+peg$padEnd("",n.column-1," ")+peg$padEnd("",p,"^")}else t+="\n at "+s}return t},peg$SyntaxError.buildMessage=function(e,t){var r={literal:function(e){return'"'+n(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?o(e[0])+"-"+o(e[1]):o(e)}));return"["+(e.inverted?"^":"")+t.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function a(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+a(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+a(e)}))}function o(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+a(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+a(e)}))}function s(e){return r[e.type](e)}return"Expected "+function(e){var t,r,a=e.map(s);if(a.sort(),a.length>0){for(t=1,r=1;t<a.length;t++)a[t-1]!==a[t]&&(a[r]=a[t],r++);a.length=r}switch(a.length){case 1:return a[0];case 2:return a[0]+" or "+a[1];default:return a.slice(0,-1).join(", ")+", or "+a[a.length-1]}}(e)+" but "+function(e){return e?'"'+n(e)+'"':"end of input"}(t)+" found."};var parser$4={StartRules:["Grammar","ImportsAndSource"],SyntaxError:peg$SyntaxError,parse:peg$parse},__spreadArray$4=commonjsGlobal&&commonjsGlobal.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var a,n=0,o=t.length;n<o;n++)!a&&n in t||(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))},asts$5=asts_1,op$1=opcodes_1,Stack$1=stack,VERSION$1=version$1,_a$3=utils$1,stringEscape$1=_a$3.stringEscape,regexpClassEscape$1=_a$3.regexpClassEscape,SourceNode$2=sourceMap$1.SourceNode,GrammarLocation$2=grammarLocation,parse=parser$4.parse;function toSourceNode(e,t,r){var a=GrammarLocation$2.offsetStart(t),n=a.line,o=a.column-1,s=e.split("\n");return 1===s.length?new SourceNode$2(n,o,String(t.source),e,r):new SourceNode$2(null,null,String(t.source),s.map((function(e,a){return new SourceNode$2(n+a,0===a?o:0,String(t.source),a===s.length-1?e:[e,"\n"],r)})))}function wrapInSourceNode(e,t,r,a,n){if(r){var o=GrammarLocation$2.offsetEnd(r);return new SourceNode$2(null,null,String(r.source),[e,toSourceNode(t,r,n),new SourceNode$2(o.line,o.column-1,String(r.source),a)])}return new SourceNode$2(null,null,null,[e,t,a])}function generateJS$1(e,t){if(!(e.literals&&e.locations&&e.classes&&e.expectations&&e.functions&&e.importedNames))throw new Error("generateJS: generate bytecode was not called.");var r=e.literals,a=e.locations,n=e.classes,o=e.expectations,s=e.functions,i=e.importedNames;if(!t.allowedStartRules)throw new Error("generateJS: options.allowedStartRules was not set.");var c=t.allowedStartRules,u=t.dependencies||{};function p(e){var t=!0,r=0;return function e(a){return Array.isArray(a)?a.map((function(t){return e(t)})):a instanceof SourceNode$2?(r++,a.children=e(a.children),r--,a):(a=t?a.replace(/^(.+)$/gm,"  $1"):a.replace(/\n(\s*\S)/g,"\n  $1"),t=!r||a.endsWith("\n"),a)}(e)}function l(e){return"peg$c"+e}function f(e){return"peg$r"+e}function d(e){return"peg$e"+e}function m(e){return"peg$f"+e}function g(e){return"peg$import"+e}function $(e){return"peg$parse"+e}function h(e){return e.codeLocation?toSourceNode(e.code,e.codeLocation,"$"+e.type):e.code}e.code=function(r){function a(){return["// @generated by Peggy ".concat(VERSION$1,"."),"//","// https://peggyjs.org/"]}function n(){var e=["{"];return t.trace&&e.push("  DefaultTracer: peg$DefaultTracer,"),t.allowedStartRules&&e.push("  StartRules: ["+t.allowedStartRules.map((function(e){return'"'+e+'"'})).join(", ")+"],"),e.push("  SyntaxError: peg$SyntaxError,","  parse: peg$parse"),e.push("}"),e.join("\n")}var o={bare:function(){if(Object.keys(u).length>0||e.imports.length>0)throw new Error("Dependencies not supported in format 'bare'.");return __spreadArray$4(__spreadArray$4([],a(),!0),["(function() {",'  "use strict";',"",r,"",p("return "+n()+";"),"})()"],!1)},commonjs:function(){var t=Object.keys(u),o=a();o.push("",'"use strict";',""),t.length>0&&(t.forEach((function(e){o.push("var "+e+' = require("'+stringEscape$1(u[e])+'");')})),o.push(""));for(var s=e.imports.length,i=0;i<s;i++)o.push("var "+g(i)+' = require("'+stringEscape$1(e.imports[i].from.module)+'");');return o.push("",r,"","module.exports = "+n()+";"),o},es:function(){var n=Object.keys(u),o=a();o.push(""),n.length>0&&(n.forEach((function(e){o.push("import "+e+' from "'+stringEscape$1(u[e])+'";')})),o.push(""));for(var s=0;s<e.imports.length;s++)o.push("import * as "+g(s)+' from "'+stringEscape$1(e.imports[s].from.module)+'";');return o.push("",r,""),o.push("const peg$allowedStartRules = [","  "+(t.allowedStartRules?t.allowedStartRules.map((function(e){return'"'+e+'"'})).join(",\n  "):""),"];",""),o.push("export {"),t.trace&&o.push("  peg$DefaultTracer as DefaultTracer,"),o.push("  peg$allowedStartRules as StartRules,","  peg$SyntaxError as SyntaxError,","  peg$parse as parse","};"),o},amd:function(){if(e.imports.length>0)throw new Error("Imports are not supported in format 'amd'.");var t=Object.keys(u),o="["+t.map((function(e){return u[e]})).map((function(e){return'"'+stringEscape$1(e)+'"'})).join(", ")+"]",s=t.join(", ");return __spreadArray$4(__spreadArray$4([],a(),!0),["define("+o+", function("+s+") {",'  "use strict";',"",r,"",p("return "+n()+";"),"});"],!1)},globals:function(){if(Object.keys(u).length>0||e.imports.length>0)throw new Error("Dependencies not supported in format 'globals'.");if(!t.exportVar)throw new Error("No export variable defined");return __spreadArray$4(__spreadArray$4([],a(),!0),["(function(root) {",'  "use strict";',"",r,"",p("root."+t.exportVar+" = "+n()+";"),"})(this);"],!1)},umd:function(){if(e.imports.length>0)throw new Error("Imports are not supported in format 'umd'.");var o=Object.keys(u),s=o.map((function(e){return u[e]})),i="["+s.map((function(e){return'"'+stringEscape$1(e)+'"'})).join(", ")+"]",c=s.map((function(e){return'require("'+stringEscape$1(e)+'")'})).join(", "),l=o.join(", "),f=a();return f.push("(function(root, factory) {",'  if (typeof define === "function" && define.amd) {',"    define("+i+", factory);",'  } else if (typeof module === "object" && module.exports) {',"    module.exports = factory("+c+");"),t.exportVar&&f.push("  } else {","    root."+t.exportVar+" = factory();"),f.push("  }","})(this, function("+l+") {",'  "use strict";',"",r,"",p("return "+n()+";"),"});"),f}},s=o[t.format||"bare"]();return new SourceNode$2(null,null,t.grammarSource,s.map((function(e){return e instanceof SourceNode$2?e:e+"\n"})))}(function(){var u=[],x=e.topLevelInitializer;if(x)if(Array.isArray(x)){if("es"===t.format){for(var b=[],v=[],A=0,y=x;A<y.length;A++){var S=y[A],_=parse(S.code,{startRule:"ImportsAndSource",grammarSource:new GrammarLocation$2(S.codeLocation.source,S.codeLocation.start)}),E=_[0],k=_[1];E.code?(b.push(E),v.push(k)):v.push(S)}x=v.concat(b)}for(var T=0,C=x.slice(0).reverse();T<C.length;T++)S=C[T],u.push(h(S)),u.push("")}else u.push(h(x)),u.push("");u.push("function peg$subclass(child, parent) {","  function C() { this.constructor = child; }","  C.prototype = parent.prototype;","  child.prototype = new C();","}","","function peg$SyntaxError(message, expected, found, location) {","  var self = Error.call(this, message);","  // istanbul ignore next Check is a necessary evil to support older environments","  if (Object.setPrototypeOf) {","    Object.setPrototypeOf(self, peg$SyntaxError.prototype);","  }","  self.expected = expected;","  self.found = found;","  self.location = location;",'  self.name = "SyntaxError";',"  return self;","}","","peg$subclass(peg$SyntaxError, Error);","","function peg$padEnd(str, targetLength, padString) {",'  padString = padString || " ";',"  if (str.length > targetLength) { return str; }","  targetLength -= str.length;","  padString += padString.repeat(targetLength);","  return str + padString.slice(0, targetLength);","}","","peg$SyntaxError.prototype.format = function(sources) {",'  var str = "Error: " + this.message;',"  if (this.location) {","    var src = null;","    var k;","    for (k = 0; k < sources.length; k++) {","      if (sources[k].source === this.location.source) {","        src = sources[k].text.split(/\\r\\n|\\n|\\r/g);","        break;","      }","    }","    var s = this.location.start;",'    var offset_s = (this.location.source && (typeof this.location.source.offset === "function"))',"      ? this.location.source.offset(s)","      : s;",'    var loc = this.location.source + ":" + offset_s.line + ":" + offset_s.column;',"    if (src) {","      var e = this.location.end;","      var filler = peg$padEnd(\"\", offset_s.line.toString().length, ' ');","      var line = src[s.line - 1];","      var last = s.line === e.line ? e.column : line.length + 1;","      var hatLen = (last - s.column) || 1;",'      str += "\\n --\x3e " + loc + "\\n"','          + filler + " |\\n"','          + offset_s.line + " | " + line + "\\n"','          + filler + " | " + peg$padEnd("", s.column - 1, \' \')','          + peg$padEnd("", hatLen, "^");',"    } else {",'      str += "\\n at " + loc;',"    }","  }","  return str;","};","","peg$SyntaxError.buildMessage = function(expected, found) {","  var DESCRIBE_EXPECTATION_FNS = {","    literal: function(expectation) {",'      return "\\"" + literalEscape(expectation.text) + "\\"";',"    },","","    class: function(expectation) {","      var escapedParts = expectation.parts.map(function(part) {","        return Array.isArray(part)",'          ? classEscape(part[0]) + "-" + classEscape(part[1])',"          : classEscape(part);","      });","",'      return "[" + (expectation.inverted ? "^" : "") + escapedParts.join("") + "]";',"    },","","    any: function() {",'      return "any character";',"    },","","    end: function() {",'      return "end of input";',"    },","","    other: function(expectation) {","      return expectation.description;","    }","  };","","  function hex(ch) {","    return ch.charCodeAt(0).toString(16).toUpperCase();","  }","","  function literalEscape(s) {","    return s",'      .replace(/\\\\/g, "\\\\\\\\")','      .replace(/"/g,  "\\\\\\"")','      .replace(/\\0/g, "\\\\0")','      .replace(/\\t/g, "\\\\t")','      .replace(/\\n/g, "\\\\n")','      .replace(/\\r/g, "\\\\r")','      .replace(/[\\x00-\\x0F]/g,          function(ch) { return "\\\\x0" + hex(ch); })','      .replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, function(ch) { return "\\\\x"  + hex(ch); });',"  }","","  function classEscape(s) {","    return s",'      .replace(/\\\\/g, "\\\\\\\\")','      .replace(/\\]/g, "\\\\]")','      .replace(/\\^/g, "\\\\^")','      .replace(/-/g,  "\\\\-")','      .replace(/\\0/g, "\\\\0")','      .replace(/\\t/g, "\\\\t")','      .replace(/\\n/g, "\\\\n")','      .replace(/\\r/g, "\\\\r")','      .replace(/[\\x00-\\x0F]/g,          function(ch) { return "\\\\x0" + hex(ch); })','      .replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, function(ch) { return "\\\\x"  + hex(ch); });',"  }","","  function describeExpectation(expectation) {","    return DESCRIBE_EXPECTATION_FNS[expectation.type](expectation);","  }","","  function describeExpected(expected) {","    var descriptions = expected.map(describeExpectation);","    var i, j;","","    descriptions.sort();","","    if (descriptions.length > 0) {","      for (i = 1, j = 1; i < descriptions.length; i++) {","        if (descriptions[i - 1] !== descriptions[i]) {","          descriptions[j] = descriptions[i];","          j++;","        }","      }","      descriptions.length = j;","    }","","    switch (descriptions.length) {","      case 1:","        return descriptions[0];","","      case 2:",'        return descriptions[0] + " or " + descriptions[1];',"","      default:",'        return descriptions.slice(0, -1).join(", ")','          + ", or "',"          + descriptions[descriptions.length - 1];","    }","  }","","  function describeFound(found) {",'    return found ? "\\"" + literalEscape(found) + "\\"" : "end of input";',"  }","",'  return "Expected " + describeExpected(expected) + " but " + describeFound(found) + " found.";',"};",""),t.trace&&u.push("function peg$DefaultTracer() {","  this.indentLevel = 0;","}","","peg$DefaultTracer.prototype.trace = function(event) {","  var that = this;","","  function log(event) {","    function repeat(string, n) {",'       var result = "", i;',"","       for (i = 0; i < n; i++) {","         result += string;","       }","","       return result;","    }","","    function pad(string, length) {",'      return string + repeat(" ", length - string.length);',"    }","",'    if (typeof console === "object") {',"      console.log(",'        event.location.start.line + ":" + event.location.start.column + "-"','          + event.location.end.line + ":" + event.location.end.column + " "','          + pad(event.type, 10) + " "','          + repeat("  ", that.indentLevel) + event.rule',"      );","    }","  }","","  switch (event.type) {",'    case "rule.enter":',"      log(event);","      this.indentLevel++;","      break;","",'    case "rule.match":',"      this.indentLevel--;","      log(event);","      break;","",'    case "rule.fail":',"      this.indentLevel--;","      log(event);","      break;","","    default:",'      throw new Error("Invalid event type: " + event.type + ".");',"  }","};","");var w="{ "+c.map((function(e){return e+": "+$(e)})).join(", ")+" }",P=$(c[0]);if(u.push("function peg$parse(input, options) {","  options = options !== undefined ? options : {};","","  var peg$FAILED = {};","  var peg$source = options.grammarSource;","","  var peg$startRuleFunctions = "+w+";","  var peg$startRuleFunction = "+P+";","",new SourceNode$2(null,null,t.grammarSource,__spreadArray$4([r.map((function(e,t){return"  var "+l(t)+' = "'+stringEscape$1(e)+'";'})).concat("",n.map((function(e,t){return"  var "+f(t)+" = /^["+((r=e).inverted?"^":"")+r.value.map((function(e){return Array.isArray(e)?regexpClassEscape$1(e[0])+"-"+regexpClassEscape$1(e[1]):regexpClassEscape$1(e)})).join("")+"]/"+(r.ignoreCase?"i":"")+";";var r}))).concat("",o.map((function(e,t){return"  var "+d(t)+" = "+function(e){switch(e.type){case"rule":return'peg$otherExpectation("'+stringEscape$1(e.value)+'")';case"literal":return'peg$literalExpectation("'+stringEscape$1(e.value)+'", '+e.ignoreCase+")";case"class":return"peg$classExpectation(["+e.value.map((function(e){return Array.isArray(e)?'["'+stringEscape$1(e[0])+'", "'+stringEscape$1(e[1])+'"]':'"'+stringEscape$1(e)+'"'})).join(", ")+"], "+e.inverted+", "+e.ignoreCase+")";case"any":return"peg$anyExpectation()";default:throw new Error("Unknown expectation type ("+JSON.stringify(e)+")")}}(e)+";"}))).concat("").join("\n")],s.map((function(e,t){return wrapInSourceNode("\n  var ".concat(m(t)," = function(").concat(e.params.join(", "),") {"),e.body,e.location,"};")})),!0)),"","  var peg$currPos = options.peg$currPos | 0;","  var peg$savedPos = peg$currPos;","  var peg$posDetailsCache = [{ line: 1, column: 1 }];","  var peg$maxFailPos = peg$currPos;","  var peg$maxFailExpected = options.peg$maxFailExpected || [];","  var peg$silentFails = options.peg$silentFails | 0;",""),t.cache&&u.push("  var peg$resultsCache = {};",""),t.trace&&u.push('  var peg$tracer = "tracer" in options ? options.tracer : new peg$DefaultTracer();',""),u.push("  var peg$result;","","  if (options.startRule) {","    if (!(options.startRule in peg$startRuleFunctions)) {",'      throw new Error("Can\'t start parsing from rule \\"" + options.startRule + "\\".");',"    }","","    peg$startRuleFunction = peg$startRuleFunctions[options.startRule];","  }","","  function text() {","    return input.substring(peg$savedPos, peg$currPos);","  }","","  function offset() {","    return peg$savedPos;","  }","","  function range() {","    return {","      source: peg$source,","      start: peg$savedPos,","      end: peg$currPos","    };","  }","","  function location() {","    return peg$computeLocation(peg$savedPos, peg$currPos);","  }","","  function expected(description, location) {","    location = location !== undefined","      ? location","      : peg$computeLocation(peg$savedPos, peg$currPos);","","    throw peg$buildStructuredError(","      [peg$otherExpectation(description)],","      input.substring(peg$savedPos, peg$currPos),","      location","    );","  }","","  function error(message, location) {","    location = location !== undefined","      ? location","      : peg$computeLocation(peg$savedPos, peg$currPos);","","    throw peg$buildSimpleError(message, location);","  }","","  function peg$literalExpectation(text, ignoreCase) {",'    return { type: "literal", text: text, ignoreCase: ignoreCase };',"  }","","  function peg$classExpectation(parts, inverted, ignoreCase) {",'    return { type: "class", parts: parts, inverted: inverted, ignoreCase: ignoreCase };',"  }","","  function peg$anyExpectation() {",'    return { type: "any" };',"  }","","  function peg$endExpectation() {",'    return { type: "end" };',"  }","","  function peg$otherExpectation(description) {",'    return { type: "other", description: description };',"  }","","  function peg$computePosDetails(pos) {","    var details = peg$posDetailsCache[pos];","    var p;","","    if (details) {","      return details;","    } else {","      if (pos >= peg$posDetailsCache.length) {","        p = peg$posDetailsCache.length - 1;","      } else {","        p = pos;","        while (!peg$posDetailsCache[--p]) {}","      }","","      details = peg$posDetailsCache[p];","      details = {","        line: details.line,","        column: details.column","      };","","      while (p < pos) {","        if (input.charCodeAt(p) === 10) {","          details.line++;","          details.column = 1;","        } else {","          details.column++;","        }","","        p++;","      }","","      peg$posDetailsCache[pos] = details;","","      return details;","    }","  }","","  function peg$computeLocation(startPos, endPos, offset) {","    var startPosDetails = peg$computePosDetails(startPos);","    var endPosDetails = peg$computePosDetails(endPos);","","    var res = {","      source: peg$source,","      start: {","        offset: startPos,","        line: startPosDetails.line,","        column: startPosDetails.column","      },","      end: {","        offset: endPos,","        line: endPosDetails.line,","        column: endPosDetails.column","      }","    };",'    if (offset && peg$source && (typeof peg$source.offset === "function")) {',"      res.start = peg$source.offset(res.start);","      res.end = peg$source.offset(res.end);","    }","    return res;","  }","","  function peg$fail(expected) {","    if (peg$currPos < peg$maxFailPos) { return; }","","    if (peg$currPos > peg$maxFailPos) {","      peg$maxFailPos = peg$currPos;","      peg$maxFailExpected = [];","    }","","    peg$maxFailExpected.push(expected);","  }","","  function peg$buildSimpleError(message, location) {","    return new peg$SyntaxError(message, null, null, location);","  }","","  function peg$buildStructuredError(expected, found, location) {","    return new peg$SyntaxError(","      peg$SyntaxError.buildMessage(expected, found),","      expected,","      found,","      location","    );","  }",""),e.imports.length>0&&u.push("  var peg$assign = Object.assign || function(t) {","    var i, s;","    for (i = 1; i < arguments.length; i++) {","      s = arguments[i];","      for (var p in s) {","        if (Object.prototype.hasOwnProperty.call(s, p)) {","          t[p] = s[p];","        }","      }","    }","    return t;","  };","","  function peg$callLibrary(lib, startRule) {","    const opts = peg$assign({}, options, {","      startRule: startRule,","      peg$currPos: peg$currPos,","      peg$silentFails: peg$silentFails,","      peg$library: true,","      peg$maxFailExpected: peg$maxFailExpected","    });","    const res = lib.parse(input, opts);","    peg$currPos = res.peg$currPos;","    peg$maxFailPos = res.peg$maxFailPos;","    peg$maxFailExpected = res.peg$maxFailExpected;","    return (res.peg$result === res.peg$FAILED) ? peg$FAILED : res.peg$result;","  }",""),e.rules.forEach((function(n){u.push.apply(u,p(function(n){var o=[],s=n.bytecode,c=new Stack$1(n.name,"s","var",s),u=function t(n){var o=0,s=n.length,u=[],h=void 0;function x(e,r,a){var s=r+3,i=n[o+s-2],l=n[o+s-1],f=c.checkedIf(o,(function(){return o+=s+i,(a||t)(n.slice(o-i,o))}),l>0?function(){return o+=l,t(n.slice(o-l,o))}:null),d=f[0],m=f[1];u.push("if ("+e+") {"),u.push.apply(u,p(d)),l>0&&(u.push("} else {"),u.push.apply(u,p(m))),u.push("}")}function b(e,r,a){var s=r+3,i=1===a?"input.charAt(peg$currPos)":"input.substr(peg$currPos, "+a+")",p=null;n[o+s]===op$1.ACCEPT_N&&n[o+s+1]===a&&(u.push(c.push(i)),i=c.pop(),p=function(e){c.sp++;var r=t(e.slice(2));return r.unshift(1===a?"peg$currPos++;":"peg$currPos += "+a+";"),r}),x(e(i,null!==p),r,p)}for(var v=function(){switch(n[o]){case op$1.PUSH_EMPTY_STRING:u.push(c.push("''")),o++;break;case op$1.PUSH_CURR_POS:u.push(c.push("peg$currPos")),o++;break;case op$1.PUSH_UNDEFINED:u.push(c.push("undefined")),o++;break;case op$1.PUSH_NULL:u.push(c.push("null")),o++;break;case op$1.PUSH_FAILED:u.push(c.push("peg$FAILED")),o++;break;case op$1.PUSH_EMPTY_ARRAY:u.push(c.push("[]")),o++;break;case op$1.POP:c.pop(),o++;break;case op$1.POP_CURR_POS:u.push("peg$currPos = "+c.pop()+";"),o++;break;case op$1.POP_N:c.pop(n[o+1]),o+=2;break;case op$1.NIP:h=c.pop(),c.pop(),u.push(c.push(h)),o++;break;case op$1.APPEND:h=c.pop(),u.push(c.top()+".push("+h+");"),o++;break;case op$1.WRAP:u.push(c.push("["+c.pop(n[o+1]).join(", ")+"]")),o+=2;break;case op$1.TEXT:u.push(c.push("input.substring("+c.pop()+", peg$currPos)")),o++;break;case op$1.PLUCK:var s=n[o+3-1],v=3+s;h=n.slice(o+3,o+v),h=1===s?c.index(h[0]):"[ ".concat(h.map((function(e){return c.index(e)})).join(", ")," ]"),c.pop(n[o+1]),u.push(c.push(h)),o+=v;break;case op$1.IF:x(c.top(),0);break;case op$1.IF_ERROR:x(c.top()+" === peg$FAILED",0);break;case op$1.IF_NOT_ERROR:x(c.top()+" !== peg$FAILED",0);break;case op$1.IF_LT:x(c.top()+".length < "+n[o+1],1);break;case op$1.IF_GE:x(c.top()+".length >= "+n[o+1],1);break;case op$1.IF_LT_DYNAMIC:x(c.top()+".length < ("+c.index(n[o+1])+"|0)",1);break;case op$1.IF_GE_DYNAMIC:x(c.top()+".length >= ("+c.index(n[o+1])+"|0)",1);break;case op$1.WHILE_NOT_ERROR:T=c.top()+" !== peg$FAILED",C=n[o+2-1],w=c.checkedLoop(o,(function(){return o+=2+C,t(n.slice(o-C,o))})),u.push("while ("+T+") {"),u.push.apply(u,p(w)),u.push("}");break;case op$1.MATCH_ANY:x("input.length > peg$currPos",0);break;case op$1.MATCH_STRING:var A=n[o+1],y=r[A];b((function(e,t){return y.length>1?"".concat(e," === ").concat(l(A)):(e=t?"".concat(e,".charCodeAt(0)"):"input.charCodeAt(peg$currPos)","".concat(e," === ").concat(y.charCodeAt(0)))}),1,y.length);break;case op$1.MATCH_STRING_IC:var S=n[o+1];b((function(e){return"".concat(e,".toLowerCase() === ").concat(l(S))}),1,r[S].length);break;case op$1.MATCH_CHAR_CLASS:var _=n[o+1];b((function(e){return"".concat(f(_),".test(").concat(e,")")}),1,1);break;case op$1.ACCEPT_N:u.push(c.push(n[o+1]>1?"input.substr(peg$currPos, "+n[o+1]+")":"input.charAt(peg$currPos)")),u.push(n[o+1]>1?"peg$currPos += "+n[o+1]+";":"peg$currPos++;"),o+=2;break;case op$1.ACCEPT_STRING:u.push(c.push(l(n[o+1]))),u.push(r[n[o+1]].length>1?"peg$currPos += "+r[n[o+1]].length+";":"peg$currPos++;"),o+=2;break;case op$1.FAIL:u.push(c.push("peg$FAILED")),u.push("if (peg$silentFails === 0) { peg$fail("+d(n[o+1])+"); }"),o+=2;break;case op$1.LOAD_SAVED_POS:u.push("peg$savedPos = "+c.index(n[o+1])+";"),o+=2;break;case op$1.UPDATE_SAVED_POS:u.push("peg$savedPos = peg$currPos;"),o++;break;case op$1.CALL:h=function(e){var t=n[o+4-1];return m(n[o+1])+"("+n.slice(o+4,o+4+t).map((function(e){return c.index(e)})).join(", ")+")"}(),c.pop(n[o+2]),u.push(c.push(h)),o+=4+n[o+3];break;case op$1.RULE:u.push(c.push($(e.rules[n[o+1]].name)+"()")),o+=2;break;case op$1.LIBRARY_RULE:var E=n[o+2],k=-1===E?"":', "'+i[E]+'"';u.push(c.push("peg$callLibrary("+g(n[o+1])+k+")")),o+=3;break;case op$1.SILENT_FAILS_ON:u.push("peg$silentFails++;"),o++;break;case op$1.SILENT_FAILS_OFF:u.push("peg$silentFails--;"),o++;break;case op$1.SOURCE_MAP_PUSH:c.sourceMapPush(u,a[n[o+1]]),o+=2;break;case op$1.SOURCE_MAP_POP:c.sourceMapPop(),o++;break;case op$1.SOURCE_MAP_LABEL_PUSH:c.labels[n[o+1]]={label:r[n[o+2]],location:a[n[o+3]]},o+=4;break;case op$1.SOURCE_MAP_LABEL_POP:delete c.labels[n[o+1]],o+=2;break;default:throw new Error("Invalid opcode: "+n[o]+".")}var T,C,w};o<s;)v();return u}(s);return o.push(wrapInSourceNode("function ",$(n.name),n.nameLocation,"() {\n",n.name)),t.trace&&o.push("  var startPos = peg$currPos;"),o.push(p(c.defines())),o.push.apply(o,p(function(r,a){var n=[];return n.push(""),t.trace&&n.push("peg$tracer.trace({",'  type: "rule.enter",',"  rule: "+r+",","  location: peg$computeLocation(startPos, startPos, true)","});",""),t.cache&&(n.push("var key = peg$currPos * "+e.rules.length+" + "+a+";","var cached = peg$resultsCache[key];","","if (cached) {","  peg$currPos = cached.nextPos;",""),t.trace&&n.push("if (cached.result !== peg$FAILED) {","  peg$tracer.trace({",'    type: "rule.match",',"    rule: "+r+",","    result: cached.result,","    location: peg$computeLocation(startPos, peg$currPos, true)","  });","} else {","  peg$tracer.trace({",'    type: "rule.fail",',"    rule: "+r+",","    location: peg$computeLocation(startPos, startPos, true)","  });","}",""),n.push("  return cached.result;","}","")),n}('"'+stringEscape$1(n.name)+'"',asts$5.indexOfRule(e,n.name)))),o.push.apply(o,p(u)),o.push.apply(o,p(function(e,r){var a=[];return t.cache&&a.push("","peg$resultsCache[key] = { nextPos: peg$currPos, result: "+r+" };"),t.trace&&a.push("","if ("+r+" !== peg$FAILED) {","  peg$tracer.trace({",'    type: "rule.match",',"    rule: "+e+",","    result: "+r+",","    location: peg$computeLocation(startPos, peg$currPos, true)","  });","} else {","  peg$tracer.trace({",'    type: "rule.fail",',"    rule: "+e+",","    location: peg$computeLocation(startPos, startPos, true)","  });","}"),a.push("","return "+r+";"),a}('"'+stringEscape$1(n.name)+'"',c.result()))),o.push("}"),o}(n))),u.push("")})),e.initializer)if(Array.isArray(e.initializer))for(var R=0,L=e.initializer;R<L.length;R++){var F=L[R];u.push(h(F)),u.push("")}else u.push(h(e.initializer)),u.push("");return u.push("  peg$result = peg$startRuleFunction();","","  if (options.peg$library) {","    return /** @type {any} */ ({","      peg$result,","      peg$currPos,","      peg$FAILED,","      peg$maxFailExpected,","      peg$maxFailPos","    });","  }","  if (peg$result !== peg$FAILED && peg$currPos === input.length) {","    return peg$result;","  } else {","    if (peg$result !== peg$FAILED && peg$currPos < input.length) {","      peg$fail(peg$endExpectation());","    }","","    throw peg$buildStructuredError(","      peg$maxFailExpected,","      peg$maxFailPos < input.length ? input.charAt(peg$maxFailPos) : null,","      peg$maxFailPos < input.length","        ? peg$computeLocation(peg$maxFailPos, peg$maxFailPos + 1)","        : peg$computeLocation(peg$maxFailPos, peg$maxFailPos)","    );","  }","}"),new SourceNode$2(null,null,t.grammarSource,u.map((function(e){return e instanceof SourceNode$2?e:e+"\n"})))}())}var generateJs=generateJS$1,asts$4=asts_1,visitor$8=visitor_1;function removeProxyRules$1(e,t,r){var a=[];e.rules.forEach((function(n,o){var s;"rule"===(s=n).type&&"rule_ref"===s.expression.type&&(function(e,t,a){visitor$8.build({rule_ref:function(n){n.name===t&&(n.name=a,r.info('Proxy rule "'.concat(t,'" replaced by the rule "').concat(a,'"'),n.location,[{message:"This rule will be used",location:asts$4.findRule(e,a).nameLocation}]))}})(e)}(e,n.name,n.expression.name),-1===t.allowedStartRules.indexOf(n.name)&&a.push(o))})),a.reverse(),a.forEach((function(t){e.rules.splice(t,1)}))}var removeProxyRules_1=removeProxyRules$1,__assign$1=commonjsGlobal&&commonjsGlobal.__assign||function(){return __assign$1=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},__assign$1.apply(this,arguments)},__spreadArray$3=commonjsGlobal&&commonjsGlobal.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var a,n=0,o=t.length;n<o;n++)!a&&n in t||(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))},visitor$7=visitor_1;function cloneOver(e,t){var r=e,a=t;Object.keys(r).forEach((function(e){return delete r[e]})),Object.keys(a).forEach((function(e){r[e]=a[e]}))}function cleanParts(e){e.sort((function(e,t){var r=Array.isArray(e)?e:[e,e],a=r[0],n=r[1],o=Array.isArray(t)?t:[t,t],s=o[0],i=o[1];return a!==s?a<s?-1:1:n!==i?n>i?-1:1:0}));for(var t="",r="",a=0;a<e.length;a++){var n=e[a],o=Array.isArray(n)?n:[n,n],s=o[0],i=o[1];i<=r?e.splice(a--,1):r.charCodeAt(0)+1>=s.charCodeAt(0)?(e.splice(a--,1),e[a]=[t,r=i]):(t=s,r=i)}return e}function mergeCharacterClasses$1(e){var t=Object.create(null);e.rules.forEach((function(e){return t[e.name]=e.expression}));var r=Object.create(null),a=[function(e,a){if("class"===e.type&&!e.inverted)return a&&((e=__assign$1({},e)).parts=__spreadArray$3([],e.parts,!0)),e;if("literal"===e.type&&1===e.value.length)return{type:"class",parts:[e.value],inverted:!1,ignoreCase:e.ignoreCase,location:e.location};if("rule_ref"===e.type){var s=t[e.name];if(s){r[e.name]||(r[e.name]=!0,o(s));var i=n(s,!0);return i&&(i.location=e.location),i}}return null},visitor$7.build({choice:function(e){var t=null,r=!1;e.alternatives.forEach((function(a,s){var i;o(a);var c=n(a);c?t&&t.ignoreCase===c.ignoreCase?((i=t.parts).push.apply(i,c.parts),e.alternatives[s-1]=t,e.alternatives[s]=t,t.location={source:t.location.source,start:t.location.start,end:c.location.end},r=!0):t=c:t=null})),r&&(e.alternatives=e.alternatives.filter((function(e,t,r){return!t||e!==r[t-1]})),e.alternatives.forEach((function(t,r){"class"===t.type&&(t.parts=cleanParts(t.parts),1!==t.parts.length||Array.isArray(t.parts[0])||t.inverted||(e.alternatives[r]={type:"literal",value:t.parts[0],ignoreCase:t.ignoreCase,location:t.location}))})),1===e.alternatives.length&&cloneOver(e,e.alternatives[0]))},text:function(e){if(o(e.expression),"class"===e.expression.type||"literal"===e.expression.type){var t=e.location;cloneOver(e,e.expression),e.location=t}}})],n=a[0],o=a[1];e.rules.forEach((function(e){r[e.name]=!0,o(e.expression)}))}var mergeCharacterClasses_1=mergeCharacterClasses$1;function reportDuplicateImports$1(e,t,r){for(var a={},n=0,o=e.imports;n<o.length;n++)for(var s=0,i=o[n].what;s<i.length;s++){var c=i[s];"import_binding_all"===c.type&&(Object.prototype.hasOwnProperty.call(a,c.binding)&&r.error('Module "'.concat(c.binding,'" is already imported'),c.location,[{message:"Original module location",location:a[c.binding]}]),a[c.binding]=c.location)}}var reportDuplicateImports_1=reportDuplicateImports$1,visitor$6=visitor_1;function reportDuplicateLabels$1(e,t,r){function a(e){var t={};return Object.keys(e).forEach((function(r){t[r]=e[r]})),t}function n(e,t){o(e.expression,a(t))}var o=visitor$6.build({rule:function(e){o(e.expression,{})},choice:function(e,t){e.alternatives.forEach((function(e){o(e,a(t))}))},action:n,labeled:function(e,t){var a=e.label;a&&Object.prototype.hasOwnProperty.call(t,a)&&r.error('Label "'.concat(e.label,'" is already defined'),e.labelLocation,[{message:"Original label location",location:t[a]}]),o(e.expression,t),t[e.label]=e.labelLocation},text:n,simple_and:n,simple_not:n,optional:n,zero_or_more:n,one_or_more:n,repeated:function(e,t){e.delimiter&&o(e.delimiter,a(t)),o(e.expression,a(t))},group:n});o(e)}var reportDuplicateLabels_1=reportDuplicateLabels$1,visitor$5=visitor_1;function reportDuplicateRules$1(e,t,r){var a={};visitor$5.build({rule:function(e){Object.prototype.hasOwnProperty.call(a,e.name)?r.error('Rule "'.concat(e.name,'" is already defined'),e.nameLocation,[{message:"Original rule location",location:a[e.name]}]):a[e.name]=e.nameLocation}})(e)}var reportDuplicateRules_1=reportDuplicateRules$1,asts$3=asts_1,visitor$4=visitor_1;function reportInfiniteRecursion$1(e,t,r){var a=[],n=[],o=visitor$4.build({rule:function(e){r.errors>0||(a.push(e.name),o(e.expression),a.pop())},sequence:function(t){r.errors>0||t.elements.every((function(t){return o(t),!(r.errors>0||asts$3.alwaysConsumesOnSuccess(e,t))}))},repeated:function(t){r.errors>0||(o(t.expression),t.delimiter&&!asts$3.alwaysConsumesOnSuccess(e,t.expression)&&o(t.delimiter))},rule_ref:function(t){if(!(r.errors>0)){n.push(t);var s=asts$3.findRule(e,t.name);if(-1!==a.indexOf(t.name))return a.push(t.name),void r.error("Possible infinite loop when parsing (left recursion: "+a.join(" -> ")+")",s.nameLocation,n.map((function(e,t,r){return{message:t+1!==r.length?"Step ".concat(t+1,': call of the rule "').concat(e.name,'" without input consumption'):"Step ".concat(t+1,": call itself without input consumption - left recursion"),location:e.location}})));s&&o(s),n.pop()}}});o(e)}var reportInfiniteRecursion_1=reportInfiniteRecursion$1,asts$2=asts_1,visitor$3=visitor_1;function reportInfiniteRepetition$1(e,t,r){var a=visitor$3.build({zero_or_more:function(t){asts$2.alwaysConsumesOnSuccess(e,t.expression)||r.error("Possible infinite loop when parsing (repetition used with an expression that may not consume any input)",t.location)},one_or_more:function(t){asts$2.alwaysConsumesOnSuccess(e,t.expression)||r.error("Possible infinite loop when parsing (repetition used with an expression that may not consume any input)",t.location)},repeated:function(t){if(t.delimiter&&a(t.delimiter),!(asts$2.alwaysConsumesOnSuccess(e,t.expression)||t.delimiter&&asts$2.alwaysConsumesOnSuccess(e,t.delimiter)))if(null===t.max.value)r.error("Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",t.location);else{var n=t.min?t.min:t.max;r.warning("constant"===n.type&&"constant"===t.max.type?"An expression may not consume any input and may always match ".concat(t.max.value," times"):"An expression may not consume any input and may always match with a maximum repetition count",t.location)}}});a(e)}var reportInfiniteRepetition_1=reportInfiniteRepetition$1,asts$1=asts_1,visitor$2=visitor_1;function reportUndefinedRules$1(e,t,r){visitor$2.build({rule_ref:function(t){asts$1.findRule(e,t.name)||r.error('Rule "'.concat(t.name,'" is not defined'),t.location)}})(e)}var reportUndefinedRules_1=reportUndefinedRules$1,visitor$1=visitor_1;function reportIncorrectPlucking$1(e,t,r){var a=visitor$1.build({action:function(e){a(e.expression,e)},labeled:function(e,t){e.pick&&t&&r.error('"@" cannot be used with an action block',e.labelLocation,[{message:"Action block location",location:t.codeLocation}]),a(e.expression)}});a(e)}var reportIncorrectPlucking_1=reportIncorrectPlucking$1,__spreadArray$2=commonjsGlobal&&commonjsGlobal.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var a,n=0,o=t.length;n<o;n++)!a&&n in t||(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))},GrammarError$3=grammarError,Defaults=function(){function e(e){"function"==typeof(e=void 0!==e?e:{}).error&&(this.error=e.error),"function"==typeof e.warning&&(this.warning=e.warning),"function"==typeof e.info&&(this.info=e.info)}return e.prototype.error=function(){},e.prototype.warning=function(){},e.prototype.info=function(){},e}(),Session$2=function(){function e(e){this._callbacks=new Defaults(e),this._firstError=null,this.errors=0,this.problems=[],this.stage=null}return e.prototype.error=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];++this.errors,null===this._firstError&&(this._firstError=new(GrammarError$3.bind.apply(GrammarError$3,__spreadArray$2([void 0],t,!1))),this._firstError.stage=this.stage,this._firstError.problems=this.problems),this.problems.push(__spreadArray$2(["error"],t,!0)),(e=this._callbacks).error.apply(e,__spreadArray$2([this.stage],t,!1))},e.prototype.warning=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];this.problems.push(__spreadArray$2(["warning"],t,!0)),(e=this._callbacks).warning.apply(e,__spreadArray$2([this.stage],t,!1))},e.prototype.info=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];this.problems.push(__spreadArray$2(["info"],t,!0)),(e=this._callbacks).info.apply(e,__spreadArray$2([this.stage],t,!1))},e.prototype.checkErrors=function(){if(0!==this.errors)throw this._firstError},e}(),session=Session$2,addImportedRules=addImportedRules_1,fixLibraryNumbers=fixLibraryNumbers_1,generateBytecode=generateBytecode_1,generateJS=generateJs,inferenceMatchResult=inferenceMatchResult_1,removeProxyRules=removeProxyRules_1,mergeCharacterClasses=mergeCharacterClasses_1,reportDuplicateImports=reportDuplicateImports_1,reportDuplicateLabels=reportDuplicateLabels_1,reportDuplicateRules=reportDuplicateRules_1,reportInfiniteRecursion=reportInfiniteRecursion_1,reportInfiniteRepetition=reportInfiniteRepetition_1,reportUndefinedRules=reportUndefinedRules_1,reportIncorrectPlucking=reportIncorrectPlucking_1,Session$1=session,visitor=visitor_1,base64$3=utils$1.base64;function processOptions(e,t){var r={};return Object.keys(e).forEach((function(t){r[t]=e[t]})),Object.keys(t).forEach((function(e){Object.prototype.hasOwnProperty.call(r,e)||(r[e]=t[e])})),r}function isSourceMapCapable(e){return"string"==typeof e?e.length>0:e&&"function"==typeof e.offset}var compiler$2={visitor:visitor,passes:{prepare:[addImportedRules,reportInfiniteRecursion],check:[reportUndefinedRules,reportDuplicateRules,reportDuplicateLabels,reportInfiniteRepetition,reportIncorrectPlucking,reportDuplicateImports],transform:[fixLibraryNumbers,removeProxyRules,mergeCharacterClasses,inferenceMatchResult],generate:[generateBytecode,generateJS]},compile:function(ast,passes,options){if(options=void 0!==options?options:{},options=processOptions(options,{allowedStartRules:[ast.rules[0].name],cache:!1,dependencies:{},exportVar:null,format:"bare",output:"parser",trace:!1}),!Array.isArray(options.allowedStartRules))throw new Error("allowedStartRules must be an array");if(0===options.allowedStartRules.length)throw new Error("Must have at least one start rule");var allRules=ast.rules.map((function(e){return e.name}));if(options.allowedStartRules.some((function(e){return"*"===e})))options.allowedStartRules=allRules;else for(var _i=0,_a=options.allowedStartRules;_i<_a.length;_i++){var rule=_a[_i];if(-1===allRules.indexOf(rule))throw new Error('Unknown start rule "'.concat(rule,'"'))}if(("source-and-map"===options.output||"source-with-inline-map"===options.output)&&!isSourceMapCapable(options.grammarSource))throw new Error("Must provide grammarSource (as a string or GrammarLocation) in order to generate source maps");var session=new Session$1(options);switch(Object.keys(passes).forEach((function(e){session.stage=e,session.info("Process stage ".concat(e)),passes[e].forEach((function(t){session.info("Process pass ".concat(e,".").concat(t.name)),t(ast,options,session)})),session.checkErrors()})),options.output){case"parser":return eval(ast.code.toString());case"source":return ast.code.toString();case"source-and-map":return ast.code;case"source-with-inline-map":if("undefined"==typeof TextEncoder)throw new Error("TextEncoder is not supported by this platform");var sourceMap=ast.code.toStringWithSourceMap(),encoder=new TextEncoder,b64=base64$3(encoder.encode(JSON.stringify(sourceMap.map.toJSON())));return sourceMap.code+"//# sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(b64,"\n");case"ast":return ast;default:throw new Error("Invalid output format: "+options.output+".")}}},compiler_1=compiler$2,GrammarError$2=grammarError,GrammarLocation$1=grammarLocation,asts=asts_1,compiler$1=compiler_1,parser$3=parser$4,VERSION=version$1,RESERVED_WORDS=["break","case","catch","class","const","continue","debugger","default","delete","do","else","export","extends","finally","for","function","if","import","in","instanceof","new","return","super","switch","this","throw","try","typeof","var","void","while","with","null","true","false","enum","implements","interface","let","package","private","protected","public","static","yield","await","arguments","eval"],peg$4={VERSION:VERSION,RESERVED_WORDS:RESERVED_WORDS,GrammarError:GrammarError$2,GrammarLocation:GrammarLocation$1,parser:parser$3,compiler:compiler$1,generate:function(e,t){var r,a,n="plugins"in(t=void 0!==t?t:{})?t.plugins:[],o={parser:peg$4.parser,passes:(r=peg$4.compiler.passes,a={},Object.keys(r).forEach((function(e){a[e]=r[e].slice()})),a),reservedWords:peg$4.RESERVED_WORDS.slice()};n.forEach((function(e){e.use(o,t)})),Array.isArray(e)||(e=[{source:t.grammarSource,text:e}]);var s=asts.combine(e.map((function(e){var t=e.source,r=e.text;return o.parser.parse(r,{grammarSource:t,reservedWords:o.reservedWords})})));return peg$4.compiler.compile(s,o.passes,t)}},peg_1=peg$4,utils={},chai$o=require$$0,Call=function(){function e(e){this.args=e}return e.prototype.calledWithExactly=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return chai$o.util.eql(this.args,e)},e}();function dummy(){function e(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e.callCount++,e.called=!0,e.calls.push(new Call(t))}return e.called=!1,e.callCount=0,e.calls=[],e.getCall=function(t){return e.calls[t]},e}utils.spy=function(){return dummy()},utils.stub=function(e,t){var r=e[t],a=dummy();return e[t]=a,a.restore=function(){e[t]=r},r};var chai$n=require$$0,peg$3=peg_1,_a$2=utils,spy$1=_a$2.spy,stub$1=_a$2.stub,expect$n=chai$n.expect;describe("generated parser API",(function(){describe("parse",(function(){it("parses input",(function(){var e=peg$3.generate("start = 'a'");expect$n(e.parse("a")).to.equal("a")})),it("throws an exception on syntax error",(function(){var e=peg$3.generate("start = 'a'");expect$n((function(){e.parse("b")})).to.throw()})),it("correctly describe character class in syntax error",(function(){var e=peg$3.generate("start = [123-5]");expect$n((function(){e.parse("0")})).to.throw("[123-5]")})),describe("start rule",(function(){var e=peg$3.generate(["a = 'x' { return 'a'; }","b = 'x' { return 'b'; }","c = 'x' { return 'c'; }"].join("\n"),{allowedStartRules:["b","c"]});describe("when |startRule| is not set",(function(){it("starts parsing from the first allowed rule",(function(){expect$n(e.parse("x")).to.equal("b")}))})),describe("when |startRule| is set to an allowed rule",(function(){it("starts parsing from specified rule",(function(){expect$n(e.parse("x",{startRule:"b"})).to.equal("b"),expect$n(e.parse("x",{startRule:"c"})).to.equal("c")}))})),describe("when |startRule| is set to a disallowed start rule",(function(){it("throws an exception",(function(){expect$n((function(){e.parse("x",{startRule:"a"})})).to.throw()}))}))})),describe("tracing",(function(){var e=peg$3.generate(["start = a / b","a = 'a'i","b = 'b'"].join("\n"),{trace:!0});describe("default tracer",(function(){it("traces using console.log (if console is defined)",(function(){var t=["1:1-1:1 rule.enter start","1:1-1:1 rule.enter   a","1:1-1:1 rule.fail    a","1:1-1:1 rule.enter   b","1:1-1:2 rule.match   b","1:1-1:2 rule.match start"];"object"==typeof console&&stub$1(console,"log");try{e.parse("b"),"object"==typeof console&&(expect$n(console.log.callCount).to.equal(t.length),t.forEach((function(e,t){var r=console.log.getCall(t);expect$n(r.calledWithExactly(e)).to.equal(!0)})))}finally{"object"==typeof console&&console.log.restore()}}))})),describe("custom tracers",(function(){describe("trace",(function(){it("receives tracing events",(function(){var t=[{type:"rule.enter",rule:"start",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:0,line:1,column:1}}},{type:"rule.enter",rule:"a",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:0,line:1,column:1}}},{type:"rule.fail",rule:"a",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:0,line:1,column:1}}},{type:"rule.enter",rule:"b",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:0,line:1,column:1}}},{type:"rule.match",rule:"b",result:"b",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:1,line:1,column:2}}},{type:"rule.match",rule:"start",result:"b",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:1,line:1,column:2}}}],r={trace:spy$1()};e.parse("b",{tracer:r}),expect$n(r.trace.callCount).to.equal(t.length),t.forEach((function(e,t){var a=r.trace.getCall(t);expect$n(a.calledWithExactly(e)).to.equal(!0)}))}))}))}))})),it("accepts custom options",(function(){peg$3.generate("start = 'a'").parse("a",{foo:42})}))}))}));var name="peggy",version="4.0.2",description="Parser generator for JavaScript",keywords=["grammar","parser generator","PEG","PEG.js"],homepage="https://peggyjs.org/",repository="peggyjs/peggy",bugs="https://github.com/peggyjs/peggy/issues",license="MIT",author="David Majda <david@majda.cz> (https://majda.cz/)",main="lib/peg.js",browser="browser/peggy.min.js",unpkg="browser/peggy.min.js",jsdelivr="browser/peggy.min.js",types="lib/peg.d.ts",bin={peggy:"bin/peggy.js"},scripts={clean:"rimraf -g build browser bin/*.map && mkdir browser",parser:"node bin/peggy.js -o lib/parser.js --format commonjs --allowed-start-rules Grammar,ImportsAndSource src/parser.pegjs ",examples:"node bin/peggy.js -c docs/js/options.js docs/js/examples.peggy",set_version:"node ./tools/set_version",lint:"eslint .",ts:"tsc --build tsconfig.json",docs:"cd docs && npm run build",test:"node --experimental-vm-modules node_modules/jest/bin/jest.js","test:web":"cd web-test && npm test","test:all":"npm run test && npm run test:web",benchmark:"node ./benchmark/run_bench.js",rollup:"copyfiles package.json build/ts && rollup -c",terser:"npm run terser:peggy && npm run terser:tests && npm run terser:bench","terser:peggy":"terser -c passes=2 -m reserved=['GrammarLocation'] --sequences 40 build/rollup/peggy.umd.js -o build/peggy.min.js","terser:tests":"terser -c passes=2 -m --sequences 40 --module build/rollup/test.umd.js -o build/test-bundle.min.js","terser:bench":"terser -c passes=2 -m --sequences 40 --module build/rollup/benchmark.umd.js -o build/benchmark-bundle.min.js",headers:"node ./tools/header.js build/peggy.min.js build/benchmark-bundle.min.js build/test-bundle.min.js",deploy:"npm run deploy:peggy && npm run deploy:tests && npm run deploy:bench",coverage:"npm run rollup && npm run parser -- -m inline && npm test","deploy:peggy":"copyfiles -f build/peggy.min.js docs/vendor/peggy/ && copyfiles -f build/peggy.min.js browser/","deploy:tests":"copyfiles -f build/test-bundle.min.js docs/js/","deploy:bench":"copyfiles -f build/benchmark-bundle.min.js docs/js/",build:"npm run build:notidy && npm run tidy","build:notidy":"npm run setup && npm run make && npm run lint && npm run audit",setup:"npm run clean && npm run set_version",make:"npm run parser && npm run ts && npm run rollup && npm run terser && npm run examples && npm run docs && npm run headers && npm run deploy",audit:"npm run test && npm run benchmark",tidy:"rimraf build",start:"cd docs && npm start"},devDependencies={"@peggyjs/eslint-config":"^3.2.4","@rollup/plugin-commonjs":"^25.0.7","@rollup/plugin-json":"^6.1.0","@rollup/plugin-multi-entry":"^6.0.1","@rollup/plugin-node-resolve":"^15.2.3","@rollup/plugin-typescript":"^11.1.6","@types/chai":"^4.3.11","@types/jest":"^29.5.12","@types/node":"^20.11.20","@typescript-eslint/eslint-plugin":"^7.0.2","@typescript-eslint/parser":"^7.0.2",chai:"^4.3.11","chai-like":"^1.1.1",copyfiles:"^2.4.1",eslint:"^8.57.0","eslint-plugin-compat":"4.2.0","eslint-plugin-mocha":"10.3.0",express:"4.18.2",glob:"^10.3.10",jest:"^29.7.0",rimraf:"^5.0.5",rollup:"^4.12.0","rollup-plugin-ignore":"1.0.10","source-map":"^0.8.0-beta.0",terser:"^5.28.1","ts-jest":"^29.1.2",tslib:"^2.6.2",typescript:"^5.3.3"},dependencies={"@peggyjs/from-mem":"1.2.1",commander:"^12.0.0","source-map-generator":"0.8.0"},browserslist=["defaults, maintained node versions, not op_mini all"],engines={node:">=18"},require$$2={name:name,version:version,description:description,keywords:keywords,homepage:homepage,repository:repository,bugs:bugs,license:license,author:author,main:main,browser:browser,unpkg:unpkg,jsdelivr:jsdelivr,types:types,bin:bin,scripts:scripts,devDependencies:devDependencies,dependencies:dependencies,browserslist:browserslist,engines:engines},sourceMap={},sourceMapGenerator={},base64Vlq={},base64$2={};const intToCharMap="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");base64$2.encode=function(e){if(0<=e&&e<intToCharMap.length)return intToCharMap[e];throw new TypeError("Must be between 0 and 63: "+e)};const base64$1=base64$2,VLQ_BASE_SHIFT=5,VLQ_BASE=1<<VLQ_BASE_SHIFT,VLQ_BASE_MASK=VLQ_BASE-1,VLQ_CONTINUATION_BIT=VLQ_BASE;function toVLQSigned(e){return e<0?1+(-e<<1):0+(e<<1)}base64Vlq.encode=function(e){let t,r="",a=toVLQSigned(e);do{t=a&VLQ_BASE_MASK,a>>>=VLQ_BASE_SHIFT,a>0&&(t|=VLQ_CONTINUATION_BIT),r+=base64$1.encode(t)}while(a>0);return r};var util$4={},urlBrowser=require$$0$1.URL;const URL$1=urlBrowser;function getArg(e,t,r){if(t in e)return e[t];if(3===arguments.length)return r;throw new Error('"'+t+'" is a required argument.')}util$4.getArg=getArg;const supportsNullProto=!("__proto__"in Object.create(null));function identity(e){return e}function toSetString(e){return isProtoString(e)?"$"+e:e}function fromSetString(e){return isProtoString(e)?e.slice(1):e}function isProtoString(e){if(!e)return!1;const t=e.length;if(t<9)return!1;if(95!==e.charCodeAt(t-1)||95!==e.charCodeAt(t-2)||111!==e.charCodeAt(t-3)||116!==e.charCodeAt(t-4)||111!==e.charCodeAt(t-5)||114!==e.charCodeAt(t-6)||112!==e.charCodeAt(t-7)||95!==e.charCodeAt(t-8)||95!==e.charCodeAt(t-9))return!1;for(let r=t-10;r>=0;r--)if(36!==e.charCodeAt(r))return!1;return!0}function strcmp(e,t){return e===t?0:null===e?1:null===t?-1:e>t?1:-1}function compareByGeneratedPositionsInflated(e,t){let r=e.generatedLine-t.generatedLine;return 0!==r?r:(r=e.generatedColumn-t.generatedColumn,0!==r?r:(r=strcmp(e.source,t.source),0!==r?r:(r=e.originalLine-t.originalLine,0!==r?r:(r=e.originalColumn-t.originalColumn,0!==r?r:strcmp(e.name,t.name)))))}function parseSourceMapInput(e){return JSON.parse(e.replace(/^\)]}'[^\n]*\n/,""))}util$4.toSetString=supportsNullProto?identity:toSetString,util$4.fromSetString=supportsNullProto?identity:fromSetString,util$4.compareByGeneratedPositionsInflated=compareByGeneratedPositionsInflated,util$4.parseSourceMapInput=parseSourceMapInput;const PROTOCOL="http:",PROTOCOL_AND_HOST=`${PROTOCOL}//host`;function createSafeHandler(e){return t=>{const r=getURLType(t),a=buildSafeBase(t),n=new URL$1(t,a);e(n);const o=n.toString();return"absolute"===r?o:"scheme-relative"===r?o.slice(PROTOCOL.length):"path-absolute"===r?o.slice(PROTOCOL_AND_HOST.length):computeRelativeURL(a,o)}}function withBase(e,t){return new URL$1(e,t).toString()}function buildUniqueSegment(e,t){let r=0;for(;;){const a=e+r++;if(-1===t.indexOf(a))return a}}function buildSafeBase(e){const t=e.split("..").length-1,r=buildUniqueSegment("p",e);let a=`${PROTOCOL_AND_HOST}/`;for(let e=0;e<t;e++)a+=`${r}/`;return a}const ABSOLUTE_SCHEME=/^[A-Za-z0-9\+\-\.]+:/;function getURLType(e){return"/"===e[0]?"/"===e[1]?"scheme-relative":"path-absolute":ABSOLUTE_SCHEME.test(e)?"absolute":"path-relative"}function computeRelativeURL(e,t){"string"==typeof e&&(e=new URL$1(e)),"string"==typeof t&&(t=new URL$1(t));const r=t.pathname.split("/"),a=e.pathname.split("/");for(a.length>0&&!a[a.length-1]&&a.pop();r.length>0&&a.length>0&&r[0]===a[0];)r.shift(),a.shift();return a.map((()=>"..")).concat(r).join("/")+t.search+t.hash}const ensureDirectory=createSafeHandler((e=>{e.pathname=e.pathname.replace(/\/?$/,"/")})),trimFilename=createSafeHandler((e=>{e.href=new URL$1(".",e.toString()).toString()})),normalize=createSafeHandler((e=>{}));function join(e,t){const r=getURLType(t),a=getURLType(e);if(e=ensureDirectory(e),"absolute"===r)return withBase(t,void 0);if("absolute"===a)return withBase(t,e);if("scheme-relative"===r)return normalize(t);if("scheme-relative"===a)return withBase(t,withBase(e,PROTOCOL_AND_HOST)).slice(PROTOCOL.length);if("path-absolute"===r)return normalize(t);if("path-absolute"===a)return withBase(t,withBase(e,PROTOCOL_AND_HOST)).slice(PROTOCOL_AND_HOST.length);const n=buildSafeBase(t+e);return computeRelativeURL(n,withBase(t,withBase(e,n)))}function relative(e,t){const r=relativeIfPossible(e,t);return"string"==typeof r?r:normalize(t)}function relativeIfPossible(e,t){if(getURLType(e)!==getURLType(t))return null;const r=buildSafeBase(e+t),a=new URL$1(e,r),n=new URL$1(t,r);try{new URL$1("",n.toString())}catch(e){return null}return n.protocol!==a.protocol||n.user!==a.user||n.password!==a.password||n.hostname!==a.hostname||n.port!==a.port?null:computeRelativeURL(a,n)}function computeSourceURL(e,t,r){e&&"path-absolute"===getURLType(t)&&(t=t.replace(/^\//,""));let a=normalize(t||"");return e&&(a=join(e,a)),r&&(a=join(trimFilename(r),a)),a}util$4.normalize=normalize,util$4.join=join,util$4.relative=relative,util$4.computeSourceURL=computeSourceURL;var arraySet={};let ArraySet$2=class e{constructor(){this._array=[],this._set=new Map}static fromArray(t,r){const a=new e;for(let e=0,n=t.length;e<n;e++)a.add(t[e],r);return a}size(){return this._set.size}add(e,t){const r=this.has(e),a=this._array.length;r&&!t||this._array.push(e),r||this._set.set(e,a)}has(e){return this._set.has(e)}indexOf(e){const t=this._set.get(e);if(t>=0)return t;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}};arraySet.ArraySet=ArraySet$2;var mappingList={};const util$3=util$4;function generatedPositionAfter(e,t){const r=e.generatedLine,a=t.generatedLine,n=e.generatedColumn,o=t.generatedColumn;return a>r||a==r&&o>=n||util$3.compareByGeneratedPositionsInflated(e,t)<=0}let MappingList$1=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,t){this._array.forEach(e,t)}add(e){generatedPositionAfter(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))}toArray(){return this._sorted||(this._array.sort(util$3.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};mappingList.MappingList=MappingList$1;const base64VLQ=base64Vlq,util$2=util$4,ArraySet$1=arraySet.ArraySet,MappingList=mappingList.MappingList;let SourceMapGenerator$1=class e{constructor(e){e||(e={}),this._file=util$2.getArg(e,"file",null),this._sourceRoot=util$2.getArg(e,"sourceRoot",null),this._skipValidation=util$2.getArg(e,"skipValidation",!1),this._sources=new ArraySet$1,this._names=new ArraySet$1,this._mappings=new MappingList,this._sourcesContents=null}static fromSourceMap(t){const r=t.sourceRoot,a=new e({file:t.file,sourceRoot:r});return t.eachMapping((function(e){const t={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(t.source=e.source,null!=r&&(t.source=util$2.relative(r,t.source)),t.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(t.name=e.name)),a.addMapping(t)})),t.sources.forEach((function(e){let n=e;null!==r&&(n=util$2.relative(r,e)),a._sources.has(n)||a._sources.add(n);const o=t.sourceContentFor(e);null!=o&&a.setSourceContent(e,o)})),a}addMapping(e){const t=util$2.getArg(e,"generated"),r=util$2.getArg(e,"original",null);let a=util$2.getArg(e,"source",null),n=util$2.getArg(e,"name",null);this._skipValidation||this._validateMapping(t,r,a,n),null!=a&&(a=String(a),this._sources.has(a)||this._sources.add(a)),null!=n&&(n=String(n),this._names.has(n)||this._names.add(n)),this._mappings.add({generatedLine:t.line,generatedColumn:t.column,originalLine:null!=r&&r.line,originalColumn:null!=r&&r.column,source:a,name:n})}setSourceContent(e,t){let r=e;null!=this._sourceRoot&&(r=util$2.relative(this._sourceRoot,r)),null!=t?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[util$2.toSetString(r)]=t):this._sourcesContents&&(delete this._sourcesContents[util$2.toSetString(r)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))}applySourceMap(e,t,r){let a=t;if(null==t){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');a=e.file}const n=this._sourceRoot;null!=n&&(a=util$2.relative(n,a));const o=this._mappings.toArray().length>0?new ArraySet$1:this._sources,s=new ArraySet$1;this._mappings.unsortedForEach((function(t){if(t.source===a&&null!=t.originalLine){const a=e.originalPositionFor({line:t.originalLine,column:t.originalColumn});null!=a.source&&(t.source=a.source,null!=r&&(t.source=util$2.join(r,t.source)),null!=n&&(t.source=util$2.relative(n,t.source)),t.originalLine=a.line,t.originalColumn=a.column,null!=a.name&&(t.name=a.name))}const i=t.source;null==i||o.has(i)||o.add(i);const c=t.name;null==c||s.has(c)||s.add(c)}),this),this._sources=o,this._names=s,e.sources.forEach((function(t){const a=e.sourceContentFor(t);null!=a&&(null!=r&&(t=util$2.join(r,t)),null!=n&&(t=util$2.relative(n,t)),this.setSourceContent(t,a))}),this)}_validateMapping(e,t,r,a){if(t&&"number"!=typeof t.line&&"number"!=typeof t.column)throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!t&&!r&&!a);else if(!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:t,name:a}))}_serializeMappings(){let e,t,r,a,n=0,o=1,s=0,i=0,c=0,u=0,p="";const l=this._mappings.toArray();for(let f=0,d=l.length;f<d;f++){if(t=l[f],e="",t.generatedLine!==o)for(n=0;t.generatedLine!==o;)e+=";",o++;else if(f>0){if(!util$2.compareByGeneratedPositionsInflated(t,l[f-1]))continue;e+=","}e+=base64VLQ.encode(t.generatedColumn-n),n=t.generatedColumn,null!=t.source&&(a=this._sources.indexOf(t.source),e+=base64VLQ.encode(a-u),u=a,e+=base64VLQ.encode(t.originalLine-1-i),i=t.originalLine-1,e+=base64VLQ.encode(t.originalColumn-s),s=t.originalColumn,null!=t.name&&(r=this._names.indexOf(t.name),e+=base64VLQ.encode(r-c),c=r)),p+=e}return p}_generateSourcesContent(e,t){return e.map((function(e){if(!this._sourcesContents)return null;null!=t&&(e=util$2.relative(t,e));const r=util$2.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,r)?this._sourcesContents[r]:null}),this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}};SourceMapGenerator$1.prototype._version=3,sourceMapGenerator.SourceMapGenerator=SourceMapGenerator$1;var sourceMapConsumer={},binarySearch$1={};!function(e){function t(r,a,n,o,s,i){const c=Math.floor((a-r)/2)+r,u=s(n,o[c],!0);return 0===u?c:u>0?a-c>1?t(c,a,n,o,s,i):i==e.LEAST_UPPER_BOUND?a<o.length?a:-1:c:c-r>1?t(r,c,n,o,s,i):i==e.LEAST_UPPER_BOUND?c:r<0?-1:r}e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2,e.search=function(r,a,n,o){if(0===a.length)return-1;let s=t(-1,a.length,r,a,n,o||e.GREATEST_LOWER_BOUND);if(s<0)return-1;for(;s-1>=0&&0===n(a[s],a[s-1],!0);)--s;return s}}(binarySearch$1);var readWasmBrowser={exports:{}};let mappingsWasm=null;readWasmBrowser.exports=function(){if("string"==typeof mappingsWasm)return fetch(mappingsWasm).then((e=>e.arrayBuffer()));if(mappingsWasm instanceof ArrayBuffer)return Promise.resolve(mappingsWasm);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},readWasmBrowser.exports.initialize=e=>{mappingsWasm=e};var readWasmBrowserExports=readWasmBrowser.exports;const readWasm$1=readWasmBrowserExports;function Mapping(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let cachedWasm=null;var wasm$1=function(){if(cachedWasm)return cachedWasm;const e=[];return cachedWasm=readWasm$1().then((t=>WebAssembly.instantiate(t,{env:{mapping_callback(t,r,a,n,o,s,i,c,u,p){const l=new Mapping;l.generatedLine=t+1,l.generatedColumn=r,a&&(l.lastGeneratedColumn=n-1),o&&(l.source=s,l.originalLine=i+1,l.originalColumn=c,u&&(l.name=p)),e[e.length-1](l)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}}))).then((t=>({exports:t.instance.exports,withMappingCallback:(t,r)=>{e.push(t);try{r()}finally{e.pop()}}}))).then(null,(e=>{throw cachedWasm=null,e})),cachedWasm};const util$1=util$4,binarySearch=binarySearch$1,ArraySet=arraySet.ArraySet,readWasm=readWasmBrowserExports,wasm=wasm$1,INTERNAL=Symbol("smcInternal");let SourceMapConsumer$1=class e{constructor(e,t){return e==INTERNAL?Promise.resolve(this):_factory(e,t)}static initialize(e){readWasm.initialize(e["lib/mappings.wasm"])}static fromSourceMap(e,t){return _factoryBSM(e,t)}static async with(t,r,a){const n=await new e(t,r);try{return await a(n)}finally{n.destroy()}}eachMapping(e,t,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(e){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}};SourceMapConsumer$1.prototype._version=3,SourceMapConsumer$1.GENERATED_ORDER=1,SourceMapConsumer$1.ORIGINAL_ORDER=2,SourceMapConsumer$1.GREATEST_LOWER_BOUND=1,SourceMapConsumer$1.LEAST_UPPER_BOUND=2,sourceMapConsumer.SourceMapConsumer=SourceMapConsumer$1;class BasicSourceMapConsumer extends SourceMapConsumer$1{constructor(e,t){return super(INTERNAL).then((r=>{let a=e;"string"==typeof e&&(a=util$1.parseSourceMapInput(e));const n=util$1.getArg(a,"version"),o=util$1.getArg(a,"sources").map(String),s=util$1.getArg(a,"names",[]),i=util$1.getArg(a,"sourceRoot",null),c=util$1.getArg(a,"sourcesContent",null),u=util$1.getArg(a,"mappings"),p=util$1.getArg(a,"file",null);if(n!=r._version)throw new Error("Unsupported version: "+n);return r._sourceLookupCache=new Map,r._names=ArraySet.fromArray(s.map(String),!0),r._sources=ArraySet.fromArray(o,!0),r._absoluteSources=ArraySet.fromArray(r._sources.toArray().map((function(e){return util$1.computeSourceURL(i,e,t)})),!0),r.sourceRoot=i,r.sourcesContent=c,r._mappings=u,r._sourceMapURL=t,r.file=p,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,wasm().then((e=>(r._wasm=e,r)))}))}_findSourceIndex(e){const t=this._sourceLookupCache.get(e);if("number"==typeof t)return t;const r=util$1.computeSourceURL(null,e,this._sourceMapURL);if(this._absoluteSources.has(r)){const t=this._absoluteSources.indexOf(r);return this._sourceLookupCache.set(e,t),t}const a=util$1.computeSourceURL(this.sourceRoot,e,this._sourceMapURL);if(this._absoluteSources.has(a)){const t=this._absoluteSources.indexOf(a);return this._sourceLookupCache.set(e,t),t}return-1}static fromSourceMap(e,t){return new BasicSourceMapConsumer(e.toString())}get sources(){return this._absoluteSources.toArray()}_getMappingsPtr(){return 0===this._mappingsPtr&&this._parseMappings(),this._mappingsPtr}_parseMappings(){const e=this._mappings,t=e.length,r=this._wasm.exports.allocate_mappings(t),a=new Uint8Array(this._wasm.exports.memory.buffer,r,t);for(let r=0;r<t;r++)a[r]=e.charCodeAt(r);const n=this._wasm.exports.parse_mappings(r);if(!n){const e=this._wasm.exports.get_last_error();let t=`Error parsing mappings (code ${e}): `;switch(e){case 1:t+="the mappings contained a negative line, column, source index, or name index";break;case 2:t+="the mappings contained a number larger than 2**32";break;case 3:t+="reached EOF while in the middle of parsing a VLQ";break;case 4:t+="invalid base 64 character while parsing a VLQ";break;default:t+="unknown error code"}throw new Error(t)}this._mappingsPtr=n}eachMapping(e,t,r){const a=t||null,n=r||SourceMapConsumer$1.GENERATED_ORDER;this._wasm.withMappingCallback((t=>{null!==t.source&&(t.source=this._absoluteSources.at(t.source),null!==t.name&&(t.name=this._names.at(t.name))),this._computedColumnSpans&&null===t.lastGeneratedColumn&&(t.lastGeneratedColumn=1/0),e.call(a,t)}),(()=>{switch(n){case SourceMapConsumer$1.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case SourceMapConsumer$1.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}}))}allGeneratedPositionsFor(e){let t=util$1.getArg(e,"source");const r=util$1.getArg(e,"line"),a=e.column||0;if(t=this._findSourceIndex(t),t<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(a<0)throw new Error("Column numbers must be >= 0");const n=[];return this._wasm.withMappingCallback((e=>{let t=e.lastGeneratedColumn;this._computedColumnSpans&&null===t&&(t=1/0),n.push({line:e.generatedLine,column:e.generatedColumn,lastColumn:t})}),(()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),t,r-1,"column"in e,a)})),n}destroy(){0!==this._mappingsPtr&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(e){const t={generatedLine:util$1.getArg(e,"line"),generatedColumn:util$1.getArg(e,"column")};if(t.generatedLine<1)throw new Error("Line numbers must be >= 1");if(t.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r,a=util$1.getArg(e,"bias",SourceMapConsumer$1.GREATEST_LOWER_BOUND);if(null==a&&(a=SourceMapConsumer$1.GREATEST_LOWER_BOUND),this._wasm.withMappingCallback((e=>r=e),(()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),t.generatedLine-1,t.generatedColumn,a)})),r&&r.generatedLine===t.generatedLine){let e=util$1.getArg(r,"source",null);null!==e&&(e=this._absoluteSources.at(e));let t=util$1.getArg(r,"name",null);return null!==t&&(t=this._names.at(t)),{source:e,line:util$1.getArg(r,"originalLine",null),column:util$1.getArg(r,"originalColumn",null),name:t}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return!!this.sourcesContent&&this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some((function(e){return null==e}))}sourceContentFor(e,t){if(!this.sourcesContent)return null;const r=this._findSourceIndex(e);if(r>=0)return this.sourcesContent[r];if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')}generatedPositionFor(e){let t=util$1.getArg(e,"source");if(t=this._findSourceIndex(t),t<0)return{line:null,column:null,lastColumn:null};const r={source:t,originalLine:util$1.getArg(e,"line"),originalColumn:util$1.getArg(e,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let a,n=util$1.getArg(e,"bias",SourceMapConsumer$1.GREATEST_LOWER_BOUND);if(null==n&&(n=SourceMapConsumer$1.GREATEST_LOWER_BOUND),this._wasm.withMappingCallback((e=>a=e),(()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,n)})),a&&a.source===r.source){let e=a.lastGeneratedColumn;return this._computedColumnSpans&&null===e&&(e=1/0),{line:util$1.getArg(a,"generatedLine",null),column:util$1.getArg(a,"generatedColumn",null),lastColumn:e}}return{line:null,column:null,lastColumn:null}}}BasicSourceMapConsumer.prototype.consumer=SourceMapConsumer$1,sourceMapConsumer.BasicSourceMapConsumer=BasicSourceMapConsumer;class IndexedSourceMapConsumer extends SourceMapConsumer$1{constructor(e,t){return super(INTERNAL).then((r=>{let a=e;"string"==typeof e&&(a=util$1.parseSourceMapInput(e));const n=util$1.getArg(a,"version"),o=util$1.getArg(a,"sections");if(n!=r._version)throw new Error("Unsupported version: "+n);let s={line:-1,column:0};return Promise.all(o.map((e=>{if(e.url)throw new Error("Support for url field in sections not implemented.");const r=util$1.getArg(e,"offset"),a=util$1.getArg(r,"line"),n=util$1.getArg(r,"column");if(a<s.line||a===s.line&&n<s.column)throw new Error("Section offsets must be ordered and non-overlapping.");return s=r,new SourceMapConsumer$1(util$1.getArg(e,"map"),t).then((e=>({generatedOffset:{generatedLine:a+1,generatedColumn:n+1},consumer:e})))}))).then((e=>(r._sections=e,r)))}))}get sources(){const e=[];for(let t=0;t<this._sections.length;t++)for(let r=0;r<this._sections[t].consumer.sources.length;r++)e.push(this._sections[t].consumer.sources[r]);return e}originalPositionFor(e){const t={generatedLine:util$1.getArg(e,"line"),generatedColumn:util$1.getArg(e,"column")},r=binarySearch.search(t,this._sections,(function(e,t){return e.generatedLine-t.generatedOffset.generatedLine||e.generatedColumn-t.generatedOffset.generatedColumn})),a=this._sections[r];return a?a.consumer.originalPositionFor({line:t.generatedLine-(a.generatedOffset.generatedLine-1),column:t.generatedColumn-(a.generatedOffset.generatedLine===t.generatedLine?a.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every((function(e){return e.consumer.hasContentsOfAllSources()}))}sourceContentFor(e,t){for(let t=0;t<this._sections.length;t++){const r=this._sections[t].consumer.sourceContentFor(e,!0);if(r)return r}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')}_findSectionIndex(e){for(let t=0;t<this._sections.length;t++){const{consumer:r}=this._sections[t];if(-1!==r._findSourceIndex(e))return t}return-1}generatedPositionFor(e){const t=this._findSectionIndex(util$1.getArg(e,"source")),r=t>=0?this._sections[t]:null,a=t>=0&&t+1<this._sections.length?this._sections[t+1]:null,n=r&&r.consumer.generatedPositionFor(e);if(n&&null!==n.line){const e=r.generatedOffset.generatedLine-1,t=r.generatedOffset.generatedColumn-1;return 1===n.line&&(n.column+=t,"number"==typeof n.lastColumn&&(n.lastColumn+=t)),n.lastColumn===1/0&&a&&n.line===a.generatedOffset.generatedLine&&(n.lastColumn=a.generatedOffset.generatedColumn-2),n.line+=e,n}return{line:null,column:null,lastColumn:null}}allGeneratedPositionsFor(e){const t=this._findSectionIndex(util$1.getArg(e,"source")),r=t>=0?this._sections[t]:null,a=t>=0&&t+1<this._sections.length?this._sections[t+1]:null;return r?r.consumer.allGeneratedPositionsFor(e).map((e=>{const t=r.generatedOffset.generatedLine-1,n=r.generatedOffset.generatedColumn-1;return 1===e.line&&(e.column+=n,"number"==typeof e.lastColumn&&(e.lastColumn+=n)),e.lastColumn===1/0&&a&&e.line===a.generatedOffset.generatedLine&&(e.lastColumn=a.generatedOffset.generatedColumn-2),e.line+=t,e})):[]}eachMapping(e,t,r){this._sections.forEach(((a,n)=>{const o=n+1<this._sections.length?this._sections[n+1]:null,{generatedOffset:s}=a,i=s.generatedLine-1,c=s.generatedColumn-1;a.consumer.eachMapping((function(t){1===t.generatedLine&&(t.generatedColumn+=c,"number"==typeof t.lastGeneratedColumn&&(t.lastGeneratedColumn+=c)),t.lastGeneratedColumn===1/0&&o&&t.generatedLine===o.generatedOffset.generatedLine&&(t.lastGeneratedColumn=o.generatedOffset.generatedColumn-2),t.generatedLine+=i,e.call(this,t)}),t,r)}))}computeColumnSpans(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.computeColumnSpans()}destroy(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.destroy()}}function _factory(e,t){let r=e;"string"==typeof e&&(r=util$1.parseSourceMapInput(e));const a=null!=r.sections?new IndexedSourceMapConsumer(r,t):new BasicSourceMapConsumer(r,t);return Promise.resolve(a)}function _factoryBSM(e,t){return BasicSourceMapConsumer.fromSourceMap(e,t)}sourceMapConsumer.IndexedSourceMapConsumer=IndexedSourceMapConsumer;var sourceNode={};const SourceMapGenerator=sourceMapGenerator.SourceMapGenerator,util=util$4,REGEX_NEWLINE=/(\r?\n)/,NEWLINE_CODE=10,isSourceNode="$$$isSourceNode$$$";let SourceNode$1=class e{constructor(e,t,r,a,n){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==r?null:r,this.name=null==n?null:n,this[isSourceNode]=!0,null!=a&&this.add(a)}static fromStringWithSourceMap(t,r,a){const n=new e,o=t.split(REGEX_NEWLINE);let s=0;const i=function(){return e()+(e()||"");function e(){return s<o.length?o[s++]:void 0}};let c,u=1,p=0,l=null;return r.eachMapping((function(e){if(null!==l){if(!(u<e.generatedLine)){c=o[s]||"";const t=c.substr(0,e.generatedColumn-p);return o[s]=c.substr(e.generatedColumn-p),p=e.generatedColumn,f(l,t),void(l=e)}f(l,i()),u++,p=0}for(;u<e.generatedLine;)n.add(i()),u++;p<e.generatedColumn&&(c=o[s]||"",n.add(c.substr(0,e.generatedColumn)),o[s]=c.substr(e.generatedColumn),p=e.generatedColumn),l=e}),this),s<o.length&&(l&&f(l,i()),n.add(o.splice(s).join(""))),r.sources.forEach((function(e){const t=r.sourceContentFor(e);null!=t&&(null!=a&&(e=util.join(a,e)),n.setSourceContent(e,t))})),n;function f(t,r){if(null===t||void 0===t.source)n.add(r);else{const o=a?util.join(a,t.source):t.source;n.add(new e(t.originalLine,t.originalColumn,o,r,t.name))}}}add(e){if(Array.isArray(e))e.forEach((function(e){this.add(e)}),this);else{if(!e[isSourceNode]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this}prepend(e){if(Array.isArray(e))for(let t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[isSourceNode]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this}walk(e){let t;for(let r=0,a=this.children.length;r<a;r++)t=this.children[r],t[isSourceNode]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let t,r;const a=this.children.length;if(a>0){for(t=[],r=0;r<a-1;r++)t.push(this.children[r]),t.push(e);t.push(this.children[r]),this.children=t}return this}replaceRight(e,t){const r=this.children[this.children.length-1];return r[isSourceNode]?r.replaceRight(e,t):"string"==typeof r?this.children[this.children.length-1]=r.replace(e,t):this.children.push("".replace(e,t)),this}setSourceContent(e,t){this.sourceContents[util.toSetString(e)]=t}walkSourceContents(e){for(let t=0,r=this.children.length;t<r;t++)this.children[t][isSourceNode]&&this.children[t].walkSourceContents(e);const t=Object.keys(this.sourceContents);for(let r=0,a=t.length;r<a;r++)e(util.fromSetString(t[r]),this.sourceContents[t[r]])}toString(){let e="";return this.walk((function(t){e+=t})),e}toStringWithSourceMap(e){const t={code:"",line:1,column:0},r=new SourceMapGenerator(e);let a=!1,n=null,o=null,s=null,i=null;return this.walk((function(e,c){t.code+=e,null!==c.source&&null!==c.line&&null!==c.column?(n===c.source&&o===c.line&&s===c.column&&i===c.name||r.addMapping({source:c.source,original:{line:c.line,column:c.column},generated:{line:t.line,column:t.column},name:c.name}),n=c.source,o=c.line,s=c.column,i=c.name,a=!0):a&&(r.addMapping({generated:{line:t.line,column:t.column}}),n=null,a=!1);for(let o=0,s=e.length;o<s;o++)e.charCodeAt(o)===NEWLINE_CODE?(t.line++,t.column=0,o+1===s?(n=null,a=!1):a&&r.addMapping({source:c.source,original:{line:c.line,column:c.column},generated:{line:t.line,column:t.column},name:c.name})):t.column++})),this.walkSourceContents((function(e,t){r.setSourceContent(e,t)})),{code:t.code,map:r}}};sourceNode.SourceNode=SourceNode$1,sourceMap.SourceMapGenerator=sourceMapGenerator.SourceMapGenerator,sourceMap.SourceMapConsumer=sourceMapConsumer.SourceMapConsumer,sourceMap.SourceNode=sourceNode.SourceNode;var chaiLike$1={exports:{}},hasRequiredChaiLike$1,chaiLike,hasRequiredChaiLike;function requireChaiLike$1(){if(hasRequiredChaiLike$1)return chaiLike$1.exports;hasRequiredChaiLike$1=1;let e=[];return chaiLike$1.exports=function(t,r){function a(e,t){return r.type(t).toUpperCase()===e.toUpperCase()}function n(t,r){for(let a of e)if(a.match(t,r))return a.assert(t,r);if(t===r)return!0;if(a("object",r)&&a("object",t)){for(let e of Object.keys(r)){if(!(e in t))return!1;if(!n(t[e],r[e]))return!1}return!0}if(a("array",r)&&a("array",t)){if(t.length!==r.length)return!1;for(let e=0;e<r.length;e++)if(!n(t[e],r[e]))return!1;return!0}return a("RegExp",t)&&a("RegExp",r)?t.toString()===r.toString():a("Date",t)&&a("Date",r)?t.getTime()===r.getTime():!!(a("string",t)&&a("string",r)||a("number",t)&&a("number",r)||a("boolean",t)&&a("boolean",r))&&t==r}t.Assertion.addMethod("like",(function(e){let a=r.flag(this,"object");this.assert(n(a,e),"expected #{this} to be like #{exp}","expected #{this} to not like #{exp}",e,a,t.config.showDiff)}))},chaiLike$1.exports.extend=function(t){e.push(t)},chaiLike$1.exports.clearPlugins=function(){e=[]},chaiLike$1.exports}function requireChaiLike(){return hasRequiredChaiLike?chaiLike:(hasRequiredChaiLike=1,chaiLike=requireChaiLike$1())}var chai$m=require$$0,peg$2=peg_1,pkg=require$$2,SourceMapConsumer=sourceMap.SourceMapConsumer,spy=utils.spy;chai$m.use(requireChaiLike()),beforeEach((function(){return"undefined"!=typeof window?SourceMapConsumer.initialize({"lib/mappings.wasm":"https://raw.githubusercontent.com/mozilla/source-map/0.7.3/lib/mappings.wasm"}):null}));var expect$m=chai$m.expect;describe("Peggy API",(function(){it("has the correct VERSION",(function(){expect$m(peg$2.VERSION).to.equal(pkg.version)})),describe("generate",(function(){it("generates a parser",(function(){var e=peg$2.generate("start = 'a'");expect$m(e).to.be.an("object"),expect$m(e.parse("a")).to.equal("a")})),it("throws an exception on syntax error",(function(){expect$m((function(){peg$2.generate("start = @")})).to.throw()})),it("throws an exception on semantic error",(function(){expect$m((function(){peg$2.generate("start = undefined")})).to.throw()})),describe("allowed start rules",(function(){var e=["a = 'x'","b = 'x'","c = 'x'"].join("\n");describe("when |allowedStartRules| is not set",(function(){it("generated parser can start only from the first rule",(function(){var t=peg$2.generate(e);expect$m(t.parse("x",{startRule:"a"})).to.equal("x"),expect$m((function(){t.parse("x",{startRule:"b"})})).to.throw(),expect$m((function(){t.parse("x",{startRule:"c"})})).to.throw()}))})),describe("when |allowedStartRules| is set",(function(){it("generated parser can start only from specified rules",(function(){var t=peg$2.generate(e,{allowedStartRules:["b","c"]});expect$m((function(){t.parse("x",{startRule:"a"})})).to.throw(),expect$m(t.parse("x",{startRule:"b"})).to.equal("x"),expect$m(t.parse("x",{startRule:"c"})).to.equal("x")}))}))})),describe("intermediate results caching",(function(){var e=["{ var n = 0; }","start = (a 'b') / (a 'c') { return n; }","a = 'a' { n++; }"].join("\n");describe("when |cache| is not set",(function(){it("generated parser doesn't cache intermediate parse results",(function(){var t=peg$2.generate(e);expect$m(t.parse("ac")).to.equal(2)}))})),describe("when |cache| is set to |false|",(function(){it("generated parser doesn't cache intermediate parse results",(function(){var t=peg$2.generate(e,{cache:!1});expect$m(t.parse("ac")).to.equal(2)}))})),describe("when |cache| is set to |true|",(function(){it("generated parser caches intermediate parse results",(function(){var t=peg$2.generate(e,{cache:!0});expect$m(t.parse("ac")).to.equal(1)}))}))})),describe("tracing",(function(){var e="start = 'a'";describe("when |trace| is not set",(function(){it("generated parser doesn't trace",(function(){var t=peg$2.generate(e),r={trace:spy()};t.parse("a",{tracer:r}),expect$m(r.trace.called).to.equal(!1)}))})),describe("when |trace| is set to |false|",(function(){it("generated parser doesn't trace",(function(){var t=peg$2.generate(e,{trace:!1}),r={trace:spy()};t.parse("a",{tracer:r}),expect$m(r.trace.called).to.equal(!1)}))})),describe("when |trace| is set to |true|",(function(){it("generated parser traces",(function(){var t=peg$2.generate(e,{trace:!0}),r={trace:spy()};t.parse("a",{tracer:r}),expect$m(r.trace.called).to.equal(!0)}))}))})),describe("output",(function(){var grammar="start = 'a'";describe("when |output| is not set",(function(){it("returns generated parser object",(function(){var e=peg$2.generate(grammar);expect$m(e).to.be.an("object"),expect$m(e.parse("a")).to.equal("a")}))})),describe('when |output| is set to |"parser"|',(function(){it("returns generated parser object",(function(){var e=peg$2.generate(grammar,{output:"parser"});expect$m(e).to.be.an("object"),expect$m(e.parse("a")).to.equal("a")}))})),describe('when |output| is set to |"source"|',(function(){it("returns generated parser source code",(function(){var source=peg$2.generate(grammar,{output:"source"});expect$m(source).to.be.a("string"),expect$m(eval(source).parse("a")).to.equal("a")}))})),describe('when |output| is set to |"ast"|',(function(){it("returns generated parser AST",(function(){var e=peg$2.generate(grammar,{output:"ast"});expect$m(e).to.be.an("object"),expect$m(e).to.be.like(peg$2.parser.parse(grammar))}))}))})),describe("reserved words",(function(){describe("throws an exception on reserved JS words used as a label",(function(){for(var e=function(e){it(e,(function(){expect$m((function(){peg$2.generate(["start = "+e+":end","end = 'a'"].join("\n"),{output:"source"})})).to.throw(peg$2.parser.SyntaxError)}))},t=0,r=peg$2.RESERVED_WORDS;t<r.length;t++)e(r[t])})),describe("does not throw an exception on special non-reserved JS words used as a label",(function(){for(var nonReserved=["abstract","boolean","byte","char","double","final","float","goto","int","long","native","short","synchronized","throws","transient","volatile","as","async","from","get","of","set"],_loop_2=function(label){it(label,(function(){var source=peg$2.generate(["start = "+label+":end { return "+label+"; }","end = 'a'"].join("\n"),{output:"source"});expect$m(eval(source).parse("a")).to.equal("a")}))},_i=0,nonReserved_1=nonReserved;_i<nonReserved_1.length;_i++){var label=nonReserved_1[_i];_loop_2(label)}})),describe("does not throw an exception on reserved JS words used as a rule name",(function(){for(var _loop_3=function(rule){it(rule,(function(){var source=peg$2.generate(["start = "+rule,rule+" = 'a'"].join("\n"),{output:"source"});expect$m(eval(source).parse("a")).to.equal("a")}))},_i=0,_a=peg$2.RESERVED_WORDS;_i<_a.length;_i++){var rule=_a[_i];_loop_3(rule)}}))})),it("accepts custom options",(function(){peg$2.generate("start = 'a'",{grammarSource:42})})),describe("generates source map",(function(){function e(e,t,r){for(var a=t instanceof RegExp?e.search(t):e.indexOf(t),n=1,o=0,s=0;s<a;++s)10===e.charCodeAt(s)?(++n,o=0):++o;if(r&&r.offset){var i=r.offset({line:n,column:o,offset:a});return delete i.offset,i}return{line:n,column:o}}var t="GLOBAL\nINITIALIZER",r="PER-PARSE\nINITIALIZER",a="NOT\nBLOCK",n="AND\nBLOCK",o="ACTION\nBLOCK",s="MIN\nBLOCK",i="MAX\nBLOCK",c="EXACT\nBLOCK",u="\n        {{".concat(t,"}}\n        {").concat(r,"}\n        RULE_1 = !{").concat(a,"} 'a' rule:RULE_2 {").concat(o,"};\n        RULE_2 'named' = &{").concat(n,"} @'b' [abc] 'def';\n        RULE_3 = RULE_1 / RULE_2;\n        RULE_4 = RULE_1|{").concat(s,"} .. {").concat(i,"}, RULE_2|{").concat(c,"}| |;\n      ");function p(t,r,a,n){void 0===n&&(n=t);var o=peg$2.generate(u,{grammarSource:r,output:"source-and-map"}).toStringWithSourceMap(),s=o.code,i=o.map,c=e(u,t,r),p=e(s,n);return delete c.offset,delete p.offset,SourceMapConsumer.fromSourceMap(i).then((function(e){expect$m(e.originalPositionFor(p)).to.be.deep.equal(Object.assign(c,{source:String(r),name:a}))}))}for(var l=function(e){describe("with source = ".concat(chai$m.util.inspect(e)),(function(){it("global initializer",(function(){return p(t,e,"$top_level_initializer")})),it("per-parse initializer",(function(){return p(r,e,"$initializer")})),it("action block",(function(){return p(o,e,null)})),it("semantic and predicate",(function(){return p(n,e,null)})),it("semantic not predicate",(function(){return p(a,e,null)})),it("min function boundary",(function(){return p(s,e,null)})),it("max function boundary",(function(){return p(i,e,null)})),it("exact function boundary",(function(){return p(c,e,null)})),it("rule name",(function(){return p("RULE_1",e,"RULE_1","peg$parseRULE_1() {")})),it("labelled rule name",(function(){return p("RULE_2 'named'",e,"RULE_2","peg$parseRULE_2() {")})),it("literal expression",(function(){return p("'a'",e,null,"input.charCodeAt(peg$currPos) === 97")})),it("multichar literal",(function(){return p("'def'",e,null,"input.substr(peg$currPos, 3) === peg$c3")})),it("chars expression",(function(){return p("[abc]",e,null,/s\d = input\.charAt\(peg\$currPos\);\s*if \(peg\$r0\.test\(s\d\)\)/)})),it("rule expression",(function(){return p("RULE_2",e,null,"peg$parseRULE_2();")})),it("choice expression",(function(){return p("RULE_1 / RULE_2",e,null,new RegExp([/peg\$parseRULE_1\(\);\s*/,/if \(s. === peg\$FAILED\) \{\s*/,/s. = peg\$parseRULE_2/].map((function(e){return e.source})).join("")))}))}))},f=0,d=["-",new peg$2.GrammarLocation("-",{offset:51,line:13,column:7})];f<d.length;f++)l(d[f])}))}))}));var chai$l=require$$0,SourceNode=sourceMap.SourceNode,peg$1=peg_1,op=opcodes_1,expect$l=chai$l.expect;describe("plugin API",(function(){describe("use",(function(){var e="start = 'a'";it("is called for each plugin",(function(){var t=[!1,!1,!1],r=[{use:function(){t[0]=!0}},{use:function(){t[1]=!0}},{use:function(){t[2]=!0}}];peg$1.generate(e,{plugins:r}),expect$l(t).to.deep.equal([!0,!0,!0])})),it("receives configuration",(function(){var t={use:function(e){expect$l(e).to.be.an("object"),expect$l(e.parser).to.be.an("object"),expect$l(e.parser.parse("start = 'a'")).to.be.an("object"),expect$l(e.passes).to.be.an("object"),expect$l(e.passes.check).to.be.an("array"),e.passes.check.forEach((function(e){expect$l(e).to.be.a("function")})),expect$l(e.passes.transform).to.be.an("array"),e.passes.transform.forEach((function(e){expect$l(e).to.be.a("function")})),expect$l(e.passes.generate).to.be.an("array"),e.passes.generate.forEach((function(e){expect$l(e).to.be.a("function")})),expect$l(e.reservedWords).to.be.an("array"),e.reservedWords.forEach((function(e){expect$l(e).to.be.a("string")}))}};peg$1.generate(e,{plugins:[t]})})),it("receives options",(function(){var t={plugins:[{use:function(e,r){expect$l(r).to.equal(t)}}],foo:42};peg$1.generate(e,t)})),it("can replace parser",(function(){var e={use:function(e){var t=peg$1.generate(["start = .* {","  return {","    type: 'grammar',","    imports: [],","    initializer: {","      type: 'initializer',","      code: ['/* included for cover ast2SourceNode in the generate-js pass */'],","    },","    rules: [","      {","        type: 'rule',","        name: 'start',","        expression: { type: 'literal',  value: text(), ignoreCase: false }","      }","    ]","  };","}"].join("\n"));e.parser=t}},t=peg$1.generate("a",{plugins:[e]});expect$l(t.parse("a")).to.equal("a")})),it("can change compiler passes",(function(){var t={use:function(e){e.passes.generate=[function(e){e.code=new SourceNode(1,0,"plugin","({ parse: function() { return 42; } })")}]}},r=peg$1.generate(e,{plugins:[t]});expect$l(r.parse("a")).to.equal(42)})),it("can change list of reserved words",(function(){var e={use:function(e){e.reservedWords=[]}};expect$l((function(){peg$1.generate("start = "+peg$1.RESERVED_WORDS[0]+":'a'",{plugins:[e],output:"source"})})).to.not.throw()})),it("can change options",(function(){var e=["a = 'x'","b = 'x'","c = 'x'"].join("\n"),t=peg$1.generate(e,{allowedStartRules:["a"],plugins:[{use:function(e,t){t.allowedStartRules=["b","c"]}}]});expect$l((function(){t.parse("x",{startRule:"a"})})).to.throw(),expect$l(t.parse("x",{startRule:"b"})).to.equal("x"),expect$l(t.parse("x",{startRule:"c"})).to.equal("x")})),it("can use star for start rules",(function(){var e=["a = 'x'","b = 'x'","c = 'x'"].join("\n"),t=peg$1.generate(e,{allowedStartRules:["*"]});expect$l(t.parse("x",{startRule:"a"})).to.equal("x"),expect$l(t.parse("x",{startRule:"b"})).to.equal("x"),expect$l(t.parse("x",{startRule:"c"})).to.equal("x")})),it("can munge the bytecode",(function(){var e={use:function(e){e.passes.generate.splice(1,0,(function(e){expect$l(e.rules.length).to.equal(2);var t=e.rules[0].bytecode;expect$l(t[0]).to.equal(op.MATCH_STRING_IC),t.splice(4,0,op.PUSH_CURR_POS,op.POP),t[2]+=2,t=e.rules[1].bytecode,expect$l(t[0]).to.equal(op.MATCH_STRING),expect$l(t[4]).to.equal(op.ACCEPT_STRING),t[4]=op.ACCEPT_N,t[5]=1}))}},t=peg$1.generate("one = 'abc'i; two = 'a'",{plugins:[e],output:"source"}),r=new RegExp([/if \(input\.substr\(peg\$currPos, 3\)/,/.toLowerCase\(\) === peg\$c0\) \{/,/\s*s0 = peg\$currPos;/,/\s*s0 = input\.substr/].map((function(e){return e.source})).join(""));expect$l(t.search(r)).to.be.greaterThan(0)}))}))}));var chai$k=require$$0,peg=peg_1,expect$k=chai$k.expect,stub=utils.stub;describe("generated parser behavior",(function(){function e(e){var t={};return Object.keys(e).forEach((function(r){t[r]=e[r]})),t}function t(e){"object"==typeof console&&stub(console,"log");try{return e()}finally{"object"==typeof console&&console.log.restore()}}function r(e,r){var a=e.Assertion;a.addMethod("parse",(function(e,a,n){var o=this;n=void 0!==n?n:{};var s=t((function(){return r.flag(o,"object").parse(e,n)}));void 0!==a&&this.assert(r.eql(s,a),"expected #{this} to parse input as #{exp} but got #{act}","expected #{this} to not parse input as #{exp}",a,s,!r.flag(this,"negate"))})),a.addMethod("failToParse",(function(e,n,o){var s=this;o=void 0!==o?o:{};var i=void 0,c=void 0;try{c=t((function(){return r.flag(s,"object").parse(e,o)})),i=!0}catch(e){c=e,i=!1}this.assert(!i,"expected #{this} to fail to parse input but got #{act}","expected #{this} to not fail to parse input but #{act} was thrown",null,c),i||void 0===n||Object.keys(n).forEach((function(e){new a(c).to.have.property(e).that.is.deep.equal(n[e])}))}))}var a;beforeEach((function(){chai$k.use(r)})),a=function(t){describe("initializer",(function(){it("executes the code before parsing starts",(function(){var e=peg.generate(["{ var result = 42; }","start = 'a' { return result; }"].join("\n"),t);expect$k(e).to.parse("a",42)})),describe("available variables and functions",(function(){it("|options| contains options",(function(){var e=peg.generate(["{ var result = options; }","start = 'a' { return result; }"].join("\n"),t);expect$k(e).to.parse("a",{a:42},{a:42})}))}))})),describe("rule",(function(){t.cache?it("caches rule match results",(function(){var e=peg.generate(["{ var n = 0; }","start = (a 'b') / (a 'c') { return n; }","a = 'a' { n++; }"].join("\n"),t);expect$k(e).to.parse("ac",1)})):it("doesn't cache rule match results",(function(){var e=peg.generate(["{ var n = 0; }","start = (a 'b') / (a 'c') { return n; }","a = 'a' { n++; }"].join("\n"),t);expect$k(e).to.parse("ac",2)})),describe("when the expression matches",(function(){describe("without display name",(function(){describe("returns its match result",(function(){it("when expression may match",(function(){var e=peg.generate("start = 'a'",t);expect$k(e).to.parse("a","a")})),it("when expression always match",(function(){var e=peg.generate("start = 'a'*",t);expect$k(e).to.parse("",[])}))}))})),describe("with display name",(function(){describe("returns its match result",(function(){it("when expression may match",(function(){var e=peg.generate("start 'start' = 'a'",t);expect$k(e).to.parse("a","a")})),it("when expression always match",(function(){var e=peg.generate("start 'start' = 'a'*",t);expect$k(e).to.parse("",[])}))}))}))})),describe("when the expression doesn't match",(function(){describe("without display name",(function(){describe("reports match failure and records an expectation",(function(){it("when expression may match",(function(){var e=peg.generate("start = 'a'",t);expect$k(e).to.failToParse("b",{expected:[{type:"literal",text:"a",ignoreCase:!1}]})})),it("when expression never match",(function(){var e=peg.generate("start = []",t);expect$k(e).to.failToParse("b",{expected:[{type:"class",parts:[],inverted:!1,ignoreCase:!1}]})}))}))})),describe("with display name",(function(){it('reports match failure and records an expectation of type "other" when expression may match',(function(){var e=peg.generate("start 'start' = 'a'",t);expect$k(e).to.failToParse("b",{expected:[{type:"other",description:"start"}]})})),it("reports match failure and doesn't records any expectations when expression never match",(function(){var e=peg.generate("start 'start' = []",t);expect$k(e).to.failToParse("b",{expected:[]})})),it("discards any expectations recorded when matching the expression",(function(){var e=peg.generate("start 'start' = 'a'",t);expect$k(e).to.failToParse("b",{expected:[{type:"other",description:"start"}]})}))}))}))})),describe("literal",(function(){describe("matching",(function(){it("matches empty literals",(function(){var e=peg.generate("start = ''",t);expect$k(e).to.parse("")})),it("matches one-character literals",(function(){var e=peg.generate("start = 'a'",t);expect$k(e).to.parse("a"),expect$k(e).to.failToParse("b")})),it("matches multi-character literals",(function(){var e=peg.generate("start = 'abcd'",t);expect$k(e).to.parse("abcd"),expect$k(e).to.failToParse("efgh")})),it('is case sensitive without the "i" flag',(function(){var e=peg.generate("start = 'a'",t);expect$k(e).to.parse("a"),expect$k(e).to.failToParse("A")})),it('is case insensitive with the "i" flag',(function(){var e=peg.generate("start = 'a'i",t);expect$k(e).to.parse("a"),expect$k(e).to.parse("A")}))})),describe("when it matches",(function(){it("returns the matched text",(function(){var e=peg.generate("start = 'a'",t);expect$k(e).to.parse("a","a")})),it("consumes the matched text",(function(){var e=peg.generate("start = 'a' .",t);expect$k(e).to.parse("ab")}))})),describe("when it doesn't match",(function(){it('reports match failure and records an expectation of type "literal"',(function(){var e=peg.generate("start = 'a'",t);expect$k(e).to.failToParse("b",{expected:[{type:"literal",text:"a",ignoreCase:!1}]})}))}))})),describe("character class",(function(){describe("matching",(function(){it("matches empty classes",(function(){var e=peg.generate("start = []",t);expect$k(e).to.failToParse("a")})),it("matches classes with a character list",(function(){var e=peg.generate("start = [abc]",t);expect$k(e).to.parse("a"),expect$k(e).to.parse("b"),expect$k(e).to.parse("c"),expect$k(e).to.failToParse("d")})),it("matches classes with a character range",(function(){var e=peg.generate("start = [a-c]",t);expect$k(e).to.parse("a"),expect$k(e).to.parse("b"),expect$k(e).to.parse("c"),expect$k(e).to.failToParse("d")})),it("matches inverted classes",(function(){var e=peg.generate("start = [^a]",t);expect$k(e).to.failToParse("a"),expect$k(e).to.parse("b")})),it('is case sensitive without the "i" flag',(function(){var e=peg.generate("start = [a]",t);expect$k(e).to.parse("a"),expect$k(e).to.failToParse("A")})),it('is case insensitive with the "i" flag',(function(){var e=peg.generate("start = [a]i",t);expect$k(e).to.parse("a"),expect$k(e).to.parse("A")}))})),describe("when it matches",(function(){it("returns the matched character",(function(){var e=peg.generate("start = [a]",t);expect$k(e).to.parse("a","a")})),it("consumes the matched character",(function(){var e=peg.generate("start = [a] .",t);expect$k(e).to.parse("ab")}))})),describe("when it doesn't match",(function(){it('reports match failure and records an expectation of type "class"',(function(){var e=peg.generate("start = [a]",t);expect$k(e).to.failToParse("b",{expected:[{type:"class",parts:["a"],inverted:!1,ignoreCase:!1}]})}))}))})),describe("dot",(function(){describe("matching",(function(){it("matches any character",(function(){var e=peg.generate("start = .",t);expect$k(e).to.parse("a"),expect$k(e).to.parse("b"),expect$k(e).to.parse("c")}))})),describe("when it matches",(function(){it("returns the matched character",(function(){var e=peg.generate("start = .",t);expect$k(e).to.parse("a","a")})),it("consumes the matched character",(function(){var e=peg.generate("start = . .",t);expect$k(e).to.parse("ab")}))})),describe("when it doesn't match",(function(){it('reports match failure and records an expectation of type "any"',(function(){var e=peg.generate("start = .",t);expect$k(e).to.failToParse("",{expected:[{type:"any"}]})}))}))})),describe("rule reference",(function(){describe("when referenced rule's expression matches",(function(){it("returns its result",(function(){var e=peg.generate(["start = a","a = 'a'"].join("\n"),t);expect$k(e).to.parse("a","a")}))})),describe("when referenced rule's expression doesn't match",(function(){it("reports match failure",(function(){var e=peg.generate(["start = a","a = 'a'"].join("\n"),t);expect$k(e).to.failToParse("b")}))}))})),describe("positive semantic predicate",(function(){describe("when the code returns a truthy value",(function(){it("returns |undefined|",(function(){var e=peg.generate("start = &{ return true; } ''",t);expect$k(e).to.parse("",[void 0,""])}))})),describe("when the code returns a falsey value",(function(){it("reports match failure",(function(){var e=peg.generate("start = &{ return false; }",t);expect$k(e).to.failToParse("")}))})),describe("label variables",(function(){describe("in containing sequence",(function(){it("can access variables defined by preceding labeled elements",(function(){var e=peg.generate("start = a:'a' &{ return a === 'a'; }",t);expect$k(e).to.parse("a")})),it("cannot access variable defined by labeled predicate element",(function(){var e=peg.generate("start = 'a' b:&{ return b === undefined; } 'c'",t);expect$k(e).to.failToParse("ac")})),it("cannot access variables defined by following labeled elements",(function(){var e=peg.generate("start = &{ return a === 'a'; } a:'a'",t);expect$k(e).to.failToParse("a")})),it("cannot access variables defined by subexpressions",(function(){[{grammar:"start = (a:'a') &{ return a === 'a'; }",input:"a"},{grammar:"start = (a:'a')? &{ return a === 'a'; }",input:"a"},{grammar:"start = (a:'a')* &{ return a === 'a'; }",input:"a"},{grammar:"start = (a:'a')+ &{ return a === 'a'; }",input:"a"},{grammar:"start = (a:'a')| .. | &{ return a === 'a'; }",input:"a"},{grammar:"start = (a:'a')|0.. | &{ return a === 'a'; }",input:"a"},{grammar:"start = (a:'a')|1.. | &{ return a === 'a'; }",input:"a"},{grammar:"start = (a:'a')|2.. | &{ return a === 'a'; }",input:"aa"},{grammar:"start = (a:'a')| ..1| &{ return a === 'a'; }",input:"a"},{grammar:"start = (a:'a')| ..3| &{ return a === 'a'; }",input:"a"},{grammar:"start = (a:'a')|2..3| &{ return a === 'a'; }",input:"aa"},{grammar:"start = (a:'a')|3| &{ return a === 'a'; }",input:"aaa"},{grammar:"start = $(a:'a') &{ return a === 'a'; }",input:"a"},{grammar:"start = &(a:'a') 'a' &{ return a === 'a'; }",input:"a"},{grammar:"start = !(a:'a') 'b' &{ return a === 'a'; }",input:"b"},{grammar:"start = b:(a:'a') &{ return a === 'a'; }",input:"a"},{grammar:"start = ('a' b:'b' 'c') &{ return b === 'b'; }",input:"abc"},{grammar:"start = (a:'a' { return a; }) &{ return a === 'a'; }",input:"a"},{grammar:"start = ('a' / b:'b' / 'c') &{ return b === 'b'; }",input:"b"}].forEach((function(e){var r=peg.generate(e.grammar,t);expect$k(r).to.failToParse(e.input)}))}))})),describe("in outer sequence",(function(){it("can access variables defined by preceding labeled elements",(function(){var e=peg.generate("start = a:'a' ('b' &{ return a === 'a'; })",t);expect$k(e).to.parse("ab")})),it("cannot access variable defined by labeled predicate element",(function(){var e=peg.generate("start = 'a' b:('b' &{ return b === undefined; }) 'c'",t);expect$k(e).to.failToParse("abc")})),it("cannot access variables defined by following labeled elements",(function(){var e=peg.generate("start = ('a' &{ return b === 'b'; }) b:'b'",t);expect$k(e).to.failToParse("ab")}))}))})),describe("initializer variables & functions",(function(){it("can access variables defined in the initializer",(function(){var e=peg.generate(["{ var v = 42 }","start = &{ return v === 42; }"].join("\n"),t);expect$k(e).to.parse("")})),it("can access functions defined in the initializer",(function(){var e=peg.generate(["{ function f() { return 42; } }","start = &{ return f() === 42; }"].join("\n"),t);expect$k(e).to.parse("")}))})),describe("available variables & functions",(function(){it("|options| contains options",(function(){var e=peg.generate(["{ var result; }","start = &{ result = options; return true; } { return result; }"].join("\n"),t);expect$k(e).to.parse("",{a:42},{a:42})})),it("|location| returns current location info",(function(){var e=peg.generate(["{ var result; }","start = line (nl+ line)* { return result; }","line = thing (' '+ thing)*","thing = digit / mark","digit = [0-9]","mark = &{ result = location(); return true; } 'x'","nl = '\\r'? '\\n'"].join("\n"),t);expect$k(e).to.parse("1\n2\n\n3\n\n\n4 5 x",{source:void 0,start:{offset:13,line:7,column:5},end:{offset:13,line:7,column:5}}),expect$k(e).to.parse("1\nx",{source:void 0,start:{offset:2,line:2,column:1},end:{offset:2,line:2,column:1}}),expect$k(e).to.parse("1\r\nx",{source:void 0,start:{offset:3,line:2,column:1},end:{offset:3,line:2,column:1}})})),it("|offset| returns current start offset",(function(){var e=peg.generate(["start = [0-9]+ @mark","mark = 'xx' { return offset(); }"].join("\n"),t);expect$k(e).to.parse("0123456xx",7)})),it("|range| returns current range",(function(){var e=peg.generate(["start = [0-9]+ @mark","mark = 'xx' { return range(); }"].join("\n"),t);expect$k(e).to.parse("0123456xx",{source:void 0,start:7,end:9})}))}))})),describe("negative semantic predicate",(function(){describe("when the code returns a falsey value",(function(){it("returns |undefined|",(function(){var e=peg.generate("start = !{ return false; } ''",t);expect$k(e).to.parse("",[void 0,""])}))})),describe("when the code returns a truthy value",(function(){it("reports match failure",(function(){var e=peg.generate("start = !{ return true; }",t);expect$k(e).to.failToParse("")}))})),describe("label variables",(function(){describe("in containing sequence",(function(){it("can access variables defined by preceding labeled elements",(function(){var e=peg.generate("start = a:'a' !{ return a !== 'a'; }",t);expect$k(e).to.parse("a")})),it("cannot access variable defined by labeled predicate element",(function(){var e=peg.generate("start = 'a' b:!{ return b !== undefined; } 'c'",t);expect$k(e).to.failToParse("ac")})),it("cannot access variables defined by following labeled elements",(function(){var e=peg.generate("start = !{ return a !== 'a'; } a:'a'",t);expect$k(e).to.failToParse("a")})),it("cannot access variables defined by subexpressions",(function(){[{grammar:"start = (a:'a') !{ return a !== 'a'; }",input:"a"},{grammar:"start = (a:'a')? !{ return a !== 'a'; }",input:"a"},{grammar:"start = (a:'a')* !{ return a !== 'a'; }",input:"a"},{grammar:"start = (a:'a')+ !{ return a !== 'a'; }",input:"a"},{grammar:"start = (a:'a')| .. | !{ return a !== 'a'; }",input:"a"},{grammar:"start = (a:'a')|0.. | !{ return a !== 'a'; }",input:"a"},{grammar:"start = (a:'a')|1.. | !{ return a !== 'a'; }",input:"a"},{grammar:"start = (a:'a')|2.. | !{ return a !== 'a'; }",input:"aa"},{grammar:"start = (a:'a')| ..1| !{ return a !== 'a'; }",input:"a"},{grammar:"start = (a:'a')| ..3| !{ return a !== 'a'; }",input:"a"},{grammar:"start = (a:'a')|2..3| !{ return a !== 'a'; }",input:"aa"},{grammar:"start = (a:'a')|3| !{ return a !== 'a'; }",input:"aaa"},{grammar:"start = $(a:'a') !{ return a !== 'a'; }",input:"a"},{grammar:"start = &(a:'a') 'a' !{ return a !== 'a'; }",input:"a"},{grammar:"start = !(a:'a') 'b' !{ return a !== 'a'; }",input:"b"},{grammar:"start = b:(a:'a') !{ return a !== 'a'; }",input:"a"},{grammar:"start = ('a' b:'b' 'c') !{ return b !== 'b'; }",input:"abc"},{grammar:"start = (a:'a' { return a; }) !{ return a !== 'a'; }",input:"a"},{grammar:"start = ('a' / b:'b' / 'c') !{ return b !== 'b'; }",input:"b"}].forEach((function(e){var r=peg.generate(e.grammar,t);expect$k(r).to.failToParse(e.input)}))}))})),describe("in outer sequence",(function(){it("can access variables defined by preceding labeled elements",(function(){var e=peg.generate("start = a:'a' ('b' !{ return a !== 'a'; })",t);expect$k(e).to.parse("ab")})),it("cannot access variable defined by labeled predicate element",(function(){var e=peg.generate("start = 'a' b:('b' !{ return b !== undefined; }) 'c'",t);expect$k(e).to.failToParse("abc")})),it("cannot access variables defined by following labeled elements",(function(){var e=peg.generate("start = ('a' !{ return b !== 'b'; }) b:'b'",t);expect$k(e).to.failToParse("ab")}))}))})),describe("initializer variables & functions",(function(){it("can access variables defined in the initializer",(function(){var e=peg.generate(["{ var v = 42 }","start = !{ return v !== 42; }"].join("\n"),t);expect$k(e).to.parse("")})),it("can access functions defined in the initializer",(function(){var e=peg.generate(["{ function f() { return 42; } }","start = !{ return f() !== 42; }"].join("\n"),t);expect$k(e).to.parse("")}))})),describe("available variables & functions",(function(){it("|options| contains options",(function(){var e=peg.generate(["{ var result; }","start = !{ result = options; return false; } { return result; }"].join("\n"),t);expect$k(e).to.parse("",{a:42},{a:42})})),it("|location| returns current location info",(function(){var e=peg.generate(["{ var result; }","start = line (nl+ line)* { return result; }","line = thing (' '+ thing)*","thing = digit / mark","digit = [0-9]","mark = !{ result = location(); return false; } 'x'","nl = '\\r'? '\\n'"].join("\n"),t);expect$k(e).to.parse("1\n2\n\n3\n\n\n4 5 x",{source:void 0,start:{offset:13,line:7,column:5},end:{offset:13,line:7,column:5}}),expect$k(e).to.parse("1\nx",{source:void 0,start:{offset:2,line:2,column:1},end:{offset:2,line:2,column:1}}),expect$k(e).to.parse("1\r\nx",{source:void 0,start:{offset:3,line:2,column:1},end:{offset:3,line:2,column:1}})}))}))})),describe("group",(function(){describe("when the expression matches",(function(){it("returns its match result",(function(){var e=peg.generate("start = ('a')",t);expect$k(e).to.parse("a","a")}))})),describe("when the expression doesn't match",(function(){it("reports match failure",(function(){var e=peg.generate("start = ('a')",t);expect$k(e).to.failToParse("b")}))}))})),describe("optional",(function(){describe("when the expression matches",(function(){it("returns its match result",(function(){var e=peg.generate("start = 'a'?",t);expect$k(e).to.parse("a","a")}))})),describe("when the expression doesn't match",(function(){it("returns |null|",(function(){var e=peg.generate("start = 'a'?",t);expect$k(e).to.parse("",null)}))}))})),describe("zero or more",(function(){describe("when the expression matches zero or more times",(function(){it("returns an array of its match results",(function(){var e=peg.generate("start = 'a'*",t);expect$k(e).to.parse("",[]),expect$k(e).to.parse("a",["a"]),expect$k(e).to.parse("aaa",["a","a","a"])}))}))})),describe("one or more",(function(){describe("when the expression matches one or more times",(function(){it("returns an array of its match results",(function(){var e=peg.generate("start = 'a'+",t);expect$k(e).to.parse("a",["a"]),expect$k(e).to.parse("aaa",["a","a","a"])}))})),describe("when the expression doesn't match",(function(){it("reports match failure",(function(){var e=peg.generate("start = 'a'+",t);expect$k(e).to.failToParse("")}))}))})),describe("repeated",(function(){function r(r){for(var a=[],n=1;n<=4;++n)for(var o=1;o<=4;++o)a[a.length]="start"+String(n)+o;var s=e(t);return s.allowedStartRules=a,peg.generate(["start11 =         val:n1      x|"+r+"|      $.*","start12 =         val:n1 data:x|"+r+"|      $.*","start13 =         val:n1      x|"+r+"| rest:$.*","start14 =         val:n1 data:x|"+r+"| rest:$.*","start21 = .       val:n1      x|"+r+"|      $.*","start22 = .       val:n1 data:x|"+r+"|      $.*","start23 = .       val:n1      x|"+r+"| rest:$.*","start24 = .       val:n1 data:x|"+r+"| rest:$.*","start31 = a:.     val:n1      x|"+r+"|      $.*","start32 = a:.     val:n1 data:x|"+r+"|      $.*","start33 = a:.     val:n1      x|"+r+"| rest:$.*","start34 = a:.     val:n1 data:x|"+r+"| rest:$.*","start41 = a:. b:. val:n1      x|"+r+"|      $.*","start42 = a:. b:. val:n1 data:x|"+r+"|      $.*","start43 = a:. b:. val:n1      x|"+r+"| rest:$.*","start44 = a:. b:. val:n1 data:x|"+r+"| rest:$.*","n1 = n:$[0-9] { return parseInt(n, 10); }","x = '='"].join(";\n"),s)}describe("without delimiter",(function(){describe("with constant boundaries",(function(){it("| .. | matches correctly",(function(){var e=peg.generate("start = 'a'|..|",t);expect$k(e).to.parse("",[]),expect$k(e).to.parse("a",["a"]),expect$k(e).to.parse("aa",["a","a"]),expect$k(e).to.parse("aaa",["a","a","a"])})),it("|0.. | matches correctly",(function(){var e=peg.generate("start = 'a'|0..|",t);expect$k(e).to.parse("",[]),expect$k(e).to.parse("a",["a"]),expect$k(e).to.parse("aa",["a","a"]),expect$k(e).to.parse("aaa",["a","a","a"])})),it("|1.. | matches correctly",(function(){var e=peg.generate("start = 'a'|1..|",t);expect$k(e).to.failToParse(""),expect$k(e).to.parse("a",["a"]),expect$k(e).to.parse("aa",["a","a"]),expect$k(e).to.parse("aaa",["a","a","a"])})),it("|2.. | matches correctly",(function(){var e=peg.generate("start = 'a'|2..|",t);expect$k(e).to.failToParse(""),expect$k(e).to.failToParse("a"),expect$k(e).to.parse("aa",["a","a"]),expect$k(e).to.parse("aaa",["a","a","a"])})),it("| ..1| matches correctly",(function(){var e=peg.generate("start = 'a'|..1|",t);expect$k(e).to.parse("",[]),expect$k(e).to.parse("a",["a"]),expect$k(e).to.failToParse("aa"),expect$k(e).to.failToParse("aaa")})),it("| ..2| matches correctly",(function(){var e=peg.generate("start = 'a'|..2|",t);expect$k(e).to.parse("",[]),expect$k(e).to.parse("a",["a"]),expect$k(e).to.parse("aa",["a","a"]),expect$k(e).to.failToParse("aaa")})),it("|2..3| matches correctly",(function(){var e=peg.generate("start = 'a'|2..3|",t);expect$k(e).to.failToParse(""),expect$k(e).to.failToParse("a"),expect$k(e).to.parse("aa",["a","a"]),expect$k(e).to.parse("aaa",["a","a","a"]),expect$k(e).to.failToParse("aaaa")})),it("|2..2| matches correctly",(function(){var e=peg.generate("start = 'a'|2..2|",t);expect$k(e).to.failToParse(""),expect$k(e).to.failToParse("a"),expect$k(e).to.parse("aa",["a","a"]),expect$k(e).to.failToParse("aaa")})),it("| 2  | matches correctly",(function(){var e=peg.generate("start = 'a'|2|",t);expect$k(e).to.failToParse(""),expect$k(e).to.failToParse("a"),expect$k(e).to.parse("aa",["a","a"]),expect$k(e).to.failToParse("aaa")})),it("|3..2| matches correctly",(function(){var e=peg.generate("start = 'a'|3..2|",t);expect$k(e).to.failToParse(""),expect$k(e).to.failToParse("a"),expect$k(e).to.failToParse("aa"),expect$k(e).to.failToParse("aaa")})),it("does not consume input on failure",(function(){var e=peg.generate("start = 'a'|3| / 'a'|2| { return 42; }",t);expect$k(e).to.parse("aa",42)})),it("correctly pass external references to labels to repeated expression",(function(){var e=peg.generate("start = ref:'a' ('b' &{ return ref === 'a'; })|..|",t);expect$k(e).to.parse("abb",["a",[["b",void 0],["b",void 0]]]),e=peg.generate("start = ref:'a' ('b' &{ return ref === 'a'; })|2..|",t),expect$k(e).to.parse("abb",["a",[["b",void 0],["b",void 0]]]),e=peg.generate("start = ref:'a' ('b' &{ return ref === 'a'; })|..3|",t),expect$k(e).to.parse("abb",["a",[["b",void 0],["b",void 0]]]),e=peg.generate("start = ref:'a' ('b' &{ return ref === 'a'; })|2..3|",t),expect$k(e).to.parse("abb",["a",[["b",void 0],["b",void 0]]]),e=peg.generate("start = ref:'a' ('b' &{ return ref === 'a'; })|2|",t),expect$k(e).to.parse("abb",["a",[["b",void 0],["b",void 0]]])}))})),describe("with variable boundaries",(function(){it("|min..   | matches correctly",(function(){for(var e=r("val.."),t=1;t<=4;++t){var a={startRule:"start1"+t};expect$k(e).to.failToParse("",void 0,a),expect$k(e).to.parse("0",[0,[],""],a),expect$k(e).to.parse("0==",[0,["=","="],""],a),expect$k(e).to.failToParse("1",void 0,a),expect$k(e).to.failToParse("2=",void 0,a),expect$k(e).to.parse("2==",[2,["=","="],""],a),expect$k(e).to.parse("2=====",[2,["=","=","=","=","="],""],a)}for(t=1;t<=4;++t)a={startRule:"start2"+t},expect$k(e).to.failToParse("-",void 0,a),expect$k(e).to.parse("-0",["-",0,[],""],a),expect$k(e).to.parse("-0==",["-",0,["=","="],""],a),expect$k(e).to.failToParse("-1",void 0,a),expect$k(e).to.failToParse("-2=",void 0,a),expect$k(e).to.parse("-2==",["-",2,["=","="],""],a),expect$k(e).to.parse("-2=====",["-",2,["=","=","=","=","="],""],a);for(t=1;t<=4;++t)a={startRule:"start3"+t},expect$k(e).to.failToParse("-",void 0,a),expect$k(e).to.parse("-0",["-",0,[],""],a),expect$k(e).to.parse("-0==",["-",0,["=","="],""],a),expect$k(e).to.failToParse("-1",void 0,a),expect$k(e).to.failToParse("-2=",void 0,a),expect$k(e).to.parse("-2==",["-",2,["=","="],""],a),expect$k(e).to.parse("-2=====",["-",2,["=","=","=","=","="],""],a);for(t=1;t<=4;++t)a={startRule:"start4"+t},expect$k(e).to.failToParse("--",void 0,a),expect$k(e).to.parse("--0",["-","-",0,[],""],a),expect$k(e).to.parse("--0==",["-","-",0,["=","="],""],a),expect$k(e).to.failToParse("--1",void 0,a),expect$k(e).to.failToParse("--2=",void 0,a),expect$k(e).to.parse("--2==",["-","-",2,["=","="],""],a),expect$k(e).to.parse("--2=====",["-","-",2,["=","=","=","=","="],""],a)})),it("|   ..max| matches correctly",(function(){for(var e=r("..val"),t=1;t<=4;++t){var a={startRule:"start1"+t};expect$k(e).to.failToParse("",void 0,a),expect$k(e).to.parse("0",[0,[],""],a),expect$k(e).to.parse("0==",[0,[],"=="],a),expect$k(e).to.parse("3",[3,[],""],a),expect$k(e).to.parse("3=",[3,["="],""],a),expect$k(e).to.parse("3===",[3,["=","=","="],""],a),expect$k(e).to.parse("3=====",[3,["=","=","="],"=="],a)}for(t=1;t<=4;++t)a={startRule:"start2"+t},expect$k(e).to.failToParse("-",void 0,a),expect$k(e).to.parse("-0",["-",0,[],""],a),expect$k(e).to.parse("-0==",["-",0,[],"=="],a),expect$k(e).to.parse("-3",["-",3,[],""],a),expect$k(e).to.parse("-3=",["-",3,["="],""],a),expect$k(e).to.parse("-3===",["-",3,["=","=","="],""],a),expect$k(e).to.parse("-3=====",["-",3,["=","=","="],"=="],a);for(t=1;t<=4;++t)a={startRule:"start3"+t},expect$k(e).to.failToParse("-",void 0,a),expect$k(e).to.parse("-0",["-",0,[],""],a),expect$k(e).to.parse("-0==",["-",0,[],"=="],a),expect$k(e).to.parse("-3",["-",3,[],""],a),expect$k(e).to.parse("-3=",["-",3,["="],""],a),expect$k(e).to.parse("-3===",["-",3,["=","=","="],""],a),expect$k(e).to.parse("-3=====",["-",3,["=","=","="],"=="],a);for(t=1;t<=4;++t)a={startRule:"start4"+t},expect$k(e).to.failToParse("--",void 0,a),expect$k(e).to.parse("--0",["-","-",0,[],""],a),expect$k(e).to.parse("--0==",["-","-",0,[],"=="],a),expect$k(e).to.parse("--3",["-","-",3,[],""],a),expect$k(e).to.parse("--3=",["-","-",3,["="],""],a),expect$k(e).to.parse("--3===",["-","-",3,["=","=","="],""],a),expect$k(e).to.parse("--3=====",["-","-",3,["=","=","="],"=="],a)})),it("|min..max| matches correctly",(function(){for(var r=function(){for(var r=[],a=1;a<=4;++a)for(var n=1;n<=4;++n)r[r.length]="start"+String(a)+n;var o=e(t);return o.allowedStartRules=r,peg.generate(["start11 =         min:n1 max:n1      .|min..max|      $.*","start12 =         min:n1 max:n1 data:.|min..max|      $.*","start13 =         min:n1 max:n1      .|min..max| rest:$.*","start14 =         min:n1 max:n1 data:.|min..max| rest:$.*","start21 = .       min:n1 max:n1      .|min..max|      $.*","start22 = .       min:n1 max:n1 data:.|min..max|      $.*","start23 = .       min:n1 max:n1      .|min..max| rest:$.*","start24 = .       min:n1 max:n1 data:.|min..max| rest:$.*","start31 = a:.     min:n1 max:n1      .|min..max|      $.*","start32 = a:.     min:n1 max:n1 data:.|min..max|      $.*","start33 = a:.     min:n1 max:n1      .|min..max| rest:$.*","start34 = a:.     min:n1 max:n1 data:.|min..max| rest:$.*","start41 = a:. b:. min:n1 max:n1      .|min..max|      $.*","start42 = a:. b:. min:n1 max:n1 data:.|min..max|      $.*","start43 = a:. b:. min:n1 max:n1      .|min..max| rest:$.*","start44 = a:. b:. min:n1 max:n1 data:.|min..max| rest:$.*","n1 = n:$[0-9] { return parseInt(n, 10); }"].join(";\n"),o)}(),a=1;a<=4;++a){var n={startRule:"start1"+a};expect$k(r).to.failToParse("",void 0,n),expect$k(r).to.parse("00",[0,0,[],""],n),expect$k(r).to.parse("00==",[0,0,[],"=="],n),expect$k(r).to.failToParse("23",void 0,n),expect$k(r).to.failToParse("23=",void 0,n),expect$k(r).to.parse("23==",[2,3,["=","="],""],n),expect$k(r).to.parse("23===",[2,3,["=","=","="],""],n),expect$k(r).to.parse("23=====",[2,3,["=","=","="],"=="],n)}for(a=1;a<=4;++a)n={startRule:"start2"+a},expect$k(r).to.failToParse("-",void 0,n),expect$k(r).to.parse("-00",["-",0,0,[],""],n),expect$k(r).to.parse("-00==",["-",0,0,[],"=="],n),expect$k(r).to.failToParse("-23",void 0,n),expect$k(r).to.failToParse("-23=",void 0,n),expect$k(r).to.parse("-23==",["-",2,3,["=","="],""],n),expect$k(r).to.parse("-23===",["-",2,3,["=","=","="],""],n),expect$k(r).to.parse("-23=====",["-",2,3,["=","=","="],"=="],n);for(a=1;a<=4;++a)n={startRule:"start3"+a},expect$k(r).to.failToParse("-",void 0,n),expect$k(r).to.parse("-00",["-",0,0,[],""],n),expect$k(r).to.parse("-00==",["-",0,0,[],"=="],n),expect$k(r).to.failToParse("-23",void 0,n),expect$k(r).to.failToParse("-23=",void 0,n),expect$k(r).to.parse("-23==",["-",2,3,["=","="],""],n),expect$k(r).to.parse("-23===",["-",2,3,["=","=","="],""],n),expect$k(r).to.parse("-23=====",["-",2,3,["=","=","="],"=="],n);for(a=1;a<=4;++a)n={startRule:"start4"+a},expect$k(r).to.failToParse("--",void 0,n),expect$k(r).to.parse("--00",["-","-",0,0,[],""],n),expect$k(r).to.parse("--00==",["-","-",0,0,[],"=="],n),expect$k(r).to.failToParse("--23",void 0,n),expect$k(r).to.failToParse("--23=",void 0,n),expect$k(r).to.parse("--23==",["-","-",2,3,["=","="],""],n),expect$k(r).to.parse("--23===",["-","-",2,3,["=","=","="],""],n),expect$k(r).to.parse("--23=====",["-","-",2,3,["=","=","="],"=="],n)})),it("|val..val| matches correctly",(function(){for(var e=r("val"),t=1;t<=4;++t){var a={startRule:"start1"+t};expect$k(e).to.failToParse("",void 0,a),expect$k(e).to.parse("0",[0,[],""],a),expect$k(e).to.parse("0==",[0,[],"=="],a),expect$k(e).to.failToParse("3",void 0,a),expect$k(e).to.failToParse("3=",void 0,a),expect$k(e).to.parse("3===",[3,["=","=","="],""],a),expect$k(e).to.parse("3=====",[3,["=","=","="],"=="],a)}for(t=1;t<=4;++t)a={startRule:"start2"+t},expect$k(e).to.failToParse("-",void 0,a),expect$k(e).to.parse("-0",["-",0,[],""],a),expect$k(e).to.parse("-0==",["-",0,[],"=="],a),expect$k(e).to.failToParse("-3",void 0,a),expect$k(e).to.failToParse("-3=",void 0,a),expect$k(e).to.parse("-3===",["-",3,["=","=","="],""],a),expect$k(e).to.parse("-3=====",["-",3,["=","=","="],"=="],a);for(t=1;t<=4;++t)a={startRule:"start3"+t},expect$k(e).to.failToParse("-",void 0,a),expect$k(e).to.parse("-0",["-",0,[],""],a),expect$k(e).to.parse("-0==",["-",0,[],"=="],a),expect$k(e).to.failToParse("-3",void 0,a),expect$k(e).to.failToParse("-3=",void 0,a),expect$k(e).to.parse("-3===",["-",3,["=","=","="],""],a),expect$k(e).to.parse("-3=====",["-",3,["=","=","="],"=="],a);for(t=1;t<=4;++t)a={startRule:"start4"+t},expect$k(e).to.failToParse("--",void 0,a),expect$k(e).to.parse("--0",["-","-",0,[],""],a),expect$k(e).to.parse("--0==",["-","-",0,[],"=="],a),expect$k(e).to.failToParse("--3",void 0,a),expect$k(e).to.failToParse("--3=",void 0,a),expect$k(e).to.parse("--3===",["-","-",3,["=","=","="],""],a),expect$k(e).to.parse("--3=====",["-","-",3,["=","=","="],"=="],a)})),it("| exact  | matches correctly",(function(){for(var e=r("val"),t=1;t<=4;++t){var a={startRule:"start1"+t};expect$k(e).to.failToParse("",void 0,a),expect$k(e).to.parse("0",[0,[],""],a),expect$k(e).to.parse("0==",[0,[],"=="],a),expect$k(e).to.failToParse("3",void 0,a),expect$k(e).to.failToParse("3=",void 0,a),expect$k(e).to.parse("3===",[3,["=","=","="],""],a),expect$k(e).to.parse("3=====",[3,["=","=","="],"=="],a)}for(t=1;t<=4;++t)a={startRule:"start2"+t},expect$k(e).to.failToParse("-",void 0,a),expect$k(e).to.parse("-0",["-",0,[],""],a),expect$k(e).to.parse("-0==",["-",0,[],"=="],a),expect$k(e).to.failToParse("-3",void 0,a),expect$k(e).to.failToParse("-3=",void 0,a),expect$k(e).to.parse("-3===",["-",3,["=","=","="],""],a),expect$k(e).to.parse("-3=====",["-",3,["=","=","="],"=="],a);for(t=1;t<=4;++t)a={startRule:"start3"+t},expect$k(e).to.failToParse("-",void 0,a),expect$k(e).to.parse("-0",["-",0,[],""],a),expect$k(e).to.parse("-0==",["-",0,[],"=="],a),expect$k(e).to.failToParse("-3",void 0,a),expect$k(e).to.failToParse("-3=",void 0,a),expect$k(e).to.parse("-3===",["-",3,["=","=","="],""],a),expect$k(e).to.parse("-3=====",["-",3,["=","=","="],"=="],a);for(t=1;t<=4;++t)a={startRule:"start4"+t},expect$k(e).to.failToParse("--",void 0,a),expect$k(e).to.parse("--0",["-","-",0,[],""],a),expect$k(e).to.parse("--0==",["-","-",0,[],"=="],a),expect$k(e).to.failToParse("--3",void 0,a),expect$k(e).to.failToParse("--3=",void 0,a),expect$k(e).to.parse("--3===",["-","-",3,["=","=","="],""],a),expect$k(e).to.parse("--3=====",["-","-",3,["=","=","="],"=="],a)}))})),describe("with function boundaries",(function(){it("|{min}..     | matches correctly",(function(){var e=peg.generate("start = 'a'|{ return 2; }..|",t);expect$k(e).to.failToParse(""),expect$k(e).to.failToParse("a"),expect$k(e).to.parse("aa",["a","a"]),expect$k(e).to.parse("aaa",["a","a","a"])})),it("|     ..{max}| matches correctly",(function(){var e=peg.generate("start = 'a'|..{ return 2; }|",t);expect$k(e).to.parse("",[]),expect$k(e).to.parse("a",["a"]),expect$k(e).to.parse("aa",["a","a"]),expect$k(e).to.failToParse("aaa")})),it("|{min}..{max}| matches correctly",(function(){var e=peg.generate("start = 'a'|{ return 2; }..{ return 3; }|",t);expect$k(e).to.failToParse(""),expect$k(e).to.failToParse("a"),expect$k(e).to.parse("aa",["a","a"]),expect$k(e).to.parse("aaa",["a","a","a"]),expect$k(e).to.failToParse("aaaa")})),it("|{val}..{val}| matches correctly",(function(){var e=peg.generate("start = 'a'|{ return 2; }..{ return 2; }|",t);expect$k(e).to.failToParse(""),expect$k(e).to.failToParse("a"),expect$k(e).to.parse("aa",["a","a"]),expect$k(e).to.failToParse("aaa")})),it("|  {exact}   | matches correctly",(function(){var e=peg.generate("start = 'a'|{ return 2; }|",t);expect$k(e).to.failToParse(""),expect$k(e).to.failToParse("a"),expect$k(e).to.parse("aa",["a","a"]),expect$k(e).to.failToParse("aaa")})),describe("function called only once",(function(){it("in |{min}..     |",(function(){var e=peg.generate("\n                { let min = 0; }\n                start = 'a'|{ ++min; return 2; }..| { return min; }\n              ",t);expect$k(e).to.parse("aa",1),expect$k(e).to.parse("aaa",1)})),it("in |     ..{max}|",(function(){var e=peg.generate("\n                { let max = 0; }\n                start = 'a'|..{ ++max; return 3; }| { return max; }\n              ",t);expect$k(e).to.parse("aa",1),expect$k(e).to.parse("aaa",1)})),it("in |{min}..{max}|",(function(){var e=peg.generate("\n                {\n                  let min = 0;\n                  let max = 0;\n                }\n                start = 'a'|\n                  { ++min; return 0; }\n                  ..\n                  { ++max; return 3; }\n                | { return [min, max]; }\n              ",t);expect$k(e).to.parse("",[1,1]),expect$k(e).to.parse("a",[1,1]),expect$k(e).to.parse("aa",[1,1]),expect$k(e).to.parse("aaa",[1,1])})),it("in |  {exact}   |",(function(){var e=peg.generate("\n                { let count = 0; }\n                start = 'a'|{ ++count; return options.exact; }| { return count; }\n              ",t);expect$k(e).to.parse("",1,{exact:0}),expect$k(e).to.parse("aa",1,{exact:2})}))})),it("correctly pass external references to labels to boundary expression",(function(){var e=peg.generate("start = ref:'a' 'b'|{ return ref === 'a' ? 2 : 0; }..|",t);expect$k(e).to.parse("abb",["a",["b","b"]]),e=peg.generate("start = ref:'a' 'b'|..{ return ref === 'a' ? 3 : 0; }|",t),expect$k(e).to.parse("abb",["a",["b","b"]]),e=peg.generate("start = ref:'a' 'b'|{ return ref === 'a' ? 2 : 0; }..{ return ref === 'a' ? 3 : 0; }|",t),expect$k(e).to.parse("abb",["a",["b","b"]]),e=peg.generate("start = ref:'a' 'b'|{ return ref === 'a' ? 2 : 0; }|",t),expect$k(e).to.parse("abb",["a",["b","b"]])}))})),it("with functions returning non-integers",(function(){var e=peg.generate("start = 'a'|{ return 'a' }|",t);expect$k(e).to.parse("",[]),expect$k(e).to.failToParse("aaa",{expected:[{type:"end"}]}),e=peg.generate("start = 'a'|{ return 'a' }..2|",t),expect$k(e).to.parse("",[]),expect$k(e).to.parse("a",["a"]),expect$k(e).to.parse("aa",["a","a"]),expect$k(e).to.failToParse("aaa",{expected:[{type:"end"}]}),e=peg.generate("start = 'a'|..{ return 'a' }|",t),expect$k(e).to.parse("",[]),expect$k(e).to.failToParse("a",{expected:[{type:"end"}]}),e=peg.generate("start = 'a'|{return '1.8e0' }..{ return 2.8 }|",t),expect$k(e).to.parse("a",["a"]),expect$k(e).to.parse("aa",["a","a"]),expect$k(e).to.failToParse("aaa",{expected:[{type:"end"}]})}))})),describe("with delimiter",(function(){describe("with constant boundaries",(function(){it("| .. , delimiter| matches correctly",(function(){var e=peg.generate("start = 'a'|.., '~'|",t);expect$k(e).to.parse("",[]),expect$k(e).to.parse("a",["a"]),expect$k(e).to.parse("a~a",["a","a"]),expect$k(e).to.parse("a~a~a",["a","a","a"])})),it("|0.. , delimiter| matches correctly",(function(){var e=peg.generate("start = 'a'|0.., '~'|",t);expect$k(e).to.parse("",[]),expect$k(e).to.parse("a",["a"]),expect$k(e).to.parse("a~a",["a","a"]),expect$k(e).to.parse("a~a~a",["a","a","a"])})),it("|1.. , delimiter| matches correctly",(function(){var e=peg.generate("start = 'a'|1.., '~'|",t);expect$k(e).to.failToParse(""),expect$k(e).to.parse("a",["a"]),expect$k(e).to.parse("a~a",["a","a"]),expect$k(e).to.parse("a~a~a",["a","a","a"])})),it("|2.. , delimiter| matches correctly",(function(){var e=peg.generate("start = 'a'|2.., '~'|",t);expect$k(e).to.failToParse(""),expect$k(e).to.failToParse("a"),expect$k(e).to.parse("a~a",["a","a"]),expect$k(e).to.parse("a~a~a",["a","a","a"])})),it("| ..1, delimiter| matches correctly",(function(){var e=peg.generate("start = 'a'|..1, '~'|",t);expect$k(e).to.parse("",[]),expect$k(e).to.parse("a",["a"]),expect$k(e).to.failToParse("a~a"),expect$k(e).to.failToParse("a~a~a")})),it("| ..2, delimiter| matches correctly",(function(){var e=peg.generate("start = 'a'|..2, '~'|",t);expect$k(e).to.parse("",[]),expect$k(e).to.parse("a",["a"]),expect$k(e).to.parse("a~a",["a","a"]),expect$k(e).to.failToParse("a~a~a")})),it("|2..3, delimiter| matches correctly",(function(){var e=peg.generate("start = 'a'|2..3, '~'|",t);expect$k(e).to.failToParse(""),expect$k(e).to.failToParse("a"),expect$k(e).to.parse("a~a",["a","a"]),expect$k(e).to.parse("a~a~a",["a","a","a"]),expect$k(e).to.failToParse("a~a~a~a")})),it("|2..2, delimiter| matches correctly",(function(){var e=peg.generate("start = 'a'|2..2, '~'|",t);expect$k(e).to.failToParse(""),expect$k(e).to.failToParse("a"),expect$k(e).to.parse("a~a",["a","a"]),expect$k(e).to.failToParse("a~a~a")})),it("|2   , delimiter| matches correctly",(function(){var e=peg.generate("start = 'a'|2, '~'|",t);expect$k(e).to.failToParse(""),expect$k(e).to.failToParse("a"),expect$k(e).to.parse("a~a",["a","a"]),expect$k(e).to.failToParse("a~a~a")})),it("|3..2, delimiter| matches correctly",(function(){var e=peg.generate("start = 'a'|3..2, '~'|",t);expect$k(e).to.failToParse(""),expect$k(e).to.failToParse("a"),expect$k(e).to.failToParse("a~a"),expect$k(e).to.failToParse("a~a~a")})),it("correctly pass external references to labels to repeated expression",(function(){var e=peg.generate("start = ref:'a' ('b' &{ return ref === 'a'; })|.., ' '|",t);expect$k(e).to.parse("ab b",["a",[["b",void 0],["b",void 0]]]),e=peg.generate("start = ref:'a' ('b' &{ return ref === 'a'; })|2.., ' '|",t),expect$k(e).to.parse("ab b",["a",[["b",void 0],["b",void 0]]]),e=peg.generate("start = ref:'a' ('b' &{ return ref === 'a'; })|..3, ' '|",t),expect$k(e).to.parse("ab b",["a",[["b",void 0],["b",void 0]]]),e=peg.generate("start = ref:'a' ('b' &{ return ref === 'a'; })|2..3, ' '|",t),expect$k(e).to.parse("ab b",["a",[["b",void 0],["b",void 0]]]),e=peg.generate("start = ref:'a' ('b' &{ return ref === 'a'; })|2, ' '|",t),expect$k(e).to.parse("ab b",["a",[["b",void 0],["b",void 0]]]),e=peg.generate("start = ref:'a' 'b'|{ return ref === 'a' ? 2 : 0; }, ' '|",t),expect$k(e).to.parse("ab b",["a",["b","b"]])}))})),describe("with variable boundaries",(function(){it("|min..   , delimiter| matches correctly",(function(){for(var e=r("val.., '~'"),t=1;t<=4;++t){var a={startRule:"start1"+t};expect$k(e).to.failToParse("",void 0,a),expect$k(e).to.parse("0",[0,[],""],a),expect$k(e).to.parse("0==",[0,["="],"="],a),expect$k(e).to.parse("0=~=",[0,["=","="],""],a),expect$k(e).to.failToParse("1",void 0,a),expect$k(e).to.failToParse("1~",void 0,a),expect$k(e).to.failToParse("2=",void 0,a),expect$k(e).to.failToParse("2=~",void 0,a),expect$k(e).to.failToParse("2==",void 0,a),expect$k(e).to.parse("2=~=",[2,["=","="],""],a),expect$k(e).to.parse("2=~=~",[2,["=","="],"~"],a),expect$k(e).to.parse("2=~=~=~=~=",[2,["=","=","=","=","="],""],a)}for(t=1;t<=4;++t)a={startRule:"start2"+t},expect$k(e).to.failToParse("-",void 0,a),expect$k(e).to.parse("-0",["-",0,[],""],a),expect$k(e).to.parse("-0==",["-",0,["="],"="],a),expect$k(e).to.parse("-0=~=",["-",0,["=","="],""],a),expect$k(e).to.failToParse("-1",void 0,a),expect$k(e).to.failToParse("-1~",void 0,a),expect$k(e).to.failToParse("-2=",void 0,a),expect$k(e).to.failToParse("-2=~",void 0,a),expect$k(e).to.failToParse("-2==",void 0,a),expect$k(e).to.parse("-2=~=",["-",2,["=","="],""],a),expect$k(e).to.parse("-2=~=~",["-",2,["=","="],"~"],a),expect$k(e).to.parse("-2=~=~=~=~=",["-",2,["=","=","=","=","="],""],a);for(t=1;t<=4;++t)a={startRule:"start3"+t},expect$k(e).to.failToParse("-",void 0,a),expect$k(e).to.parse("-0",["-",0,[],""],a),expect$k(e).to.parse("-0==",["-",0,["="],"="],a),expect$k(e).to.parse("-0=~=",["-",0,["=","="],""],a),expect$k(e).to.failToParse("-1",void 0,a),expect$k(e).to.failToParse("-1~",void 0,a),expect$k(e).to.failToParse("-2=",void 0,a),expect$k(e).to.failToParse("-2=~",void 0,a),expect$k(e).to.failToParse("-2==",void 0,a),expect$k(e).to.parse("-2=~=",["-",2,["=","="],""],a),expect$k(e).to.parse("-2=~=~",["-",2,["=","="],"~"],a),expect$k(e).to.parse("-2=~=~=~=~=",["-",2,["=","=","=","=","="],""],a);for(t=1;t<=4;++t)a={startRule:"start4"+t},expect$k(e).to.failToParse("--",void 0,a),expect$k(e).to.parse("--0",["-","-",0,[],""],a),expect$k(e).to.parse("--0==",["-","-",0,["="],"="],a),expect$k(e).to.parse("--0=~=",["-","-",0,["=","="],""],a),expect$k(e).to.failToParse("--1",void 0,a),expect$k(e).to.failToParse("--1~",void 0,a),expect$k(e).to.failToParse("--2=",void 0,a),expect$k(e).to.failToParse("--2=~",void 0,a),expect$k(e).to.failToParse("--2==",void 0,a),expect$k(e).to.parse("--2=~=",["-","-",2,["=","="],""],a),expect$k(e).to.parse("--2=~=~",["-","-",2,["=","="],"~"],a),expect$k(e).to.parse("--2=~=~=~=~=",["-","-",2,["=","=","=","=","="],""],a)})),it("|   ..max, delimiter| matches correctly",(function(){for(var e=r("..val, '~'"),t=1;t<=4;++t){var a={startRule:"start1"+t};expect$k(e).to.failToParse("",void 0,a),expect$k(e).to.parse("0",[0,[],""],a),expect$k(e).to.parse("0==",[0,[],"=="],a),expect$k(e).to.parse("0=~=",[0,[],"=~="],a),expect$k(e).to.parse("3",[3,[],""],a),expect$k(e).to.parse("3=",[3,["="],""],a),expect$k(e).to.parse("3===",[3,["="],"=="],a),expect$k(e).to.parse("3=~=~",[3,["=","="],"~"],a),expect$k(e).to.parse("3=~=~=",[3,["=","=","="],""],a),expect$k(e).to.parse("3=~=~=~=~=",[3,["=","=","="],"~=~="],a)}for(t=1;t<=4;++t)a={startRule:"start2"+t},expect$k(e).to.failToParse("-",void 0,a),expect$k(e).to.parse("-0",["-",0,[],""],a),expect$k(e).to.parse("-0==",["-",0,[],"=="],a),expect$k(e).to.parse("-0=~=",["-",0,[],"=~="],a),expect$k(e).to.parse("-3",["-",3,[],""],a),expect$k(e).to.parse("-3=",["-",3,["="],""],a),expect$k(e).to.parse("-3===",["-",3,["="],"=="],a),expect$k(e).to.parse("-3=~=~",["-",3,["=","="],"~"],a),expect$k(e).to.parse("-3=~=~=",["-",3,["=","=","="],""],a),expect$k(e).to.parse("-3=~=~=~=~=",["-",3,["=","=","="],"~=~="],a);for(t=1;t<=4;++t)a={startRule:"start3"+t},expect$k(e).to.failToParse("-",void 0,a),expect$k(e).to.parse("-0",["-",0,[],""],a),expect$k(e).to.parse("-0==",["-",0,[],"=="],a),expect$k(e).to.parse("-0=~=",["-",0,[],"=~="],a),expect$k(e).to.parse("-3",["-",3,[],""],a),expect$k(e).to.parse("-3=",["-",3,["="],""],a),expect$k(e).to.parse("-3===",["-",3,["="],"=="],a),expect$k(e).to.parse("-3=~=~",["-",3,["=","="],"~"],a),expect$k(e).to.parse("-3=~=~=",["-",3,["=","=","="],""],a),expect$k(e).to.parse("-3=~=~=~=~=",["-",3,["=","=","="],"~=~="],a);for(t=1;t<=4;++t)a={startRule:"start4"+t},expect$k(e).to.failToParse("--",void 0,a),expect$k(e).to.parse("--0",["-","-",0,[],""],a),expect$k(e).to.parse("--0==",["-","-",0,[],"=="],a),expect$k(e).to.parse("--0=~=",["-","-",0,[],"=~="],a),expect$k(e).to.parse("--3",["-","-",3,[],""],a),expect$k(e).to.parse("--3=",["-","-",3,["="],""],a),expect$k(e).to.parse("--3===",["-","-",3,["="],"=="],a),expect$k(e).to.parse("--3=~=~",["-","-",3,["=","="],"~"],a),expect$k(e).to.parse("--3=~=~=",["-","-",3,["=","=","="],""],a),expect$k(e).to.parse("--3=~=~=~=~=",["-","-",3,["=","=","="],"~=~="],a)})),it("|min..max, delimiter| matches correctly",(function(){for(var r=function(){for(var r=[],a=1;a<=4;++a)for(var n=1;n<=4;++n)r[r.length]="start"+String(a)+n;var o=e(t);return o.allowedStartRules=r,peg.generate(["start11 =         min:n1 max:n1      .|min..max, '~'|      $.*","start12 =         min:n1 max:n1 data:.|min..max, '~'|      $.*","start13 =         min:n1 max:n1      .|min..max, '~'| rest:$.*","start14 =         min:n1 max:n1 data:.|min..max, '~'| rest:$.*","start21 = .       min:n1 max:n1      .|min..max, '~'|      $.*","start22 = .       min:n1 max:n1 data:.|min..max, '~'|      $.*","start23 = .       min:n1 max:n1      .|min..max, '~'| rest:$.*","start24 = .       min:n1 max:n1 data:.|min..max, '~'| rest:$.*","start31 = a:.     min:n1 max:n1      .|min..max, '~'|      $.*","start32 = a:.     min:n1 max:n1 data:.|min..max, '~'|      $.*","start33 = a:.     min:n1 max:n1      .|min..max, '~'| rest:$.*","start34 = a:.     min:n1 max:n1 data:.|min..max, '~'| rest:$.*","start41 = a:. b:. min:n1 max:n1      .|min..max, '~'|      $.*","start42 = a:. b:. min:n1 max:n1 data:.|min..max, '~'|      $.*","start43 = a:. b:. min:n1 max:n1      .|min..max, '~'| rest:$.*","start44 = a:. b:. min:n1 max:n1 data:.|min..max, '~'| rest:$.*","n1 = n:$[0-9] { return parseInt(n, 10); }"].join(";\n"),o)}(),a=1;a<=4;++a){var n={startRule:"start1"+a};expect$k(r).to.failToParse("",void 0,n),expect$k(r).to.parse("00",[0,0,[],""],n),expect$k(r).to.parse("00==",[0,0,[],"=="],n),expect$k(r).to.parse("00=~=",[0,0,[],"=~="],n),expect$k(r).to.failToParse("23",void 0,n),expect$k(r).to.failToParse("23=",void 0,n),expect$k(r).to.failToParse("23=~",void 0,n),expect$k(r).to.failToParse("23==",void 0,n),expect$k(r).to.parse("23=~=",[2,3,["=","="],""],n),expect$k(r).to.parse("23=~=~",[2,3,["=","="],"~"],n),expect$k(r).to.parse("23=~=~=",[2,3,["=","=","="],""],n),expect$k(r).to.parse("23=~=~=~=~=",[2,3,["=","=","="],"~=~="],n)}for(a=1;a<=4;++a)n={startRule:"start2"+a},expect$k(r).to.failToParse("-",void 0,n),expect$k(r).to.parse("-00",["-",0,0,[],""],n),expect$k(r).to.parse("-00==",["-",0,0,[],"=="],n),expect$k(r).to.parse("-00=~=",["-",0,0,[],"=~="],n),expect$k(r).to.failToParse("-23",void 0,n),expect$k(r).to.failToParse("-23=",void 0,n),expect$k(r).to.failToParse("-23=~",void 0,n),expect$k(r).to.failToParse("-23==",void 0,n),expect$k(r).to.parse("-23=~=",["-",2,3,["=","="],""],n),expect$k(r).to.parse("-23=~=~",["-",2,3,["=","="],"~"],n),expect$k(r).to.parse("-23=~=~=",["-",2,3,["=","=","="],""],n),expect$k(r).to.parse("-23=~=~=~=~=",["-",2,3,["=","=","="],"~=~="],n);for(a=1;a<=4;++a)n={startRule:"start3"+a},expect$k(r).to.failToParse("-",void 0,n),expect$k(r).to.parse("-00",["-",0,0,[],""],n),expect$k(r).to.parse("-00==",["-",0,0,[],"=="],n),expect$k(r).to.parse("-00=~=",["-",0,0,[],"=~="],n),expect$k(r).to.failToParse("-23",void 0,n),expect$k(r).to.failToParse("-23=",void 0,n),expect$k(r).to.failToParse("-23=~",void 0,n),expect$k(r).to.failToParse("-23==",void 0,n),expect$k(r).to.parse("-23=~=",["-",2,3,["=","="],""],n),expect$k(r).to.parse("-23=~=~",["-",2,3,["=","="],"~"],n),expect$k(r).to.parse("-23=~=~=",["-",2,3,["=","=","="],""],n),expect$k(r).to.parse("-23=~=~=~=~=",["-",2,3,["=","=","="],"~=~="],n);for(a=1;a<=4;++a)n={startRule:"start4"+a},expect$k(r).to.failToParse("--",void 0,n),expect$k(r).to.parse("--00",["-","-",0,0,[],""],n),expect$k(r).to.parse("--00==",["-","-",0,0,[],"=="],n),expect$k(r).to.parse("--00=~=",["-","-",0,0,[],"=~="],n),expect$k(r).to.failToParse("--23",void 0,n),expect$k(r).to.failToParse("--23=",void 0,n),expect$k(r).to.failToParse("--23=~",void 0,n),expect$k(r).to.failToParse("--23==",void 0,n),expect$k(r).to.parse("--23=~=",["-","-",2,3,["=","="],""],n),expect$k(r).to.parse("--23=~=~",["-","-",2,3,["=","="],"~"],n),expect$k(r).to.parse("--23=~=~=",["-","-",2,3,["=","=","="],""],n),expect$k(r).to.parse("--23=~=~=~=~=",["-","-",2,3,["=","=","="],"~=~="],n)})),it("|val..val, delimiter| matches correctly",(function(){for(var e=r("val, '~'"),t=1;t<=4;++t){var a={startRule:"start1"+t};expect$k(e).to.failToParse("",void 0,a),expect$k(e).to.parse("0",[0,[],""],a),expect$k(e).to.parse("0==",[0,[],"=="],a),expect$k(e).to.parse("0=~=",[0,[],"=~="],a),expect$k(e).to.failToParse("3",void 0,a),expect$k(e).to.failToParse("3=",void 0,a),expect$k(e).to.failToParse("3=~",void 0,a),expect$k(e).to.parse("3=~=~=",[3,["=","=","="],""],a),expect$k(e).to.parse("3=~=~=~",[3,["=","=","="],"~"],a),expect$k(e).to.parse("3=~=~=~=~=",[3,["=","=","="],"~=~="],a)}for(t=1;t<=4;++t)a={startRule:"start2"+t},expect$k(e).to.failToParse("-",void 0,a),expect$k(e).to.parse("-0",["-",0,[],""],a),expect$k(e).to.parse("-0==",["-",0,[],"=="],a),expect$k(e).to.parse("-0=~=",["-",0,[],"=~="],a),expect$k(e).to.failToParse("-3",void 0,a),expect$k(e).to.failToParse("-3=",void 0,a),expect$k(e).to.failToParse("-3=~",void 0,a),expect$k(e).to.parse("-3=~=~=",["-",3,["=","=","="],""],a),expect$k(e).to.parse("-3=~=~=~",["-",3,["=","=","="],"~"],a),expect$k(e).to.parse("-3=~=~=~=~=",["-",3,["=","=","="],"~=~="],a);for(t=1;t<=4;++t)a={startRule:"start3"+t},expect$k(e).to.failToParse("-",void 0,a),expect$k(e).to.parse("-0",["-",0,[],""],a),expect$k(e).to.parse("-0==",["-",0,[],"=="],a),expect$k(e).to.parse("-0=~=",["-",0,[],"=~="],a),expect$k(e).to.failToParse("-3",void 0,a),expect$k(e).to.failToParse("-3=",void 0,a),expect$k(e).to.failToParse("-3=~",void 0,a),expect$k(e).to.parse("-3=~=~=",["-",3,["=","=","="],""],a),expect$k(e).to.parse("-3=~=~=~",["-",3,["=","=","="],"~"],a),expect$k(e).to.parse("-3=~=~=~=~=",["-",3,["=","=","="],"~=~="],a);for(t=1;t<=4;++t)a={startRule:"start4"+t},expect$k(e).to.failToParse("--",void 0,a),expect$k(e).to.parse("--0",["-","-",0,[],""],a),expect$k(e).to.parse("--0==",["-","-",0,[],"=="],a),expect$k(e).to.parse("--0=~=",["-","-",0,[],"=~="],a),expect$k(e).to.failToParse("--3",void 0,a),expect$k(e).to.failToParse("--3=",void 0,a),expect$k(e).to.failToParse("--3=~",void 0,a),expect$k(e).to.parse("--3=~=~=",["-","-",3,["=","=","="],""],a),expect$k(e).to.parse("--3=~=~=~",["-","-",3,["=","=","="],"~"],a),expect$k(e).to.parse("--3=~=~=~=~=",["-","-",3,["=","=","="],"~=~="],a)})),it("| exact  , delimiter| matches correctly",(function(){for(var e=r("val, '~'"),t=1;t<=4;++t){var a={startRule:"start1"+t};expect$k(e).to.failToParse("",void 0,a),expect$k(e).to.parse("0",[0,[],""],a),expect$k(e).to.parse("0==",[0,[],"=="],a),expect$k(e).to.parse("0=~=",[0,[],"=~="],a),expect$k(e).to.failToParse("3",void 0,a),expect$k(e).to.failToParse("3=",void 0,a),expect$k(e).to.failToParse("3=~",void 0,a),expect$k(e).to.parse("3=~=~=",[3,["=","=","="],""],a),expect$k(e).to.parse("3=~=~=~",[3,["=","=","="],"~"],a),expect$k(e).to.parse("3=~=~=~=~=",[3,["=","=","="],"~=~="],a)}for(t=1;t<=4;++t)a={startRule:"start2"+t},expect$k(e).to.failToParse("-",void 0,a),expect$k(e).to.parse("-0",["-",0,[],""],a),expect$k(e).to.parse("-0==",["-",0,[],"=="],a),expect$k(e).to.parse("-0=~=",["-",0,[],"=~="],a),expect$k(e).to.failToParse("-3",void 0,a),expect$k(e).to.failToParse("-3=",void 0,a),expect$k(e).to.failToParse("-3=~",void 0,a),expect$k(e).to.parse("-3=~=~=",["-",3,["=","=","="],""],a),expect$k(e).to.parse("-3=~=~=~",["-",3,["=","=","="],"~"],a),expect$k(e).to.parse("-3=~=~=~=~=",["-",3,["=","=","="],"~=~="],a);for(t=1;t<=4;++t)a={startRule:"start3"+t},expect$k(e).to.failToParse("-",void 0,a),expect$k(e).to.parse("-0",["-",0,[],""],a),expect$k(e).to.parse("-0==",["-",0,[],"=="],a),expect$k(e).to.parse("-0=~=",["-",0,[],"=~="],a),expect$k(e).to.failToParse("-3",void 0,a),expect$k(e).to.failToParse("-3=",void 0,a),expect$k(e).to.failToParse("-3=~",void 0,a),expect$k(e).to.parse("-3=~=~=",["-",3,["=","=","="],""],a),expect$k(e).to.parse("-3=~=~=~",["-",3,["=","=","="],"~"],a),expect$k(e).to.parse("-3=~=~=~=~=",["-",3,["=","=","="],"~=~="],a);for(t=1;t<=4;++t)a={startRule:"start4"+t},expect$k(e).to.failToParse("--",void 0,a),expect$k(e).to.parse("--0",["-","-",0,[],""],a),expect$k(e).to.parse("--0==",["-","-",0,[],"=="],a),expect$k(e).to.parse("--0=~=",["-","-",0,[],"=~="],a),expect$k(e).to.failToParse("--3",void 0,a),expect$k(e).to.failToParse("--3=",void 0,a),expect$k(e).to.failToParse("--3=~",void 0,a),expect$k(e).to.parse("--3=~=~=",["-","-",3,["=","=","="],""],a),expect$k(e).to.parse("--3=~=~=~",["-","-",3,["=","=","="],"~"],a),expect$k(e).to.parse("--3=~=~=~=~=",["-","-",3,["=","=","="],"~=~="],a)}))})),describe("with function boundaries",(function(){it("|{2}..   , delimiter| matches correctly",(function(){var e=peg.generate("start = 'a'|{ return 2; }.., '~'|",t);expect$k(e).to.failToParse(""),expect$k(e).to.failToParse("a"),expect$k(e).to.parse("a~a",["a","a"]),expect$k(e).to.parse("a~a~a",["a","a","a"])})),it("|   ..{2}, delimiter| matches correctly",(function(){var e=peg.generate("start = 'a'|..{ return 2; }, '~'|",t);expect$k(e).to.parse("",[]),expect$k(e).to.parse("a",["a"]),expect$k(e).to.parse("a~a",["a","a"]),expect$k(e).to.failToParse("a~a~a")})),it("|{2}..{3}, delimiter| matches correctly",(function(){var e=peg.generate("start = 'a'|{ return 2; }..{ return 3; }, '~'|",t);expect$k(e).to.failToParse(""),expect$k(e).to.failToParse("a"),expect$k(e).to.parse("a~a",["a","a"]),expect$k(e).to.parse("a~a~a",["a","a","a"]),expect$k(e).to.failToParse("a~a~a~a")})),it("|{2}..{2}, delimiter| matches correctly",(function(){var e=peg.generate("start = 'a'|{ return 2; }..{ return 2; }, '~'|",t);expect$k(e).to.failToParse(""),expect$k(e).to.failToParse("a"),expect$k(e).to.parse("a~a",["a","a"]),expect$k(e).to.failToParse("a~a~a")})),it("|{2}     , delimiter| matches correctly",(function(){var e=peg.generate("start = 'a'|{ return 2; }, '~'|",t);expect$k(e).to.failToParse(""),expect$k(e).to.failToParse("a"),expect$k(e).to.parse("a~a",["a","a"]),expect$k(e).to.failToParse("a~a~a")})),it("|{3}..{2}, delimiter| matches correctly",(function(){var e=peg.generate("start = 'a'|{ return 3; }..{ return 2; }, '~'|",t);expect$k(e).to.failToParse(""),expect$k(e).to.failToParse("a"),expect$k(e).to.failToParse("a~a"),expect$k(e).to.failToParse("a~a~a")})),it("correctly pass external references to labels to boundary expression",(function(){var e=peg.generate("start = ref:'a' 'b'|{ return ref === 'a' ? 2 : 0; }.., ' '|",t);expect$k(e).to.parse("ab b",["a",["b","b"]]),e=peg.generate("start = ref:'a' 'b'|..{ return ref === 'a' ? 3 : 0; }, ' '|",t),expect$k(e).to.parse("ab b",["a",["b","b"]]),e=peg.generate("start = ref:'a' 'b'|{ return ref === 'a' ? 2 : 0; }..{ return ref === 'a' ? 3 : 0; }, ' '|",t),expect$k(e).to.parse("ab b",["a",["b","b"]]),e=peg.generate("start = ref:'a' 'b'|{ return ref === 'a' ? 2 : 0; }, ' '|",t),expect$k(e).to.parse("ab b",["a",["b","b"]])}))}))})),describe("handle delimiter correctly",(function(){it("with constant boundaries",(function(){var e=peg.generate("start = 'a'|2..3, '~'|",t);expect$k(e).to.failToParse(""),expect$k(e).to.failToParse("a"),expect$k(e).to.failToParse("aa"),expect$k(e).to.failToParse("a~"),expect$k(e).to.parse("a~a",["a","a"]),expect$k(e).to.failToParse("a~a~"),expect$k(e).to.parse("a~a~a",["a","a","a"]),expect$k(e).to.failToParse("a~a~a~"),expect$k(e).to.failToParse("a~a~a~a")})),it("with variable boundaries",(function(){var e=peg.generate(["start = min:n1 max:n1 'a'|min..max, '~'|","n1 = n:$[0-9] { return parseInt(n, 10); }"].join(";\n"),t);expect$k(e).to.failToParse("23"),expect$k(e).to.failToParse("23a"),expect$k(e).to.failToParse("23aa"),expect$k(e).to.failToParse("23a~"),expect$k(e).to.parse("23a~a",[2,3,["a","a"]]),expect$k(e).to.failToParse("23a~a~"),expect$k(e).to.parse("23a~a~a",[2,3,["a","a","a"]]),expect$k(e).to.failToParse("23a~a~a~"),expect$k(e).to.failToParse("23a~a~a~a")})),it("with variable boundaries in delimiter",(function(){var e=peg.generate(["start = min:n1 max:n1 'a'|2, '~'|min..max||","n1 = n:$[0-9] { return parseInt(n, 10); }"].join(";\n"),t);expect$k(e).to.failToParse("23"),expect$k(e).to.failToParse("23a"),expect$k(e).to.failToParse("23aa"),expect$k(e).to.failToParse("23a~"),expect$k(e).to.failToParse("23a~a"),expect$k(e).to.failToParse("23a~~"),expect$k(e).to.parse("23a~~a",[2,3,["a","a"]]),expect$k(e).to.parse("23a~~~a",[2,3,["a","a"]]),expect$k(e).to.failToParse("23a~~~~a"),expect$k(e).to.failToParse("23a~~a~~a")})),it("with function boundaries",(function(){var e=peg.generate("start = 'a'|{ return 2; }..{ return 3; }, '~'|",t);expect$k(e).to.failToParse(""),expect$k(e).to.failToParse("a"),expect$k(e).to.failToParse("aa"),expect$k(e).to.failToParse("a~"),expect$k(e).to.parse("a~a",["a","a"]),expect$k(e).to.failToParse("a~a~"),expect$k(e).to.parse("a~a~a",["a","a","a"]),expect$k(e).to.failToParse("a~a~a~"),expect$k(e).to.failToParse("a~a~a~a")}))}))})),describe("text",(function(){describe("when the expression matches",(function(){it("returns the matched text",(function(){var e=peg.generate("start = $('a' 'b' 'c')",t);expect$k(e).to.parse("abc","abc")}))})),describe("when the expression doesn't match",(function(){it("reports match failure",(function(){var e=peg.generate("start = $('a')",t);expect$k(e).to.failToParse("b")}))}))})),describe("positive simple predicate",(function(){describe("when the expression matches",(function(){it("returns |undefined|",(function(){var e=peg.generate("start = &'a' 'a'",t);expect$k(e).to.parse("a",[void 0,"a"])})),it("resets parse position",(function(){var e=peg.generate("start = &'a' 'a'",t);expect$k(e).to.parse("a")}))})),describe("when the expression doesn't match",(function(){it("reports match failure",(function(){var e=peg.generate("start = &'a'",t);expect$k(e).to.failToParse("b")})),it("discards any expectations recorded when matching the expression",(function(){var e=peg.generate("start = 'a' / &'b' / 'c'",t);expect$k(e).to.failToParse("d",{expected:[{type:"literal",text:"a",ignoreCase:!1},{type:"literal",text:"c",ignoreCase:!1}]})}))}))})),describe("negative simple predicate",(function(){describe("when the expression matches",(function(){it("reports match failure",(function(){var e=peg.generate("start = !'a'",t);expect$k(e).to.failToParse("a")}))})),describe("when the expression doesn't match",(function(){it("returns |undefined|",(function(){var e=peg.generate("start = !'a' 'b'",t);expect$k(e).to.parse("b",[void 0,"b"])})),it("resets parse position",(function(){var e=peg.generate("start = !'a' 'b'",t);expect$k(e).to.parse("b")})),it("discards any expectations recorded when matching the expression",(function(){var e=peg.generate("start = 'a' / !'b' / 'c'",t);expect$k(e).to.failToParse("b",{expected:[{type:"literal",text:"a",ignoreCase:!1},{type:"literal",text:"c",ignoreCase:!1}]})}))}))})),describe("label",(function(){describe("when the expression matches",(function(){it("returns its match result",(function(){var e=peg.generate("start = a:'a'",t);expect$k(e).to.parse("a","a")}))})),describe("when the expression doesn't match",(function(){it("reports match failure",(function(){var e=peg.generate("start = a:'a'",t);expect$k(e).to.failToParse("b")}))}))})),describe("sequence",(function(){describe("when all expressions match",(function(){it("returns an array of their match results",(function(){var e=peg.generate("start = 'a' 'b' 'c'",t);expect$k(e).to.parse("abc",["a","b","c"])})),it("plucks a single value",(function(){var e=peg.generate("start = @'a'",t);expect$k(e).to.parse("a","a"),e=peg.generate("start = @'a' / @'b'",t),expect$k(e).to.parse("a","a"),expect$k(e).to.parse("b","b"),e=peg.generate("start = 'a' @'b' 'c'",t),expect$k(e).to.parse("abc","b"),e=peg.generate("start = 'a' ( @'b' 'c' )",t),expect$k(e).to.parse("abc",["a","b"]),e=peg.generate("start = 'a' @( 'b' @'c' 'd' )",t),expect$k(e).to.parse("abcd","c"),e=peg.generate("start = 'a' ( @'b' 'c' ) @'d'",t),expect$k(e).to.parse("abcd","d"),e=peg.generate("start = 'a' @'b' 'c' / 'd' 'e' @'f'",t),expect$k(e).to.parse("def","f")})),it("plucks a multiple values",(function(){var e=peg.generate("start = 'a' @'b' @'c'",t);expect$k(e).to.parse("abc",["b","c"]),e=peg.generate("start = 'a' ( @'b' @'c' )",t),expect$k(e).to.parse("abc",["a",["b","c"]]),e=peg.generate("start = 'a' @( 'b' @'c' @'d' )",t),expect$k(e).to.parse("abcd",["c","d"]),e=peg.generate("start = 'a' @( @'b' 'c' ) @'d' 'e'",t),expect$k(e).to.parse("abcde",["b","d"]),e=peg.generate("start = 'a' @'b' 'c' / @'d' 'e' @'f'",t),expect$k(e).to.parse("def",["d","f"])})),it('prevents "@" on a semantic predicate',(function(){expect$k((function(){return peg.generate("start1 = 'a' @&{ /* semantic_and */ } 'c'")}),t).to.throw(),expect$k((function(){return peg.generate("start2 = 'a' @!{ /* semantic_not */ } 'c'")}),t).to.throw()}))})),describe("when any expression doesn't match",(function(){it("reports match failure",(function(){var e=peg.generate("start = 'a' 'b' 'c'",t);expect$k(e).to.failToParse("dbc"),expect$k(e).to.failToParse("adc"),expect$k(e).to.failToParse("abd")})),it("resets parse position",(function(){var e=peg.generate("start = 'a' 'b' / 'a'",t);expect$k(e).to.parse("a","a")}))}))})),describe("action",(function(){describe("when the expression matches",(function(){it("returns the value returned by the code",(function(){var e=peg.generate("start = 'a' { return 42; }",t);expect$k(e).to.parse("a",42)})),describe("label variables",(function(){describe("in the expression",(function(){it("can access variable defined by labeled expression",(function(){var e=peg.generate("start = a:'a' { return a; }",t);expect$k(e).to.parse("a","a")})),it("can access variables defined by labeled sequence elements",(function(){var e=peg.generate("start = a:'a' b:'b' c:'c' { return [a, b, c]; }",t);expect$k(e).to.parse("abc",["a","b","c"])})),it("cannot access variables defined by subexpressions",(function(){[{grammar:"start = (a:'a') { return a; }",input:"a"},{grammar:"start = (a:'a')? { return a; }",input:"a"},{grammar:"start = (a:'a')* { return a; }",input:"a"},{grammar:"start = (a:'a')+ { return a; }",input:"a"},{grammar:"start = (a:'a')| .. | { return a; }",input:"a"},{grammar:"start = (a:'a')|0.. | { return a; }",input:"a"},{grammar:"start = (a:'a')|1.. | { return a; }",input:"a"},{grammar:"start = (a:'a')|2.. | { return a; }",input:"aa"},{grammar:"start = (a:'a')| ..1| { return a; }",input:"a"},{grammar:"start = (a:'a')| ..3| { return a; }",input:"a"},{grammar:"start = (a:'a')|2..3| { return a; }",input:"aa"},{grammar:"start = (a:'a')|3| { return a; }",input:"aaa"},{grammar:"start = $(a:'a') { return a; }",input:"a"},{grammar:"start = &(a:'a') 'a' { return a; }",input:"a"},{grammar:"start = !(a:'a') 'b' { return a; }",input:"b"},{grammar:"start = b:(a:'a') { return a; }",input:"a"},{grammar:"start = ('a' b:'b' 'c') { return b; }",input:"abc"},{grammar:"start = (a:'a' { return a; }) { return a; }",input:"a"},{grammar:"start = ('a' / b:'b' / 'c') { return b; }",input:"b"}].forEach((function(e){var r=peg.generate(e.grammar,t);expect$k(r).to.failToParse(e.input)}))}))})),describe("in outer sequence",(function(){it("can access variables defined by preceding labeled elements",(function(){var e=peg.generate("start = a:'a' ('b' { return a; })",t);expect$k(e).to.parse("ab",["a","a"])})),it("cannot access variable defined by labeled action element",(function(){var e=peg.generate("start = 'a' b:('b' { return b; }) c:'c'",t);expect$k(e).to.failToParse("abc")})),it("cannot access variables defined by following labeled elements",(function(){var e=peg.generate("start = ('a' { return b; }) b:'b'",t);expect$k(e).to.failToParse("ab")}))}))})),describe("initializer variables & functions",(function(){it("can access variables defined in the initializer",(function(){var e=peg.generate(["{ var v = 42 }","start = 'a' { return v; }"].join("\n"),t);expect$k(e).to.parse("a",42)})),it("can access functions defined in the initializer",(function(){var e=peg.generate(["{ function f() { return 42; } }","start = 'a' { return f(); }"].join("\n"),t);expect$k(e).to.parse("a",42)}))})),describe("available variables & functions",(function(){it("|options| contains options",(function(){var e=peg.generate("start = 'a' { return options; }",t);expect$k(e).to.parse("a",{a:42},{a:42})})),it("|text| returns text matched by the expression",(function(){var e=peg.generate("start = 'a' { return text(); }",t);expect$k(e).to.parse("a","a")})),it("|location| returns location info of the expression",(function(){var e=peg.generate(["{ var result; }","start = line (nl+ line)* { return result; }","line = thing (' '+ thing)*","thing = digit / mark","digit = [0-9]","mark = 'x' { result = location(); }","nl = '\\r'? '\\n'"].join("\n"),t);expect$k(e).to.parse("1\n2\n\n3\n\n\n4 5 x",{source:void 0,start:{offset:13,line:7,column:5},end:{offset:14,line:7,column:6}}),expect$k(e).to.parse("1\nx",{source:void 0,start:{offset:2,line:2,column:1},end:{offset:3,line:2,column:2}}),expect$k(e).to.parse("1\r\nx",{source:void 0,start:{offset:3,line:2,column:1},end:{offset:4,line:2,column:2}})})),describe("|expected|",(function(){it("terminates parsing and throws an exception",(function(){var e=peg.generate("start = 'a' { expected('a'); }",t);expect$k(e).to.failToParse("a",{message:'Expected a but "a" found.',expected:[{type:"other",description:"a"}],found:"a",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:1,line:1,column:2}}})})),it("allows to set custom location info",(function(){var e=peg.generate(["start = 'a' {","  expected('a', {","    start: { offset: 1, line: 1, column: 2 },","    end: { offset: 2, line: 1, column: 3 }","  });","}"].join("\n"),t);expect$k(e).to.failToParse("a",{message:'Expected a but "a" found.',expected:[{type:"other",description:"a"}],found:"a",location:{start:{offset:1,line:1,column:2},end:{offset:2,line:1,column:3}}})}))})),describe("|error|",(function(){it("terminates parsing and throws an exception",(function(){var e=peg.generate("start = 'a' { error('a'); }",t);expect$k(e).to.failToParse("a",{message:"a",found:null,expected:null,location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:1,line:1,column:2}}})})),it("allows to set custom location info",(function(){var e=peg.generate(["start = 'a' {","  error('a', {","    start: { offset: 1, line: 1, column: 2 },","    end: { offset: 2, line: 1, column: 3 }","  });","}"].join("\n"),t);expect$k(e).to.failToParse("a",{message:"a",expected:null,found:null,location:{start:{offset:1,line:1,column:2},end:{offset:2,line:1,column:3}}})}))}))}))})),describe("when the expression doesn't match",(function(){it("reports match failure",(function(){var e=peg.generate("start = 'a' { return 42; }",t);expect$k(e).to.failToParse("b")})),it("doesn't execute the code",(function(){var e=peg.generate("start = 'a' { throw 'Boom!'; } / 'b'",t);expect$k(e).to.parse("b")}))}))})),describe("choice",(function(){describe("when any expression matches",(function(){it("returns its match result",(function(){var e=peg.generate("start = 'a' / 'b' / 'c'",t);expect$k(e).to.parse("a","a"),expect$k(e).to.parse("b","b"),expect$k(e).to.parse("c","c")}))})),describe("when all expressions don't match",(function(){it("reports match failure",(function(){var e=peg.generate("start = 'a' / 'b' / 'c'",t);expect$k(e).to.failToParse("d")}))}))})),describe("error reporting",(function(){describe("behavior",(function(){it("reports only the rightmost error",(function(){var e=peg.generate("start = 'a' 'b' / 'a' 'c' 'd'",t);expect$k(e).to.failToParse("ace",{expected:[{type:"literal",text:"d",ignoreCase:!1}]})}))})),describe("expectations reporting",(function(){it("reports expectations correctly with no alternative",(function(){var e=peg.generate("start = 'a'",t);expect$k(e).to.failToParse("ab",{expected:[{type:"end"}]})})),it("reports expectations correctly with one alternative",(function(){var e=peg.generate("start = 'a'",t);expect$k(e).to.failToParse("b",{expected:[{type:"literal",text:"a",ignoreCase:!1}]})})),it("reports expectations correctly with multiple alternatives",(function(){var e=peg.generate("start = 'aa' / 'bb' / 'cc'",t);expect$k(e).to.failToParse("dd",{expected:[{type:"literal",text:"aa",ignoreCase:!1},{type:"literal",text:"bb",ignoreCase:!1},{type:"literal",text:"cc",ignoreCase:!1}]})}))})),describe("found string reporting",(function(){it("reports found string correctly at the end of input",(function(){var e=peg.generate("start = 'a'",t);expect$k(e).to.failToParse("",{found:null})})),it("reports found string correctly in the middle of input",(function(){var e=peg.generate("start = 'a'",t);expect$k(e).to.failToParse("b",{found:"b"})}))})),describe("message building",(function(){it("builds message correctly with no alternative",(function(){var e=peg.generate("start = 'a'",t);expect$k(e).to.failToParse("ab",{message:'Expected end of input but "b" found.'})})),it("builds message correctly with one alternative",(function(){var e=peg.generate("start = 'a'",t);expect$k(e).to.failToParse("b",{message:'Expected "a" but "b" found.'})})),it("builds message correctly with multiple alternatives",(function(){var e=peg.generate("start = 'aa' / 'bb' / 'cc'",t);expect$k(e).to.failToParse("dd",{message:'Expected "aa", "bb", or "cc" but "d" found.'})})),it("builds message correctly at the end of input",(function(){var e=peg.generate("start = 'a'",t);expect$k(e).to.failToParse("",{message:'Expected "a" but end of input found.'})})),it("builds message correctly in the middle of input",(function(){var e=peg.generate("start = 'a'",t);expect$k(e).to.failToParse("b",{message:'Expected "a" but "b" found.'})})),it("removes duplicates from expectations",(function(){var e=peg.generate("start = 'a' / 'a'",t);expect$k(e).to.failToParse("b",{message:'Expected "a" but "b" found.'})})),it("sorts expectations",(function(){var e=peg.generate("start = 'cc' / 'bb' / 'aa'",t);expect$k(e).to.failToParse("d",{message:'Expected "aa", "bb", or "cc" but "d" found.'})}))})),describe("position reporting",(function(){it("reports position correctly at the end of input",(function(){var e=peg.generate("start = 'a'",t);expect$k(e).to.failToParse("",{location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:0,line:1,column:1}}})})),it("reports position correctly in the middle of input",(function(){var e=peg.generate("start = 'a'",t);expect$k(e).to.failToParse("b",{location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:1,line:1,column:2}}})})),it("reports position correctly with trailing input",(function(){var e=peg.generate("start = 'a'",t);expect$k(e).to.failToParse("aa",{location:{source:void 0,start:{offset:1,line:1,column:2},end:{offset:2,line:1,column:3}}})})),it("reports position correctly in complex cases",(function(){var e=peg.generate(["start = line (nl+ line)*","line = digit (' '+ digit)*","digit = [0-9]","nl = '\\r'? '\\n'"].join("\n"),t);expect$k(e).to.failToParse("1\n2\n\n3\n\n\n4 5 x",{location:{source:void 0,start:{offset:13,line:7,column:5},end:{offset:14,line:7,column:6}}}),expect$k(e).to.failToParse("1\nx",{location:{source:void 0,start:{offset:2,line:2,column:1},end:{offset:3,line:2,column:2}}}),expect$k(e).to.failToParse("1\r\nx",{location:{source:void 0,start:{offset:3,line:2,column:1},end:{offset:4,line:2,column:2}}})})),it("reports location source correctly",(function(){var e={source:"object"},r=peg.generate(["start = line (nl+ line)*","line = digit (' '+ digit)*","digit = [0-9]","nl = '\\r'? '\\n'"].join("\n"),t);expect$k(r).to.failToParse("1\n2\n\n3\n\n\n4 5 x",{location:{source:e,start:{offset:13,line:7,column:5},end:{offset:14,line:7,column:6}}},{grammarSource:e})}))}))})),describe("complex examples",(function(){it("handles arithmetics example correctly",(function(){var e=peg.generate(["Expr = Sum","Sum = head:Product tail:(('+' / '-') Product)* {","        return tail.reduce(function(result, element) {","          if (element[0] === '+') { return result + element[1]; }","          if (element[0] === '-') { return result - element[1]; }","        }, head);","      }","Product = head:Value tail:(('*' / '/') Value)* {","            return tail.reduce(function(result, element) {","              if (element[0] === '*') { return result * element[1]; }","              if (element[0] === '/') { return result / element[1]; }","            }, head);","          }","Value = digits:[0-9]+     { return parseInt(digits.join(''), 10); }","      / '(' expr:Expr ')' { return expr; }"].join("\n"),t);expect$k(e).to.parse("0",0),expect$k(e).to.parse("123",123),expect$k(e).to.parse("(42+43)",85),expect$k(e).to.parse("42",42),expect$k(e).to.parse("42*43",1806),expect$k(e).to.parse("42*43*44*45",3575880),expect$k(e).to.parse("42/43",42/43),expect$k(e).to.parse("42/43/44/45",42/43/44/45),expect$k(e).to.parse("42*43",1806),expect$k(e).to.parse("42*43+44*45",3786),expect$k(e).to.parse("42*43+44*45+46*47+48*49",8300),expect$k(e).to.parse("42*43-44*45",-174),expect$k(e).to.parse("42*43-44*45-46*47-48*49",-4688),expect$k(e).to.parse("42+43",85),expect$k(e).to.parse("(1+2)*(3+4)",21)})),it("handles non-context-free language correctly",(function(){var e=peg.generate(["S = &(A 'c') a:'a'+ B:B !('a' / 'b' / 'c') { return a.join('') + B; }","A = a:'a' A:A? b:'b' { return [a, A, b].join(''); }","B = b:'b' B:B? c:'c' { return [b, B, c].join(''); }"].join("\n"),t);expect$k(e).to.parse("abc","abc"),expect$k(e).to.parse("aaabbbccc","aaabbbccc"),expect$k(e).to.failToParse("aabbbccc"),expect$k(e).to.failToParse("aaaabbbccc"),expect$k(e).to.failToParse("aaabbccc"),expect$k(e).to.failToParse("aaabbbbccc"),expect$k(e).to.failToParse("aaabbbcc"),expect$k(e).to.failToParse("aaabbbcccc")})),it("handles nested comments example correctly",(function(){var e=peg.generate(["C = begin:Begin ns:N* end:End { return begin + ns.join('') + end; }","N = C","  / !Begin !End z:Z { return z; }","Z = .","Begin = '(*'","End = '*)'"].join("\n"),t);expect$k(e).to.parse("(**)","(**)"),expect$k(e).to.parse("(*abc*)","(*abc*)"),expect$k(e).to.parse("(*(**)*)","(*(**)*)"),expect$k(e).to.parse("(*abc(*def*)ghi(*(*(*jkl*)*)*)mno*)","(*abc(*def*)ghi(*(*(*jkl*)*)*)mno*)")}))})),describe("run side-effects in non-matching",(function(){it("positive semantic predicate",(function(){var e=peg.generate("\n        { let i = 0; }\n        start = (neverMatched / .) { return i; };\n        neverMatched = &{ i = 1; return true; } [];\n        ",t);expect$k(e).to.parse("b",1),e=peg.generate('\n        { let i = 0; }\n        start = ("a" / neverMatched / .) { return i; };\n        neverMatched = &{ i = 1; return true; } [];\n        ',t),expect$k(e).to.parse("b",1)})),it("negative semantic predicate",(function(){var e=peg.generate("\n        { let i = 0; }\n        start = (neverMatched / .) { return i; };\n        neverMatched = !{ i = 1; return false; } [];\n        ",t);expect$k(e).to.parse("b",1),e=peg.generate('\n        { let i = 0; }\n        start = ("a" / neverMatched / .) { return i; };\n        neverMatched = !{ i = 1; return false; } [];\n        ',t),expect$k(e).to.parse("b",1)})),it("action",(function(){var e=peg.generate("\n        { let i = 0; }\n        start = (neverMatched / .) { return i; };\n        neverMatched = (. { i = 1; }) [];\n        ",t);expect$k(e).to.parse("b",1),e=peg.generate('\n        { let i = 0; }\n        start = ("a" / neverMatched / .) { return i; };\n        neverMatched = (. { i = 1; }) [];\n        ',t),expect$k(e).to.parse("b",1)}))}))},[{cache:!1,trace:!1},{cache:!1,trace:!0},{cache:!0,trace:!1},{cache:!0,trace:!0}].forEach((function(t){describe("with options "+chai$k.util.inspect(t),(function(){a(e(t))}))})),describe("syntax errors",(function(){it("formats",(function(){var e={source:"stdin",text:"==="};try{peg.generate(e.text,{grammarSource:e.source})}catch(t){expect$k(t).to.be.an.instanceof(peg.parser.SyntaxError),expect$k(t.format([e])).to.equal('Error: Expected "import", "{", code block, comment, end of line, identifier, or whitespace but "=" found.\n --\x3e stdin:1:1\n  |\n1 | ===\n  | ^')}try{peg.generate("===",{grammarSource:"stdin"})}catch(e){expect$k(e).to.be.an.instanceof(peg.parser.SyntaxError),expect$k(e.format([])).to.equal('Error: Expected "import", "{", code block, comment, end of line, identifier, or whitespace but "=" found.\n at stdin:1:1')}})),it("detects infinite loops before other errors",(function(){try{peg.generate('\n          start = start\n          dup = label:"foo" label:"bar"\n        ')}catch(t){expect$k(t).with.property("stage","prepare"),expect$k(t).with.property("problems").to.be.an("array");var e=t.problems.filter((function(e){return"error"===e[0]})).map((function(e){return e[1]}));expect$k(e).to.deep.equal(["Possible infinite loop when parsing (left recursion: start -> start)"])}})),it("reports multiple errors in each compilation stage",(function(){try{peg.generate('\n          start = leftRecursion\n          leftRecursion = duplicatedLabel:duplicatedRule duplicatedLabel:missingRule\n          duplicatedRule = missingRule\n          duplicatedRule = "nothing"\n        ')}catch(t){expect$k(t).with.property("stage","check"),expect$k(t).with.property("problems").to.be.an("array"),t.problems.forEach((function(e){expect$k(e).to.be.an("array").lengthOf.gte(2),expect$k(e[0]).to.be.oneOf(["error","warning","info"])}));var e=t.problems.filter((function(e){return"error"===e[0]})).map((function(e){return e[1]}));expect$k(e).to.include.members(['Rule "missingRule" is not defined','Rule "duplicatedRule" is already defined','Label "duplicatedLabel" is already defined'])}}))}))}));var chai$j=require$$0,parser$2=parser$4,compiler=compiler_1,expect$j=chai$j.expect;describe("Peggy compiler",(function(){it("checks start rules",(function(){var e=parser$2.parse("foo='1'");expect$j(compiler.compile(e,compiler.passes)).to.be.an("object"),expect$j((function(){return compiler.compile(e,compiler.passes,{allowedStartRules:null})})).to.throw("allowedStartRules must be an array"),expect$j((function(){return compiler.compile(e,compiler.passes,{allowedStartRules:[]})})).to.throw("Must have at least one start rule"),expect$j((function(){return compiler.compile(e,compiler.passes,{allowedStartRules:["bar"]})})).to.throw('Unknown start rule "bar"')})),it("checks output type",(function(){var e=parser$2.parse("foo='1'");expect$j(compiler.compile(e,compiler.passes,{output:"source"})).to.be.a("string"),expect$j((function(){return compiler.compile(e,compiler.passes,{output:"INVALID OUTPUT TYPE"})})).to.throw("Invalid output format: INVALID OUTPUT TYPE.")})),it("generates inline sourceMappingURL",(function(){var e=parser$2.parse("foo='1'");if(expect$j(e).to.be.an("object"),"function"==typeof TextEncoder&&(expect$j(compiler.compile(e,compiler.passes,{output:"source-with-inline-map",grammarSource:"src.peggy"})).to.match(/^\/\/# sourceMappingURL=data:application\/json;charset=utf-8;base64,/m),"object"==typeof globalThis)){var t=globalThis.TextEncoder;delete globalThis.TextEncoder,expect$j((function(){return compiler.compile(e,compiler.passes,{output:"source-with-inline-map",grammarSource:"src.peggy"})})).to.throw("TextEncoder is not supported by this platform"),globalThis.TextEncoder=t}})),it("requires grammarSource with source-map",(function(){var e=parser$2.parse("foo='1'");expect$j(e).to.be.an("object"),expect$j((function(){return compiler.compile(e,compiler.passes,{output:"source-and-map"})})).to.throw("Must provide grammarSource (as a string or GrammarLocation) in order to generate source maps"),expect$j((function(){return compiler.compile(e,compiler.passes,{output:"source-and-map",grammarSource:""})})).to.throw("Must provide grammarSource (as a string or GrammarLocation) in order to generate source maps"),"function"==typeof TextEncoder&&expect$j((function(){return compiler.compile(e,compiler.passes,{output:"source-with-inline-map",grammarSource:{toString:function(){return""}}})})).to.throw("Must provide grammarSource (as a string or GrammarLocation) in order to generate source maps")}))}));var chai$i=require$$0,Intern=intern,expect$i=chai$i.expect;describe("utility class Intern",(function(){it("handles strings",(function(){var e=new Intern;expect$i(e.add("one")).to.equal(0),expect$i(e.add("one")).to.equal(0),expect$i(e.add("two")).to.equal(1),expect$i(e.add("one")).to.equal(0),expect$i(e.add("two")).to.equal(1),expect$i(e.add(void 0)).to.equal(-1),expect$i(e.add(null)).to.equal(-1),expect$i(e.items.length).to.equal(2),expect$i(e.items).to.deep.equal(["one","two"]),expect$i(e.get(0)).to.equal("one"),expect$i(e.get(1)).to.equal("two"),expect$i(e.get(-1)).to.equal(void 0),expect$i(e.get(10)).to.equal(void 0);var t=e.map((function(e,t){return[e,t]}));expect$i(t).to.deep.equal([["one",0],["two",1]])})),it("does conversions",(function(){var e=new Intern({convert:function(e){return Array.from(e).map((function(e){return e.codePointAt(0)}))}});expect$i(e.add("abc")).to.equal(0),expect$i(e.add("abc")).to.equal(0),expect$i(e.add("abd")).to.equal(1),expect$i(e.get(0)).to.deep.equal([97,98,99]),expect$i(e.get(1)).to.deep.equal([97,98,100])})),it("stringifies",(function(){var e=new Intern({stringify:function(){return"same"}});expect$i(e.add("abc")).to.equal(0),expect$i(e.add("def")).to.equal(0)}))}));var __spreadArray$1=commonjsGlobal&&commonjsGlobal.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var a,n=0,o=t.length;n<o;n++)!a&&n in t||(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))},GrammarError$1=peg_1.GrammarError,parser$1=parser$4,Session=session,helpers$d=function(e,t){var r=e.Assertion;e.use(requireChaiLike()),r.addMethod("changeAST",(function(e,a,n){n=void 0!==n?n:{};var o=parser$1.parse(e,n);t.flag(this,"object")(o,n,new Session({error:function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];throw new(GrammarError$1.bind.apply(GrammarError$1,__spreadArray$1([void 0],t,!1)))}})),new r(o).like(a)})),r.addMethod("reportError",(function(e,a){var n=parser$1.parse(e),o=void 0,s=void 0;try{t.flag(this,"object")(n,{},new Session({error:function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];throw new(GrammarError$1.bind.apply(GrammarError$1,__spreadArray$1([void 0],t,!1)))}})),o=!0}catch(e){s=e,o=!1}this.assert(!o,"expected #{this} to report an error but it didn't","expected #{this} to not report an error but #{act} was reported",null,s),o||void 0===a||Object.keys(a).forEach((function(e){new r(s).to.have.property(e).that.is.deep.equal(a[e])}))}))},chai$h=require$$0,helpers$c=helpers$d,pass$d=addImportedRules_1;chai$h.use(helpers$c);var expect$h=chai$h.expect;describe("compiler pass |addImportedRules|",(function(){it("creates default rules with undefined startRule",(function(){expect$h(pass$d).to.changeAST("\nimport foo from './foo.js'\nimport bar from './bar.js'\n\na = foo / bar\n",{rules:[{type:"rule",name:"a",expression:{type:"choice",alternatives:[{name:"foo",type:"rule_ref"},{name:"bar",type:"rule_ref"}]}},{type:"rule",name:"foo",expression:{type:"library_ref",name:void 0,library:"./foo.js",libraryNumber:0}},{type:"rule",name:"bar",expression:{type:"library_ref",name:void 0,library:"./bar.js",libraryNumber:1}}]})})),it("creates bound rules with named startRule",(function(){expect$h(pass$d).to.changeAST("\nimport {foo} from './foo.js'\nimport {bar} from './bar.js'\n\na = foo / bar\n",{rules:[{type:"rule",name:"a",expression:{type:"choice",alternatives:[{name:"foo",type:"rule_ref"},{name:"bar",type:"rule_ref"}]}},{type:"rule",name:"foo",expression:{type:"library_ref",name:"foo",library:"./foo.js",libraryNumber:0}},{type:"rule",name:"bar",expression:{type:"library_ref",name:"bar",library:"./bar.js",libraryNumber:1}}]})})),it("creates bound rules with renamed startRule",(function(){expect$h(pass$d).to.changeAST("\nimport {foo as foo1} from './foo.js'\nimport {bar as bar2} from './bar.js'\n\na = foo1 / bar2\n",{rules:[{type:"rule",name:"a",expression:{type:"choice",alternatives:[{name:"foo1",type:"rule_ref"},{name:"bar2",type:"rule_ref"}]}},{type:"rule",name:"foo1",expression:{type:"library_ref",name:"foo",library:"./foo.js",libraryNumber:0}},{type:"rule",name:"bar2",expression:{type:"library_ref",name:"bar",library:"./bar.js",libraryNumber:1}}]})})),it("skips import as",(function(){expect$h(pass$d).to.changeAST("\nimport * as foo from './foo.js'\n\na = foo.one / foo.two\n",{rules:[{type:"rule",name:"a",expression:{type:"choice",alternatives:[{type:"library_ref",name:"one",library:"foo",libraryNumber:-1},{type:"library_ref",name:"two",library:"foo",libraryNumber:-1}]}}]})})),it("errors on bad types",(function(){expect$h((function(){pass$d({imports:[{what:[{type:"unknown"}],from:{module:"foo.js"}}]})})).to.throw(TypeError)}))}));var chai$g=require$$0,helpers$b=helpers$d,pass$c=fixLibraryNumbers_1;chai$g.use(helpers$b);var expect$g=chai$g.expect;describe("compiler pass |fixLibraryNumbers|",(function(){it("Adds library numbers for import * as",(function(){expect$g(pass$c).to.changeAST('\nimport * as foo from "./foo.js";\nimport * as bar from "./foo.js";\n\na = foo.one / bar.two\n      ',{rules:[{type:"rule",name:"a",expression:{type:"choice",alternatives:[{type:"library_ref",name:"one",library:"foo",libraryNumber:0},{type:"library_ref",name:"two",library:"bar",libraryNumber:1}]}}]})})),it("fails on unknown module names",(function(){expect$g(pass$c).to.reportError("a = foo.bar",{message:'Unknown module "foo"'})}))}));var chai$f=require$$0,helpers$a=helpers$d,pass$b=generateBytecode_1;chai$f.use(helpers$a);var expect$f=chai$f.expect;describe("compiler pass |generateBytecode|",(function(){function e(e){return{rules:[{bytecode:e}]}}function t(e,t){return{rules:[{bytecode:e}],locations:t}}function r(e,t,r,a){return{literals:e,classes:t,expectations:r,functions:a}}describe("for grammar",(function(){it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(["a = 'a'","b = 'b'","c = 'c'"].join("\n"),{rules:[{bytecode:[18,0,2,2,22,0,23,0]},{bytecode:[18,1,2,2,22,1,23,1]},{bytecode:[18,2,2,2,22,2,23,2]}]})})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(["a = 'a'","b = 'b'","c = 'c'"].join("\n"),r(["a","b","c"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1},{type:"literal",value:"c",ignoreCase:!1}],[]))})),it("generates correct source mapping",(function(){expect$f(pass$b).to.changeAST(["a = 'a'"].join("\n"),t([37,0,18,0,2,2,22,0,23,0,38],[{source:"-",start:{offset:4,line:1,column:5},end:{offset:7,line:1,column:8}}]),{grammarSource:"-",output:"source-and-map"})})),it("generates correct plucking bytecode",(function(){expect$f(pass$b).to.changeAST("start = 'a' @'b' 'c'",e([5,18,0,2,2,22,0,23,0,15,34,3,18,1,2,2,22,1,23,1,15,19,4,18,2,2,2,22,2,23,2,15,4,4,36,4,1,1,8,3,7,3,8,2,7,3,6,7,3])),expect$f(pass$b).to.changeAST("start = 'a' @'b' @'c'",e([5,18,0,2,2,22,0,23,0,15,35,3,18,1,2,2,22,1,23,1,15,20,4,18,2,2,2,22,2,23,2,15,5,4,36,4,2,1,0,8,3,7,3,8,2,7,3,6,7,3]))}))})),describe("for rule",(function(){it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST("start = 'a'",e([18,0,2,2,22,0,23,0]))}))})),describe("for named",(function(){var t="start 'start' = 'a'";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([28,18,0,2,2,22,0,23,1,29,14,2,0,23,0]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"rule",value:"start"},{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("for choice",(function(){it("generates correct bytecode and source mapping",(function(){expect$f(pass$b).to.changeAST("start = 'a' / label:'b' / 'c'",t([37,5,37,0,18,0,2,2,22,0,23,0,38,14,36,0,6,37,3,39,0,2,2,37,1,18,1,2,2,22,1,23,1,38,40,0,38,14,12,0,6,37,4,18,3,2,2,22,3,23,2,38,38],[{source:"-",start:{offset:8,line:1,column:9},end:{offset:11,line:1,column:12}},{source:"-",start:{offset:20,line:1,column:21},end:{offset:23,line:1,column:24}},{source:"-",start:{offset:14,line:1,column:15},end:{offset:19,line:1,column:20}},{source:"-",start:{offset:14,line:1,column:15},end:{offset:23,line:1,column:24}},{source:"-",start:{offset:26,line:1,column:27},end:{offset:29,line:1,column:30}},{source:"-",start:{offset:8,line:1,column:9},end:{offset:29,line:1,column:30}}]),{grammarSource:"-",output:"source-and-map"})}))})),describe("for action",(function(){describe("without labels",(function(){var t="start = 'a' { code }";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,18,0,2,2,22,0,23,0,15,6,0,24,1,26,0,1,0,9]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[{predicate:!1,params:[],body:" code ",location:{source:void 0,start:{offset:13,line:1,column:14},end:{offset:19,line:1,column:20}}}]))}))})),describe("with one label",(function(){var t="start = a:'a' { code }";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,18,0,2,2,22,0,23,0,15,7,0,24,1,26,0,1,1,0,9]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[{predicate:!1,params:["a"],body:" code ",location:{source:void 0,start:{offset:15,line:1,column:16},end:{offset:21,line:1,column:22}}}]))}))})),describe("with multiple labels",(function(){var t="start = a:'a' b:'b' c:'c' { code }";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,18,0,2,2,22,0,23,0,15,39,3,18,1,2,2,22,1,23,1,15,24,4,18,2,2,2,22,2,23,2,15,9,4,24,3,26,0,4,3,2,1,0,8,3,7,3,8,2,7,3,6,7,3]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a","b","c"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1},{type:"literal",value:"c",ignoreCase:!1}],[{predicate:!1,params:["a","b","c"],body:" code ",location:{source:void 0,start:{offset:27,line:1,column:28},end:{offset:33,line:1,column:34}}}]))}))}))})),describe("for sequence",(function(){var t="start = 'a' 'b' 'c'";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,18,0,2,2,22,0,23,0,15,33,3,18,1,2,2,22,1,23,1,15,18,4,18,2,2,2,22,2,23,2,15,3,4,11,3,9,8,3,7,3,8,2,7,3,6,7,3]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a","b","c"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1},{type:"literal",value:"c",ignoreCase:!1}],[]))}))})),describe("for labeled",(function(){it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST("start = a:'a'",e([18,0,2,2,22,0,23,0]))}))})),describe("for text",(function(){it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST("start = $'a'",e([5,18,0,2,2,22,0,23,0,15,2,1,6,12,9]))}))})),describe("for simple_and",(function(){var t="start = &'a'";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,28,18,0,2,2,22,0,23,0,29,15,3,3,6,7,1,6,6,3]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("for simple_not",(function(){var t="start = !'a'";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,28,18,0,2,2,22,0,23,0,29,14,3,3,6,6,1,6,7,3]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("for optional",(function(){var t="start = 'a'?";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([18,0,2,2,22,0,23,0,14,2,0,6,2]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("for zero_or_more",(function(){var t="start = 'a'*";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([4,18,0,2,2,22,0,23,0,16,9,10,18,0,2,2,22,0,23,0,6]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("for one_or_more",(function(){var t="start = 'a'+";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([4,18,0,2,2,22,0,23,0,15,12,3,16,9,10,18,0,2,2,22,0,23,0,6,6,6,3]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("for repeated",(function(){describe("without delimiter",(function(){describe("| .. | (edge case -- no boundaries)",(function(){var t="start = 'a'| .. |";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([4,18,0,2,2,22,0,23,0,16,9,10,18,0,2,2,22,0,23,0,6]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("with constant boundaries",(function(){describe("| ..3| (edge case -- no min boundary)",(function(){var t="start = 'a'| ..3|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([4,18,0,2,2,22,0,23,0,16,14,10,31,3,1,8,3,18,0,2,2,22,0,23,0,6]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("| ..1| (edge case -- no min boundary -- same as |optional|)",(function(){var t="start = 'a'| ..1|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([4,18,0,2,2,22,0,23,0,16,14,10,31,1,1,8,3,18,0,2,2,22,0,23,0,6]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("|2.. | (edge case -- no max boundary)",(function(){var t="start = 'a'|2.. |";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,4,18,0,2,2,22,0,23,0,16,9,10,18,0,2,2,22,0,23,0,6,30,2,3,1,6,7,3,9]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("|0.. | (edge case -- no max boundary -- same as |zero or more|)",(function(){var t="start = 'a'|0.. |";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([4,18,0,2,2,22,0,23,0,16,9,10,18,0,2,2,22,0,23,0,6]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("|1.. | (edge case -- no max boundary -- same as |one or more|)",(function(){var t="start = 'a'|1.. |";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,4,18,0,2,2,22,0,23,0,16,9,10,18,0,2,2,22,0,23,0,6,30,1,3,1,6,7,3,9]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("|2..3|",(function(){var t="start = 'a'|2..3|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,4,18,0,2,2,22,0,23,0,16,14,10,31,3,1,8,3,18,0,2,2,22,0,23,0,6,30,2,3,1,6,7,3,9]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("| 42 | (edge case -- exact repetitions)",(function(){var t="start = 'a'|42|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,4,18,0,2,2,22,0,23,0,16,14,10,31,42,1,8,3,18,0,2,2,22,0,23,0,6,30,42,3,1,6,7,3,9]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))}))})),describe("with variable boundaries",(function(){describe("| ..x| (edge case -- no min boundary)",(function(){var t="start = max:('a'{return 42;}) 'a'| ..max|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,5,18,0,2,2,22,0,23,0,15,6,0,24,1,26,0,1,0,9,15,41,3,4,33,1,1,8,3,18,0,2,2,22,0,23,0,16,14,10,33,1,1,8,3,18,0,2,2,22,0,23,0,6,15,3,4,11,2,9,8,2,7,3,6,7,3]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[{predicate:!1,params:[],body:"return 42;"}]))}))})),describe("|x.. | (edge case -- no max boundary)",(function(){var t="start = min:('a'{return 42;}) 'a'|min.. |";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,5,18,0,2,2,22,0,23,0,15,6,0,24,1,26,0,1,0,9,15,40,3,5,4,18,0,2,2,22,0,23,0,16,9,10,18,0,2,2,22,0,23,0,6,32,2,3,1,6,7,3,9,15,3,4,11,2,9,8,2,7,3,6,7,3]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[{predicate:!1,params:[],body:"return 42;"}]))}))})),describe("|x..y|",(function(){var t="start = min:('a'{return 42;}) max:('a'{return 42;}) 'a'|min..max|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,5,18,0,2,2,22,0,23,0,15,6,0,24,1,26,0,1,0,9,15,77,3,5,18,0,2,2,22,0,23,0,15,7,0,24,1,26,1,1,1,2,9,15,50,4,5,4,33,2,1,8,3,18,0,2,2,22,0,23,0,16,14,10,33,2,1,8,3,18,0,2,2,22,0,23,0,6,32,3,3,1,6,7,3,9,15,3,4,11,3,9,8,3,7,3,8,2,7,3,6,7,3]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[{predicate:!1,params:[],body:"return 42;"},{predicate:!1,params:["min"],body:"return 42;"}]))}))})),describe("|exact| (edge case -- exact repetitions)",(function(){var t="start = exact:('a'{return 42;}) 'a'|exact|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,5,18,0,2,2,22,0,23,0,15,6,0,24,1,26,0,1,0,9,15,50,3,5,4,33,2,1,8,3,18,0,2,2,22,0,23,0,16,14,10,33,2,1,8,3,18,0,2,2,22,0,23,0,6,32,2,3,1,6,7,3,9,15,3,4,11,2,9,8,2,7,3,6,7,3]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[{predicate:!1,params:[],body:"return 42;"}]))}))}))})),describe("with function boundaries",(function(){describe("| ..x| (edge case -- no min boundary)",(function(){var t="start = 'a'| ..{return 42;}|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([26,0,0,0,4,33,1,1,8,3,18,0,2,2,22,0,23,0,16,14,10,33,1,1,8,3,18,0,2,2,22,0,23,0,6,9]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[{predicate:!0,params:[],body:"return 42;"}]))}))})),describe("|x.. | (edge case -- no max boundary)",(function(){var t="start = 'a'|{return 42;}.. |";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([26,0,0,0,5,4,18,0,2,2,22,0,23,0,16,9,10,18,0,2,2,22,0,23,0,6,32,2,3,1,6,7,3,9,9]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[{predicate:!0,params:[],body:"return 42;"}]))}))})),describe("|x..y|",(function(){var t="start = 'a'|{return 41;}..{return 43;}|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([26,0,0,0,26,1,0,0,5,4,33,2,1,8,3,18,0,2,2,22,0,23,0,16,14,10,33,2,1,8,3,18,0,2,2,22,0,23,0,6,32,3,3,1,6,7,3,9,9,9]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[{predicate:!0,params:[],body:"return 41;"},{predicate:!0,params:[],body:"return 43;"}]))}))})),describe("|exact| (edge case -- exact repetitions)",(function(){var t="start = 'a'|{return 42;}|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([26,0,0,0,5,4,33,2,1,8,3,18,0,2,2,22,0,23,0,16,14,10,33,2,1,8,3,18,0,2,2,22,0,23,0,6,32,2,3,1,6,7,3,9,9]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[{predicate:!0,params:[],body:"return 42;"}]))}))}))}))})),describe("with delimiter",(function(){describe("| .. , delim| (edge case -- no boundaries)",(function(){var t="start = 'a'| .. , 'b'|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([4,18,0,2,2,22,0,23,0,16,30,10,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[]))}))})),describe("with constant boundaries",(function(){describe("| ..3, delim| (edge case -- no min boundary)",(function(){var t="start = 'a'| ..3, 'b'|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([4,18,0,2,2,22,0,23,0,16,35,10,31,3,1,29,3,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[]))}))})),describe("| ..1, delim| (edge case -- no min boundary -- same as |optional|)",(function(){var t="start = 'a'| ..1, 'b'|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([4,18,0,2,2,22,0,23,0,16,35,10,31,1,1,29,3,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[]))}))})),describe("|2.. , delim| (edge case -- no max boundary)",(function(){var t="start = 'a'|2.. , 'b'|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,4,18,0,2,2,22,0,23,0,16,30,10,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,30,2,3,1,6,7,3,9]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[]))}))})),describe("|0.. , delim| (edge case -- no max boundary -- same as |zero or more|)",(function(){var t="start = 'a'|0.. , 'b'|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([4,18,0,2,2,22,0,23,0,16,30,10,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[]))}))})),describe("|1.. , delim| (edge case -- no max boundary -- same as |one or more|)",(function(){var t="start = 'a'|1.. , 'b'|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,4,18,0,2,2,22,0,23,0,16,30,10,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,30,1,3,1,6,7,3,9]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[]))}))})),describe("|2..3, delim|",(function(){var t="start = 'a'|2..3, 'b'|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,4,18,0,2,2,22,0,23,0,16,35,10,31,3,1,29,3,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,30,2,3,1,6,7,3,9]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[]))}))})),describe("| 42 , delim| (edge case -- exact repetitions)",(function(){var t="start = 'a'|42, 'b'|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,4,18,0,2,2,22,0,23,0,16,35,10,31,42,1,29,3,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,30,42,3,1,6,7,3,9]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[]))}))}))})),describe("with variable boundaries",(function(){describe("| ..x, delim| (edge case -- no min boundary)",(function(){var t="start = max:(''{return 42;}) 'a'| ..max, 'b'|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,5,35,15,6,0,24,1,26,0,1,0,9,15,62,3,4,33,1,1,8,3,18,0,2,2,22,0,23,0,16,35,10,33,1,1,29,3,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,15,3,4,11,2,9,8,2,7,3,6,7,3]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[{predicate:!1,params:[],body:"return 42;"}]))}))})),describe("|x.. , delim| (edge case -- no max boundary)",(function(){var t="start = min:(''{return 42;}) 'a'|min.. , 'b'|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,5,35,15,6,0,24,1,26,0,1,0,9,15,61,3,5,4,18,0,2,2,22,0,23,0,16,30,10,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,32,2,3,1,6,7,3,9,15,3,4,11,2,9,8,2,7,3,6,7,3]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[{predicate:!1,params:[],body:"return 42;"}]))}))})),describe("|x..y, delim|",(function(){var t="start = min:(''{return 42;}) max:(''{return 42;}) 'a'|min..max, 'b'|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,5,35,15,6,0,24,1,26,0,1,0,9,15,91,3,5,35,15,7,0,24,1,26,1,1,1,2,9,15,71,4,5,4,33,2,1,8,3,18,0,2,2,22,0,23,0,16,35,10,33,2,1,29,3,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,32,3,3,1,6,7,3,9,15,3,4,11,3,9,8,3,7,3,8,2,7,3,6,7,3]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[{predicate:!1,params:[],body:"return 42;"},{predicate:!1,params:["min"],body:"return 42;"}]))}))})),describe("|exact, delim| (edge case -- exact repetitions)",(function(){var t="start = exact:(''{return 42;}) 'a'|exact, 'b'|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,5,35,15,6,0,24,1,26,0,1,0,9,15,71,3,5,4,33,2,1,8,3,18,0,2,2,22,0,23,0,16,35,10,33,2,1,29,3,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,32,2,3,1,6,7,3,9,15,3,4,11,2,9,8,2,7,3,6,7,3]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[{predicate:!1,params:[],body:"return 42;"}]))}))})),describe("used in delimiter",(function(){describe("delim|min..|",(function(){var t="start = min:(''{return 42;}) 'a'|.., 'b'|min..| |";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,5,35,15,6,0,24,1,26,0,1,0,9,15,74,3,4,18,0,2,2,22,0,23,0,16,52,10,5,5,4,18,1,2,2,22,1,23,1,16,9,10,18,1,2,2,22,1,23,1,6,32,4,3,1,6,7,3,9,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,15,3,4,11,2,9,8,2,7,3,6,7,3]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[{predicate:!1,params:[],body:"return 42;"}]))}))})),describe("delim|..max|",(function(){var t="start = max:(''{return 42;}) 'a'|.., 'b'|..max| |";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,5,35,15,6,0,24,1,26,0,1,0,9,15,75,3,4,18,0,2,2,22,0,23,0,16,53,10,5,4,33,3,1,8,3,18,1,2,2,22,1,23,1,16,14,10,33,3,1,8,3,18,1,2,2,22,1,23,1,6,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,15,3,4,11,2,9,8,2,7,3,6,7,3]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[{predicate:!1,params:[],body:"return 42;"}]))}))})),describe("delim|exact|",(function(){var t="start = exact:(''{return 42;}) 'a'|.., 'b'|exact| |";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,5,35,15,6,0,24,1,26,0,1,0,9,15,84,3,4,18,0,2,2,22,0,23,0,16,62,10,5,5,4,33,4,1,8,3,18,1,2,2,22,1,23,1,16,14,10,33,4,1,8,3,18,1,2,2,22,1,23,1,6,32,4,3,1,6,7,3,9,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,15,3,4,11,2,9,8,2,7,3,6,7,3]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[{predicate:!1,params:[],body:"return 42;"}]))}))}))}))})),describe("with function boundaries",(function(){describe("| ..x, delim| (edge case -- no min boundary)",(function(){var t="start = 'a'| ..{return 42;}, 'b'|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([26,0,0,0,4,33,1,1,8,3,18,0,2,2,22,0,23,0,16,35,10,33,1,1,29,3,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,9]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[{predicate:!0,params:[],body:"return 42;"}]))}))})),describe("|x.. , delim| (edge case -- no max boundary)",(function(){var t="start = 'a'|{return 42;}.. , 'b'|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([26,0,0,0,5,4,18,0,2,2,22,0,23,0,16,30,10,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,32,2,3,1,6,7,3,9,9]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[{predicate:!0,params:[],body:"return 42;"}]))}))})),describe("|x..y, delim|",(function(){var t="start = 'a'|{return 41;}..{return 43;}, 'b'|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([26,0,0,0,26,1,0,0,5,4,33,2,1,8,3,18,0,2,2,22,0,23,0,16,35,10,33,2,1,29,3,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,32,3,3,1,6,7,3,9,9,9]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[{predicate:!0,params:[],body:"return 41;"},{predicate:!0,params:[],body:"return 43;"}]))}))})),describe("|exact, delim| (edge case -- exact repetitions)",(function(){var t="start = 'a'|{return 42;}, 'b'|";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([26,0,0,0,5,4,33,2,1,8,3,18,0,2,2,22,0,23,0,16,35,10,33,2,1,29,3,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,32,2,3,1,6,7,3,9,9]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[{predicate:!0,params:[],body:"return 42;"}]))}))}))}))}))})),describe("for group",(function(){var t="start = ('a')";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([18,0,2,2,22,0,23,0]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("for semantic_and",(function(){describe("without labels",(function(){var t="start = &{ code }";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([25,26,0,0,0,13,2,2,6,1,6,3]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r([],[],[],[{predicate:!0,params:[],body:" code ",location:{source:void 0,start:{offset:10,line:1,column:11},end:{offset:16,line:1,column:17}}}]))}))})),describe("with labels",(function(){var t="start = a:'a' b:'b' c:'c' &{ code }";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,18,0,2,2,22,0,23,0,15,55,3,18,1,2,2,22,1,23,1,15,40,4,18,2,2,2,22,2,23,2,15,25,4,25,26,0,0,3,2,1,0,13,2,2,6,1,6,3,15,3,4,11,4,9,8,4,7,3,8,3,7,3,8,2,7,3,6,7,3]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a","b","c"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1},{type:"literal",value:"c",ignoreCase:!1}],[{predicate:!0,params:["a","b","c"],body:" code ",location:{source:void 0,start:{offset:28,line:1,column:29},end:{offset:34,line:1,column:35}}}]))}))}))})),describe("for semantic_not",(function(){describe("without labels",(function(){var t="start = !{ code }";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([25,26,0,0,0,13,2,2,6,3,6,1]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r([],[],[],[{predicate:!0,params:[],body:" code ",location:{source:void 0,start:{offset:10,line:1,column:11},end:{offset:16,line:1,column:17}}}]))}))})),describe("with labels",(function(){var t="start = a:'a' b:'b' c:'c' !{ code }";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([5,18,0,2,2,22,0,23,0,15,55,3,18,1,2,2,22,1,23,1,15,40,4,18,2,2,2,22,2,23,2,15,25,4,25,26,0,0,3,2,1,0,13,2,2,6,3,6,1,15,3,4,11,4,9,8,4,7,3,8,3,7,3,8,2,7,3,6,7,3]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a","b","c"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1},{type:"literal",value:"c",ignoreCase:!1}],[{predicate:!0,params:["a","b","c"],body:" code ",location:{source:void 0,start:{offset:28,line:1,column:29},end:{offset:34,line:1,column:35}}}]))}))}))})),describe("for rule_ref",(function(){it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(["start = other","other = 'other'"].join("\n"),{rules:[{bytecode:[27,1]},{}]})}))})),describe("for literal",(function(){describe("empty",(function(){var t="start = ''";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([35]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r([],[],[],[]))}))})),describe("non-empty case-sensitive",(function(){var t="start = 'a'";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([18,0,2,2,22,0,23,0]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("non-empty case-insensitive",(function(){var t="start = 'A'i";it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([19,0,2,2,21,1,23,0]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r(["a"],[],[{type:"literal",value:"A",ignoreCase:!0}],[]))}))}))})),describe("for class",(function(){it("generates correct bytecode",(function(){expect$f(pass$b).to.changeAST("start = [a]",e([20,0,2,2,21,1,23,0]))})),describe("non-inverted case-sensitive",(function(){it("defines correct constants",(function(){expect$f(pass$b).to.changeAST("start = [a]",r([],[{value:["a"],ignoreCase:!1,inverted:!1}],[{type:"class",value:["a"],ignoreCase:!1,inverted:!1}],[]))}))})),describe("inverted case-sensitive",(function(){it("defines correct constants",(function(){expect$f(pass$b).to.changeAST("start = [^a]",r([],[{value:["a"],ignoreCase:!1,inverted:!0}],[{type:"class",value:["a"],ignoreCase:!1,inverted:!0}],[]))}))})),describe("non-inverted case-insensitive",(function(){it("defines correct constants",(function(){expect$f(pass$b).to.changeAST("start = [a]i",r([],[{value:["a"],ignoreCase:!0,inverted:!1}],[{type:"class",value:["a"],ignoreCase:!0,inverted:!1}],[]))}))})),describe("complex",(function(){it("defines correct constants",(function(){expect$f(pass$b).to.changeAST("start = [ab-def-hij-l]",r([],[{value:["a",["b","d"],"e",["f","h"],"i",["j","l"]],ignoreCase:!1,inverted:!1}],[{type:"class",value:["a",["b","d"],"e",["f","h"],"i",["j","l"]],ignoreCase:!1,inverted:!1}],[]))}))}))})),describe("for any",(function(){var t="start = .";it("generates bytecode",(function(){expect$f(pass$b).to.changeAST(t,e([17,2,2,21,1,23,0]))})),it("defines correct constants",(function(){expect$f(pass$b).to.changeAST(t,r([],[],[{type:"any"}],[]))}))}))}));var __assign=commonjsGlobal&&commonjsGlobal.__assign||function(){return __assign=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},__assign.apply(this,arguments)},chai$e=require$$0,pass$a=generateJs,expect$e=chai$e.expect;describe("compiler pass |generateJS|",(function(){describe("coverage",(function(){var e={type:"grammar",imports:[],rules:[],location:{source:"",start:{line:1,column:1,offset:0},end:{line:1,column:1,offset:0}}},t={};it("throws unless various grammar fields are set",(function(){expect$e((function(){return pass$a(e,t)})).to.throw(Error,"generateJS: generate bytecode was not called."),e.literals=[],expect$e((function(){return pass$a(__assign(__assign({},e),{literals:[]}),t)})).to.throw(Error,"generateJS: generate bytecode was not called."),e.locations=[],expect$e((function(){return pass$a(__assign(__assign({},e),{literals:[]}),t)})).to.throw(Error,"generateJS: generate bytecode was not called."),e.classes=[],expect$e((function(){return pass$a(__assign(__assign({},e),{literals:[]}),t)})).to.throw(Error,"generateJS: generate bytecode was not called."),e.expectations=[],expect$e((function(){return pass$a(__assign(__assign({},e),{literals:[]}),t)})).to.throw(Error,"generateJS: generate bytecode was not called."),e.functions=[],expect$e((function(){return pass$a(__assign(__assign({},e),{literals:[]}),t)})).to.throw(Error,"generateJS: generate bytecode was not called."),e.importedNames=[],expect$e((function(){return pass$a(e,t)})).to.throw(Error,"generateJS: options.allowedStartRules was not set."),t.allowedStartRules=["start"],expect$e((function(){return pass$a(e,t)})).to.not.throw()}))}))}));var chai$d=require$$0,helpers$9=helpers$d,pass$9=inferenceMatchResult_1;chai$d.use(helpers$9);var expect$d=chai$d.expect;describe("compiler pass |inferenceMatchResult|",(function(){it("calculate |match| property for |any| correctly",(function(){expect$d(pass$9).to.changeAST("start = .",{rules:[{match:0}]})})),it("calculate |match| property for |literal| correctly",(function(){expect$d(pass$9).to.changeAST("start = ''",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''i",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = 'a'",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = 'a'i",{rules:[{match:0}]})})),it("calculate |match| property for |class| correctly",(function(){expect$d(pass$9).to.changeAST("start = []",{rules:[{match:-1}]}),expect$d(pass$9).to.changeAST("start = []i",{rules:[{match:-1}]}),expect$d(pass$9).to.changeAST("start = [a]",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = [a]i",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = [a-b]",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = [a-b]i",{rules:[{match:0}]})})),it("calculate |match| property for |sequence| correctly",(function(){expect$d(pass$9).to.changeAST("start = 'a' 'b'",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = 'a' ''",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = '' 'b'",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = '' ''",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = 'a' []",{rules:[{match:-1}]}),expect$d(pass$9).to.changeAST("start = [] 'b'",{rules:[{match:-1}]}),expect$d(pass$9).to.changeAST("start = [] []",{rules:[{match:-1}]})})),it("calculate |match| property for |choice| correctly",(function(){expect$d(pass$9).to.changeAST("start = 'a' / 'b'",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = 'a' / ''",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''  / 'b'",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''  / ''",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = 'a' / []",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []  / 'b'",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []  / []",{rules:[{match:-1}]})})),it("calculate |match| property for predicates correctly",(function(){expect$d(pass$9).to.changeAST("start = &.",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = &''",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = &[]",{rules:[{match:-1}]}),expect$d(pass$9).to.changeAST("start = !.",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = !''",{rules:[{match:-1}]}),expect$d(pass$9).to.changeAST("start = ![]",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = &{ code }",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = !{ code }",{rules:[{match:0}]})})),it("calculate |match| property for |text| correctly",(function(){expect$d(pass$9).to.changeAST("start = $.",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = $''",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = $[]",{rules:[{match:-1}]})})),it("calculate |match| property for |action| correctly",(function(){expect$d(pass$9).to.changeAST("start = .  { code }",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = '' { code }",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = [] { code }",{rules:[{match:-1}]})})),it("calculate |match| property for |labeled| correctly",(function(){expect$d(pass$9).to.changeAST("start = a:.",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = a:''",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = a:[]",{rules:[{match:-1}]})})),it("calculate |match| property for |named| correctly",(function(){expect$d(pass$9).to.changeAST("start 'start' = .",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start 'start' = ''",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start 'start' = []",{rules:[{match:-1}]})})),it("calculate |match| property for |optional| correctly",(function(){expect$d(pass$9).to.changeAST("start = .?",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''?",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []?",{rules:[{match:1}]})})),it("calculate |match| property for |zero_or_more| correctly",(function(){expect$d(pass$9).to.changeAST("start = .*",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''*",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []*",{rules:[{match:1}]})})),it("calculate |match| property for |one_or_more| correctly",(function(){expect$d(pass$9).to.changeAST("start = .+",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''+",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []+",{rules:[{match:-1}]})})),describe("calculate |match| property for |repeated|",(function(){describe("without delimiter",(function(){describe("with constant boundaries",(function(){it("for | .. | correctly",(function(){expect$d(pass$9).to.changeAST("start =  .| .. |",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''| .. |",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []| .. |",{rules:[{match:1}]})})),it("for | ..1| correctly",(function(){expect$d(pass$9).to.changeAST("start =  .| ..1|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''| ..1|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []| ..1|",{rules:[{match:1}]})})),it("for | ..3| correctly",(function(){expect$d(pass$9).to.changeAST("start =  .| ..3|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''| ..3|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []| ..3|",{rules:[{match:1}]})})),it("for |0.. | correctly",(function(){expect$d(pass$9).to.changeAST("start =  .|0.. |",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''|0.. |",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []|0.. |",{rules:[{match:1}]})})),it("for |1.. | correctly",(function(){expect$d(pass$9).to.changeAST("start =  .|1.. |",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|1.. |",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []|1.. |",{rules:[{match:-1}]})})),it("for |2.. | correctly",(function(){expect$d(pass$9).to.changeAST("start =  .|2.. |",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|2.. |",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []|2.. |",{rules:[{match:-1}]})})),it("for |2..3| correctly",(function(){expect$d(pass$9).to.changeAST("start =  .|2..3|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|2..3|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []|2..3|",{rules:[{match:-1}]})})),it("for | 42 | correctly",(function(){expect$d(pass$9).to.changeAST("start =  .| 42 |",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''| 42 |",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []| 42 |",{rules:[{match:-1}]})}))})),describe("with variable boundaries",(function(){it("for |   ..max| correctly",(function(){expect$d(pass$9).to.changeAST("start =  .|   ..max|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|   ..max|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|   ..max|",{rules:[{match:0}]})})),it("for |min..   | correctly",(function(){expect$d(pass$9).to.changeAST("start =  .|min..   |",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|min..   |",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|min..   |",{rules:[{match:0}]})})),it("for |min..max| correctly",(function(){expect$d(pass$9).to.changeAST("start =  .|min..max|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|min..max|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|min..max|",{rules:[{match:0}]})})),it("for | exact  | correctly",(function(){expect$d(pass$9).to.changeAST("start =  .|exact|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|exact|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|exact|",{rules:[{match:0}]})}))})),describe("with function boundaries",(function(){it("for |  ..{}| correctly",(function(){expect$d(pass$9).to.changeAST("start =  .|   ..{}|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|   ..{}|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|   ..{}|",{rules:[{match:0}]})})),it("for |{}..  | correctly",(function(){expect$d(pass$9).to.changeAST("start =  .|{}..   |",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|{}..   |",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|{}..   |",{rules:[{match:0}]})})),it("for |{}..{}| correctly",(function(){expect$d(pass$9).to.changeAST("start =  .|{}..{}|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|{}..{}|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|{}..{}|",{rules:[{match:0}]})})),it("for |  {}  | correctly",(function(){expect$d(pass$9).to.changeAST("start =  .|{}|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|{}|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|{}|",{rules:[{match:0}]})}))}))})),describe("with delimiter",(function(){describe("with constant boundaries",(function(){it("for | .. , delimiter| correctly",(function(){expect$d(pass$9).to.changeAST("start =  .| .. , .|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start =  .| .. ,''|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start =  .| .. ,[]|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''| .. , .|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''| .. ,''|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''| .. ,[]|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []| .. , .|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []| .. ,''|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []| .. ,[]|",{rules:[{match:1}]})})),it("for | ..1, delimiter| correctly",(function(){expect$d(pass$9).to.changeAST("start =  .| ..1, .|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start =  .| ..1,''|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start =  .| ..1,[]|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''| ..1, .|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''| ..1,''|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''| ..1,[]|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []| ..1, .|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []| ..1,''|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []| ..1,[]|",{rules:[{match:1}]})})),it("for | ..3, delimiter| correctly",(function(){expect$d(pass$9).to.changeAST("start =  .| ..3, .|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start =  .| ..3,''|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start =  .| ..3,[]|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''| ..3, .|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''| ..3,''|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''| ..3,[]|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []| ..3, .|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []| ..3,''|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []| ..3,[]|",{rules:[{match:1}]})})),it("for |0.. , delimiter| correctly",(function(){expect$d(pass$9).to.changeAST("start =  .|0.. , .|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start =  .|0.. ,''|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start =  .|0.. ,[]|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''|0.. , .|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''|0.. ,''|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''|0.. ,[]|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []|0.. , .|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []|0.. ,''|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []|0.. ,[]|",{rules:[{match:1}]})})),it("for |1.. , delimiter| correctly",(function(){expect$d(pass$9).to.changeAST("start =  .|1.. , .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .|1.. ,''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .|1.. ,[]|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|1.. , .|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''|1.. ,''|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''|1.. ,[]|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = []|1.. , .|",{rules:[{match:-1}]}),expect$d(pass$9).to.changeAST("start = []|1.. ,''|",{rules:[{match:-1}]}),expect$d(pass$9).to.changeAST("start = []|1.. ,[]|",{rules:[{match:-1}]})})),it("for |2.. , delimiter| correctly",(function(){expect$d(pass$9).to.changeAST("start =  .|2.. , .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .|2.. ,''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .|2.. ,[]|",{rules:[{match:-1}]}),expect$d(pass$9).to.changeAST("start = ''|2.. , .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|2.. ,''|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''|2.. ,[]|",{rules:[{match:-1}]}),expect$d(pass$9).to.changeAST("start = []|2.. , .|",{rules:[{match:-1}]}),expect$d(pass$9).to.changeAST("start = []|2.. ,''|",{rules:[{match:-1}]}),expect$d(pass$9).to.changeAST("start = []|2.. ,[]|",{rules:[{match:-1}]})})),it("for |2..3, delimiter| correctly",(function(){expect$d(pass$9).to.changeAST("start =  .|2..3, .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .|2..3,''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .|2..3,[]|",{rules:[{match:-1}]}),expect$d(pass$9).to.changeAST("start = ''|2..3, .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|2..3,''|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''|2..3,[]|",{rules:[{match:-1}]}),expect$d(pass$9).to.changeAST("start = []|2..3, .|",{rules:[{match:-1}]}),expect$d(pass$9).to.changeAST("start = []|2..3,''|",{rules:[{match:-1}]}),expect$d(pass$9).to.changeAST("start = []|2..3,[]|",{rules:[{match:-1}]})})),it("for | 42 , delimiter| correctly",(function(){expect$d(pass$9).to.changeAST("start =  .| 42 , .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .| 42 ,''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .| 42 ,[]|",{rules:[{match:-1}]}),expect$d(pass$9).to.changeAST("start = ''| 42 , .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''| 42 ,''|",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ''| 42 ,[]|",{rules:[{match:-1}]}),expect$d(pass$9).to.changeAST("start = []| 42 , .|",{rules:[{match:-1}]}),expect$d(pass$9).to.changeAST("start = []| 42 ,''|",{rules:[{match:-1}]}),expect$d(pass$9).to.changeAST("start = []| 42 ,[]|",{rules:[{match:-1}]})}))})),describe("with variable boundaries",(function(){it("for |   ..max, delimiter| correctly",(function(){expect$d(pass$9).to.changeAST("start =  .|   ..max, .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .|   ..max,''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .|   ..max,[]|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|   ..max, .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|   ..max,''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|   ..max,[]|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|   ..max, .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|   ..max,''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|   ..max,[]|",{rules:[{match:0}]})})),it("for |min..   , delimiter| correctly",(function(){expect$d(pass$9).to.changeAST("start =  .|min..   , .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .|min..   ,''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .|min..   ,[]|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|min..   , .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|min..   ,''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|min..   ,[]|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|min..   , .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|min..   ,''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|min..   ,[]|",{rules:[{match:0}]})})),it("for |min..max, delimiter| correctly",(function(){expect$d(pass$9).to.changeAST("start =  .|min..max, .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .|min..max,''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .|min..max,[]|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|min..max, .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|min..max,''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|min..max,[]|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|min..max, .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|min..max,''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|min..max,[]|",{rules:[{match:0}]})})),it("for | exact  , delimiter| correctly",(function(){expect$d(pass$9).to.changeAST("start =  .| exact  , .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .| exact  ,''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .| exact  ,[]|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''| exact  , .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''| exact  ,''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''| exact  ,[]|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []| exact  , .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []| exact  ,''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []| exact  ,[]|",{rules:[{match:0}]})}))})),describe("with function boundaries",(function(){it("for |  ..{}, delimiter| correctly",(function(){expect$d(pass$9).to.changeAST("start =  .|   ..{}, .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .|   ..{},''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .|   ..{},[]|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|   ..{}, .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|   ..{},''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|   ..{},[]|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|   ..{}, .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|   ..{},''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|   ..{},[]|",{rules:[{match:0}]})})),it("for |{}..  , delimiter| correctly",(function(){expect$d(pass$9).to.changeAST("start =  .|{}..   , .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .|{}..   ,''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .|{}..   ,[]|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|{}..   , .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|{}..   ,''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|{}..   ,[]|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|{}..   , .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|{}..   ,''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|{}..   ,[]|",{rules:[{match:0}]})})),it("for |{}..{}, delimiter| correctly",(function(){expect$d(pass$9).to.changeAST("start =  .|{}..{}, .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .|{}..{},''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .|{}..{},[]|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|{}..{}, .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|{}..{},''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''|{}..{},[]|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|{}..{}, .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|{}..{},''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []|{}..{},[]|",{rules:[{match:0}]})})),it("for |  {}  , delimiter| correctly",(function(){expect$d(pass$9).to.changeAST("start =  .| {}  , .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .| {}  ,''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start =  .| {}  ,[]|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''| {}  , .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''| {}  ,''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ''| {}  ,[]|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []| {}  , .|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []| {}  ,''|",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = []| {}  ,[]|",{rules:[{match:0}]})}))}))}))})),it("calculate |match| property for |group| correctly",(function(){expect$d(pass$9).to.changeAST("start = (.)",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = ('')",{rules:[{match:1}]}),expect$d(pass$9).to.changeAST("start = ([])",{rules:[{match:-1}]})})),it("calculate |match| property for |rule_ref| correctly",(function(){expect$d(pass$9).to.changeAST(["start = end","end = . "].join("\n"),{rules:[{match:0},{match:0}]}),expect$d(pass$9).to.changeAST(["start = end","end = ''"].join("\n"),{rules:[{match:1},{match:1}]}),expect$d(pass$9).to.changeAST(["start = end","end = []"].join("\n"),{rules:[{match:-1},{match:-1}]}),expect$d(pass$9).to.changeAST("start = .  start",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = '' start",{rules:[{match:0}]}),expect$d(pass$9).to.changeAST("start = [] start",{rules:[{match:-1}]}),expect$d(pass$9).to.changeAST("start = . start []",{rules:[{match:-1}]})}))}));var chai$c=require$$0,helpers$8=helpers$d,pass$8=mergeCharacterClasses_1;chai$c.use(helpers$8);var expect$c=chai$c.expect;describe("compiler pass |mergeCharacterClasses|",(function(){it("Merges single character literals, class, and ref_rules",(function(){expect$c(pass$8).to.changeAST(["one = three / $('a' / 'd') / [c-f] / [efh] / [c-h] / [c-g]","two = 'P' / 'P' / three / 'P' / [Q-T]","three = $('x' / [u-w])","four = 'a' / [aaa] / 'a'"].join("\n"),{rules:[{name:"one",expression:{type:"class",parts:["a",["c","h"],["u","x"]],ignoreCase:!1,inverted:!1,location:{start:{line:1,column:7},end:{line:1,column:59}}}},{name:"two",expression:{type:"class",parts:[["P","T"],["u","x"]],ignoreCase:!1,inverted:!1,location:{start:{line:2,column:7},end:{line:2,column:38}}}},{name:"three",expression:{type:"class",parts:[["u","x"]],ignoreCase:!1,inverted:!1,location:{start:{line:3,column:9},end:{line:3,column:23}}}},{name:"four",expression:{type:"literal",value:"a",ignoreCase:!1,location:{start:{line:4,column:8},end:{line:4,column:25}}}}]},{mergeCharacterClasses:!0})})),it("Merges case-independent single character literals, class, and ref_rules",(function(){expect$c(pass$8).to.changeAST(["one = three / $('a'i / 'd'i) / [c-f]i / [efh]i / [c-h]i / [c-g]i","two = 'P'i / 'P'i / three / 'P'i / [Q-T]i","three = $('x'i / [u-w]i)","four = 'a'i / [aaa]i / 'a'i"].join("\n"),{rules:[{name:"one",expression:{type:"class",parts:["a",["c","h"],["u","x"]],ignoreCase:!0,inverted:!1,location:{start:{line:1,column:7},end:{line:1,column:65}}}},{name:"two",expression:{type:"class",parts:[["P","T"],["u","x"]],ignoreCase:!0,inverted:!1,location:{start:{line:2,column:7},end:{line:2,column:42}}}},{name:"three",expression:{type:"class",parts:[["u","x"]],ignoreCase:!0,inverted:!1,location:{start:{line:3,column:9},end:{line:3,column:25}}}},{name:"four",expression:{type:"literal",value:"a",ignoreCase:!0,location:{start:{line:4,column:8},end:{line:4,column:28}}}}]},{mergeCharacterClasses:!0})})),it("Doesn't merge inappropriately",(function(){expect$c(pass$8).to.changeAST(["case = action / 'a'i / [c-g]","invert = action / 'P' / [^Q-T]","action = 'x' { return 42; } / [u-w]"].join("\n"),{rules:[{name:"case",expression:{type:"choice",alternatives:[{type:"rule_ref",name:"action"},{type:"literal",value:"a",ignoreCase:!0},{type:"class",parts:[["c","g"]],ignoreCase:!1,inverted:!1}]}},{name:"invert",expression:{type:"choice",alternatives:[{type:"rule_ref",name:"action"},{type:"literal",value:"P",ignoreCase:!1},{type:"class",parts:[["Q","T"]],ignoreCase:!1,inverted:!0}]}},{name:"action",expression:{type:"choice",alternatives:[{type:"action"},{type:"class",parts:[["u","w"]],ignoreCase:!1,inverted:!1}]}}]},{mergeCharacterClasses:!0})})),it("Handles undefined rule_refs",(function(){expect$c(pass$8).to.changeAST(["start = unknown / 'a' / [c-g]"].join("\n"),{rules:[{name:"start",expression:{type:"choice",alternatives:[{type:"rule_ref",name:"unknown"},{type:"class",parts:["a",["c","g"]],ignoreCase:!1,inverted:!1}]}}]},{mergeCharacterClasses:!0})}))}));var chai$b=require$$0,helpers$7=helpers$d,pass$7=removeProxyRules_1;chai$b.use(helpers$7);var expect$b=chai$b.expect;describe("compiler pass |removeProxyRules|",(function(){describe("when a proxy rule isn't listed in |allowedStartRules|",(function(){it("updates references and removes it",(function(){expect$b(pass$7).to.changeAST(["start = proxy","proxy = proxied","proxied = 'a'"].join("\n"),{rules:[{name:"start",expression:{type:"rule_ref",name:"proxied"}},{name:"proxied"}]},{allowedStartRules:["start"]})}))})),describe("when a proxy rule is listed in |allowedStartRules|",(function(){it("updates references but doesn't remove it",(function(){expect$b(pass$7).to.changeAST(["start = proxy","proxy = proxied","proxied = 'a'"].join("\n"),{rules:[{name:"start",expression:{type:"rule_ref",name:"proxied"}},{name:"proxy",expression:{type:"rule_ref",name:"proxied"}},{name:"proxied"}]},{allowedStartRules:["start","proxy"]})}))}))}));var chai$a=require$$0,helpers$6=helpers$d,pass$6=reportDuplicateImports_1;chai$a.use(helpers$6);var expect$a=chai$a.expect;describe("compiler pass |reportDuplicateImports|",(function(){it("Errors when the same import all name is used twice",(function(){expect$a(pass$6).to.reportError('\nimport {unrelated} from "./foo.js"\nimport * as foo from "./foo.js"\nimport * as foo from "./bar.js"\n\na = foo.one\n',{message:'Module "foo" is already imported'})}))}));var chai$9=require$$0,helpers$5=helpers$d,pass$5=reportDuplicateLabels_1;chai$9.use(helpers$5);var expect$9=chai$9.expect;describe("compiler pass |reportDuplicateLabels|",(function(){describe("in a sequence",(function(){it("reports labels duplicate with labels of preceding elements",(function(){expect$9(pass$5).to.reportError("start = a:'a' a:'a'",{message:'Label "a" is already defined',location:{source:void 0,start:{offset:14,line:1,column:15},end:{offset:15,line:1,column:16}},diagnostics:[{message:"Original label location",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:9,line:1,column:10}}}]})})),it("doesn't report labels duplicate with labels in subexpressions",(function(){expect$9(pass$5).to.not.reportError("start = ('a' / a:'a' / 'a') a:'a'"),expect$9(pass$5).to.not.reportError("start = (a:'a' { }) a:'a'"),expect$9(pass$5).to.not.reportError("start = ('a' a:'a' 'a') a:'a'"),expect$9(pass$5).to.not.reportError("start = b:(a:'a') a:'a'"),expect$9(pass$5).to.not.reportError("start = $(a:'a') a:'a'"),expect$9(pass$5).to.not.reportError("start = &(a:'a') a:'a'"),expect$9(pass$5).to.not.reportError("start = !(a:'a') a:'a'"),expect$9(pass$5).to.not.reportError("start = (a:'a')? a:'a'"),expect$9(pass$5).to.not.reportError("start = (a:'a')* a:'a'"),expect$9(pass$5).to.not.reportError("start = (a:'a')+ a:'a'"),expect$9(pass$5).to.not.reportError("start = (a:'a')|2..3| a:'a'"),expect$9(pass$5).to.not.reportError("start = 'a'|2..3, a:'a'| a:'a'"),expect$9(pass$5).to.not.reportError("start = (a:'a') a:'a'")}))})),describe("in a choice",(function(){it("doesn't report labels duplicate with labels of preceding alternatives",(function(){expect$9(pass$5).to.not.reportError("start = a:'a' / a:'a'")}))})),describe("in outer sequence",(function(){it("reports labels duplicate with labels of preceding elements",(function(){expect$9(pass$5).to.reportError("start = a:'a' (a:'a')",{message:'Label "a" is already defined',location:{source:void 0,start:{offset:15,line:1,column:16},end:{offset:16,line:1,column:17}},diagnostics:[{message:"Original label location",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:9,line:1,column:10}}}]})})),it("doesn't report labels duplicate with the label of the current element",(function(){expect$9(pass$5).to.not.reportError("start = a:(a:'a')")})),it("doesn't report labels duplicate with labels of following elements",(function(){expect$9(pass$5).to.not.reportError("start = (a:'a') a:'a'")}))}))}));var chai$8=require$$0,helpers$4=helpers$d,pass$4=reportDuplicateRules_1;chai$8.use(helpers$4);var expect$8=chai$8.expect;describe("compiler pass |reportDuplicateRules|",(function(){it("reports duplicate rules",(function(){expect$8(pass$4).to.reportError(["start = 'a'","start = 'b'"].join("\n"),{message:'Rule "start" is already defined',location:{source:void 0,start:{offset:12,line:2,column:1},end:{offset:17,line:2,column:6}},diagnostics:[{message:"Original rule location",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:5,line:1,column:6}}}]})}))}));var chai$7=require$$0,helpers$3=helpers$d,pass$3=reportIncorrectPlucking_1;chai$7.use(helpers$3);var expect$7=chai$7.expect;describe("compiler pass |reportIncorrectPlucking|",(function(){it('prevents "@" from being used with an action block',(function(){expect$7(pass$3).to.reportError("start1 = 'a' @'b' 'c' { /* empty action block */ }",{message:'"@" cannot be used with an action block',location:{source:void 0,start:{offset:13,line:1,column:14},end:{offset:14,line:1,column:15}},diagnostics:[{message:"Action block location",location:{source:void 0,start:{offset:23,line:1,column:24},end:{offset:49,line:1,column:50}}}]}),expect$7(pass$3).to.reportError("start2 = 'a' @('b' @'c' { /* empty action block */ })",{message:'"@" cannot be used with an action block',location:{source:void 0,start:{offset:19,line:1,column:20},end:{offset:20,line:1,column:21}},diagnostics:[{message:"Action block location",location:{source:void 0,start:{offset:25,line:1,column:26},end:{offset:51,line:1,column:52}}}]})})),it("allows valid plucking",(function(){expect$7(pass$3).not.to.reportError("\n\n      start1 =  @'1'               // return '1'\n      start2 =  @'1' / @'2'        // return '1' or '2'\n      start2 =   '1'   @'2' '3'    // return '2'\n      start3 =   '1' @b:'2' '3'    // return '2', label \"b\" can be used in semantic predicates\n      start4 = a:'1' @b:'2' '3'    // return '2', labels \"a\" and \"b\" can be used in semantic predicates\n      start5 =  @'1'   @'2' '3'    // return ['1', '2']\n      start6 =  @'1' @b:'2' '3'    // return ['1', '2'], label \"b\" can be used in semantic predicates\n      start7 = a:'1'   @'2' &{}    // return '2' if the semantic predicate doesnt fail\n      start8 = @a:$[a-z]i+ &{ return a === 'foo' } // return \"foo\"\n\n    ")}))}));var chai$6=require$$0,helpers$2=helpers$d,pass$2=reportInfiniteRecursion_1;chai$6.use(helpers$2);var expect$6=chai$6.expect;describe("compiler pass |reportInfiniteRecursion|",(function(){it("reports direct left recursion",(function(){expect$6(pass$2).to.reportError("start = start",{message:"Possible infinite loop when parsing (left recursion: start -> start)",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:5,line:1,column:6}}})})),it("reports indirect left recursion",(function(){expect$6(pass$2).to.reportError(["start = stop","stop = start"].join("\n"),{message:"Possible infinite loop when parsing (left recursion: start -> stop -> start)",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:5,line:1,column:6}}})})),describe("in sequences",(function(){it("reports left recursion if all preceding elements match empty string",(function(){expect$6(pass$2).to.reportError("start = '' '' '' start")})),it("doesn't report left recursion if some preceding element doesn't match empty string",(function(){expect$6(pass$2).to.not.reportError("start = 'a' '' '' start"),expect$6(pass$2).to.not.reportError("start = '' 'a' '' start"),expect$6(pass$2).to.not.reportError("start = '' '' 'a' start")})),it("reports left recursion when rule reference is wrapped in an expression",(function(){expect$6(pass$2).to.reportError("start = '' start?")})),it("computes expressions that always consume input on success correctly",(function(){expect$6(pass$2).to.reportError(["start = a start","a 'a' = ''"].join("\n")),expect$6(pass$2).to.not.reportError(["start = a start","a 'a' = 'a'"].join("\n")),expect$6(pass$2).to.reportError("start = ('' / 'a' / 'b') start"),expect$6(pass$2).to.reportError("start = ('a' / '' / 'b') start"),expect$6(pass$2).to.reportError("start = ('a' / 'b' / '') start"),expect$6(pass$2).to.not.reportError("start = ('a' / 'b' / 'c') start"),expect$6(pass$2).to.reportError("start = ('' { }) start"),expect$6(pass$2).to.not.reportError("start = ('a' { }) start"),expect$6(pass$2).to.reportError("start = ('' '' '') start"),expect$6(pass$2).to.not.reportError("start = ('a' '' '') start"),expect$6(pass$2).to.not.reportError("start = ('' 'a' '') start"),expect$6(pass$2).to.not.reportError("start = ('' '' 'a') start"),expect$6(pass$2).to.reportError("start = a:'' start"),expect$6(pass$2).to.not.reportError("start = a:'a' start"),expect$6(pass$2).to.reportError("start = $'' start"),expect$6(pass$2).to.not.reportError("start = $'a' start"),expect$6(pass$2).to.reportError("start = &'' start"),expect$6(pass$2).to.reportError("start = &'a' start"),expect$6(pass$2).to.reportError("start = !'' start"),expect$6(pass$2).to.reportError("start = !'a' start"),expect$6(pass$2).to.reportError("start = ''? start"),expect$6(pass$2).to.reportError("start = 'a'? start"),expect$6(pass$2).to.reportError("start = ''* start"),expect$6(pass$2).to.reportError("start = 'a'* start"),expect$6(pass$2).to.reportError("start = ''+ start"),expect$6(pass$2).to.not.reportError("start = 'a'+ start"),expect$6(pass$2).to.reportError("start = ''| .. | start"),expect$6(pass$2).to.reportError("start = ''|0.. | start"),expect$6(pass$2).to.reportError("start = ''|1.. | start"),expect$6(pass$2).to.reportError("start = ''|2.. | start"),expect$6(pass$2).to.reportError("start = ''| ..1| start"),expect$6(pass$2).to.reportError("start = ''| ..3| start"),expect$6(pass$2).to.reportError("start = ''|2..3| start"),expect$6(pass$2).to.reportError("start = ''| 42 | start"),expect$6(pass$2).to.reportError("start = 'a'| .. | start"),expect$6(pass$2).to.reportError("start = 'a'|0.. | start"),expect$6(pass$2).to.not.reportError("start = 'a'|1.. | start"),expect$6(pass$2).to.not.reportError("start = 'a'|2.. | start"),expect$6(pass$2).to.reportError("start = 'a'| ..1| start"),expect$6(pass$2).to.reportError("start = 'a'| ..3| start"),expect$6(pass$2).to.not.reportError("start = 'a'|2..3| start"),expect$6(pass$2).to.not.reportError("start = 'a'| 42 | start"),expect$6(pass$2).to.reportError("start = ('') start"),expect$6(pass$2).to.not.reportError("start = ('a') start"),expect$6(pass$2).to.reportError("start = &{ } start"),expect$6(pass$2).to.reportError("start = !{ } start"),expect$6(pass$2).to.reportError(["start = a start","a = ''"].join("\n")),expect$6(pass$2).to.not.reportError(["start = a start","a = 'a'"].join("\n")),expect$6(pass$2).to.reportError("start = '' start"),expect$6(pass$2).to.not.reportError("start = 'a' start"),expect$6(pass$2).to.not.reportError("start = [a-d] start"),expect$6(pass$2).to.not.reportError("start = . start")}))})),describe("in repeated with delimiter",(function(){it("doesn't report left recursion for delimiter if expression not match empty string",(function(){expect$6(pass$2).to.not.reportError("start = 'a'| .. , start|"),expect$6(pass$2).to.not.reportError("start = 'a'|0.. , start|"),expect$6(pass$2).to.not.reportError("start = 'a'|1.. , start|"),expect$6(pass$2).to.not.reportError("start = 'a'|2.. , start|"),expect$6(pass$2).to.not.reportError("start = 'a'| ..3, start|"),expect$6(pass$2).to.not.reportError("start = 'a'|2..3, start|"),expect$6(pass$2).to.not.reportError("start = 'a'| 42 , start|")})),it("reports left recursion for delimiter if expression match empty string",(function(){expect$6(pass$2).to.reportError("start = ''| .. , start|"),expect$6(pass$2).to.reportError("start = ''|0.. , start|"),expect$6(pass$2).to.reportError("start = ''|1.. , start|"),expect$6(pass$2).to.reportError("start = ''|2.. , start|"),expect$6(pass$2).to.reportError("start = ''| ..3, start|"),expect$6(pass$2).to.reportError("start = ''|2..3, start|"),expect$6(pass$2).to.reportError("start = ''| 42 , start|")})),it("does not inifinite loop",(function(){expect$6(pass$2).to.reportError('\n        start = expr*\n\n        expr\n          = expr "++"\n      ',{message:"Possible infinite loop when parsing (left recursion: start -> expr -> expr)"})}))}))}));var chai$5=require$$0,helpers$1=helpers$d,pass$1=reportInfiniteRepetition_1;chai$5.use(helpers$1);var expect$5=chai$5.expect;describe("compiler pass |reportInfiniteRepetition|",(function(){it("reports infinite loops for zero_or_more",(function(){expect$5(pass$1).to.reportError("start = ('')*",{message:"Possible infinite loop when parsing (repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:13,line:1,column:14}}})})),it("reports infinite loops for one_or_more",(function(){expect$5(pass$1).to.reportError("start = ('')+",{message:"Possible infinite loop when parsing (repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:13,line:1,column:14}}})})),describe("reports infinite loops for repeated",(function(){describe("without delimiter",(function(){it("with constant boundaries",(function(){expect$5(pass$1).to.reportError("start = ('')|..|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:16,line:1,column:17}}}),expect$5(pass$1).to.reportError("start = ('')|0..|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:17,line:1,column:18}}}),expect$5(pass$1).to.reportError("start = ('')|1..|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:17,line:1,column:18}}}),expect$5(pass$1).to.reportError("start = ('')|2..|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:17,line:1,column:18}}}),expect$5(pass$1).to.not.reportError("start = ('')| ..1|"),expect$5(pass$1).to.not.reportError("start = ('')| ..3|"),expect$5(pass$1).to.not.reportError("start = ('')|2..3|"),expect$5(pass$1).to.not.reportError("start = ('')| 42 |")})),it("with variable boundaries",(function(){expect$5(pass$1).to.reportError("start = ('')|len..|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:19,line:1,column:20}}}),expect$5(pass$1).to.not.reportError("start = ('')|..len|"),expect$5(pass$1).to.not.reportError("start = ('')|len1..len2|"),expect$5(pass$1).to.not.reportError("start = ('')|len|")})),it("with function boundaries",(function(){expect$5(pass$1).to.reportError("start = ('')|{}..|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:18,line:1,column:19}}}),expect$5(pass$1).to.not.reportError("start = ('')|..{}|"),expect$5(pass$1).to.not.reportError("start = ('')|{}..{}|"),expect$5(pass$1).to.not.reportError("start = ('')|{}|")}))})),describe("with empty delimiter",(function(){it("with constant boundaries",(function(){expect$5(pass$1).to.reportError("start = ('')| .., ''|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:21,line:1,column:22}}}),expect$5(pass$1).to.reportError("start = ('')|0.., ''|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:21,line:1,column:22}}}),expect$5(pass$1).to.reportError("start = ('')|1.., ''|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:21,line:1,column:22}}}),expect$5(pass$1).to.reportError("start = ('')|2.., ''|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:21,line:1,column:22}}}),expect$5(pass$1).to.not.reportError("start = ('')| ..1, ''|"),expect$5(pass$1).to.not.reportError("start = ('')| ..3, ''|"),expect$5(pass$1).to.not.reportError("start = ('')|2..3, ''|"),expect$5(pass$1).to.not.reportError("start = ('')| 42 , ''|")})),it("with variable boundaries",(function(){expect$5(pass$1).to.reportError("start = ('')|len.., ''|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:23,line:1,column:24}}}),expect$5(pass$1).to.not.reportError("start = ('')|..len, ''|"),expect$5(pass$1).to.not.reportError("start = ('')|len1..len2, ''|"),expect$5(pass$1).to.not.reportError("start = ('')|len, ''|")})),it("with function boundaries",(function(){expect$5(pass$1).to.reportError("start = ('')|{}.., ''|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:22,line:1,column:23}}}),expect$5(pass$1).to.not.reportError("start = ('')|..{}, ''|"),expect$5(pass$1).to.not.reportError("start = ('')|{}..{}, ''|"),expect$5(pass$1).to.not.reportError("start = ('')|{}, ''|")}))})),describe("with non-empty delimiter",(function(){it("with constant boundaries",(function(){expect$5(pass$1).to.not.reportError("start = ('')| .., 'a'|"),expect$5(pass$1).to.not.reportError("start = ('')|0.., 'a'|"),expect$5(pass$1).to.not.reportError("start = ('')|1.., 'a'|"),expect$5(pass$1).to.not.reportError("start = ('')|2.., 'a'|"),expect$5(pass$1).to.not.reportError("start = ('')| ..1, 'a'|"),expect$5(pass$1).to.not.reportError("start = ('')| ..3, 'a'|"),expect$5(pass$1).to.not.reportError("start = ('')|2..3, 'a'|"),expect$5(pass$1).to.not.reportError("start = ('')| 42 , 'a'|")})),it("with variable boundaries",(function(){expect$5(pass$1).to.not.reportError("start = ('')|len.., 'a'|"),expect$5(pass$1).to.not.reportError("start = ('')|..len, 'a'|"),expect$5(pass$1).to.not.reportError("start = ('')|len1..len2, 'a'|"),expect$5(pass$1).to.not.reportError("start = ('')|len, 'a'|")})),it("with function boundaries",(function(){expect$5(pass$1).to.not.reportError("start = ('')|{}.., 'a'|"),expect$5(pass$1).to.not.reportError("start = ('')|..{}, 'a'|"),expect$5(pass$1).to.not.reportError("start = ('')|{}..{}, 'a'|"),expect$5(pass$1).to.not.reportError("start = ('')|{}, 'a'|")}))}))})),it("computes expressions that always consume input on success correctly",(function(){expect$5(pass$1).to.reportError(["start = a*","a 'a' = ''"].join("\n")),expect$5(pass$1).to.not.reportError(["start = a*","a 'a' = 'a'"].join("\n")),expect$5(pass$1).to.reportError("start = ('' / 'a' / 'b')*"),expect$5(pass$1).to.reportError("start = ('a' / '' / 'b')*"),expect$5(pass$1).to.reportError("start = ('a' / 'b' / '')*"),expect$5(pass$1).to.not.reportError("start = ('a' / 'b' / 'c')*"),expect$5(pass$1).to.reportError("start = ('' { })*"),expect$5(pass$1).to.not.reportError("start = ('a' { })*"),expect$5(pass$1).to.reportError("start = ('' '' '')*"),expect$5(pass$1).to.not.reportError("start = ('a' '' '')*"),expect$5(pass$1).to.not.reportError("start = ('' 'a' '')*"),expect$5(pass$1).to.not.reportError("start = ('' '' 'a')*"),expect$5(pass$1).to.reportError("start = (a:'')*"),expect$5(pass$1).to.not.reportError("start = (a:'a')*"),expect$5(pass$1).to.reportError("start = ($'')*"),expect$5(pass$1).to.not.reportError("start = ($'a')*"),expect$5(pass$1).to.reportError("start = (&'')*"),expect$5(pass$1).to.reportError("start = (&'a')*"),expect$5(pass$1).to.reportError("start = (!'')*"),expect$5(pass$1).to.reportError("start = (!'a')*"),expect$5(pass$1).to.reportError("start = (''?)*"),expect$5(pass$1).to.reportError("start = ('a'?)*"),expect$5(pass$1).to.reportError("start = (''*)*"),expect$5(pass$1).to.reportError("start = ('a'*)*"),expect$5(pass$1).to.reportError("start = (''+)*"),expect$5(pass$1).to.not.reportError("start = ('a'+)*"),expect$5(pass$1).to.reportError("start = ('')*"),expect$5(pass$1).to.not.reportError("start = ('a')*"),expect$5(pass$1).to.reportError("start = (&{ })*"),expect$5(pass$1).to.reportError("start = (!{ })*"),expect$5(pass$1).to.reportError("start = 'a'|.., ('')*|"),expect$5(pass$1).to.not.reportError("start = 'a'|.., ('b')*|"),expect$5(pass$1).to.reportError(["start = a*","a = ''"].join("\n")),expect$5(pass$1).to.not.reportError(["start = a*","a = 'a'"].join("\n")),expect$5(pass$1).to.reportError("start = ''*"),expect$5(pass$1).to.not.reportError("start = 'a'*"),expect$5(pass$1).to.not.reportError("start = [a-d]*"),expect$5(pass$1).to.not.reportError("start = .*")}))}));var chai$4=require$$0,helpers=helpers$d,pass=reportUndefinedRules_1;chai$4.use(helpers);var expect$4=chai$4.expect;describe("compiler pass |reportUndefinedRules|",(function(){it("reports undefined rules",(function(){expect$4(pass).to.reportError("start = undefined",{message:'Rule "undefined" is not defined',location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:17,line:1,column:18}}})}))}));var chai$3=require$$0,Stack=stack,expect$3=chai$3.expect;describe("utility class Stack",(function(){describe("for an empty stack",(function(){var e=void 0;beforeEach((function(){e=new Stack("rule","v","let",[42])})),describe("throws an error when attempting",(function(){it("`pop`",(function(){expect$3((function(){return e.pop()})).to.throw(RangeError,"Rule 'rule': The variable stack underflow: attempt to use a variable 'v<x>' at an index -1.\nBytecode: 42")})),it("`top`",(function(){expect$3((function(){return e.top()})).to.throw(RangeError,"Rule 'rule': The variable stack underflow: attempt to use a variable 'v<x>' at an index -1.\nBytecode: 42")})),it("`result`",(function(){expect$3((function(){return e.result()})).to.throw(RangeError,"Rule 'rule': The variable stack is empty, can't get the result")})),it("`index`",(function(){expect$3((function(){return e.index(-2)})).to.throw(RangeError,"Rule 'rule': The variable stack overflow: attempt to get a variable at a negative index -2.\nBytecode: 42"),expect$3((function(){return e.index(0)})).to.throw(RangeError,"Rule 'rule': The variable stack underflow: attempt to use a variable 'v<x>' at an index -1.\nBytecode: 42"),expect$3((function(){return e.index(2)})).to.throw(RangeError,"Rule 'rule': The variable stack underflow: attempt to use a variable 'v<x>' at an index -3.\nBytecode: 42")})),it("`sourceMapPop`",(function(){expect$3((function(){return e.sourceMapPop()})).to.throw(RangeError,"Rule 'rule': Attempting to pop an empty source map stack.\nBytecode: 42")}))})),it("`defines` returns an empty string",(function(){expect$3(e.defines()).to.equal("")}))})),it("throws an error when attempting `pop` more than `push`",(function(){var e=new Stack("rule","v","let",[42]);e.push("1"),expect$3((function(){return e.pop(3)})).to.throw(RangeError,"Rule 'rule': The variable stack underflow: attempt to use a variable 'v<x>' at an index -2.\nBytecode: 42")})),it("returns a variable with an index 0 for `result`",(function(){var e=new Stack("rule","v","let",[]);e.push("1"),expect$3(e.result()).to.equal("v0")})),it("`defines` returns a define expression for all used variables",(function(){var e=new Stack("rule","v","let",[]);e.push("1"),e.push("2"),e.pop(),e.push("3"),expect$3(e.defines()).to.equal("let v0, v1;")})),describe("`checkedIf` method",(function(){var e=void 0;beforeEach((function(){(e=new Stack("rule","v","let",[42])).push("1")})),describe("does not throws an error",(function(){it("without the else brach",(function(){expect$3((function(){return e.checkedIf(0,(function(){}))})).to.not.throw(),expect$3((function(){return e.checkedIf(0,(function(){return e.pop()}))})).to.not.throw(),expect$3((function(){return e.checkedIf(0,(function(){return e.push("2")}))})).to.not.throw()})),describe("when the stack pointer",(function(){it("was not moving in both the arms",(function(){function t(){}function r(){e.push("1"),e.pop()}function a(){e.push("1"),e.push("2"),e.pop(2)}function n(){e.push("1"),e.pop(),e.push("2"),e.pop()}expect$3((function(){return e.checkedIf(0,t,t)})).to.not.throw(),expect$3((function(){return e.checkedIf(0,r,r)})).to.not.throw(),expect$3((function(){return e.checkedIf(0,a,a)})).to.not.throw(),expect$3((function(){return e.checkedIf(0,n,n)})).to.not.throw()})),it("increases on the same value in both the arms",(function(){expect$3((function(){return e.checkedIf(0,(function(){return e.push("1")}),(function(){return e.push("2")}))})).to.not.throw()})),it("decreases on the same value in both the arms",(function(){e.push("2"),expect$3((function(){return e.checkedIf(0,(function(){return e.pop(2)}),(function(){e.pop(),e.pop()}))})).to.not.throw()}))}))})),describe("throws an error when the stack pointer",(function(){it("was not moving in `if` and decreases in `then`",(function(){expect$3((function(){e.checkedIf(0,(function(){}),(function(){return e.pop()}))})).to.throw(Error,"Rule 'rule', position 0: Branches of a condition can't move the stack pointer differently (before: 0, after then: 0, after else: -1). Bytecode: 42")})),it("decreases in `if` and was not moving in `then`",(function(){expect$3((function(){e.checkedIf(0,(function(){return e.pop()}),(function(){}))})).to.throw(Error,"Rule 'rule', position 0: Branches of a condition can't move the stack pointer differently (before: 0, after then: -1, after else: 0). Bytecode: 42")})),it("was not moving in `if` and increases in `then`",(function(){expect$3((function(){e.checkedIf(0,(function(){}),(function(){return e.push("2")}))})).to.throw(Error,"Rule 'rule', position 0: Branches of a condition can't move the stack pointer differently (before: 0, after then: 0, after else: 1). Bytecode: 42")})),it("increases in `if` and was not moving in `then`",(function(){expect$3((function(){e.checkedIf(0,(function(){return e.push("2")}),(function(){}))})).to.throw(Error,"Rule 'rule', position 0: Branches of a condition can't move the stack pointer differently (before: 0, after then: 1, after else: 0). Bytecode: 42")})),it("decreases in `if` and increases in `then`",(function(){expect$3((function(){e.checkedIf(0,(function(){return e.pop()}),(function(){return e.push("2")}))})).to.throw(Error,"Rule 'rule', position 0: Branches of a condition can't move the stack pointer differently (before: 0, after then: -1, after else: 1). Bytecode: 42")})),it("increases in `if` and decreases in `then`",(function(){expect$3((function(){e.checkedIf(0,(function(){return e.push("2")}),(function(){return e.pop()}))})).to.throw(Error,"Rule 'rule', position 0: Branches of a condition can't move the stack pointer differently (before: 0, after then: 1, after else: -1). Bytecode: 42")}))}))})),describe("`checkedLoop` method",(function(){var e=void 0;beforeEach((function(){(e=new Stack("rule","v","let",[42])).push("1")})),it("does not throws an error when the stack pointer was not moving",(function(){function t(){}function r(){e.push("1"),e.pop()}function a(){e.push("1"),e.push("2"),e.pop(2)}function n(){e.push("1"),e.pop(),e.push("2"),e.pop()}expect$3((function(){return e.checkedLoop(0,t)})).to.not.throw(),expect$3((function(){return e.checkedLoop(0,r)})).to.not.throw(),expect$3((function(){return e.checkedLoop(0,a)})).to.not.throw(),expect$3((function(){return e.checkedLoop(0,n)})).to.not.throw()})),it("throws an error when the stack pointer increases",(function(){expect$3((function(){return e.checkedLoop(0,(function(){return e.push("1")}))})).to.throw(Error,"Rule 'rule', position 0: Body of a loop can't move the stack pointer (before: 0, after: 1). Bytecode: 42")})),it("throws an error when the stack pointer decreases",(function(){expect$3((function(){return e.checkedLoop(0,(function(){return e.pop()}))})).to.throw(Error,"Rule 'rule', position 0: Body of a loop can't move the stack pointer (before: 0, after: -1). Bytecode: 42")}))})),describe("SourceNode handling",(function(){it("sourceNode handles unknown column",(function(){expect$3(Stack.sourceNode({source:"",start:{line:1,column:0,offset:0},end:{line:1,column:0,offset:0}},["foo"],"test").column).to.equal(null)}))}))}));var chai$2=require$$0,_a$1=utils$1,hex=_a$1.hex,stringEscape=_a$1.stringEscape,regexpClassEscape=_a$1.regexpClassEscape,base64=_a$1.base64,expect$2=chai$2.expect;describe("utility functions",(function(){it("hex",(function(){expect$2(hex("0")).to.equal("30"),expect$2(hex("\0")).to.equal("0"),expect$2(hex("\n")).to.equal("A"),expect$2(hex("\ufeff")).to.equal("FEFF")})),it("stringEscape",(function(){expect$2(stringEscape("abc")).to.equal("abc"),expect$2(stringEscape('\\"\0\b\t\n\v\f\r')).to.equal('\\\\\\"\\0\\b\\t\\n\\v\\f\\r'),expect$2(stringEscape("")).to.equal("\\x01\\x0F"),expect$2(stringEscape("")).to.equal("\\x10\\x1F\\x7F"),expect$2(stringEscape("Ā࿿")).to.equal("\\u0100\\u0FFF"),expect$2(stringEscape("က￿")).to.equal("\\u1000\\uFFFF")})),it("regexpClassEscape",(function(){expect$2(regexpClassEscape("\\\0\b\t\n\v\f\r")).to.equal("\\\\\\0\\b\\t\\n\\v\\f\\r"),expect$2(regexpClassEscape("/]^-")).to.equal("\\/\\]\\^\\-"),expect$2(regexpClassEscape("")).to.equal("\\x01\\x0F"),expect$2(regexpClassEscape("")).to.equal("\\x10\\x1F\\x7F"),expect$2(regexpClassEscape("Ā࿿")).to.equal("\\u0100\\u0FFF"),expect$2(regexpClassEscape("က￿")).to.equal("\\u1000\\uFFFF")})),it("base64",(function(){expect$2(base64(new Uint8Array([]))).to.equal(""),expect$2(base64(new Uint8Array([97]))).to.equal("YQ=="),expect$2(base64(new Uint8Array([97,98]))).to.equal("YWI="),expect$2(base64(new Uint8Array([97,98,99]))).to.equal("YWJj"),expect$2(base64(new Uint8Array([97,98,99,100]))).to.equal("YWJjZA=="),expect$2(base64(new Uint8Array([97,98,99,100,101]))).to.equal("YWJjZGU="),expect$2(base64(new Uint8Array([97,98,99,100,101,102]))).to.equal("YWJjZGVm")}))}));var chai$1=require$$0,_a=peg_1,GrammarError=_a.GrammarError,GrammarLocation=_a.GrammarLocation,expect$1=chai$1.expect,location={source:void 0,start:{offset:0,line:1,column:1},end:{offset:4,line:1,column:5}};describe("Grammar Errors",(function(){it("might not have a location",(function(){var e=new GrammarError("message");expect$1(e.location).to.equal(void 0),expect$1(e.toString()).to.equal("GrammarError: message")})),it("might have locations",(function(){location.source=void 0;var e=new GrammarError("message",location);expect$1(e.location).to.eql(location),expect$1(e.toString()).to.equal("GrammarError: message\n at 1:1"),e=new GrammarError("message",null,[{message:"Subinfo",location:location}]),expect$1(e.location).to.equal(null),expect$1(e.toString()).to.equal("GrammarError: message\n from 1:1: Subinfo"),location.source="foo.peggy",e=new GrammarError("message",location,[{message:"Subinfo",location:location}]),expect$1(e.toString()).to.equal("GrammarError: message\n at foo.peggy:1:1\n from foo.peggy:1:1: Subinfo")})),describe("formats",(function(){var e={source:"foo.peggy",text:"some error\nthat"},t={source:"foo.peggy",start:{offset:5,line:1,column:6},end:{offset:11,line:2,column:1}},r=[{message:"Subinfo",location:t}];describe("single problem",(function(){describe("with main location",(function(){location.source="foo.peggy";var t=new GrammarError("message",location,r);it("with zero-length error at the end",(function(){var t=new GrammarError("message",{source:"foo.peggy",start:{offset:4,line:1,column:5},end:{offset:4,line:1,column:5}});expect$1(t.format([e])).to.equal("error: message\n --\x3e foo.peggy:1:5\n  |\n1 | some error\n  |     ^")})),it("with source",(function(){expect$1(t.format([e])).to.equal("error: message\n --\x3e foo.peggy:1:1\n  |\n1 | some error\n  | ^^^^\nnote: Subinfo\n --\x3e foo.peggy:1:6\n  |\n1 | some error\n  |      ^^^^^")})),it("without source",(function(){expect$1(t.format([])).to.equal("error: message\n at foo.peggy:1:1\n at foo.peggy:1:6: Subinfo")}))})),describe("without main location",(function(){var t=new GrammarError("message",null,r);it("with source",(function(){expect$1(t.format([e])).to.equal("error: message\nnote: Subinfo\n --\x3e foo.peggy:1:6\n  |\n1 | some error\n  |      ^^^^^")})),it("without source",(function(){expect$1(t.format([])).to.equal("error: message\n at foo.peggy:1:6: Subinfo")}))}))})),describe("several problems",(function(){describe("with main location",(function(){location.source="foo.peggy";var a=new GrammarError("message",location,r);a.problems.push(["warning","Warning message",t,[{message:"Warning Subinfo",location:t}]]),a.problems.push(["info","Info message",null,[]]),it("null source text",(function(){expect$1(a.format([{source:null,text:null}])).to.equal("error: message\n at foo.peggy:1:1\n at foo.peggy:1:6: Subinfo\n\nwarning: Warning message\n at foo.peggy:1:6\n at foo.peggy:1:6: Warning Subinfo"),expect$1(a.format([{source:null,text:void 0}])).to.equal("error: message\n at foo.peggy:1:1\n at foo.peggy:1:6: Subinfo\n\nwarning: Warning message\n at foo.peggy:1:6\n at foo.peggy:1:6: Warning Subinfo")})),it("with source",(function(){expect$1(a.format([e])).to.equal("error: message\n --\x3e foo.peggy:1:1\n  |\n1 | some error\n  | ^^^^\nnote: Subinfo\n --\x3e foo.peggy:1:6\n  |\n1 | some error\n  |      ^^^^^\n\nwarning: Warning message\n --\x3e foo.peggy:1:6\n  |\n1 | some error\n  |      ^^^^^\nnote: Warning Subinfo\n --\x3e foo.peggy:1:6\n  |\n1 | some error\n  |      ^^^^^")})),it("with GrammarLocation",(function(){var r=new GrammarLocation("foo.peggy",{offset:12,line:15,column:8});expect$1(String(r)).to.equal("foo.peggy"),location.source=r,t.source=r,a.diagnostics.push({message:"Column not offset",location:{source:r,start:{offset:11,line:2,column:1},end:{offset:15,line:2,column:5}}}),expect$1(a.format([{source:r,text:e.text}])).to.equal("error: message\n --\x3e foo.peggy:15:8\n   |\n15 | some error\n   | ^^^^\nnote: Subinfo\n --\x3e foo.peggy:15:13\n   |\n15 | some error\n   |      ^^^^^\nnote: Column not offset\n --\x3e foo.peggy:16:1\n   |\n16 | that\n   | ^^^^\n\nwarning: Warning message\n --\x3e foo.peggy:15:13\n   |\n15 | some error\n   |      ^^^^^\nnote: Warning Subinfo\n --\x3e foo.peggy:15:13\n   |\n15 | some error\n   |      ^^^^^"),location.source="foo.peggy",t.source="foo.peggy",a.diagnostics.pop()})),it("without source",(function(){expect$1(a.format([])).to.equal("error: message\n at foo.peggy:1:1\n at foo.peggy:1:6: Subinfo\n\nwarning: Warning message\n at foo.peggy:1:6\n at foo.peggy:1:6: Warning Subinfo")}))})),describe("without main location",(function(){var a=new GrammarError("message",null,r);a.problems.push(["warning","Warning message",null,[{message:"Warning Subinfo",location:t}]]),a.problems.push(["info","Info message",null,[]]),it("with source",(function(){expect$1(a.format([e])).to.equal("error: message\nnote: Subinfo\n --\x3e foo.peggy:1:6\n  |\n1 | some error\n  |      ^^^^^\n\nwarning: Warning message\nnote: Warning Subinfo\n --\x3e foo.peggy:1:6\n  |\n1 | some error\n  |      ^^^^^")})),it("without source",(function(){expect$1(a.format([])).to.equal("error: message\n at foo.peggy:1:6: Subinfo\n\nwarning: Warning message\n at foo.peggy:1:6: Warning Subinfo")}))}))}))}))}));var __spreadArray=commonjsGlobal&&commonjsGlobal.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var a,n=0,o=t.length;n<o;n++)!a&&n in t||(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))},chai=require$$0,parser=parser$4,expect=chai.expect;describe("Peggy grammar parser",(function(){var e={type:"literal",value:"abcd",ignoreCase:!1},t={type:"literal",value:"efgh",ignoreCase:!1},r={type:"literal",value:"ijkl",ignoreCase:!1},a={type:"literal",value:"mnop",ignoreCase:!1},n={type:"semantic_and",code:" code "},o={type:"semantic_not",code:" code "},s={type:"optional",expression:e},i={type:"zero_or_more",expression:e},c={type:"one_or_more",expression:e},u={type:"text",expression:s},p={type:"simple_not",expression:e},l={type:"simple_and",expression:s},f={type:"simple_not",expression:s},d={type:"labeled",label:"a",expression:e},m={type:"labeled",label:"b",expression:t},g={type:"labeled",label:"a",expression:p},$={type:"sequence",elements:[e,t,r]},h={type:"sequence",elements:[d,m]},x={type:"sequence",elements:[d,m,{type:"labeled",label:"c",expression:r},{type:"labeled",label:"d",expression:a}]},b={type:"group",expression:d},v={type:"group",expression:$},A={type:"action",expression:e,code:" code "},y={type:"action",expression:t,code:" code "},S={type:"action",expression:$,code:" code "},_={type:"choice",alternatives:[e,t,r]},E={type:"choice",alternatives:[A,y]},k={type:"choice",alternatives:[A,y,{type:"action",expression:r,code:" code "},{type:"action",expression:a,code:" code "}]},T={type:"named",name:"start rule",expression:e},C={type:"rule",name:"a",expression:e},w={type:"rule",name:"b",expression:t},P={type:"rule",name:"c",expression:r},R={type:"rule",name:"start",expression:e},L={type:"top_level_initializer",code:" top level code "},F={type:"initializer",code:" code "};function O(e){return{type:"grammar",imports:[],topLevelInitializer:null,initializer:null,rules:[{type:"rule",name:"start",expression:e}]}}function B(t){return O({type:"action",expression:e,code:t})}function M(e,t){return O({type:"literal",value:e,ignoreCase:t})}function D(e,t,r){return O({type:"class",parts:e,inverted:t,ignoreCase:r})}function I(){return O({type:"any"})}function j(e){return O({type:"rule_ref",name:e})}function N(t,r,a,n){return void 0===a&&(a="variable"),void 0===n&&(n=null),O({type:"repeated",min:{type:"string"==typeof t?a:"constant",value:t},max:{type:"string"==typeof r?a:"constant",value:r},expression:e,delimiter:n})}function U(e,t){return N(e,t,"function")}function q(e,r){return N(e,r,"variable",t)}function G(e,r){return N(e,r,"function",t)}var H=M("abcd",!1),z={type:"grammar",imports:[],topLevelInitializer:null,initializer:null,rules:[C,w]},W=function(){function e(e){delete e.location,delete e.codeLocation,delete e.nameLocation,delete e.labelLocation}function t(e){delete e.location,delete e.codeLocation,delete e.nameLocation,delete e.labelLocation,n(e.expression)}function r(e){return function(t){delete t.location,delete t.codeLocation,delete t.nameLocation,delete t.labelLocation,t[e].forEach(n)}}var a,n=(a={grammar:function(e){delete e.location,delete e.codeLocation,delete e.nameLocation,delete e.labelLocation,e.topLevelInitializer&&n(e.topLevelInitializer),e.initializer&&n(e.initializer),e.rules.forEach(n)},top_level_initializer:e,initializer:e,rule:t,named:t,choice:r("alternatives"),action:t,sequence:r("elements"),labeled:t,text:t,simple_and:t,simple_not:t,optional:t,zero_or_more:t,one_or_more:t,repeated:function(e){e.min&&(delete e.min.location,delete e.min.codeLocation),delete e.max.location,delete e.max.codeLocation,delete e.location,n(e.expression),e.delimiter&&(delete e.delimiter.location,n(e.delimiter))},group:t,semantic_and:e,semantic_not:e,rule_ref:e,library_ref:e,literal:e,class:e,any:e},function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return a[e.type].apply(a,__spreadArray([e],t,!1))});return n}();function V(e,t){var r=e.Assertion;r.addMethod("parseAs",(function(e){var r=parser.parse(t.flag(this,"object"));W(r),this.assert(t.eql(r,e),"expected #{this} to parse as #{exp} but got #{act}","expected #{this} to not parse as #{exp}",e,r,!t.flag(this,"negate"))})),r.addMethod("failToParse",(function(e){var a=void 0,n=void 0;try{n=parser.parse(t.flag(this,"object")),a=!0}catch(e){n=e,a=!1}a&&W(n),this.assert(!a,"expected #{this} to fail to parse but got #{act}","expected #{this} to not fail to parse but it failed with #{act}",null,n),a||void 0===e||Object.keys(e).forEach((function(t){new r(n).to.have.property(t).that.is.deep.equal(e[t])}))}))}beforeEach((function(){chai.use(V)})),it("parses Grammar",(function(){expect("\na = 'abcd';\n").to.parseAs({type:"grammar",imports:[],topLevelInitializer:null,initializer:null,rules:[C]}),expect("\na = 'abcd'; /* comment */; // comment\n;\nb = 'efgh';\nc = 'ijkl';\n").to.parseAs({type:"grammar",imports:[],topLevelInitializer:null,initializer:null,rules:[C,w,P]}),expect("\n{ code };\na = 'abcd';\n").to.parseAs({type:"grammar",imports:[],topLevelInitializer:null,initializer:F,rules:[C]}),expect("\n{{ top level code }};\na = 'abcd';\n").to.parseAs({type:"grammar",imports:[],topLevelInitializer:L,initializer:null,rules:[C]}),expect("\n{{ top level code }};\n{ code };\na = 'abcd';\n").to.parseAs({type:"grammar",imports:[],topLevelInitializer:L,initializer:F,rules:[C]})})),it("parses Top-Level Initializer",(function(){expect("{{ top level code }};start = 'abcd'").to.parseAs({type:"grammar",imports:[],topLevelInitializer:L,initializer:null,rules:[R]})})),it("parses Initializer",(function(){expect("{ code };start = 'abcd'").to.parseAs({type:"grammar",imports:[],topLevelInitializer:null,initializer:F,rules:[R]})})),it("parses Rule",(function(){expect("start\n=\n'abcd';").to.parseAs(O(e)),expect("start\n'start rule'\n=\n'abcd';").to.parseAs(O(T))})),it("parses Expression",(function(){expect("start = 'abcd' / 'efgh' / 'ijkl'").to.parseAs(O(_))})),it("parses ChoiceExpression",(function(){expect("start = 'abcd' { code }").to.parseAs(O(A)),expect("start = 'abcd' { code }\n/\n'efgh' { code }").to.parseAs(O(E)),expect("start = 'abcd' { code }\n/\n'efgh' { code }\n/\n'ijkl' { code }\n/\n'mnop' { code }").to.parseAs(O(k))})),it("parses ActionExpression",(function(){expect("start = 'abcd' 'efgh' 'ijkl'").to.parseAs(O($)),expect("start = 'abcd' 'efgh' 'ijkl'\n{ code }").to.parseAs(O(S))})),it("parses SequenceExpression",(function(){expect("start = a:'abcd'").to.parseAs(O(d)),expect("start = a:'abcd'\nb:'efgh'").to.parseAs(O(h)),expect("start = a:'abcd'\nb:'efgh'\nc:'ijkl'\nd:'mnop'").to.parseAs(O(x))})),it("parses `@` (value plucking)",(function(){function n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return O({type:"sequence",elements:e})}function o(e,t){return{type:"labeled",pick:!0,label:e,expression:t}}expect("start = @'abcd'").to.parseAs(n(o(null,e))),expect("start = @a:'abcd'").to.parseAs(n(o("a",e))),expect("start = 'abcd' @'efgh'").to.parseAs(n(e,o(null,t))),expect("start = a:'abcd' @b:'efgh'").to.parseAs(n(d,o("b",t))),expect("start = @'abcd' b:'efgh'").to.parseAs(n(o(null,e),m)),expect("start = a:'abcd' @'efgh' 'ijkl' @d:'mnop'").to.parseAs(n(d,o(null,t),r,o("d",a)))})),it("parses LabeledExpression",(function(){expect("start = a\n:\n!'abcd'").to.parseAs(O(g)),expect("start = !'abcd'").to.parseAs(O(p))})),it("parses PrefixedExpression",(function(){expect("start = !\n'abcd'?").to.parseAs(O(f)),expect("start = 'abcd'?").to.parseAs(O(s))})),it("parses PrefixedOperator",(function(){expect("start = $'abcd'?").to.parseAs(O(u)),expect("start = &'abcd'?").to.parseAs(O(l)),expect("start = !'abcd'?").to.parseAs(O(f))})),it("parses SuffixedExpression",(function(){expect("start = 'abcd'\n?").to.parseAs(O(s)),expect("start = 'abcd'").to.parseAs(O(e))})),it("parses SuffixedOperator",(function(){expect("start = 'abcd'?").to.parseAs(O(s)),expect("start = 'abcd'*").to.parseAs(O(i)),expect("start = 'abcd'+").to.parseAs(O(c))})),it("parses PrimaryExpression",(function(){expect("start = 'abcd'").to.parseAs(H),expect("start = [a-d]").to.parseAs(D([["a","d"]],!1,!1)),expect("start = .").to.parseAs(I()),expect("start = a").to.parseAs(j("a")),expect("start = &{ code }").to.parseAs(O(n)),expect("start = (\na:'abcd'\n)").to.parseAs(O(b)),expect("start = (\n'abcd' 'efgh' 'ijkl'\n)").to.parseAs(O(v)),expect("start = (\n'abcd'\n)").to.parseAs(H)})),describe("parses RepeatedExpression",(function(){describe("without delimiter",(function(){it("with constant boundaries",(function(){var t=N(2,3);expect("start = 'abcd'|2..3|  ").to.parseAs(t),expect("start = 'abcd'\n|2..3|").to.parseAs(t),expect("start = 'abcd'|\n2..3|").to.parseAs(t),expect("start = 'abcd'|2\n..3|").to.parseAs(t),expect("start = 'abcd'|2..\n3|").to.parseAs(t),expect("start = 'abcd'|2..3\n|").to.parseAs(t),t=O({type:"repeated",min:null,max:{type:"constant",value:3},expression:e,delimiter:null}),expect("start = 'abcd'\n|3|").to.parseAs(t),expect("start = 'abcd'|\n3|").to.parseAs(t),expect("start = 'abcd'|3\n|").to.parseAs(t)})),it("with variable boundaries",(function(){var t=N("min","max");expect("start = 'abcd'|min..max|  ").to.parseAs(t),expect("start = 'abcd'\n|min..max|").to.parseAs(t),expect("start = 'abcd'|\nmin..max|").to.parseAs(t),expect("start = 'abcd'|min\n..max|").to.parseAs(t),expect("start = 'abcd'|min..\nmax|").to.parseAs(t),expect("start = 'abcd'|min..max\n|").to.parseAs(t),t=O({type:"repeated",min:null,max:{type:"variable",value:"exact"},expression:e,delimiter:null}),expect("start = 'abcd'\n|exact|").to.parseAs(t),expect("start = 'abcd'|\nexact|").to.parseAs(t),expect("start = 'abcd'|exact\n|").to.parseAs(t)})),it("with function boundaries",(function(){var t=U("min","max");expect("start = 'abcd'|{min}..{max}|  ").to.parseAs(t),expect("start = 'abcd'\n|{min}..{max}|").to.parseAs(t),expect("start = 'abcd'|\n{min}..{max}|").to.parseAs(t),expect("start = 'abcd'|{min}\n..{max}|").to.parseAs(t),expect("start = 'abcd'|{min}..\n{max}|").to.parseAs(t),expect("start = 'abcd'|{min}..{max}\n|").to.parseAs(t),t=O({type:"repeated",min:null,max:{type:"function",value:"exact"},expression:e,delimiter:null}),expect("start = 'abcd'\n|{exact}|").to.parseAs(t),expect("start = 'abcd'|\n{exact}|").to.parseAs(t),expect("start = 'abcd'|{exact}\n|").to.parseAs(t)})),it("with mixed boundaries",(function(){var e=N(2,"max");expect("start = 'abcd'|2..max|  ").to.parseAs(e),expect("start = 'abcd'\n|2..max|").to.parseAs(e),expect("start = 'abcd'|\n2..max|").to.parseAs(e),expect("start = 'abcd'|2\n..max|").to.parseAs(e),expect("start = 'abcd'|2..\nmax|").to.parseAs(e),expect("start = 'abcd'|2..max\n|").to.parseAs(e),e=N("min",3),expect("start = 'abcd'|min..3|  ").to.parseAs(e),expect("start = 'abcd'\n|min..3|").to.parseAs(e),expect("start = 'abcd'|\nmin..3|").to.parseAs(e),expect("start = 'abcd'|min\n..3|").to.parseAs(e),expect("start = 'abcd'|min..\n3|").to.parseAs(e),expect("start = 'abcd'|min..3\n|").to.parseAs(e)}))})),describe("with delimiter",(function(){it("with constant boundaries",(function(){var r=q(2,3);expect("start = 'abcd'|2..3,'efgh'|  ").to.parseAs(r),expect("start = 'abcd'\n|2..3,'efgh'|").to.parseAs(r),expect("start = 'abcd'|\n2..3,'efgh'|").to.parseAs(r),expect("start = 'abcd'|2\n..3,'efgh'|").to.parseAs(r),expect("start = 'abcd'|2..\n3,'efgh'|").to.parseAs(r),expect("start = 'abcd'|2..3\n,'efgh'|").to.parseAs(r),expect("start = 'abcd'|2..3,\n'efgh'|").to.parseAs(r),expect("start = 'abcd'|2..3,'efgh'\n|").to.parseAs(r),r=O({type:"repeated",min:null,max:{type:"constant",value:3},expression:e,delimiter:t}),expect("start = 'abcd'\n|3,'efgh'|").to.parseAs(r),expect("start = 'abcd'|\n3,'efgh'|").to.parseAs(r),expect("start = 'abcd'|3\n,'efgh'|").to.parseAs(r),expect("start = 'abcd'|3,\n'efgh'|").to.parseAs(r),expect("start = 'abcd'|3,'efgh'\n|").to.parseAs(r),expect("start = 'abcd'|3, 'efgh'?|").to.parseAs(O({type:"repeated",min:null,max:{type:"constant",value:3},expression:e,delimiter:{type:"optional",expression:t}}))})),it("with variable boundaries",(function(){var r=q("min","max");expect("start = 'abcd'|min..max,'efgh'|  ").to.parseAs(r),expect("start = 'abcd'\n|min..max,'efgh'|").to.parseAs(r),expect("start = 'abcd'|\nmin..max,'efgh'|").to.parseAs(r),expect("start = 'abcd'|min\n..max,'efgh'|").to.parseAs(r),expect("start = 'abcd'|min..\nmax,'efgh'|").to.parseAs(r),expect("start = 'abcd'|min..max\n,'efgh'|").to.parseAs(r),expect("start = 'abcd'|min..max,\n'efgh'|").to.parseAs(r),expect("start = 'abcd'|min..max,'efgh'\n|").to.parseAs(r),r=O({type:"repeated",min:null,max:{type:"variable",value:"exact"},expression:e,delimiter:t}),expect("start = 'abcd'\n|exact,'efgh'|").to.parseAs(r),expect("start = 'abcd'|\nexact,'efgh'|").to.parseAs(r),expect("start = 'abcd'|exact\n,'efgh'|").to.parseAs(r),expect("start = 'abcd'|exact,\n'efgh'|").to.parseAs(r),expect("start = 'abcd'|exact,'efgh'\n|").to.parseAs(r),expect("start = 'abcd'|exact, 'efgh'?|").to.parseAs(O({type:"repeated",min:null,max:{type:"variable",value:"exact"},expression:e,delimiter:{type:"optional",expression:t}}))})),it("with function boundaries",(function(){var r=G("min","max");expect("start = 'abcd'|{min}..{max},'efgh'|  ").to.parseAs(r),expect("start = 'abcd'\n|{min}..{max},'efgh'|").to.parseAs(r),expect("start = 'abcd'|\n{min}..{max},'efgh'|").to.parseAs(r),expect("start = 'abcd'|{min}\n..{max},'efgh'|").to.parseAs(r),expect("start = 'abcd'|{min}..\n{max},'efgh'|").to.parseAs(r),expect("start = 'abcd'|{min}..{max}\n,'efgh'|").to.parseAs(r),expect("start = 'abcd'|{min}..{max},\n'efgh'|").to.parseAs(r),expect("start = 'abcd'|{min}..{max},'efgh'\n|").to.parseAs(r),r=O({type:"repeated",min:null,max:{type:"function",value:"exact"},expression:e,delimiter:t}),expect("start = 'abcd'\n|{exact},'efgh'|").to.parseAs(r),expect("start = 'abcd'|\n{exact},'efgh'|").to.parseAs(r),expect("start = 'abcd'|{exact}\n,'efgh'|").to.parseAs(r),expect("start = 'abcd'|{exact},\n'efgh'|").to.parseAs(r),expect("start = 'abcd'|{exact},'efgh'\n|").to.parseAs(r),expect("start = 'abcd'|{exact}, 'efgh'?|").to.parseAs(O({type:"repeated",min:null,max:{type:"function",value:"exact"},expression:e,delimiter:{type:"optional",expression:t}}))})),it("with mixed boundaries",(function(){var e=q(2,"max");expect("start = 'abcd'|2..max,'efgh'|  ").to.parseAs(e),expect("start = 'abcd'\n|2..max,'efgh'|").to.parseAs(e),expect("start = 'abcd'|\n2..max,'efgh'|").to.parseAs(e),expect("start = 'abcd'|2\n..max,'efgh'|").to.parseAs(e),expect("start = 'abcd'|2..\nmax,'efgh'|").to.parseAs(e),expect("start = 'abcd'|2..max\n,'efgh'|").to.parseAs(e),expect("start = 'abcd'|2..max,\n'efgh'|").to.parseAs(e),expect("start = 'abcd'|2..max,'efgh'\n|").to.parseAs(e),e=q("min",3),expect("start = 'abcd'|min..3,'efgh'|  ").to.parseAs(e),expect("start = 'abcd'\n|min..3,'efgh'|").to.parseAs(e),expect("start = 'abcd'|\nmin..3,'efgh'|").to.parseAs(e),expect("start = 'abcd'|min\n..3,'efgh'|").to.parseAs(e),expect("start = 'abcd'|min..\n3,'efgh'|").to.parseAs(e),expect("start = 'abcd'|min..3\n,'efgh'|").to.parseAs(e),expect("start = 'abcd'|min..3,\n'efgh'|").to.parseAs(e),expect("start = 'abcd'|min..3,'efgh'\n|").to.parseAs(e),e=G(2,"max"),expect("start = 'abcd'|2..{max},'efgh'|  ").to.parseAs(e),expect("start = 'abcd'\n|2..{max},'efgh'|").to.parseAs(e),expect("start = 'abcd'|\n2..{max},'efgh'|").to.parseAs(e),expect("start = 'abcd'|2\n..{max},'efgh'|").to.parseAs(e),expect("start = 'abcd'|2..\n{max},'efgh'|").to.parseAs(e),expect("start = 'abcd'|2..{max}\n,'efgh'|").to.parseAs(e),expect("start = 'abcd'|2..{max},\n'efgh'|").to.parseAs(e),expect("start = 'abcd'|2..{max},'efgh'\n|").to.parseAs(e),e=G("min",3),expect("start = 'abcd'|{min}..3,'efgh'|  ").to.parseAs(e),expect("start = 'abcd'\n|{min}..3,'efgh'|").to.parseAs(e),expect("start = 'abcd'|\n{min}..3,'efgh'|").to.parseAs(e),expect("start = 'abcd'|{min}\n..3,'efgh'|").to.parseAs(e),expect("start = 'abcd'|{min}..\n3,'efgh'|").to.parseAs(e),expect("start = 'abcd'|{min}..3\n,'efgh'|").to.parseAs(e),expect("start = 'abcd'|{min}..3,\n'efgh'|").to.parseAs(e),expect("start = 'abcd'|{min}..3,'efgh'\n|").to.parseAs(e)}))}))})),describe("parses RepeatedOperator",(function(){describe("without delimiter",(function(){it("with constant boundaries",(function(){expect("start = 'abcd'| .. |").to.parseAs(N(0,null)),expect("start = 'abcd'|0.. |").to.parseAs(N(0,null)),expect("start = 'abcd'|1.. |").to.parseAs(N(1,null)),expect("start = 'abcd'|2.. |").to.parseAs(N(2,null)),expect("start = 'abcd'| ..1|").to.parseAs(N(0,1)),expect("start = 'abcd'| ..2|").to.parseAs(N(0,2)),expect("start = 'abcd'|2..2|").to.parseAs(N(2,2)),expect("start = 'abcd'|2..3|").to.parseAs(N(2,3)),expect("start = 'abcd'|3|   ").to.parseAs(O({type:"repeated",min:null,max:{type:"constant",value:3},expression:e,delimiter:null})),expect("start = 'abcd'| ..0|").to.failToParse(),expect("start = 'abcd'|0..0|").to.failToParse(),expect("start = 'abcd'|0|   ").to.failToParse()})),it("with variable boundaries",(function(){expect("start = 'abcd'|min..   |").to.parseAs(N("min",null)),expect("start = 'abcd'|   ..max|").to.parseAs(N(0,"max")),expect("start = 'abcd'|min..max|").to.parseAs(N("min","max")),expect("start = 'abcd'|exact|   ").to.parseAs(O({type:"repeated",min:null,max:{type:"variable",value:"exact"},expression:e,delimiter:null}))})),it("with function boundaries",(function(){expect("start = 'abcd'|{min}..     |").to.parseAs(U("min",null)),expect("start = 'abcd'|     ..{max}|").to.parseAs(U(0,"max")),expect("start = 'abcd'|{min}..{max}|").to.parseAs(U("min","max")),expect("start = 'abcd'|{exact}|     ").to.parseAs(O({type:"repeated",min:null,max:{type:"function",value:"exact"},expression:e,delimiter:null}))})),it("with mixed boundaries",(function(){expect("start = 'abcd'|2..max|").to.parseAs(N(2,"max")),expect("start = 'abcd'|min..3|").to.parseAs(N("min",3)),expect("start = 'abcd'|2..{max}|").to.parseAs(U(2,"max")),expect("start = 'abcd'|{min}..3|").to.parseAs(U("min",3))}))})),describe("with delimiter",(function(){it("with constant boundaries",(function(){expect("start = 'abcd'| .. , 'efgh'|").to.parseAs(q(0,null)),expect("start = 'abcd'|0.. , 'efgh'|").to.parseAs(q(0,null)),expect("start = 'abcd'|1.. , 'efgh'|").to.parseAs(q(1,null)),expect("start = 'abcd'|2.. , 'efgh'|").to.parseAs(q(2,null)),expect("start = 'abcd'| ..1, 'efgh'|").to.parseAs(q(0,1)),expect("start = 'abcd'| ..2, 'efgh'|").to.parseAs(q(0,2)),expect("start = 'abcd'|2..2, 'efgh'|").to.parseAs(q(2,2)),expect("start = 'abcd'|2..3, 'efgh'|").to.parseAs(q(2,3)),expect("start = 'abcd'|3   , 'efgh'|").to.parseAs(O({type:"repeated",min:null,max:{type:"constant",value:3},expression:e,delimiter:t})),expect("start = 'abcd'| ..0, 'efgh'|").to.failToParse(),expect("start = 'abcd'|0..0, 'efgh'|").to.failToParse(),expect("start = 'abcd'|0   , 'efgh'|").to.failToParse()})),it("with variable boundaries",(function(){expect("start = 'abcd'|min..   , 'efgh'|").to.parseAs(q("min",null)),expect("start = 'abcd'|   ..max, 'efgh'|").to.parseAs(q(0,"max")),expect("start = 'abcd'|min..max, 'efgh'|").to.parseAs(q("min","max")),expect("start = 'abcd'|exact, 'efgh'|   ").to.parseAs(O({type:"repeated",min:null,max:{type:"variable",value:"exact"},expression:e,delimiter:t}))})),it("with function boundaries",(function(){expect("start = 'abcd'|{min}..     , 'efgh'|").to.parseAs(G("min",null)),expect("start = 'abcd'|     ..{max}, 'efgh'|").to.parseAs(G(0,"max")),expect("start = 'abcd'|{min}..{max}, 'efgh'|").to.parseAs(G("min","max")),expect("start = 'abcd'|{exact},      'efgh'|").to.parseAs(O({type:"repeated",min:null,max:{type:"function",value:"exact"},expression:e,delimiter:t}))})),it("with mixed boundaries",(function(){expect("start = 'abcd'|2..max, 'efgh'|").to.parseAs(q(2,"max")),expect("start = 'abcd'|min..3, 'efgh'|").to.parseAs(q("min",3)),expect("start = 'abcd'|2..{max}, 'efgh'|").to.parseAs(G(2,"max")),expect("start = 'abcd'|{min}..3, 'efgh'|").to.parseAs(G("min",3))}))}))})),it("parses RuleReferenceExpression",(function(){expect("start = a").to.parseAs(j("a")),expect("start = a\n=").to.failToParse(),expect("start = a\n'abcd'\n=").to.failToParse()})),it("parses SemanticPredicateExpression",(function(){expect("start = !\n{ code }").to.parseAs(O(o))})),it("parses SemanticPredicateOperator",(function(){expect("start = &{ code }").to.parseAs(O(n)),expect("start = !{ code }").to.parseAs(O(o))})),it("parses WhiteSpace",(function(){expect("start =\t'abcd'").to.parseAs(H),expect("start =\v'abcd'").to.parseAs(H),expect("start =\f'abcd'").to.parseAs(H),expect("start = 'abcd'").to.parseAs(H),expect("start = 'abcd'").to.parseAs(H),expect("start =\ufeff'abcd'").to.parseAs(H),expect("start = 'abcd'").to.parseAs(H)})),it("parses LineTerminator",(function(){expect("start = '\n'").to.failToParse(),expect("start = '\r'").to.failToParse(),expect("start = '\u2028'").to.failToParse(),expect("start = '\u2029'").to.failToParse()})),it("parses LineTerminatorSequence",(function(){expect("start =\n'abcd'").to.parseAs(H),expect("start =\r\n'abcd'").to.parseAs(H),expect("start =\r'abcd'").to.parseAs(H),expect("start =\u2028'abcd'").to.parseAs(H),expect("start =\u2029'abcd'").to.parseAs(H)})),it("parses Comment",(function(){expect("start =// comment\n'abcd'").to.parseAs(H),expect("start =/* comment */'abcd'").to.parseAs(H)})),it("parses MultiLineComment",(function(){expect("start =/**/'abcd'").to.parseAs(H),expect("start =/*a*/'abcd'").to.parseAs(H),expect("start =/*abc*/'abcd'").to.parseAs(H),expect("start =/**/*/'abcd'").to.failToParse()})),it("parses MultiLineCommentNoLineTerminator",(function(){expect("a = 'abcd'/**/\r\nb = 'efgh'").to.parseAs(z),expect("a = 'abcd'/*a*/\r\nb = 'efgh'").to.parseAs(z),expect("a = 'abcd'/*abc*/\r\nb = 'efgh'").to.parseAs(z),expect("a = 'abcd'/**/*/\r\nb = 'efgh'").to.failToParse(),expect("a = 'abcd'/*\n*/\r\nb = 'efgh'").to.failToParse()})),it("parses SingleLineComment",(function(){expect("start =//\n'abcd'").to.parseAs(H),expect("start =//a\n'abcd'").to.parseAs(H),expect("start =//abc\n'abcd'").to.parseAs(H),expect("start =//\n@\n'abcd'").to.failToParse()})),it("parses Identifier",(function(){expect("start = a:'abcd'").to.parseAs(O(d))})),it("parses IdentifierName",(function(){expect("start = a").to.parseAs(j("a")),expect("start = ab").to.parseAs(j("ab")),expect("start = abcd").to.parseAs(j("abcd"))})),it("parses IdentifierStart",(function(){expect("start = a").to.parseAs(j("a")),expect("start = $").to.failToParse(),expect("$start = a").to.failToParse(),expect("start = a$b").to.parseAs(j("a$b")),expect("start = _").to.parseAs(j("_")),expect("start = \\u0061").to.parseAs(j("a"))})),it("parses IdentifierPart",(function(){expect("start = aa").to.parseAs(j("aa")),expect("start = à").to.parseAs(j("à")),expect("start = a0").to.parseAs(j("a0")),expect("start = a‿").to.parseAs(j("a‿")),expect("start = a‌").to.parseAs(j("a‌")),expect("start = a‍").to.parseAs(j("a‍"))})),it("parses LiteralMatcher",(function(){expect("start = 'abcd'").to.parseAs(M("abcd",!1)),expect("start = 'abcd'i").to.parseAs(M("abcd",!0))})),it("parses StringLiteral",(function(){expect('start = ""').to.parseAs(M("",!1)),expect('start = "a"').to.parseAs(M("a",!1)),expect('start = "abc"').to.parseAs(M("abc",!1)),expect("start = ''").to.parseAs(M("",!1)),expect("start = 'a'").to.parseAs(M("a",!1)),expect("start = 'abc'").to.parseAs(M("abc",!1))})),it("parses DoubleStringCharacter",(function(){expect('start = "a"').to.parseAs(M("a",!1)),expect('start = "\\n"').to.parseAs(M("\n",!1)),expect('start = "\\\n"').to.parseAs(M("",!1)),expect('start = """').to.failToParse(),expect('start = "\\"').to.failToParse(),expect('start = "\n"').to.failToParse()})),it("parses SingleStringCharacter",(function(){expect("start = 'a'").to.parseAs(M("a",!1)),expect("start = '\\n'").to.parseAs(M("\n",!1)),expect("start = '\\\n'").to.parseAs(M("",!1)),expect("start = '''").to.failToParse(),expect("start = '\\'").to.failToParse(),expect("start = '\n'").to.failToParse()})),it("parses CharacterClassMatcher",(function(){expect("start = []").to.parseAs(D([],!1,!1)),expect("start = [a-d]").to.parseAs(D([["a","d"]],!1,!1)),expect("start = [a]").to.parseAs(D(["a"],!1,!1)),expect("start = [a-de-hi-l]").to.parseAs(D([["a","d"],["e","h"],["i","l"]],!1,!1)),expect("start = [^a-d]").to.parseAs(D([["a","d"]],!0,!1)),expect("start = [a-d]i").to.parseAs(D([["a","d"]],!1,!0)),expect("start = [\\\n]").to.parseAs(D([],!1,!1))})),it("parses ClassCharacterRange",(function(){expect("start = [a-d]").to.parseAs(D([["a","d"]],!1,!1)),expect("start = [a-a]").to.parseAs(D([["a","a"]],!1,!1)),expect("start = [b-a]").to.failToParse({message:"Invalid character range: b-a."})})),it("parses ClassCharacter",(function(){expect("start = [a]").to.parseAs(D(["a"],!1,!1)),expect("start = [\\n]").to.parseAs(D(["\n"],!1,!1)),expect("start = [\\\n]").to.parseAs(D([],!1,!1)),expect("start = []]").to.failToParse(),expect("start = [\\]").to.failToParse(),expect("start = [\n]").to.failToParse()})),it("parses LineContinuation",(function(){expect("start = '\\\r\n'").to.parseAs(M("",!1))})),it("parses EscapeSequence",(function(){expect("start = '\\n'").to.parseAs(M("\n",!1)),expect("start = '\\0'").to.parseAs(M("\0",!1)),expect("start = '\\xFF'").to.parseAs(M("ÿ",!1)),expect("start = '\\uFFFF'").to.parseAs(M("￿",!1)),expect("start = '\\09'").to.failToParse()})),it("parses CharacterEscapeSequence",(function(){expect("start = '\\n'").to.parseAs(M("\n",!1)),expect("start = '\\a'").to.parseAs(M("a",!1))})),it("parses SingleEscapeCharacter",(function(){expect("start = '\\''").to.parseAs(M("'",!1)),expect("start = '\\\"'").to.parseAs(M('"',!1)),expect("start = '\\\\'").to.parseAs(M("\\",!1)),expect("start = '\\b'").to.parseAs(M("\b",!1)),expect("start = '\\f'").to.parseAs(M("\f",!1)),expect("start = '\\n'").to.parseAs(M("\n",!1)),expect("start = '\\r'").to.parseAs(M("\r",!1)),expect("start = '\\t'").to.parseAs(M("\t",!1)),expect("start = '\\v'").to.parseAs(M("\v",!1))})),it("parses NonEscapeCharacter",(function(){expect("start = '\\a'").to.parseAs(M("a",!1))})),it("parses HexEscapeSequence",(function(){expect("start = '\\xFF'").to.parseAs(M("ÿ",!1))})),it("parses UnicodeEscapeSequence",(function(){expect("start = '\\uFFFF'").to.parseAs(M("￿",!1))})),it("parses AnyMatcher",(function(){expect("start = .").to.parseAs(I())})),it("parses CodeBlock",(function(){expect("start = 'abcd' { code }").to.parseAs(B(" code "))})),it("parses Code",(function(){expect("start = 'abcd' {a}").to.parseAs(B("a")),expect("start = 'abcd' {abc}").to.parseAs(B("abc")),expect("start = 'abcd' {{a}}").to.parseAs(B("{a}")),expect("start = 'abcd' {{a}{b}{c}}").to.parseAs(B("{a}{b}{c}")),expect("start = 'abcd' {{}").to.failToParse(),expect("start = 'abcd' {}}").to.failToParse()})),it("parses __",(function(){expect("start ='abcd'").to.parseAs(H),expect("start = 'abcd'").to.parseAs(H),expect("start =\r\n'abcd'").to.parseAs(H),expect("start =/* comment */'abcd'").to.parseAs(H),expect("start =   'abcd'").to.parseAs(H)})),it("parses _",(function(){expect("a = 'abcd'\r\nb = 'efgh'").to.parseAs(z),expect("a = 'abcd' \r\nb = 'efgh'").to.parseAs(z),expect("a = 'abcd'/* comment */\r\nb = 'efgh'").to.parseAs(z),expect("a = 'abcd'   \r\nb = 'efgh'").to.parseAs(z)})),it("parses EOS",(function(){expect("a = 'abcd'\n;b = 'efgh'").to.parseAs(z),expect("a = 'abcd' \r\nb = 'efgh'").to.parseAs(z),expect("a = 'abcd' // comment\r\nb = 'efgh'").to.parseAs(z),expect("a = 'abcd'\nb = 'efgh'").to.parseAs(z)})),it("parses EOF",(function(){expect("start = 'abcd'\n").to.parseAs(H)})),it("generates codeLocation / nameLocation / labelLocation",(function(){var e=parser.parse("\n{{\n  const foo = 12;\n}}\n{\n  const bar = 13;\n}\na = label:'abcd' &{ return true; } !{ return false; } { return 'so true'; }\nb = @LABEL:'efgh'\nc = @'ijkl'\n");expect(e).to.eql({type:"grammar",imports:[],topLevelInitializer:{type:"top_level_initializer",code:"\n  const foo = 12;\n",codeLocation:{source:void 0,start:{offset:3,line:2,column:3},end:{offset:22,line:4,column:1}},location:{source:void 0,start:{offset:1,line:2,column:1},end:{offset:25,line:5,column:1}}},initializer:{type:"initializer",code:"\n  const bar = 13;\n",codeLocation:{source:void 0,start:{offset:26,line:5,column:2},end:{offset:45,line:7,column:1}},location:{source:void 0,start:{offset:25,line:5,column:1},end:{offset:47,line:8,column:1}}},rules:[{type:"rule",name:"a",nameLocation:{source:void 0,start:{offset:47,line:8,column:1},end:{offset:48,line:8,column:2}},expression:{type:"action",expression:{type:"sequence",elements:[{type:"labeled",label:"label",labelLocation:{source:void 0,start:{offset:51,line:8,column:5},end:{offset:56,line:8,column:10}},expression:{type:"literal",value:"abcd",ignoreCase:!1,location:{source:void 0,start:{offset:57,line:8,column:11},end:{offset:63,line:8,column:17}}},location:{source:void 0,start:{offset:51,line:8,column:5},end:{offset:63,line:8,column:17}}},{type:"semantic_and",code:" return true; ",codeLocation:{source:void 0,start:{offset:66,line:8,column:20},end:{offset:80,line:8,column:34}},location:{source:void 0,start:{offset:64,line:8,column:18},end:{offset:81,line:8,column:35}}},{type:"semantic_not",code:" return false; ",codeLocation:{source:void 0,start:{offset:84,line:8,column:38},end:{offset:99,line:8,column:53}},location:{source:void 0,start:{offset:82,line:8,column:36},end:{offset:100,line:8,column:54}}}],location:{source:void 0,start:{offset:51,line:8,column:5},end:{offset:100,line:8,column:54}}},code:" return 'so true'; ",codeLocation:{source:void 0,start:{offset:102,line:8,column:56},end:{offset:121,line:8,column:75}},location:{source:void 0,start:{offset:51,line:8,column:5},end:{offset:122,line:8,column:76}}},location:{source:void 0,start:{offset:47,line:8,column:1},end:{offset:123,line:9,column:1}}},{type:"rule",name:"b",nameLocation:{source:void 0,start:{offset:123,line:9,column:1},end:{offset:124,line:9,column:2}},expression:{type:"sequence",elements:[{type:"labeled",label:"LABEL",labelLocation:{source:void 0,start:{offset:128,line:9,column:6},end:{offset:133,line:9,column:11}},pick:!0,expression:{type:"literal",value:"efgh",ignoreCase:!1,location:{source:void 0,start:{offset:134,line:9,column:12},end:{offset:140,line:9,column:18}}},location:{source:void 0,start:{offset:127,line:9,column:5},end:{offset:140,line:9,column:18}}}],location:{source:void 0,start:{offset:127,line:9,column:5},end:{offset:140,line:9,column:18}}},location:{source:void 0,start:{offset:123,line:9,column:1},end:{offset:141,line:10,column:1}}},{type:"rule",name:"c",nameLocation:{source:void 0,start:{offset:141,line:10,column:1},end:{offset:142,line:10,column:2}},expression:{type:"sequence",elements:[{type:"labeled",label:null,labelLocation:{source:void 0,start:{offset:145,line:10,column:5},end:{offset:146,line:10,column:6}},pick:!0,expression:{type:"literal",value:"ijkl",ignoreCase:!1,location:{source:void 0,start:{offset:146,line:10,column:6},end:{offset:152,line:10,column:12}}},location:{source:void 0,start:{offset:145,line:10,column:5},end:{offset:152,line:10,column:12}}}],location:{source:void 0,start:{offset:145,line:10,column:5},end:{offset:152,line:10,column:12}}},location:{source:void 0,start:{offset:141,line:10,column:1},end:{offset:153,line:11,column:1}}}],location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:153,line:11,column:1}}})}))}))}));